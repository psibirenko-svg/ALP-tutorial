Pavel Sibirenko
# 1 –º–µ—Å—è—Ü
## 1 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è–¥—Ä–∞ —Å–∏—Å—Ç–µ–º—ã"</ins>

–¶–µ–ª—å: –Ω–∞—É—á–∏—Ç—å—Å—è –æ–±–Ω–æ–≤–ª—è—Ç—å —è–¥—Ä–æ –≤ –û–° Linux;

üéØ**–ó–∞–¥–∞–Ω–∏–µ
1.–ó–∞–ø—É—Å—Ç–∏—Ç–µ –í–ú c Ubuntu.
2.–û–±–Ω–æ–≤–∏—Ç–µ —è–¥—Ä–æ –û–° –Ω–∞ –Ω–æ–≤–µ–π—à—É—é —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –∏–∑ mainline-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
3.–û—Ñ–æ—Ä–º–∏—Ç–µ –æ—Ç—á–µ—Ç –≤ README-—Ñ–∞–π–ª–µ –≤ GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.**
<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Ubuntu
- –í Ubuntu –≤—Å—ë –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —á–µ—Ç—ã—Ä–µ —Å–µ–∫—Ü–∏–∏, –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏,
 —á—Ç–æ–±—ã –æ—Ç—Ä–∞–∑–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –≤ –ª–∏—Ü–µ–Ω–∑–∏–∏ –∏ —É—Ä–æ–≤–Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.
- –ü–∞–∫–µ—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:
- Main ‚Äì —Å–≤–æ–±–æ–¥–Ω–æ–µ –ü–û, –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ –∫–æ–º–ø–∞–Ω–∏–µ–π Canonical. 
- Restricted ‚Äì –ø—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–æ–µ –ü–û (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º ‚Äî –¥—Ä–∞–π–≤–µ—Ä—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤), –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ –∫–æ–º–ø–∞–Ω–∏–µ–π Canonical. 
- Universe ‚Äì —Å–≤–æ–±–æ–¥–Ω–æ–µ –ü–û, –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ –∫–æ–º–ø–∞–Ω–∏–µ–π Canonical (–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π). 
- Multiverse ‚Äì –ø—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–æ–µ –ü–û, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ –∫–æ–º–ø–∞–Ω–∏–µ–π Canonical. 
 
- –°—É—â–µ—Å—Ç–≤—É–µ—Ç —á–µ—Ç—ã—Ä–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Ubuntu.
- $release1) ‚Äì —ç—Ç–æ –ø–∞–∫–µ—Ç—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∞ —Ä–µ–ª–∏–∑–∞. 
- $release-security ‚Äì –ø–∞–∫–µ—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. 
- $release-updates ‚Äì –ø–∞–∫–µ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã (—Ç.–µ. –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ü–û, –≤—ã—à–µ–¥—à–∏–µ —É–∂–µ –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞). 
- $release-backports ‚Äì –±—ç–∫–ø–æ—Ä—Ç—ã –±–æ–ª–µ–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –ü–û, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Ubuntu. 
- partner ‚Äì —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—â–∏–π –ü–û –∫–æ–º–ø–∞–Ω–∏–π-–ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ Canonical.
  
- –ö—Ä–æ–º–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –æ—Ç –∞–≤—Ç–æ—Ä–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º –∏ –æ—Ç —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –ø–æ–ª–µ–Ω–∏–ª—Å—è —Å–æ–±—Ä–∞—Ç—å –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –ø–∞–∫–µ—Ç –∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –∏–º —Å –¥—Ä—É–≥–∏–º–∏. Launchpad –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å PPA-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Äî Personal Package Archive, –æ–±—ã—á–Ω–æ –Ω–µ–±–æ–ª—å—à–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ —Ö–æ–∑—è–∏–Ω —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫–∏, –∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—É—á–∞—é—Ç —É–∂–µ –≥–æ—Ç–æ–≤—ã–π deb-–ø–∞–∫–µ—Ç.
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Ubuntu —Å–æ–¥–µ—Ä–∂–∞—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º, –æ–¥–Ω–∞–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö Ubuntu, –∏ –≤–æ–∑–º–æ–∂–Ω–æ, –í—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–≥–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –ø–æ–¥–∫–ª—é—á–∏–≤ –∫–æ—Ç–æ—Ä—ã–µ –í—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º—É –ü–û. –°–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ –∫–∞–∫ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Ç–∞–∫ –∏ –≤ –∫–æ–Ω—Å–æ–ª–∏.
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–æ–º–∏–º–æ –Ω—É–∂–Ω—ã—Ö –í–∞–º –ø–∞–∫–µ—Ç–æ–≤ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–±–æ—Ä–∫–∏ —Ä–∞–∑–ª–∏—á–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ü–û, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∏ —è–¥–µ—Ä linux. –¢.–∫. –≤–µ—Ä—Å–∏—è —ç—Ç–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –≤—ã—à–µ, —á–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —É –í–∞—Å, –ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è ¬´–æ–±–Ω–æ–≤–∏—Ç—å¬ª —Å–∏—Å—Ç–µ–º—É —Å —ç—Ç–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, —á—Ç–æ –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç –ø–æ–≤—Ä–µ–¥–∏—Ç—å –í–∞—à—É —Å–∏—Å—Ç–µ–º—É. –ü–æ—ç—Ç–æ–º—É –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–∞–µ–º–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ú–µ–Ω–µ–¥–∂–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

- –ß—Ç–æ —Ç–∞–∫–æ–µ mainline-—è–¥—Ä–æ

- Ubuntu –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–¥—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è Canonical (–æ–±—ã—á–Ω–æ LTS + security-patches).
- –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —è–¥—Ä–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ ¬´–∂–µ–ª–µ–∑–∞¬ª –∏–ª–∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤).
- –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Ubuntu Mainline Kernel ‚Äî —Ç–∞–º –≤—ã–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –ø–∞–∫–µ—Ç—ã —Å ¬´—á–∏—Å—Ç—ã–º–∏¬ª —è–¥—Ä–∞–º–∏ –æ—Ç kernel.org, —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥ Ubuntu.
 
- –ï—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –æ–±–Ω–æ–≤–∏—Ç—å —è–¥—Ä–æ: –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É mainline.

- **1. –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞**
- –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:‚Ä® https://kernel.ubuntu.com/mainline/
- –í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, v6.12.41/).
- –°–∫–∞—á–∞–π—Ç–µ .deb –ø–∞–∫–µ—Ç—ã –¥–ª—è —Å–≤–æ–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–æ–±—ã—á–Ω–æ amd64):
- linux-headers-...all.deb
- linux-headers-...amd64.deb
- linux-image-unsigned-...amd64.deb
- linux-modules-...amd64.deb
  
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏—Ö:

- sudo dpkg -i *.deb
  
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —Å –Ω–æ–≤—ã–º —è–¥—Ä–æ–º.

- **2. –° –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã mainline (—É–¥–æ–±–Ω–µ–µ)**
- –ï—Å—Ç—å GUI/CLI-–ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è mainline-—è–¥—Ä–∞–º–∏.

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞:

- sudo add-apt-repository ppa:cappelikan/ppa
- sudo apt update
- sudo apt install mainline
   
–ó–∞–ø—É—Å–∫:

- mainline --list   # —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —è–¥–µ—Ä
- mainline --install 6.10.5   # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–¥—Ä–∞

- **–í–∞–∂–Ω–æ**
- Mainline-—è–¥—Ä–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è Canonical –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ, –∏—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç ¬´–Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫¬ª.
- –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, –≤—Å–µ–≥–¥–∞  –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ —è–¥—Ä–∞ (–æ–Ω–æ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –º–µ–Ω—é GRUB).*
</details>

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:**
- spg@ol-alp-ubuntu1:~$ uname -r
- 6.8.0-79-generic
- spg@ol-alp-ubuntu1:~$ cat /proc/version
- Linux version 6.8.0-79-generic (buildd@lcy02-amd64-049) (x86_64-linux-gnu-gcc-13 (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #79-Ubuntu SMP PREEMPT_DYNAMIC Tue Aug 12 14:42:46 UTC 2025
- spg@ol-alp-ubuntu1:~$ sudo add-apt-repository ppa:cappelikan/ppa
- spg@ol-alp-ubuntu1:~$ sudo su
- root@ol-alp-ubuntu1:/home/spg#
- apt update
- Scanning linux images...

- Running kernel seems to be up-to-date.
- mainline --list
- mainline 1.4.13
- Notice: "--list" has been renamed to "list"
- Updating Kernels...
- -----------------------
- Available Kernels...
- -----------------------
- 6.16.4
- 6.16.3
- 6.16.2
- 6.16.1
- 6.16
- 6.15.11
-  ...
- mainline --install 6.10.5
- mainline 1.4.13
Notice: "--install" has been renamed to "install"
Updating Kernels...
Downloading 6.10.5
Installing 6.10.5
sh: 1: pkexec: not found
- spg@ol-alp-ubuntu1:~$ sudo apt update
- sudo apt install policykit-1
- sudo su
- mainline --install 6.10.5
- ...update-initramfs:
-  Generating /boot/initrd.img-6.10.5-061005-generic...
- reboot
- spg@ol-alp-ubuntu1:~$ uname -r
- 6.10.5-061005-generic

## 2 –£—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ**
<ins>–†–∞–±–æ—Ç–∞ —Å mdadm</ins>

**–¶–µ–ª—å:** –Ω–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º–∏ RAID-–º–∞—Å—Å–∏–≤–∞–º–∏ –≤ Linux;

üéØ**–ó–∞–¥–∞–Ω–∏–µ
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –í–ú c Ubuntu.
 –î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Å–∫–æ–≤
‚Ä¢	–°–æ–±–µ—Ä–∏—Ç–µ RAID-0/1/5/10 –Ω–∞ –≤—ã–±–æ—Ä
‚Ä¢	–°–ª–æ–º–∞–π—Ç–µ –∏ –ø–æ—á–∏–Ω–∏—Ç–µ RAID
‚Ä¢	–°–æ–∑–¥–∞–π—Ç–µ GPT —Ç–∞–±–ª–∏—Ü—É, –ø—è—Ç—å —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏—Ö –≤ —Å–∏—Å—Ç–µ–º–µ.**

<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
  mdadm ‚Äî —ç—Ç–æ —É—Ç–∏–ª–∏—Ç–∞ –≤ Linux –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º–∏ RAID-–º–∞—Å—Å–∏–≤–∞–º–∏ (software RAID). –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å, —É–ø—Ä–∞–≤–ª—è—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å RAID –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–°, –±–µ–∑ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.

üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ mdadm
	‚Ä¢	–°–æ–∑–¥–∞–Ω–∏–µ RAID-–º–∞—Å—Å–∏–≤–æ–≤ (0, 1, 4, 5, 6, 10 –∏ –¥—Ä.).
	‚Ä¢	–î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤.
	‚Ä¢	–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –ø–æ—Å–ª–µ —Å–±–æ—è.
	‚Ä¢	–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è RAID.
	‚Ä¢	–°–±–æ—Ä–∫–∞ –º–∞—Å—Å–∏–≤–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã.
 
üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã
- cat /proc/mdstat
2. –°–æ–∑–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä RAID1 –∏–∑ 2 –¥–∏—Å–∫–æ–≤)
  - sudo mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/sdb /dev/sdc
  - /dev/md0 ‚Äî –∏–º—è RAID-–º–∞—Å—Å–∏–≤–∞
  - --level=1 ‚Äî —Ç–∏–ø RAID (–∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - --raid-devices=2 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏—Å–∫–æ–≤
/dev/sdb /dev/sdc ‚Äî —Å–∞–º–∏ –¥–∏—Å–∫–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞
- sudo mdadm --detail /dev/md0
4. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–∏—Å–∫ –≤ –º–∞—Å—Å–∏–≤
- sudo mdadm --add /dev/md0 /dev/sdd
5. –£–¥–∞–ª–∏—Ç—å –¥–∏—Å–∫ –∏–∑ –º–∞—Å—Å–∏–≤–∞
  - sudo mdadm --remove /dev/md0 /dev/sdb
6. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞—Å—Å–∏–≤
- sudo mdadm --stop /dev/md0
  
üîπ –ê–≤—Ç–æ—Å–±–æ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
–ß—Ç–æ–±—ã RAID –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–ª—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:
- sudo mdadm --detail --scan >> /etc/mdadm/mdadm.conf
  
‚ö†Ô∏è –í–∞–∂–Ω–æ:
	‚Ä¢	–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ—á–∏—Å—Ç–∏ –¥–∏—Å–∫–∏ –æ—Ç —Å—Ç–∞—Ä—ã—Ö RAID-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:
- sudo mdadm --zero-superblock /dev/sdX
- **–ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ/–ø—É—Å—Ç—ã–µ –¥–∏—Å–∫–∏, –∏–Ω–∞—á–µ –ø–æ—Ç–µ—Ä—è–µ—à—å –¥–∞–Ω–Ω—ã–µ.**
- –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤ –Ω—É–∂–Ω–æ –µ—â—ë –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤ ext4).

**–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ—Å–±–æ—Ä–∫—É RAID –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ (mdadm)**
	1.	–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ RAID —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å‚Ä®‚Ä®
- cat /proc/mdstat
- –¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–π –º–∞—Å—Å–∏–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- md0 : active raid1 sdb1[0] sdc1[1]
	2.	–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ mdadm.conf —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞
- –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥ RAID:
- sudo mdadm --detail --scan >> /etc/mdadm/mdadm.conf
- –ü—Ä–æ–≤–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:
- cat /etc/mdadm/mdadm.conf
- –¢–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ –≤—Ä–æ–¥–µ:
- ARRAY /dev/md0 metadata=1.2 name=server:0 UUID=xxxxxxxx:yyyyyyyy:zzzzzzzz
	3. –û–±–Ω–æ–≤–∏—Ç—å initramfs (—á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–ª–∞ RAID –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)
- –î–ª—è Debian/Ubuntu:
- sudo update-initramfs -u
- –î–ª—è CentOS/RHEL:
- sudo dracut -H -f /boot/initramfs-$(uname -r).img $(uname -r)
	4. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ fstab (–µ—Å–ª–∏ –º–∞—Å—Å–∏–≤ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è)
- –£–∑–Ω–∞–π UUID —Ä–∞–∑–¥–µ–ª–∞:
- sudo blkid /dev/md0
- –î–æ–ø—É—Å—Ç–∏–º, UUID=1111-2222
- –¢–æ–≥–¥–∞ –¥–æ–±–∞–≤—å –≤ /etc/fstab —Å—Ç—Ä–æ–∫—É:
- UUID=1111-2222   /mnt/raid   ext4   defaults   0   0
- (–∑–∞–º–µ–Ω–∏ ext4 –Ω–∞ —Ç–≤–æ—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏ /mnt/raid –Ω–∞ —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è).
	5. –ü—Ä–æ–≤–µ—Ä–∫–∞
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å–µ—Ä–≤–µ—Ä.
- –í—ã–ø–æ–ª–Ω–∏:
- cat /proc/mdstat
- RAID –¥–æ–ª–∂–µ–Ω —Å–æ–±—Ä–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞:
- df -h
- ‚ö° –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã
- –ï—Å–ª–∏ –æ–¥–∏–Ω –¥–∏—Å–∫ –≤—ã–π–¥–µ—Ç –∏–∑ —Å—Ç—Ä–æ—è, –º–∞—Å—Å–∏–≤ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è, –Ω–æ –≤ degraded-—Å–æ—Å—Ç–æ—è–Ω–∏–∏.
- –ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏—Å—ã–ª–∞–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö, –≤ mdadm.conf  –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å email-–æ–ø–æ–≤–µ—â–µ–Ω–∏—è:‚Ä®‚Ä®
</details>

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:**

- –î–æ–±–∞–≤–ª–µ–Ω–æ 2 –¥–∏—Å–∫–∞ –ø–æ 25–ì–ë.
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞ –º–∞—à–∏–Ω–∞
- **root@ol-alp-ubuntu1:/home/spg#fdisk -l**
- **Disk /dev/sda: 30 GiB**, 32212254720 bytes, 62914560 sectors
- Disk model: Virtual disk
- Units: sectors of 1 * 512 = 512 bytes
- Sector size (logical/physical): 512 bytes / 512 bytes
- I/O size (minimum/optimal): 512 bytes / 512 bytes
- Disklabel type: gpt
- Disk identifier: 8D9F226A-26B4-4BCB-B1D9-1A25308F5904

 -Device       Start      End  Sectors Size Type
 -/dev/sda1     2048     4095     2048   1M BIOS boot
 -/dev/sda2     4096  4198399  4194304   2G Linux filesystem
 -/dev/sda3  4198400 62912511 58714112  28G Linux filesystem


- **Disk /dev/sdb: 25 GiB**, 26843545600 bytes, 52428800 sectors
- Disk model: Virtual disk
- Units: sectors of 1 * 512 = 512 bytes
 -Sector size (logical/physical): 512 bytes / 512 bytes
 -I/O size (minimum/optimal): 512 bytes / 512 bytes


- **Disk /dev/sdc: 25 GiB**, 26843545600 bytes, 52428800 sectors
- Disk model: Virtual disk
- Units: sectors of 1 * 512 = 512 bytes
- Sector size (logical/physical): 512 bytes / 512 bytes
- I/O size (minimum/optimal): 512 bytes / 512 bytes

- **root@ol-alp-ubuntu1:/home/spg# mdadm --zero-superblock --force /dev/sd{b,c}** # –æ–±–Ω—É–ª—è–µ–º —Å—É–ø–µ—Ä–±—é–ª–æ–∫–∏
- mdadm: Unrecognised md component device - /dev/sdb
- mdadm: Unrecognised md component device - /dev/sdc

- **root@ol-alp-ubuntu1:/home/spg# mdadm --create --verbose /dev/md0 -l 1 -n 2 /dev/sd{b,c}** # –°–æ–∑–¥–∞–µ–º RAID1 –∏–∑ –¥–≤—É—Ö –Ω–∞—à–∏—Ö –¥–∏—Å–∫–æ–≤
- mdadm: Note: this array has metadata at the start and
-    may not be suitable as a boot device.  If you plan to
-    store '/boot' on this device please ensure that
-    your boot-loader understands md/v1.x metadata, or use
-    --metadata=0.90
- mdadm: size set to 26196992K
- Continue creating array? y
- mdadm: Defaulting to version 1.2 metadata
- mdadm: **array /dev/md0 started**.
- **root@ol-alp-ubuntu1:/home/spg# cat /proc/mdstat** # –ø—Ä–æ–≤–µ—Ä–∫–∞ RAID
- Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]
- md0 : active raid1 sdc[1] sdb[0]
- 26196992 blocks super 1.2 [2/2] [UU]
- [===================>.]  resync = 96.9% (25406848/26196992) finish=0.0min speed=206724K/sec
-
- unused devices: <none>
- **root@ol-alp-ubuntu1:/home/spg# mdadm -D /dev/md0**
- /dev/md0:
- Version : 1.2
- Creation Time : Mon Sep  8 12:30:54 2025
- Raid Level : raid1
- Array Size : 26196992 (24.98 GiB 26.83 GB)
- Used Dev Size : 26196992 (24.98 GiB 26.83 GB)
- Raid Devices : 2
- Total Devices : 2
- Persistence : Superblock is persistent
- Update Time : Mon Sep  8 12:33:04 2025
- State : clean
- Active Devices : 2
- Working Devices : 2
- Failed Devices : 0
- Spare Devices : 0
- Consistency Policy : resync
- Name : ol-alp-ubuntu1:0  (local to host ol-alp-ubuntu1)
- UUID : fb759b8b:cfc4115e:f806dd32:0d7e6930
- Events : 17
- Number   Major   Minor   RaidDevice State
- 	0       8       16        0      active sync   /dev/sdb
- 	1       8       32        1      active sync   /dev/sdc
- **root@ol-alp-ubuntu1:/home/spg# mdadm /dev/md0 --fail /dev/sdc** # "–ª–æ–º–∞–µ–º" –¥–∏—Å–∫ 1 –≤ RAID-–µ md0
- mdadm: set /dev/sdc faulty in /dev/md0
- **root@ol-alp-ubuntu1:/home/spg#mdadm -D /dev/md0** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- Number   Major   Minor   RaidDevice State
- 0       8       16        0      active sync   /dev/sdb
- 0        0        1      removed
- 1       8       32        -      faulty   /dev/sdc
- **root@ol-alp-ubuntu1:/home/spg# mdadm /dev/md0 --remove /dev/sdc** # —É–¥–∞–ª—è–µ–º "—Å–ª–æ–º–∞–Ω–Ω—ã–π –¥–∏—Å–∫" –∏–∑ –º–∞—Å—Å–∏–≤–∞ md0
- mdadm: hot removed /dev/sdc from /dev/md0
- "–∑–∞–º–µ–Ω–∏–ª–∏" –¥–∏—Å–∫ –Ω–∞ –Ω–æ–≤—ã–π (**–ù—É–∂–Ω–æ –ª–∏ –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º, —á—Ç–æ –Ω–∞ –Ω–æ–≤–æ–º –Ω–µ—Ç –Ω–∏–∫–∞–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ä–µ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ md0?**)
- **root@ol-alp-ubuntu1:/home/spg# mdadm /dev/md0 --add /dev/sdc** # –¥–æ–±–∞–≤–ª—è–µ–º "–Ω–æ–≤—ã–π –∏—Å–ø—Ä–∞–≤–Ω—ã–π" –¥–∏—Å–∫ –≤ –Ω–∞—à –º–∞—Å—Å–∏–≤
mdadm: added /dev/sdc
- **root@ol-alp-ubuntu1:/home/spg# cat /proc/mdstat** # –ü—Ä–æ—Ü–µ—Å—Å rebuild-–∞
- Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]
- md0 : active raid1 sdc[2] sdb[0]
- 26196992 blocks super 1.2 **[2/1] [U_]**
- [=======>.............]  recovery = **36.8%** (9652352/26196992) finish=1.3min speed=206294K/sec
- **root@ol-alp-ubuntu1:/home/spg# cat /proc/mdstat**
- Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]
- md0 : active raid1 sdc[2] sdb[0]
- 26196992 blocks super 1.2 **[2/1] [U_]**
- [=============>.......]  recovery = **68.3%** (17907840/26196992) finish=0.6min speed=200041K/sec
- unused devices: <none>
- **root@ol-alp-ubuntu1:/home/spg# cat /proc/mdstat**
- Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]
- md0 : active raid1 sdc[2] sdb[0]
- 26196992 blocks super 1.2 **[2/2] [UU]** # –ì–æ—Ç–æ–≤–æ!
- unused devices: <none>
- parted -s /dev/md0 mklabel gpt

  
- **root@ol-alp-ubuntu1:/home/spg# fdisk /dev/md0**

- Welcome to fdisk (util-linux 2.39.3).
- Changes will remain in memory only, until you decide to write them.
- Be careful before using the write command.

- Command (m for help): **p** # –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–¥–µ–ª–æ–≤
- Disk /dev/md0: 24.98 GiB, 26825719808 bytes, 52393984 sectors
- Units: sectors of 1 * 512 = 512 bytes
- Sector size (logical/physical): 512 bytes / 512 bytes
- I/O size (minimum/optimal): 512 bytes / 512 bytes
- Disklabel type: gpt
- Disk identifier: 590C44E9-EC0D-4A26-BC53-E5775ACF2E02 

- Device     Start      End  Sectors Size Type
- /dev/md0p1  2048 10479615 10477568   5G Linux filesystem

- Command (m for help): **d** # —É–¥–∞–ª—è–µ–º —Ä–∞–∑–¥–µ–ª md0p1
- Selected partition 1
- Partition 1 has been deleted.

- Command (m for help): **p** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- Disk /dev/md0: 24.98 GiB, 26825719808 bytes, 52393984 sectors
- Units: sectors of 1 * 512 = 512 bytes
- Sector size (logical/physical): 512 bytes / 512 bytes
- I/O size (minimum/optimal): 512 bytes / 512 bytes
- Disklabel type: gpt
- Disk identifier: 590C44E9-EC0D-4A26-BC53-E5775ACF2E02

- Command (m for help): **quit**

- **root@ol-alp-ubuntu1:/home/spg# parted -s /dev/md0 mklabel gpt** #—Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–¥–µ–ª–æ–≤ GPT
- **root@ol-alp-ubuntu1:/home/spg# parted /dev/md0 mkpart primary ext4 0% 20%**
- **root@ol-alp-ubuntu1:/home/spg# parted /dev/md0 mkpart primary ext4 20% 40%**
- **root@ol-alp-ubuntu1:/home/spg# parted /dev/md0 mkpart primary ext4 40% 60%**
- **root@ol-alp-ubuntu1:/home/spg# parted /dev/md0 mkpart primary ext4 60% 80%**
- **root@ol-alp-ubuntu1:/home/spg# parted /dev/md0 mkpart primary ext4 80% 1000%**



- Information: You may need to update /etc/fstab.

- **root@ol-alp-ubuntu1:/home/spg# parted /dev/md0** # –ø—Ä–æ–≤–µ—Ä—è–µ–º

- GNU Parted 3.6
- Using /dev/md0
- Welcome to GNU Parted! Type 'help' to view a list of commands.
- (parted) mklabel gpt
- Warning: The existing disk label on /dev/md0 will be destroyed and all data on this disk will be lost. Do you
- want to continue?
- Yes/No? **Y**
- (parted) **print**
- Model: Linux Software RAID Array (md)
- Disk /dev/md0: 26.8GB
- Sector size (logical/physical): 512B/512B
- Partition Table: gpt
- Disk Flags:

- Number  Start  End  Size  File system  Name  Flags

- (parted) **mkpart primary ext4 0% 20%**
- (parted) **mkpart primary ext4 20% 40%**
- (parted) **mkpart primary ext4 40% 60%**
- (parted) **mkpart primary ext4 60% 80%**
- (parted) **mkpart primary ext4 80% 100%**
- (parted) **print**
- Model: Linux Software RAID Array (md)
- Disk /dev/md0: 26.8GB
- Sector size (logical/physical): 512B/512B
- Partition Table: gpt
- Disk Flags:

- Number  Start   End     Size    File system  Name     Flags
- 1      1049kB  5366MB  5365MB  ext4         primary
- 2      5366MB  10.7GB  5365MB  ext4         primary
- 3      10.7GB  16.1GB  5366MB  ext4         primary
- 4      16.1GB  21.5GB  5365MB  ext4         primary
- 5      21.5GB  26.8GB  5365MB  ext4         primary

- (parted) **quit**
- Information: You may need to update /etc/fstab.

- **root@ol-alp-ubuntu1:/home/spg# for i in $(seq 1 5); do sudo mkfs.ext4 /dev/md0p$i; done** # —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–¥–µ–ª—ã –≤ ext4
- mke2fs 1.47.0 (5-Feb-2023)
- Creating filesystem with 1309696 4k blocks and 327680 inodes
- Filesystem UUID: 92eca3f1-12d7-49ce-be6a-733e609bb7d7
- Superblock backups stored on blocks:
- 32768, 98304, 163840, 229376, 294912, 819200, 884736

- Allocating group tables: done
- Writing inode tables: done
- Creating journal (16384 blocks): done
- Writing superblocks and filesystem accounting information: done

- mke2fs 1.47.0 (5-Feb-2023)
- Creating filesystem with 1309696 4k blocks and 327680 inodes
- Filesystem UUID: 6f5c3479-02a4-4ed2-a7aa-026f09ccef68
- Superblock backups stored on blocks:
- 32768, 98304, 163840, 229376, 294912, 819200, 884736

- Allocating group tables: done
- Writing inode tables: done
- Creating journal (16384 blocks): done
- Writing superblocks and filesystem accounting information: done
 
- mke2fs 1.47.0 (5-Feb-2023)
- Creating filesystem with 1309952 4k blocks and 327680 inodes
- Filesystem UUID: 5c870d58-bc00-444b-a417-c5c5d1282f7b
- Superblock backups stored on blocks:
- 32768, 98304, 163840, 229376, 294912, 819200, 884736

- Allocating group tables: done
- Writing inode tables: done
- Creating journal (16384 blocks): done
- Writing superblocks and filesystem accounting information: done
- **root@ol-alp-ubuntu1:/home/spg# vi /etc/fstab** # –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –û–°
- dev/disk/by-uuid/92eca3f1-12d7-49ce-be6a-733e609bb7d7 /mnt/raid/part1 ext4 defaults 0 0
- /dev/disk/by-uuid/6f5c3479-02a4-4ed2-a7aa-026f09ccef68 /mnt/raid/part2 ext4 defaults 0 0
- /dev/disk/by-uuid/5c870d58-bc00-444b-a417-c5c5d1282f7b /mnt/raid/part3 ext4 defaults 0 0
- /dev/disk/by-uuid/f93c1908-34a8-46af-90d5-16822484d597 /mnt/raid/part4 ext4 defaults 0 0
- /dev/disk/by-uuid/353739df-06c1-4c27-bd64-e42ee243599c /mnt/raid/part5 ext4 defaults 0 0

- **root@ol-alp-ubuntu1:/home/spg# reboot** # –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º –û–° –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º
- **spg@ol-alp-ubuntu1:~$ df -k**
- Filesystem                        1K-blocks    Used Available Use% Mounted on
- tmpfs                                201536    1188    200348   1% /run
- /dev/mapper/ubuntu--vg-ubuntu--lv  14339080 5001468   8587432  37% /
- tmpfs                               1007672       0   1007672   0% /dev/shm
- tmpfs                                  5120       0      5120   0% /run/lock
- **/dev/md127p3**                       5071520      24   4793124   1% /mnt/raid/part3
- **/dev/md127p4**                        5070496      24   4792152   1% /mnt/raid/part4
- **/dev/md127p1**                        5070496      24   4792152   1% /mnt/raid/part1
- **/dev/md127p2**                        5070496      24   4792152   1% /mnt/raid/part2
- **/dev/md127p5**                        5070496      24   4792152   1% /mnt/raid/part5
- /dev/sda2                           1992552  101928   1769384   6% /boot
- tmpfs                                201532      16    201516   1% /run/user/1000
  
- **root@ol-alp-ubuntu1:/# ls -hal /mnt/raid**
- total 28K
- drwxr-xr-x 7 root root 4.0K Sep  8 13:31 .
- drwxr-xr-x 3 root root 4.0K Sep  8 13:31 ..
- drwxr-xr-x 4 root root 4.0K Sep  9 11:40 part1
- drwxr-xr-x 3 root root 4.0K Sep  8 13:19 part2
- drwxr-xr-x 3 root root 4.0K Sep  8 13:19 part3
- drwxr-xr-x 3 root root 4.0K Sep  8 13:19 part4
- drwxr-xr-x 3 root root 4.0K Sep  8 13:19 part5

  
## 3 –∏ 4 –£—Ä–æ–∫

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ**
<ins>–†–∞–±–æ—Ç–∞ —Å LVM</ins>

**–¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ —Ç–æ–º–∞–º–∏ –≤ LVM;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç–µ LVM –≤ Ubuntu 24.04 Server
2. –°–æ–∑–¥–∞–π—Ç–µ Physical Volume, Volume Group –∏ Logical Volume
3. –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
4. –†–∞—Å—à–∏—Ä—å—Ç–µ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∑–∞ —Å—á—ë—Ç –Ω–æ–≤–æ–≥–æ –¥–∏—Å–∫–∞
5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ resize
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã**

<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
- LVM (Logical Volume Manager) –≤ Linux ‚Äî —ç—Ç–æ –ø—Ä–æ—Å–ª–æ–π–∫–∞ –º–µ–∂–¥—É ¬´–∂–µ–ª–µ–∑–Ω—ã–º–∏¬ª –¥–∏—Å–∫–∞–º–∏ –∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ–±–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–∏—Å–∫–∞–º–∏:
- –æ–±—ä–µ–¥–∏–Ω—è—Ç—å, –¥–µ–ª–∏—Ç—å, —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —Ç–æ–º–∞ ¬´–Ω–∞ –ª–µ—Ç—É¬ª.

üß© –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã LVM
- 	1	Physical Volume (PV) ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –Ω–æ—Å–∏—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, /dev/sdb, /dev/sdc), –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –¥–ª—è LVM.
- 	2	Volume Group (VG) ‚Äî –≥—Ä—É–ø–ø–∞ —Ç–æ–º–æ–≤. –≠—Ç–æ –∫–∞–∫ ¬´–ø—É–ª¬ª –ø–∞–º—è—Ç–∏, –≤ –∫–æ—Ç–æ—Ä—ã–π —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è PV.
- 	3	Logical Volume (LV) ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º (—Ä–∞–∑–¥–µ–ª –≤–Ω—É—Ç—Ä–∏ VG). –ù–∞ –Ω–µ–≥–æ –Ω–∞–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º—É.

üîß –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å LVM (Ubuntu)
- 	1 –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∏—Å–∫–∏ –ø–æ–¥ LVM
- –î–æ–ø—É—Å—Ç–∏–º, —É —Ç–µ–±—è –µ—Å—Ç—å –¥–≤–∞ –ø—É—Å—Ç—ã—Ö –¥–∏—Å–∫–∞ /dev/sdb –∏ /dev/sdc:
- sudo pvcreate /dev/sdb /dev/sdc
- 2 –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É —Ç–æ–º–æ–≤
- sudo vgcreate vg_data /dev/sdb /dev/sdc
- –¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å VG —Å –∏–º–µ–Ω–µ–º vg_data
- 3 –°–æ–∑–¥–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º
- –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–º —Ä–∞–∑–º–µ—Ä–æ–º 50 –ì–ë:
- sudo lvcreate -L 50G -n lv_storage vg_data
- –ò–ª–∏ –∑–∞–Ω—è—Ç—å –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ:
- sudo lvcreate -l 100%FREE -n lv_storage vg_data
- 4 –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
- sudo mkfs.ext4 /dev/vg_data/lv_storage
- 5 –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥
- sudo mkdir /mnt/storage
- sudo mount /dev/vg_data/lv_storage /mnt/storage
  üîÑ –ü–æ–ª–µ–∑–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å LVM
- 	‚Ä¢	–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å PV, VG –∏ LV:
- sudo pvs
- sudo vgs
- sudo lvs
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–æ–º (–∏ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É):
- sudo lvextend -L +10G /dev/vg_data/lv_storage
- sudo resize2fs /dev/vg_data/lv_storage
- –£–º–µ–Ω—å—à–∏—Ç—å —Ç–æ–º (–æ–ø–∞—Å–Ω–æ, –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —É–º–µ–Ω—å—à–∏—Ç—å –§–°):
- sudo resize2fs /dev/vg_data/lv_storage 20G
- sudo lvreduce -L 20G /dev/vg_data/lv_storage
- –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º:
- sudo umount /mnt/storage
- sudo lvremove /dev/vg_data/lv_storage
- –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É —Ç–æ–º–æ–≤:
- sudo vgremove vg_data
- –£–¥–∞–ª–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ç–æ–º:
- sudo pvremove /dev/sdb
- 
- ‚ö° –ü–ª—é—Å—ã LVM
- ‚Ä¢	–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ( —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å/—É–º–µ–Ω—å—à–∞—Ç—å —Ç–æ–º–∞).
- ‚Ä¢	–ì–∏–±–∫–æ—Å—Ç—å (–Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Å–∫–æ–≤ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ).
- ‚Ä¢	Snapshots (—Å–Ω–∏–º–∫–∏ —Ç–æ–º–æ–≤ –¥–ª—è –±—ç–∫–∞–ø–æ–≤).
- ‚Ä¢	–£–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ( –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –¥–∏—Å–∫–∞–º–∏).





 
</details>


**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:**

- –î–æ–±–∞–≤–ª–µ–Ω–æ 2 –¥–∏—Å–∫–∞ –ø–æ 25–ì–ë (c—Ç–∞–ª–æ 5 –¥–∏—Å–∫–æ–≤: 1 - —Å–∏—Å—Ç–µ–º–∞, 2 - raid, 2 - –Ω–æ–≤—ã–µ
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞ –º–∞—à–∏–Ω–∞
- **root@ol-alp-ubuntu1:~# lsblk**
- NAME                      MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINTS
- sda                         8:0    0   30G  0 disk
- ‚îú‚îÄsda1                      8:1    0    1M  0 part
- ‚îú‚îÄsda2                      8:2    0    2G  0 part  /boot
- ‚îî‚îÄsda3                      8:3    0   28G  0 part
-   ‚îî‚îÄubuntu--vg-ubuntu--lv 252:0    0   14G  0 lvm   /
- sdb                         8:16   0   25G  0 disk
- ‚îî‚îÄmd127                     9:127  0   25G  0 raid1
-   ‚îú‚îÄmd127p1               259:0    0    5G  0 part  /mnt/raid/part1
-   ‚îú‚îÄmd127p2               259:1    0    5G  0 part  /mnt/raid/part2
-   ‚îú‚îÄmd127p3               259:2    0    5G  0 part  /mnt/raid/part3
-   ‚îú‚îÄmd127p4               259:3    0    5G  0 part  /mnt/raid/part4
-   ‚îî‚îÄmd127p5               259:4    0    5G  0 part  /mnt/raid/part5
- sdc                         8:32   0   25G  0 disk
- ‚îî‚îÄmd127                     9:127  0   25G  0 raid1
-   ‚îú‚îÄmd127p1               259:0    0    5G  0 part  /mnt/raid/part1
-   ‚îú‚îÄmd127p2               259:1    0    5G  0 part  /mnt/raid/part2
-   ‚îú‚îÄmd127p3               259:2    0    5G  0 part  /mnt/raid/part3
-   ‚îú‚îÄmd127p4               259:3    0    5G  0 part  /mnt/raid/part4
-   ‚îî‚îÄmd127p5               259:4    0    5G  0 part  /mnt/raid/part5
- sdd                         8:48   0   25G  0 disk
- sde                         8:64   0   25G  0 disk
- sr0                        11:0    1  3.1G  0 rom
- **root@ol-alp-ubuntu1:~# cat /proc/mdstat** # –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–∞—à –º–∞—Å—Å–∏–≤, –µ–≥–æ –Ω—É–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è (–Ω—É–∂–Ω–æ 4 –¥–∏—Å–∫–∞)
- Personalities : [raid1] [raid0] [raid6] [raid5] [raid4] [raid10]
- md127 : active raid1 sdb[0] sdc[2]
- root@ol-alp-ubuntu1:~# umount /dev/md127p1
- root@ol-alp-ubuntu1:~# umount /dev/md127p2
- root@ol-alp-ubuntu1:~# umount /dev/md127p3
- root@ol-alp-ubuntu1:~# umount /dev/md127p4
- root@ol-alp-ubuntu1:~# umount /dev/md127p5
- **root@ol-alp-ubuntu1:~# umount /dev/md127**
- umount: /dev/md127: not mounted.
- **root@ol-alp-ubuntu1:~# mdadm --stop /dev/md127**
- mdadm: stopped /dev/md127
- **root@ol-alp-ubuntu1:~# lsblk**
- NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
- sda                         8:0    0   30G  0 disk
- ‚îú‚îÄsda1                      8:1    0    1M  0 part
- ‚îú‚îÄsda2                      8:2    0    2G  0 part /boot
- ‚îî‚îÄsda3                      8:3    0   28G  0 part
-   ‚îî‚îÄubuntu--vg-ubuntu--lv 252:0    0   14G  0 lvm  /
- **sdb                         8:16   0   25G  0 disk**
- **sdc                         8:32   0   25G  0 disk**
- **sdd                         8:48   0   25G  0 disk**
- **sde                         8:64   0   25G  0 disk**
- sr0                        11:0    1  3.1G  0 rom
- **# —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å 4 —Å–≤–æ–±–æ–¥–Ω—ã—Ö –¥–∏—Å–∫–∞ –¥–ª—è –î–ó**
- **root@ol-alp-ubuntu1:~# lvmdiskscan**
-  /dev/sda2 [       2.00 GiB]
-  /dev/sda3 [     <28.00 GiB] LVM physical volume
-  /dev/sdd  [      25.00 GiB]
-  /dev/sde  [      25.00 GiB]
-  2 disks
-  1 partition
-  0 LVM physical volume whole disks
-  1 LVM physical volume
-  **# –Ω–µ—Ç 2-—Ö –¥–∏—Å–∫–æ–≤ (–Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –¥–ª—è LVM (PV), —Ç.–∫. —Ä–∞–∑–º–µ—á–µ–Ω—ã –ø–æ–¥ ext4**
- **root@ol-alp-ubuntu1:~# wipefs -a /dev/sdb** # —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Ä–∞–∑–º–µ—Ç–∫—É (—Å–æ—Ç—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ)
- /dev/sdb: 4 bytes were erased at offset 0x00001000 (linux_raid_member): fc 4e 2b a9
- **root@ol-alp-ubuntu1:~# wipefs -a /dev/sdc** # —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Ä–∞–∑–º–µ—Ç–∫—É (—Å–æ—Ç—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ)
- /dev/sdc: 4 bytes were erased at offset 0x00001000 (linux_raid_member): fc 4e 2b a9
- **root@ol-alp-ubuntu1:~# lvmdiskscan** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
-  /dev/sda2 [       2.00 GiB]
-  /dev/sda3 [     <28.00 GiB] LVM physical volume
-  **/dev/sdb  [      25.00 GiB]**
-  **/dev/sdc  [      25.00 GiB]**
-  **/dev/sdd  [      25.00 GiB]**
-  **/dev/sde  [      25.00 GiB]**
-  4 disks
-  1 partition
-  0 LVM physical volume whole disks
-  1 LVM physical volume
-  **root@ol-alp-ubuntu1:~# pvcreate /dev/sdb** # —Ä–∞–∑–º–µ—Ç–∏–º –¥–∏—Å–∫ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LVM - —Å–æ–∑–¥–∞–¥–∏–º PV
-  Physical volume "/dev/sdb" successfully created
-  **root@ol-alp-ubuntu1:~# vgcreate otus /dev/sdb** # —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ - VG
-  Volume group "otus" successfully created
-  **root@ol-alp-ubuntu1:~# lvcreate -l+80%FREE -n test otus** # —Å–æ–∑–¥–∞–µ–º Logical Volume (LV)
-  Logical volume "test" created.
-  **root@ol-alp-ubuntu1:~# vgdisplay otus**
-  --- Volume group ---
-  VG Name               otus
-  System ID
-  Format                lvm2
-  Metadata Areas        1
-  Metadata Sequence No  2
-  VG Access             read/write
-  VG Status             resizable
-  MAX LV                0
-  Cur LV                1
-  Open LV               0
-  Max PV                0
-  Cur PV                1
-  Act PV                1
-  VG Size               <25.00 GiB
-  PE Size               4.00 MiB
-  Total PE              6399
-  Alloc PE / Size       5119 / <20.00 GiB
-  Free  PE / Size       1280 / 5.00 GiB
-  VG UUID               jCugMC-ZHcJ-muKG-FqI5-XiQr-aACB-Us9wMV
-  **root@ol-alp-ubuntu1:~# vgdisplay -v otus | grep 'PV Name'**
-  PV Name               /dev/sdb
-  **root@ol-alp-ubuntu1:~# lvdisplay /dev/otus/test**
-  --- Logical volume ---
-  LV Path                /dev/otus/test
-  LV Name                test
-  VG Name                otus
-  LV UUID                0B0NKg-ICGz-PyZM-SlqY-qg9j-pEgW-Izl0XI
-  LV Write Access        read/write
-  LV Creation host, time ol-alp-ubuntu1, 2025-09-12 06:17:06 +0000
-  LV Status              available
-  open                 0
-  LV Size                <20.00 GiB
-  Current LE             5119
-  Segments               1
-  Allocation             inherit
-  Read ahead sectors     auto
-  - currently set to     256
-  Block device           252:1
- **root@ol-alp-ubuntu1:~# vgs**
-  VG        #PV #LV #SN Attr   VSize   VFree
-  otus        1   1   0 wz--n- <25.00g  5.00g
-  ubuntu-vg   1   1   0 wz--n- <28.00g 14.00g
- **root@ol-alp-ubuntu1:~# lvs**
-  LV        VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
-  test      otus      -wi-a----- <20.00g
-  ubuntu-lv ubuntu-vg -wi-ao---- <14.00g
- **root@ol-alp-ubuntu1:~# lvcreate -L100M -n small otus** # —Å–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–∏–Ω LV –∏–∑ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞. –ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ —Å–æ–∑–¥–∞–¥–∏–º –Ω–µ —ç–∫—Å—Ç–µ–Ω—Ç–∞–º–∏, –∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö:
-  Logical volume "small" created.
-  **root@ol-alp-ubuntu1:~# lvs**
-  LV        VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
-  small     otus      -wi-a----- 100.00m
-  test      otus      -wi-a----- <20.00g
-  ubuntu-lv ubuntu-vg -wi-ao---- <14.00g
- **root@ol-alp-ubuntu1:~# mkfs.ext4 /dev/otus/test** # –°–æ–∑–¥–∞–µ–º –Ω–∞ LV —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–µ–º –µ–≥–æ
- mke2fs 1.47.0 (5-Feb-2023)
- Creating filesystem with 5241856 4k blocks and 1310720 inodes
- Filesystem UUID: e962ea62-1dcc-4f03-be63-d15e556065a2
- Superblock backups stored on blocks:
- 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
- 4096000
-
- Allocating group tables: done
- Writing inode tables: done
- Creating journal (32768 blocks): done
- Writing superblocks and filesystem accounting information: done
- **root@ol-alp-ubuntu1:~# mkdir /data**
- **root@ol-alp-ubuntu1:~# mount /dev/otus/test /data/**
- **root@ol-alp-ubuntu1:~# mount | grep /data**
- /dev/mapper/otus-test on /data type ext4 (rw,relatime
- # –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ LVM
- –î–æ–ø—É—Å—Ç–∏–º, –ø–µ—Ä–µ–¥ –Ω–∞–º–∏ –≤—Å—Ç–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /data. –ú—ã –º–æ–∂–µ–º —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ LV /dev/otus/test –∑–∞ - —Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ –±–ª–æ—á–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ /dev/sdc.
- **root@ol-alp-ubuntu1:~# pvcreate /dev/sdc**
- Physical volume "/dev/sdc" successfully created.
- **root@ol-alp-ubuntu1:~# vgextend otus /dev/sdc** # —Ä–∞—Å—à–∏—Ä—è–µ–º VG otus –¥–∏—Å–∫–æ–º sdc
- Volume group "otus" successfully extended
- **root@ol-alp-ubuntu1:~# vgdisplay -v otus | grep 'PV Name'** # –ø—Ä–æ–≤–µ—Ä–∫–∞
- PV Name               /dev/sdb
- PV Name               /dev/sdc
- **root@ol-alp-ubuntu1:~# vgs**
- VG        #PV #LV #SN Attr   VSize   VFree
- otus        2   2   0 wz--n-  49.99g <29.90g
- ubuntu-vg   1   1   0 wz--n- <28.00g  14.00g
- **root@ol-alp-ubuntu1:~# dd if=/dev/zero of=/data/test.log bs=1M  count=80000 status=progress** # –∑–∞–π–º–µ–º –≤—Å–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
- 20094910464 bytes (20 GB, 19 GiB) copied, 16 s, 1.3 GB/s
- dd: error writing '/data/test.log': **No space left on device** # –∑–∞–Ω—è—Ç–æ 100% –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- 19967+0 records in
- 19966+0 records out
- 20936445952 bytes (21 GB, 19 GiB) copied, 16.7435 s, 1.3 GB/s
- **root@ol-alp-ubuntu1:~# df -Th /data/**
- Filesystem            Type  Size  Used Avail Use% Mounted on
- /dev/mapper/otus-test ext4   20G   20G     0 100% /data
- **root@ol-alp-ubuntu1:~# lvextend -l+80%FREE /dev/otus/test** # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º LV –∑–∞ —Å—á–µ—Ç —á–∞—Å—Ç–∏ (80%) –ø–æ—è–≤–∏–≤—à–µ–≥–æ—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞.
- Size of logical volume otus/test changed from <20.00 GiB (5119 extents) **to <43.92 GiB** (11243 extents).
- Logical volume otus/test successfully resized.
- **root@ol-alp-ubuntu1:~# lvs /dev/otus/test**
- LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
- test otus -wi-ao---- <43.92g
- **root@ol-alp-ubuntu1:~# df -Th /data** # —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ —Ä–∞–∑–º–µ—Ä–µ –ø–æ–∫–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
- Filesystem            Type  Size  Used Avail Use% Mounted on
- /dev/mapper/otus-test ext4   20G   20G     0 100% /data
- **root@ol-alp-ubuntu1:~# resize2fs /dev/otus/test**
- resize2fs 1.47.0 (5-Feb-2023)
- Filesystem at /dev/otus/test is mounted on /data; on-line resizing required
- old_desc_blocks = 3, new_desc_blocks = 6
- The filesystem on /dev/otus/test is now 11512832 (4k) blocks long.
- **root@ol-alp-ubuntu1:~# df -Th /data** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Å—Ç–æ
- Filesystem            Type  Size  Used Avail Use% Mounted on
- /dev/mapper/otus-test ext4   44G   20G   22G  48% /data
- # –î–æ–ø—É—Å—Ç–∏–º –í—ã –∑–∞–±—ã–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ —Å–Ω–∞–ø—à–æ—Ç—ã.  —É–º–µ–Ω—å—à–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π LV —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã lvreduce, –Ω–æ –ø–µ—Ä–µ–¥ —ç—Ç–∏–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—ë –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —É–º–µ–Ω—å—à–∏—Ç—å –µ–µ —Ä–∞–∑–º–µ—Ä:

- **root@ol-alp-ubuntu1:~# umount /data/**
- **root@ol-alp-ubuntu1:~# e2fsck -fy /dev/otus/test**
- e2fsck 1.47.0 (5-Feb-2023)
- Pass 1: Checking inodes, blocks, and sizes
- Pass 2: Checking directory structure
- Pass 3: Checking directory connectivity
- Pass 4: Checking reference counts
- Pass 5: Checking group summary information
- /dev/otus/test: 12/2883584 files (0.0% non-contiguous), 5338504/11512832 blocks
- **root@ol-alp-ubuntu1:~# resize2fs /dev/otus/test 30G**
- resize2fs 1.47.0 (5-Feb-2023)
- Resizing the filesystem on /dev/otus/test to 7864320 (4k) blocks.
- The filesystem on /dev/otus/test is now 7864320 (4k) blocks long.
- **root@ol-alp-ubuntu1:~# df -Th /data**
- Filesystem                        Type  Size  Used Avail Use% Mounted on
- /dev/mapper/ubuntu--vg-ubuntu--lv ext4   14G  4.8G  8.2G  37% /
- **root@ol-alp-ubuntu1:~# lvs /dev/otus/test**
- LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
- test otus -wi-a----- <43.92g

- # –†–∞–±–æ—Ç–∞ —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏
- **–°–Ω–∞–ø—à–æ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π lvcreate, —Ç–æ–ª—å–∫–æ —Å —Ñ–ª–∞–≥–æ–º -s, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ —ç—Ç–æ —Å–Ω–∏–º–æ–∫:**
- **root@ol-alp-ubuntu1:~# lvcreate -L 500M -s -n test-snap /dev/otus/test**
- Logical volume "test-snap" created.
- **root@ol-alp-ubuntu1:~# vgs -o +lv_size,lv_name | grep test** # –ø—Ä–æ–≤–µ—Ä–∫–∞
- otus        2   3   1 wz--n-  49.99g <5.49g <43.92g test
- otus        2   3   1 wz--n-  49.99g <5.49g 500.00m test-snap
- **root@ol-alp-ubuntu1:~# lsblk**
- NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
- sda                         8:0    0   30G  0 disk
- ‚îú‚îÄsda1                      8:1    0    1M  0 part
- ‚îú‚îÄsda2                      8:2    0    2G  0 part /boot
- ‚îî‚îÄsda3                      8:3    0   28G  0 part
-  ‚îî‚îÄubuntu--vg-ubuntu--lv 252:0    0   14G  0 lvm  /
- sdb                         8:16   0   25G  0 disk
- ‚îú‚îÄotus-small              252:2    0  100M  0 lvm
- ‚îî‚îÄotus-test-real          252:3    0 43.9G  0 lvm
-  ‚îú‚îÄotus-test             252:1    0 43.9G  0 lvm
-  ‚îî‚îÄotus-test--snap       252:5    0 43.9G  0 lvm
- sdc                         8:32   0   25G  0 disk
- ‚îú‚îÄ**otus-test-real**          252:3    0 43.9G  0 lvm
- ‚îÇ ‚îú‚îÄotus-test             252:1    0 43.9G  0 lvm
- ‚îÇ ‚îî‚îÄ**otus-test--snap**       252:5    0 43.9G  0 lvm
- ‚îî‚îÄ**otus-test--snap-cow**     252:4    0  500M  0 lvm
-  ‚îî‚îÄotus-test--snap       252:5    0 43.9G  0 lvm
- sdd                         8:48   0   25G  0 disk
- sde                         8:64   0   25G  0 disk
- sr0                        11:0    1  3.1G  0 rom
- **root@ol-alp-ubuntu1:~# mkdir /data-snap**
- **root@ol-alp-ubuntu1:~# mount /dev/otus/test-snap /data-snap/**
- **root@ol-alp-ubuntu1:~# ll /data-snap/**
- total 20445776
- drwxr-xr-x  3 root root        4096 Sep 12 06:47 ./
- drwxr-xr-x 26 root root        4096 Sep 12 07:21 ../
- drwx------  2 root root       16384 Sep 12 06:34 lost+found/
- -rw-r--r--  1 root root 20936445952 Sep 12 06:49 test.log
- # –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. ‚Äú–û—Ç–∫–∞—Ç–∏—Ç—å—Å—è‚Äù –Ω–∞ —Å–Ω–∞–ø—à–æ—Ç.
- **root@ol-alp-ubuntu1:~# umount /data-snap**
- **root@ol-alp-ubuntu1:/# umount /data**
- umount: /data: not mounted.
- **root@ol-alp-ubuntu1:/# lvconvert --merge /dev/otus/test-snap**
- Merging of volume otus/test-snap started.
- otus/test: Merged: 100.00%
- **root@ol-alp-ubuntu1:/# mount /dev/otus/test /data**
- **root@ol-alp-ubuntu1:/# ll /data**
- total 20445776
- drwxr-xr-x  3 root root        4096 Sep 12 06:47 ./
- drwxr-xr-x 26 root root        4096 Sep 12 07:21 ../
- drwx------  2 root root       16384 Sep 12 06:34 lost+found/
- -rw-r--r--  1 root root 20936445952 Sep 12 06:49 test.log
- # –†–∞–±–æ—Ç–∞ —Å LVM-RAID
- **root@ol-alp-ubuntu1:/# pvcreate /dev/sd{d,e}**
- Physical volume "/dev/sdd" successfully created.
- Physical volume "/dev/sde" successfully created.
- **root@ol-alp-ubuntu1:/# vgcreate vg0 /dev/sd{d,e}**
- Volume group "vg0" successfully create
- **root@ol-alp-ubuntu1:/# lvcreate -l+80%FREE -m1 -n mirror vg0**
- Logical volume "mirror" created.
- **root@ol-alp-ubuntu1:/# lvs**
- LV        VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
- small     otus      -wi-a----- 100.00m
- test      otus      -wi-ao---- <43.92g
- ubuntu-lv ubuntu-vg -wi-ao---- <14.00g
- mirror    vg0       rwi-a-r--- <20.00g                                    45.80



- **root@ol-alp-ubuntu1:~# lsblk**
- NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
- sda                         8:0    0   30G  0 disk
- ‚îú‚îÄsda1                      8:1    0    1M  0 part
- ‚îú‚îÄsda2                      8:2    0    2G  0 part /boot
- ‚îî‚îÄsda3                      8:3    0   28G  0 part
-   ‚îî‚îÄubuntu--vg-ubuntu--lv 252:2    0   14G  0 lvm  /
- sdb                         8:16   0   25G  0 disk
- ‚îú‚îÄotus-test               252:0    0 43.9G  0 lvm
- ‚îî‚îÄotus-small              252:1    0  100M  0 lvm
- sdc                         8:32   0   25G  0 disk
- ‚îî‚îÄotus-test               252:0    0 43.9G  0 lvm
- sdd                         8:48   0   25G  0 disk
- ‚îú‚îÄvg0-mirror_rmeta_0      252:3    0    4M  0 lvm
- ‚îÇ ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- ‚îî‚îÄvg0-mirror_rimage_0     252:4    0   20G  0 lvm
-   ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- sde                         8:64   0   25G  0 disk
- ‚îú‚îÄvg0-mirror_rmeta_1      252:5    0    4M  0 lvm
- ‚îÇ ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- ‚îî‚îÄvg0-mirror_rimage_1     252:6    0   20G  0 lvm
-   ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- sr0                        11:0    1 1024M  0 rom
- **root@ol-alp-ubuntu1:~#  lvdisplay /dev/otus/test**
-   --- Logical volume ---
-   LV Path                /dev/otus/test
-   LV Name                test
-   VG Name                otus
-   LV UUID                0B0NKg-ICGz-PyZM-SlqY-qg9j-pEgW-Izl0XI
-   LV Write Access        read/write
-  LV Creation host, time ol-alp-ubuntu1, 2025-09-12 06:17:06 +0000
-   LV Status              available
-   # open                 0
-  LV Size                <43.92 GiB
-   Current LE             11243
-   Segments               3
-   Allocation             inherit
-   Read ahead sectors     auto
-   - currently set to     256
-   Block device           252:0

- **root@ol-alp-ubuntu1:~# vgs**
-   VG        #PV #LV #SN Attr   VSize   VFree
-   otus        2   2   0 wz--n-  49.99g <5.98g
-   ubuntu-vg   1   1   0 wz--n- <28.00g 14.00g
-   vg0         2   1   0 wz--n-  49.99g  9.99g
- **root@ol-alp-ubuntu1:~# lvs**
-   LV        VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
-   small     otus      -wi-a----- 100.00m
-   test      otus      -wi-a----- <43.92g
-   ubuntu-lv ubuntu-vg -wi-ao---- <14.00g
-   mirror    vg0       rwi-a-r--- <20.00g                                    100.00
- **root@ol-alp-ubuntu1:~# lvremove /dev/otus/test**
- Do you really want to remove and DISCARD active logical volume otus/test? [y/n]: Y
-   Logical volume "test" successfully removed.
- **root@ol-alp-ubuntu1:~# lvremove /dev/otus/small**
- Do you really want to remove and DISCARD active logical volume otus/small? [y/n]: Y
-   Logical volume "small" successfully removed.
- **root@ol-alp-ubuntu1:~# vgremove otus**
-   Volume group "otus" successfully removed
- **root@ol-alp-ubuntu1:~# pvremove /dev/sdb**
-   Labels on physical volume "/dev/sdb" successfully wiped.
- **root@ol-alp-ubuntu1:~# pvremove /dev/sdc**
-   Labels on physical volume "/dev/sdc" successfully wiped.
- **root@ol-alp-ubuntu1:~# lsblk**
- NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
- sda                         8:0    0   30G  0 disk
- ‚îú‚îÄsda1                      8:1    0    1M  0 part
- ‚îú‚îÄsda2                      8:2    0    2G  0 part /boot
- ‚îî‚îÄsda3                      8:3    0   28G  0 part
-   ‚îî‚îÄubuntu--vg-ubuntu--lv 252:2    0   14G  0 lvm  /
- sdb                         8:16   0   25G  0 disk
- sdc                         8:32   0   25G  0 disk
- sdd                         8:48   0   25G  0 disk
- ‚îú‚îÄvg0-mirror_rmeta_0      252:3    0    4M  0 lvm
- ‚îÇ ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- ‚îî‚îÄvg0-mirror_rimage_0     252:4    0   20G  0 lvm
-   ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- sde                         8:64   0   25G  0 disk
- ‚îú‚îÄvg0-mirror_rmeta_1      252:5    0    4M  0 lvm
- ‚îÇ ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- ‚îî‚îÄvg0-mirror_rimage_1     252:6    0   20G  0 lvm
-   ‚îî‚îÄvg0-mirror            252:7    0   20G  0 lvm
- sr0                        11:0    1 1024M  0 rom
- # –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ (–µ—â–µ –æ–¥–Ω–æ –Ω–∞—à–ª–æ—Å—å)
- **–ù–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ —Å Ubuntu 24.04 –∏ LVM.
- **–£–º–µ–Ω—å—à–∏—Ç—å —Ç–æ–º –ø–æ–¥ / –¥–æ 8G.
- **–í—ã–¥–µ–ª–∏—Ç—å —Ç–æ–º –ø–æ–¥ /home.
- **–í—ã–¥–µ–ª–∏—Ç—å —Ç–æ–º –ø–æ–¥ /var - —Å–¥–µ–ª–∞—Ç—å –≤ mirror.
- **/home - —Å–¥–µ–ª–∞—Ç—å —Ç–æ–º –¥–ª—è —Å–Ω–∞–ø—à–æ—Ç–æ–≤.
- **–ü—Ä–æ–ø–∏—Å–∞—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ fstab. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏ –∏ —Ä–∞–∑–Ω—ã–º–∏ —Ñ–∞–π–ª–æ–≤—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (–Ω–∞ –≤—ã–±–æ—Ä).
- **–†–∞–±–æ—Ç–∞ —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏:
- **—Å–≥–µ–Ω–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –≤ /home/;
- **—Å–Ω—è—Ç—å —Å–Ω–∞–ø—à–æ—Ç;
- **—É–¥–∞–ª–∏—Ç—å —á–∞—Å—Ç—å —Ñ–∞–π–ª–æ–≤;
- **–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞.
- ** * –ù–∞ –¥–∏—Å–∫–∞—Ö –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å btrfs/zfs ‚Äî —Å –∫—ç—à–µ–º, —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏ –∏ —Ä–∞–∑–º–µ—Ç–∏—Ç—å —Ç–∞–º –∫–∞—Ç–∞–ª–æ–≥ /opt.
- ** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã script

- **root@ol-alp-ubuntu1:~# pvcreate /dev/sdb**
-   Physical volume "/dev/sdb" successfully created.
- **root@ol-alp-ubuntu1:~# vgcreate vg_root /dev/sdb**
-   Volume group "vg_root" successfully created
- **root@ol-alp-ubuntu1:~# lvcreate -n lv_root -l +100%FREE /dev/vg_root**
- WARNING: ext4 signature detected on /dev/vg_root/lv_root at offset 1080. Wipe it? [y/n]: Y
-   Wiping ext4 signature on /dev/vg_root/lv_root.
-   Logical volume "lv_root" created.
- **root@ol-alp-ubuntu1:~# mkfs.ext4 /dev/vg_root/lv_root**
- mke2fs 1.47.0 (5-Feb-2023)
- Creating filesystem with 6552576 4k blocks and 1638400 inodes
- Filesystem UUID: 783b3aed-d8d5-4c32-b246-57c6db19d784
- Superblock backups stored on blocks:
- 	4096000

- Allocating group tables: done
- Writing inode tables: done
- Creating journal (32768 blocks): done
- Writing superblocks and filesystem accounting information: done
- **root@ol-alp-ubuntu1:~# mount /dev/vg_root/lv_root /mnt**

- **root@ol-alp-ubuntu1:~# rsync -avxHAX --progress / /mnt/** # –∫–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å / —Ä–∞–∑–¥–µ–ª–∞ –≤ /mnt
- **root@ol-alp-ubuntu1:~# ls /mnt**
- bin                boot   dev  home  lib64              lost+found  mnt  proc  run   sbin.usr-is-merged  srv       sys  usr
- bin.usr-is-merged  cdrom  etc  lib   lib.usr-is-merged  media       opt  root  sbin  snap                swap.img  tmp  var
- **—Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º grub –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–æ–≤—ã–π /.
–°—ã–º–∏—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π root, —Å–¥–µ–ª–∞–µ–º –≤ –Ω–µ–≥–æ chroot –∏ –æ–±–Ω–æ–≤–∏–º grub:**
- **root@ol-alp-ubuntu1:~# for i in /proc/ /sys/ /dev/ /run/ /boot/; \
 do mount --bind $i /mnt/$i; done**
- **root@ol-alp-ubuntu1:~# chroot /mnt/**
- **root@ol-alp-ubuntu1:/# grub-mkconfig -o /boot/grub/grub.cfg** # C–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º grub –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–æ–≤—ã–π /.
–°—ã–º–∏—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π root, —Å–¥–µ–ª–∞–µ–º –≤ –Ω–µ–≥–æ chroot –∏ –æ–±–Ω–æ–≤–∏–º grub:

- Sourcing file `/etc/default/grub'
- Generating grub configuration file ...
- Found linux image: /boot/vmlinuz-6.8.0-79-generic
- Found initrd image: /boot/initrd.img-6.8.0-79-generic
- Warning: os-prober will not be executed to detect other bootable partitions.
- Systems on them will not be added to the GRUB boot configuration.
- Check GRUB_DISABLE_OS_PROBER documentation entry.
- Adding boot menu entry for UEFI Firmware Settings ...
- done
- **root@ol-alp-ubuntu1:/# update-initramfs -u**
- update-initramfs: Generating /boot/initrd.img-6.8.0-79-generic
- **root@ol-alp-ubuntu1:/# reboot**
- # –¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Å—Ç–∞—Ä–æ–π VG –∏ –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –Ω–µ–≥–æ —Ä—É—Ç. –î–ª—è —ç—Ç–æ–≥–æ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π LV —Ä–∞–∑–º–µ—Ä–æ–º –≤ 25G –∏ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –Ω–∞ 8G:
- **root@ol-alp-ubuntu1:/home/spg# lvremove /dev/ubuntu-vg/ubuntu-lv**
- Do you really want to remove and DISCARD active logical volume ubuntu-vg/ubuntu-lv? [y/n]: Y
-  Logical volume "ubuntu-lv" successfully removed.
- **root@ol-alp-ubuntu1:/home/spg# lvcreate -n ubuntu-vg/ubuntu-lv -L 8G /dev/ubuntu-vg**
- Logical volume "ubuntu-lv" created.
- **root@ol-alp-ubuntu1:/home/spg# mkfs.ext4 /dev/ubuntu-vg/ubuntu-lv**
- mke2fs 1.47.0 (5-Feb-2023)
- Discarding device blocks: done
- Creating filesystem with 2097152 4k blocks and 524288 inodes
- Filesystem UUID: 2a8d4d79-8b33-47a2-baf2-e5b9c408c43a
- Superblock backups stored on blocks:
- 	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

- Allocating group tables: done
- Writing inode tables: done
- Creating journal (16384 blocks): done
- Writing superblocks and filesystem accounting information: done

- **root@ol-alp-ubuntu1:/home/spg# mount /dev/ubuntu-vg/ubuntu-lv /mnt**
- **root@ol-alp-ubuntu1:/home/spg# rsync -avxHAX --progress / /mnt/**
- # –¢–∞–∫ –∂–µ –∫–∞–∫ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ c–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º grub.
- **root@ol-alp-ubuntu1:/home/spg# for i in /proc/ /sys/ /dev/ /run/ /boot/;  do mount --bind $i /mnt/$i; done**
- **root@ol-alp-ubuntu1:/home/spg# chroot /mnt/**
- **root@ol-alp-ubuntu1:/# grub-mkconfig -o /boot/grub/grub.cfg**
- Sourcing file `/etc/default/grub'
- Generating grub configuration file ...
- Found linux image: /boot/vmlinuz-6.8.0-79-generic
- Found initrd image: /boot/initrd.img-6.8.0-79-generic
- Warning: os-prober will not be executed to detect other bootable partitions.
- Systems on them will not be added to the GRUB boot configuration.
- Check GRUB_DISABLE_OS_PROBER documentation entry.
- Adding boot menu entry for UEFI Firmware Settings ...
- done
- **root@ol-alp-ubuntu1:/# update-initramfs -u**
- update-initramfs: Generating /boot/initrd.img-6.8.0-79-generic
- W: Couldn't identify type of root file system for fsck hook
- # –ü–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º—Å—è –∏ –Ω–µ –≤—ã—Ö–æ–¥–∏–º –∏–∑ –ø–æ–¥ chroot - –º—ã –º–æ–∂–µ–º –∑–∞–æ–¥–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ /var.
- # –í—ã–¥–µ–ª–∏—Ç—å —Ç–æ–º –ø–æ–¥ /var –≤ –∑–µ—Ä–∫–∞–ª–æ
- **root@ol-alp-ubuntu1:/# pvcreate /dev/sdc /dev/sdd**
-   Can't initialize physical volume "/dev/sdd" of volume group "vg0" without -ff
-   /dev/sdd: physical volume not initialized.
-   Physical volume "/dev/sdc" successfully created.
- **root@ol-alp-ubuntu1:/# vgcreate vg_var /dev/sdc /dev/sdd**
-   Physical volume '/dev/sdd' is already in volume group 'vg0'
-   /dev/sdd: physical volume not initialized.
- **root@ol-alp-ubuntu1:/# vgremove /dev/vg0**
-   Volume group "vg0" successfully removed
- **root@ol-alp-ubuntu1:/# vgcreate vg_var /dev/sdc /dev/sdd**
-   Volume group "vg_var" successfully created
- **root@ol-alp-ubuntu1:/# lvcreate -L 950M -m1 -n lv_var vg_var**
-   Rounding up size to full physical extent 952.00 MiB
-   Logical volume "lv_var" created.
- **root@ol-alp-ubuntu1:/# mkfs.ext4 /dev/vg_var/lv_var**
- mke2fs 1.47.0 (5-Feb-2023)
- Creating filesystem with 243712 4k blocks and 60928 inodes
- Filesystem UUID: 7452f181-6515-4b19-9215-9b8cc70da811
- Superblock backups stored on blocks:
- 	32768, 98304, 163840, 229376

- Allocating group tables: done
- Writing inode tables: done
- Creating journal (4096 blocks): done
- Writing superblocks and filesystem accounting information: done
- **root@ol-alp-ubuntu1:/# mount /dev/vg_var/lv_var /mnt**
- **root@ol-alp-ubuntu1:/# cp -aR /var/* /mnt/**
- **root@ol-alp-ubuntu1:/# mkdir /tmp/oldvar && mv /var/* /tmp/oldvar**
- **root@ol-alp-ubuntu1:/# umount /mnt**
- **root@ol-alp-ubuntu1:/# mount /dev/vg_var/lv_var /var**
- **root@ol-alp-ubuntu1:/# echo "`blkid | grep var: | awk '{print $2}'` \
 /var ext4 defaults 0 0" >> /etc/fstab**
- **root@ol-alp-ubuntu1:/# vi /etc/fstab**
- **root@ol-alp-ubuntu1:/# reboot**
- **root@ol-alp-ubuntu1:/home/spg# lvremove /dev/vg_root/lv_root
- Do you really want to remove and DISCARD active logical volume vg_root/lv_root? [y/n]: Y
-   Logical volume "lv_root" successfully removed.
- **root@ol-alp-ubuntu1:/home/spg# vgremove /dev/vg_root
-   Volume group "vg_root" successfully removed
- **root@ol-alp-ubuntu1:/home/spg# pvremove /dev/sdb**
-   Labels on physical volume "/dev/sdb" successfully wiped.
-  # –í—ã–¥–µ–ª–∏—Ç—å —Ç–æ–º –ø–æ–¥ /home
–í—ã–¥–µ–ª—è–µ–º —Ç–æ–º –ø–æ–¥ /home –ø–æ —Ç–æ–º—É –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø—É —á—Ç–æ –¥–µ–ª–∞–ª–∏ –¥–ª—è /var:
- **root@ol-alp-ubuntu1:/home/spg# lvcreate -n LogVol_Home -L 2G /dev/ubuntu-vg**
-   Logical volume "LogVol_Home" created.
- **root@ol-alp-ubuntu1:/home/spg# mkfs.ext4 /dev/ubuntu-vg/LogVol_Home**
- mke2fs 1.47.0 (5-Feb-2023)
- Discarding device blocks: done
- Creating filesystem with 524288 4k blocks and 131072 inodes
- Filesystem UUID: b28aacff-dc63-4343-98c8-fe64bd743c70
- Superblock backups stored on blocks:
- 	32768, 98304, 163840, 229376, 294912

- Allocating group tables: done
- Writing inode tables: done
- Creating journal (16384 blocks): done
- Writing superblocks and filesystem accounting information: done
- **root@ol-alp-ubuntu1:/home/spg# mount /dev/ubuntu-vg/LogVol_Home /mnt/**
- **root@ol-alp-ubuntu1:/home/spg# cp -aR /home/* /mnt/**
- **root@ol-alp-ubuntu1:/home/spg# rm -rf /home/* **
- **root@ol-alp-ubuntu1:/home/spg# umount /mnt**
- mount /dev/ubuntu-vg/LogVol_Home /home/
- # –ü—Ä–∞–≤–∏–º fstab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è /home:
- **root@ol-alp-ubuntu1:/home/spg# echo "`blkid | grep Home | awk '{print $2}'` \
 /home xfs defaults 0 0" >> /etc/fstab**
- **root@ol-alp-ubuntu1:/home/spg# vi /etc/fstab**
- # –†–∞–±–æ—Ç–∞ —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ /home/:
- **root@ol-alp-ubuntu1:/home/spg# touch /home/file{1..20**
- # –°–Ω—è—Ç—å —Å–Ω–∞–ø—à–æ—Ç:
- ** root@ol-alp-ubuntu1:/home/spg# lvcreate -L 100MB -s -n home_snap \ /dev/ubuntu-vg/LogVol_Home**
-  Logical volume "home_snap" created.
-  **root@ol-alp-ubuntu1:/home/spg# rm -f /home/file{11..20}**
-  # –ü—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞:
-  **root@ol-alp-ubuntu1:/home/spg# umount /home**
- **root@ol-alp-ubuntu1:/home/spg# lvconvert --merge /dev/ubuntu-vg/home_snap**
- Merging of volume ubuntu-vg/home_snap started.
- ubuntu-vg/LogVol_Home: Merged: 100.00%
- **root@ol-alp-ubuntu1:/home/spg# mount /dev/mapper/ubuntu--vg-LogVol_Home /home**
- mount: (hint) your fstab has been modified, but systemd still uses
- the old version; use 'systemctl daemon-reload' to reload.
- **root@ol-alp-ubuntu1:/home/spg# ls -al /home**
- total 28
- drwxr-xr-x  4 root root  4096 Sep 15 09:19 .
- drwxr-xr-x 23 root root  4096 Sep 15 05:58 ..
- -rw-r--r--  1 root root     0 Sep 15 09:19 file1
- -rw-r--r--  1 root root     0 Sep 15 09:19 file10
- -rw-r--r--  1 root root     0 Sep 15 09:19 file11
- -rw-r--r--  1 root root     0 Sep 15 09:19 file12
- -rw-r--r--  1 root root     0 Sep 15 09:19 file13
- -rw-r--r--  1 root root     0 Sep 15 09:19 file14
- -rw-r--r--  1 root root     0 Sep 15 09:19 file15
- -rw-r--r--  1 root root     0 Sep 15 09:19 file16
- -rw-r--r--  1 root root     0 Sep 15 09:19 file17
- -rw-r--r--  1 root root     0 Sep 15 09:19 file18
- -rw-r--r--  1 root root     0 Sep 15 09:19 file19
- -rw-r--r--  1 root root     0 Sep 15 09:19 file2
- -rw-r--r--  1 root root     0 Sep 15 09:19 file20
- -rw-r--r--  1 root root     0 Sep 15 09:19 file3
- -rw-r--r--  1 root root     0 Sep 15 09:19 file4
- -rw-r--r--  1 root root     0 Sep 15 09:19 file5
- -rw-r--r--  1 root root     0 Sep 15 09:19 file6
- -rw-r--r--  1 root root     0 Sep 15 09:19 file7
- -rw-r--r--  1 root root     0 Sep 15 09:19 file8
- -rw-r--r--  1 root root     0 Sep 15 09:19 file9
- drwx------  2 root root 16384 Sep 15 09:12 lost+found
- drwxr-x---  4 spg  spg   4096 Sep 15 06:01 spg
- # –§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é —Å–Ω–∞–ø—à–æ—Ç–∞.

 ## 5 –£—Ä–æ–∫

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ**
<ins>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å ZFS</ins>

**–¶–µ–ª—å:** –Ω–∞—É—á–∏—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å ZFS, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—É–ª—ã, –∏–∑—É—á–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ZFS;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Å –Ω–∞–∏–ª—É—á—à–∏–º —Å–∂–∞—Ç–∏–µ–º:
- –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–∂–∞—Ç–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç zfs (gzip, zle, lzjb, lz4);
- —Å–æ–∑–¥–∞—Ç—å 4 —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º—ã, –Ω–∞ –∫–∞–∂–¥–æ–π –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–∂–∞—Ç–∏—è;
- –¥–ª—è —Å–∂–∞—Ç–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–±–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª, –ª–∏–±–æ –≥—Ä—É–ø–ø—É —Ñ–∞–π–ª–æ–≤.
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞.
- –° –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã zfs import —Å–æ–±—Ä–∞—Ç—å pool ZFS.
- –ö–æ–º–∞–Ω–¥–∞–º–∏ zfs –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞;
- —Ç–∏–ø pool;
- –∑–Ω–∞—á–µ–Ω–∏–µ recordsize;
- –∫–∞–∫–æ–µ —Å–∂–∞—Ç–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è;
- –∫–∞–∫–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
3. –†–∞–±–æ—Ç–∞ —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏:
- —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏;
- –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ. zfs receive;
- –Ω–∞–π—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–µ secret_message.

<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary> 
# üìÇ ZFS –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

–í **ZFS** –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ‚Äî —ç—Ç–æ —Å–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É–ª–∞, dataset'–æ–≤ –∏ —Ñ–∞–π–ª–æ–≤.  

---

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### 1. Uberblock
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—É–ª.  
- –•—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–π –æ–±—ä–µ–∫—Ç.  
- –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –ø—É–ª–∞ (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è).  

### 2. MOS (Meta Object Set)
- ¬´–ö–∞—Ç–∞–ª–æ–≥¬ª –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø—É–ª–µ.  
- –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞:
  - dataset'—ã,  
  - —Å–Ω–∞–ø—à–æ—Ç—ã,  
  - space maps,  
  - ZIL.  

### 3. Block Pointer
- –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö.  
- –•—Ä–∞–Ω–∏—Ç:
  - —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å,  
  - —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞,  
  - –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É,  
  - –º–µ—Ç–æ–¥ —Å–∂–∞—Ç–∏—è,  
  - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π.  

### 4. dnode
- –û–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç (—Ñ–∞–π–ª, –∫–∞—Ç–∞–ª–æ–≥, —Å–Ω–∞–ø—à–æ—Ç).  
- –°–æ–¥–µ—Ä–∂–∏—Ç:
  - –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—ä–µ–∫—Ç–∞,  
  - —Å—Å—ã–ª–∫–∏ –Ω–∞ block pointer‚Äô—ã.  

### 5. ZIL (ZFS Intent Log)
- –ñ—É—Ä–Ω–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`fsync`).  
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ—è—Ö.  

### 6. Space Maps
- –ö–∞—Ä—Ç–∞ –∑–∞–Ω—è—Ç—ã—Ö –∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –±–ª–æ–∫–æ–≤.  
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º.  

---

## üîπ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ ZFS
- **–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã**: –∫–∞–∂–¥–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è.  
- **–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π**: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–∏–Ω–∏–º—É–º –≤ –¥–≤—É—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö.  
- **Copy-on-Write**: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è.  

---
## üìå –ò—Ç–æ–≥
ZFS –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ‚Äî —ç—Ç–æ ¬´–∫–∞—Ä—Ç–∞¬ª –≤—Å–µ–≥–æ –ø—É–ª–∞.  
–û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:
- –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É,  
- –Ω–∞—Ö–æ–¥–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ,  
- –¥–µ–ª–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç—ã –∏ —Ä–µ–ø–ª–∏–∫–∏,  
- –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤.

---

# üîê –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –≤ ZFS

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ
ZFS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã (checksums)** –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π.  
–ö–∞–∂–¥—ã–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –∫–∞–∂–¥—ã–π –±–ª–æ–∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è —Ö—ç—à-—Å—É–º–º–æ–π, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Å–∞–º–æ–≥–æ –±–ª–æ–∫–∞.  

---

## üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö ZFS –≤—ã—á–∏—Å–ª—è–µ—Ç —Ö—ç—à (–Ω–∞–ø—Ä–∏–º–µ—Ä, SHA-256 –∏–ª–∏ Fletcher4).  
2. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è **–Ω–µ —Ä—è–¥–æ–º —Å –¥–∞–Ω–Ω—ã–º–∏**, –∞ –≤ –∏—Ö **—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –±–ª–æ–∫–µ (block pointer)**.  
3. –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏:
   - ZFS –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ö—ç—à —Å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞,  
   - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –µ–≥–æ —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º,  
   - –µ—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞ ‚Üí –±–ª–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –∫–æ–ø–∏–∏ (RAID-Z, –∑–µ—Ä–∫–∞–ª–∞).  

---

## üîπ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **End-to-End –∑–∞—â–∏—Ç–∞**: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–µ—Å—å –ø—É—Ç—å –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ –¥–∏—Å–∫–∞.  
- **–°–∞–º–æ–ª–µ—á–µ–Ω–∏–µ (self-healing)**: –µ—Å–ª–∏ –æ–¥–∏–Ω –±–ª–æ–∫ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω, ZFS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –µ–≥–æ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏.  
- **Copy-on-Write**: –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–ª–æ–∫–æ–≤ –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º–æ–π.  

---

## üîπ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- Fletcher2 / Fletcher4 (–±—ã—Å—Ç—Ä—ã–µ, —Å—Ç–∞—Ä—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã).  
- SHA-256 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–∞–¥—ë–∂–Ω—ã–π).  
- Skein, Edon-R, SHA-512 (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ, –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å).  

üìå –ò—Ç–æ–≥
–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã ZFS –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:
	‚Ä¢	–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç—ã—Ö –æ—à–∏–±–æ–∫ –Ω–∞ –¥–∏—Å–∫–µ (bit rot),
	‚Ä¢	–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö,
	‚Ä¢	–≥–∞—Ä–∞–Ω—Ç–∏—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤—Å–µ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã


---

# üì¶ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤ ZFS

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ
**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º ZFS —Ö—Ä–∞–Ω–∏—Ç **—Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∫–æ–ø–∏—é –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö**.  
–ï—Å–ª–∏ –¥–≤–∞ —Ñ–∞–π–ª–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –±–ª–æ–∫, —Ç–æ –≤ –ø—É–ª–µ –æ–Ω –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ª–∏—à—å –æ–¥–∏–Ω —Ä–∞–∑, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ–≥–æ.  

---

## üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–ª–æ–∫–∞ ZFS —Å—á–∏—Ç–∞–µ—Ç –µ–≥–æ **—Ö—ç—à (–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É)**.  
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ **DDT (Deduplication Table)**, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π –±–ª–æ–∫ —É–∂–µ –≤ –ø—É–ª–µ.  
3. –ï—Å–ª–∏ –±–ª–æ–∫ –Ω–∞–π–¥–µ–Ω:
   - –Ω–æ–≤—ã–π –±–ª–æ–∫ **–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è**,  
   - —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π.  
4. –ï—Å–ª–∏ –±–ª–æ–∫ –Ω–æ–≤—ã–π:
   - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ø—É–ª,  
   - –µ–≥–æ —Ö—ç—à –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ DDT. 

---

## üîπ –ü—Ä–∏–º–µ—Ä
–§–∞–π–ª `A` –∏ —Ñ–∞–π–ª `B` —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –±–ª–æ–∫–∏:  

A = [X][Y][Z]
B = [X][Y][Z]


–ë–µ–∑ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: —Ö—Ä–∞–Ω–∏—Ç—Å—è 6 –±–ª–æ–∫–æ–≤.  
–° –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π: —Ö—Ä–∞–Ω–∏—Ç—Å—è 3 –±–ª–æ–∫–∞, –∞ –æ–±–∞ —Ñ–∞–π–ª–∞ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ.  

---

## üîπ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç **–Ω–∞ —É—Ä–æ–≤–Ω–µ –±–ª–æ–∫–æ–≤**, –∞ –Ω–µ —Ü–µ–ª—ã—Ö —Ñ–∞–π–ª–æ–≤.  
- –¢—Ä–µ–±—É–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ **–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏**:  
  - –ø—Ä–∏–º–µ—Ä–Ω–æ **1‚Äì5 –ì–ë RAM –Ω–∞ –∫–∞–∂–¥—ã–π 1 –¢–ë –¥–∞–Ω–Ω—ã—Ö**.  
  - —Ç–∞–±–ª–∏—Ü–∞ DDT –¥–æ–ª–∂–Ω–∞ –ø–æ–º–µ—â–∞—Ç—å—Å—è –≤ –ø–∞–º—è—Ç—å –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.  
- –ú–æ–∂–µ—Ç —Å–∏–ª—å–Ω–æ **–∑–∞–º–µ–¥–ª–∏—Ç—å –∑–∞–ø–∏—Å—å**, –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å –º–∞–ª—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º RAM.  

---

## üîπ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Ä–µ–¥ (VM, VDI), –≥–¥–µ –º–Ω–æ–≥–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤,  
- —Ñ–∞–π–ª–æ–≤ —Å –≤—ã—Å–æ–∫–æ–π —Å—Ç–µ–ø–µ–Ω—å—é –ø–æ–≤—Ç–æ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ç–∫–∞–ø—ã –æ–±—Ä–∞–∑–æ–≤).  

‚ùå –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è:
- –¥–æ–º–∞—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –±–µ–∑ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ RAM,  
- –ø—É–ª–æ–≤ —Å —Ä–∞–∑–Ω–æ—Ä–æ–¥–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ).

---

## üîπ –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å
bash
zfs set dedup=on tank/data

---

## üìå –ò—Ç–æ–≥
–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤ ZFS –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–∫–æ–Ω–æ–º–∏—Ç—å –º–µ—Å—Ç–æ, –Ω–æ:
-	—Ç—Ä–µ–±—É–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏,
-	–∑–∞–º–µ–¥–ª—è–µ—Ç –∑–∞–ø–∏—Å—å,
-	—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö —Å –≤—ã—Å–æ–∫–æ–π —Å—Ç–µ–ø–µ–Ω—å—é –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

---

# ‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ZFS

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ
ZFS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏.  
–û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç **–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å** –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –±—ã—Å—Ç—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (SSD).  

---

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∫—ç—à–∞

### 1. ARC (Adaptive Replacement Cache)
- –û—Å–Ω–æ–≤–Ω–æ–π –∫—ç—à –≤ **–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (RAM)**.  
- –•—Ä–∞–Ω–∏—Ç –Ω–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.  
- –£–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –º–µ–∂–¥—É:
  - **—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –±–ª–æ–∫–∞–º–∏** (frequency),  
  - **–Ω–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏** (recency).  
- –ú–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ 50‚Äì75% –≤—Å–µ–π RAM.  

---

### 2. L2ARC (Level 2 ARC)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫—ç—à –Ω–∞ SSD.  
- –•—Ä–∞–Ω–∏—Ç ¬´–≤—ã—Ç–µ—Å–Ω–µ–Ω–Ω—ã–µ¬ª –∏–∑ ARC –±–ª–æ–∫–∏.  
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è **—á—Ç–µ–Ω–∏—è** (read cache).  
- –ü–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏ —Ä–∞–±–æ—á–∏–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –±–æ–ª—å—à–µ –¥–æ—Å—Ç—É–ø–Ω–æ–π RAM.  

---

### 3. ZIL (ZFS Intent Log)
- –ñ—É—Ä–Ω–∞–ª –¥–ª—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏** (`fsync`).  
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø—É–ª–µ (–Ω–∞ –¥–∏—Å–∫–∞—Ö).  
- –ú–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –±—ã—Å—Ç—Ä–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (SSD/SLOG).  
- –£—Å–∫–æ—Ä—è–µ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –º–Ω–æ–≥–æ sync-–∑–∞–ø–∏—Å–µ–π.  

---

## üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ß—Ç–µ–Ω–∏–µ:
   - —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∏—Å–∫ –±–ª–æ–∫–∞ –≤ **ARC**,  
   - –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **L2ARC**,  
   - –µ—Å–ª–∏ –∏ —Ç–∞–º –Ω–µ—Ç ‚Üí —á—Ç–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—É–ª–∞ (HDD/SSD).  

2. –ó–∞–ø–∏—Å—å:
   - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç—å –∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø–æ–∑–∂–µ,  
   - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ **ZIL**, –∞ –ø–æ—Ç–æ–º –ø–∏—à—É—Ç—Å—è –≤ –ø—É–ª.  

---

## üìå –ò—Ç–æ–≥
ZFS –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
-	üîπ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –¥–∞–Ω–Ω—ã–º (ARC, L2ARC),
-	üîπ –∑–∞—â–∏—Ç—É –∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π (ZIL/SLOG),
-	üîπ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM –∏ SSD.
- –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å:
-	–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ RAM –¥–ª—è ARC,
-	–±—ã—Å—Ç—Ä—ã–µ SSD –¥–ª—è L2ARC –∏ ZIL.

---

# üì∏ –°–Ω–∞–ø—à–æ—Ç—ã –≤ ZFS

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ
**–°–Ω–∞–ø—à–æ—Ç (snapshot)** ‚Äî —ç—Ç–æ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–Ω–∏–º–æ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ —Ç–æ–º–∞ ZFS.  
–û–Ω —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–≥–æ –ø—É–ª–∞.  

---

## üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ZFS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **Copy-on-Write (COW)**.  
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–Ω–∞–ø—à–æ—Ç–∞ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –≤ –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏, –∞ —Å—Ç–∞—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è —Å–Ω–∞–ø—à–æ—Ç–∞.  
- –°–Ω–∞–ø—à–æ—Ç –∑–∞–Ω–∏–º–∞–µ—Ç –æ—á–µ–Ω—å –º–∞–ª–æ –º–µ—Å—Ç–∞, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è.  

---

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
- –°–Ω–∞–ø—à–æ—Ç —è–≤–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è**.  
- –°–æ–∑–¥–∞—ë—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ dataset'–∞.  
- –•—Ä–∞–Ω–∏—Ç –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è.  
- –£–¥–∞–ª–µ–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –±–ª–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.  

---

## üîπ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç
- bash
- zfs snapshot tank/data@snap1
### –°–ø–∏—Å–æ–∫ —Å–Ω–∞–ø—à–æ—Ç–æ–≤
- zfs list -t snapshot
### –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç
- zfs mount tank/data@snap1
### –£–¥–∞–ª–∏—Ç—å —Å–Ω–∞–ø—à–æ—Ç
- zfs destroy tank/data@snap1
### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞
- zfs rollback tank/data@snap1
üîπ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å–Ω–∞–ø—à–æ—Ç—ã
- üîπ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ ¬´–Ω–∞ –ª–µ—Ç—É¬ª –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.
- üîπ –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫ –∏–ª–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
- üîπ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–≤—è–∑–∫–∞ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ + —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è).
- üîπ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ (zfs send | zfs receive).

üìå –ò—Ç–æ–≥
### –°–Ω–∞–ø—à–æ—Ç—ã –≤ ZFS ‚Äî —ç—Ç–æ:
- –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Å–Ω–∏–º–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö,
- —ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è Copy-on-Write,
- —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –æ—Ç–∫–∞—Ç–∞ –∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è,
- –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤.

---

# üå± –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ZFS

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ
**–ö–ª–æ–Ω (clone)** –≤ ZFS ‚Äî —ç—Ç–æ –∑–∞–ø–∏—Å—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–Ω–∞–ø—à–æ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è:
- –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ —Å–Ω–∞–ø—à–æ—Ç—É,  
- —è–≤–ª—è–µ—Ç—Å—è **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π** (–º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è),  
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–µ –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å–Ω–∞–ø—à–æ—Ç–æ–º, —ç–∫–æ–Ω–æ–º—è –º–µ—Å—Ç–æ.  

---

## üîπ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –ö–ª–æ–Ω –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞**.  
- –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–Ω–∞–ø—à–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è), –∫–ª–æ–Ω ‚Äî **–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏**.  
- –ö–ª–æ–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞:  
  —É–¥–∞–ª–∏—Ç—å —Å–Ω–∞–ø—à–æ—Ç –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–≤—è–∑–∫–∏ –≤—Å–µ—Ö –µ–≥–æ –∫–ª–æ–Ω–æ–≤.  
- –ö–ª–æ–Ω—ã —ç–∫–æ–Ω–æ–º—è—Ç –º–µ—Å—Ç–æ –±–ª–∞–≥–æ–¥–∞—Ä—è **Copy-on-Write**.  

---

## üîπ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç
- bash
- zfs snapshot tank/data@snap1
### 2. –°–æ–∑–¥–∞—Ç—å –∫–ª–æ–Ω –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞
- zfs clone tank/data@snap1 tank/clone1
### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –∏ –∫–ª–æ–Ω–æ–≤
- zfs list
### 4. –û—Ç–≤—è–∑–∞—Ç—å –∫–ª–æ–Ω (–ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É)
- zfs promote tank/clone1
---
üîπ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –∫–ª–æ–Ω—ã
- üîπ –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ä–µ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- üîπ –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞: –∫–ª–æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –±–ª–æ–∫–∏, —á—Ç–æ –∏ —Å–Ω–∞–ø—à–æ—Ç.
- üîπ –£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –º–æ–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π –±–µ–∑ —Ä–∏—Å–∫–∞.
- üîπ –û—Å–Ω–æ–≤–∞ –¥–ª—è CI/CD –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

üìå –ò—Ç–æ–≥
–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ZFS –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–µ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –±–∞–∑–µ —Å–Ω–∞–ø—à–æ—Ç–æ–≤,
- —ç–∫–æ–Ω–æ–º–∏—Ç—å –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ,
- –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∏ —Ä–∞–±–æ—á–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

</details>

- ## 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å –Ω–∞–∏–ª—É—á—à–∏–º —Å–∂–∞—Ç–∏–µ–º

- **spg@ol-alp-ubuntu1:~$ sudo -i**
- [sudo] password for spg:
- **root@ol-alp-ubuntu1:~# lsblk**
- NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
- sda                         8:0    0   30G  0 disk
- ‚îú‚îÄsda1                      8:1    0    1M  0 part
- ‚îú‚îÄsda2                      8:2    0    2G  0 part /boot
- ‚îî‚îÄsda3                      8:3    0   28G  0 part
-   ‚îî‚îÄubuntu--vg-ubuntu--lv 252:0    0   14G  0 lvm  /
- sdb                         8:16   0  512M  0 disk
- sdc                         8:32   0  512M  0 disk
- sdd                         8:48   0  512M  0 disk
- sde                         8:64   0  512M  0 disk
- sdf                         8:80   0  512M  0 disk
- sdg                         8:96   0  512M  0 disk
- sdh                         8:112  0  512M  0 disk
- sdi                         8:128  0  512M  0 disk
- sr0                        11:0    1 1024M  0 rom
- **root@ol-alp-ubuntu1:~# apt install zfsutils-linux -y** # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ ZFS
- **root@ol-alp-ubuntu1:~# zpool create -f zfs_test mirror /dev/vdb /dev/vdc** # —Å–æ–∑–¥–∞–µ–º –ø—É–ª –Ω–∞ –¥–≤—É—Ö –¥–∏—Å–∫–∞—Ö (bc)
- **root@ol-alp-ubuntu1:~# zpool status**
-   pool: zfs_test
-  state: ONLINE
- config:

- NAME      STATE   READ WRITE CKSUM
- zfs_test  ONLINE   0     0     0
- mirror-0  ONLINE   0     0     0
- sdb     ONLINE     0     0     0
- sdc     ONLINE     0     0     0

- errors: No known data errors
- **root@ol-alp-ubuntu1:~# zpool export zfs_test**  # –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ–º –ø—É–ª —á–µ—Ä–µ–∑ —ç–∫—Å–ø–æ—Ä—Ç-–∏–º–ø–æ—Ä—Ç –≤ otus1
- **root@ol-alp-ubuntu1:~# zpool import zfs_test otus1**
- **root@ol-alp-ubuntu1:~# zpool status** #  –ø–æ—Å–º–æ—Ç—Ä–∏–º –∏–Ω—Ñ—É –ø–æ –¥–∏—Å–∫–∞–º
- pool: otus1
-  state: ONLINE
- config:

- NAME      STATE     READ WRITE CKSUM
- otus1     ONLINE     0     0     0
- mirror-0  ONLINE     0     0     0
- sdb     ONLINE       0     0     0
- sdc     ONLINE       0     0     0

- errors: No known data errors
- **root@ol-alp-ubuntu1:~# zpool create -f otus2 mirror /dev/sdd /dev/sde**
- **root@ol-alp-ubuntu1:~# zpool create -f otus3 mirror /dev/sdf /dev/sdg**
- **root@ol-alp-ubuntu1:~# zpool create -f otus4 mirror /dev/sdh /dev/sdi**
- **root@ol-alp-ubuntu1:~# zpool list** # —Å–æ–∑–¥–∞–ª–∏ 4 –ø—É–ª–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –ø–æ –Ω–∏–º –∏–Ω—Ñ—É
- NAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
- otus1   480M   130K   480M        -         -     0%     0%  1.00x    ONLINE  -
- otus2   480M   130K   480M        -         -     0%     0%  1.00x    ONLINE  -
- otus3   480M   110K   480M        -         -     0%     0%  1.00x    ONLINE  -
- otus4   480M   110K   480M        -         -     0%     0%  1.00x    ONLINE  -

- **root@ol-alp-ubuntu1:~# zfs set compression=lzjb otus1** #  –¥–æ–±–∞–≤–∏–º –∫–∞–∂–¥–æ–º—É –ø—É–ª—É —Ä–∞–∑–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–∂–∞—Ç–∏—è
- **root@ol-alp-ubuntu1:~# zfs set compression=lz4 otus2**
- **root@ol-alp-ubuntu1:~# zfs set compression=gzip-9 otus3**
- **oot@ol-alp-ubuntu1:~# zfs set compression=zle otus4**
- **root@ol-alp-ubuntu1:~# zfs get all | grep compression** # –ø—Ä–æ–≤–µ—Ä–∏–º
- otus1  compression           lzjb                   local
- otus2  compression           lz4                    local
- otus3  compression           gzip-9                 local
- otus4  compression           zle                    local
- ## —Å–∂–∞—Ç–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –≤–Ω–æ–≤—å –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏, –∑–∞–∫–∞—á–∞–µ–º –Ω–∞ –≤—Å–µ 4 –ø—É–ª–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª
- **root@ol-alp-ubuntu1:~# for i in {1..4}; do wget -P /otus$i https://gutenberg.org/cache/epub/2600/pg2600.converter.log; done**
- **root@ol-alp-ubuntu1:~# ls -l /otus*** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤–∏–¥–∏–º, —á—Ç–æ –º–µ—Ç–æ–¥ —Å–∂–∞—Ç–∏—è –≤ –ø—É–ª–µ otus3 (gzip-9) —Å–∞–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ —Å–∂–∞—Ç–∏—é
- /otus1:
- total **22111**
- -rw-r--r-- 1 root root 41174169 Sep  2 07:31 pg2600.converter.log

- /otus2:
- total **18013**
- -rw-r--r-- 1 root root 41174169 Sep  2 07:31 pg2600.converter.log

- /otus3:
- total **10969**
- -rw-r--r-- 1 root root 41174169 Sep  2 07:31 pg2600.converter.log

- /otus4:
- total **40237**
- -rw-r--r-- 1 root root 41174169 Sep  2 07:31 pg2600.converter.log
- **root@ol-alp-ubuntu1:~# zfs list** # –ø—Ä–æ–≤–µ—Ä–∏–º —Å–∫–æ–ª—å–∫–æ –∑–∞–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª –≤ –Ω–∞—à–∏—Ö –ø—É–ª–∞—Ö
- NAME    USED  AVAIL  REFER  MOUNTPOINT
- otus1  21.7M   330M  21.6M  /otus1
- otus2  17.7M   334M  17.6M  /otus2
- otus3  10.9M   341M  10.7M  /otus3
- otus4  39.4M   313M  39.3M  /otus4
- **root@ol-alp-ubuntu1:~# zfs get all | grep compressratio | grep -v ref** # –ø—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–µ–ø–µ–Ω—å —Å–∂–∞—Ç–∏—è –∏ —É–±–µ–¥–∏–º—è —á—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º gzip-9 —Å–∞–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ —Å–∂–∞—Ç–∏—é...
- otus1  compressratio         1.82x                  -
- otus2  compressratio         2.23x                  -
- otus3  compressratio         3.66x                  -
- otus4  compressratio         1.00x                  -
- # 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—É–ª–∞
- **root@ol-alp-ubuntu1:~# wget -O archive.tar.gz --no-check-certificate 'https://drive.usercontent.google.com/download?id=1MvrcEp-WgAQe57aDEzxSRalPAwbNN1Bb&export=download'** # –°–∫–∞—á–∏–≤–∞–µ–º –∞—Ä—Ö–∏–≤ –≤ –¥–æ–º–∞—à–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥
- **root@ol-alp-ubuntu1:~# tar -xzvf archive.tar.gz** #  —Ä–∞—Å–∂–∏–º–∞–µ–º –µ–≥–æ
- zpoolexport/
- zpoolexport/filea
- zpoolexport/fileb
- **root@ol-alp-ubuntu1:~# zpool import -d zpoolexport/**
-    pool: otus # **–∏–º—è –ø—É–ª–∞ otus –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞**
- id: 6554193320433390805
-   state: ONLINE
- status: Some supported features are not enabled on the pool.
- 	(Note that they may be intentionally disabled if the
- 	'compatibility' property is set.)
-  action: The pool can be imported using its name or numeric identifier, though
- 	some features will not be available without an explicit 'zpool upgrade'.
-  config:

- 	otus                         ONLINE
- mirror-0                   ONLINE
- /root/zpoolexport/filea  ONLINE
- /root/zpoolexport/fileb  ONLINE
- **root@ol-alp-ubuntu1:~#  zpool import -d zpoolexport/ otus** # –∏–º–ø–æ—Ä—Ç –ø—É–ª–∞ otus –∫ –Ω–∞–º –≤ –û–°
- **root@ol-alp-ubuntu1:~# zpool status**
-   pool: otus
-  state: ONLINE
- status: Some supported and requested features are not enabled on the pool.
- 	The pool can still be used, but some features are unavailable.
- action: Enable all features using 'zpool upgrade'. Once this is done,
- 	the pool may no longer be accessible by software that does not support
- 	the features. See zpool-features(7) for details.
- config:

- NAME                      STATE     READ WRITE CKSUM
- otus                     ONLINE       0     0     0
- mirror-0                 ONLINE       0     0     0
- /root/zpoolexport/filea  ONLINE       0     0     0
- /root/zpoolexport/fileb  ONLINE       0     0     0

- errors: No known data errors

- **root@ol-alp-ubuntu1:~# zfs get all otus** # –∑–∞–ø—Ä–æ—Å –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **root@ol-alp-ubuntu1:~# zfs get available otus** # –†–∞–∑–º–µ—Ä
- NAME  PROPERTY   VALUE  SOURCE
- otus  available  350M   -
- **root@ol-alp-ubuntu1:~# zfs get readonly otus** # —Ç–∏–ø
- NAME  PROPERTY  VALUE   SOURCE
- otus  readonly  off     default
- **root@ol-alp-ubuntu1:~# zfs get recordsize otus** # –∑–Ω–∞—á–µ–Ω–∏–µ recordsize
- NAME  PROPERTY    VALUE    SOURCE
- otus  recordsize  128K     local
- **root@ol-alp-ubuntu1:~# zfs get compression otus** # —Ç–∏–ø —Å–∂–∞—Ç–∏—è (–∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç–∫–ª—é—á–µ–Ω–∏—è)
- NAME  PROPERTY     VALUE           SOURCE
- otus  compression  zle             local
- **root@ol-alp-ubuntu1:~# zfs get checksum otus** # —Ç–∏–ø –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
- NAME  PROPERTY  VALUE      SOURCE
- otus  checksum  sha256     local
- ## 3. –†–∞–±–æ—Ç–∞ —Å–æ —Å–Ω–∞–ø—à–æ—Ç–æ–º, –ø–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- **root@ol-alp-ubuntu1:~# pwd**
- /root
- root@ol-alp-ubuntu1:~# wget -O otus_task2.file --no-check-certificate https://drive.usercontent.google.com/download?id=1wgxjih8YZ-cqLqaZVa0lA3h3Y029c3oI&export=download # –°–∫–∞—á–∞–µ–º —Ñ–∞–π–ª, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –∑–∞–¥–∞–Ω–∏–∏
- [1] 7119
- Redirecting output to ‚Äòwget-log‚Äô.

- [1]+  Done                    wget -O otus_task2.file --no-check-certificate https://drive.usercontent.google.com/download?id=1wgxjih8YZ-cqLqaZVa0lA3h3Y029c3oI
- **root@ol-alp-ubuntu1:~# ls** # –ø—Ä–æ–≤–µ—Ä–∏–º
- archive.tar.gz  **otus_task2.file**  wget-log  zpoolexport
- **root@ol-alp-ubuntu1:~# zfs receive otus/test@today < otus_task2.file** # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞
- **oot@ol-alp-ubuntu1:~# find /otus/test -name "secret_message"**
- /otus/test/task1/file_mess/secret_message
- /otus/test/task1/file_mess/secret_message
- -bash: /otus/test/task1/file_mess/secret_message: Permission denied
- **root@ol-alp-ubuntu1:~# cat /otus/test/task1/file_mess/secret_message**
- https://otus.ru/lessons/linux-hl/ # –≤–∏–¥–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫—É—Ä—Å OTUS
- https://otus.ru/lessons/linux-hl/

- -bash: https://otus.ru/lessons/linux-hl/: No such file or directory
## –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

---

 ## 6 –£—Ä–æ–∫

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ**
<ins>–†–∞–±–æ—Ç–∞ —Å NFS</ins>

**–¶–µ–ª—å:** –Ω–∞—É—á–∏—Ç—å—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å NFS –∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –∫ –Ω–µ–º—É –∫–ª–∏–µ–Ω—Ç–æ–≤;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

- –∑–∞–ø—É—Å—Ç–∏—Ç—å 2 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω—ã (—Å–µ—Ä–≤–µ—Ä NFS –∏ –∫–ª–∏–µ–Ω—Ç–∞);
- –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ NFS –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è;
- –≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏–º–µ–Ω–µ–º upload —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –Ω–µ—ë;
- —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (systemd, autofs –∏–ª–∏ fstab ‚Äî –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º);
- –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞ NFS –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º NFSv3.

‚≠êÔ∏è –ó–∞–¥–∞–Ω–∏–µ —Å–æ –∑–≤–µ–∑–¥–æ—á–∫–æ–π*

- –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ KERBEROS —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º NFSv4

<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary> 
# NFS vs FUSE ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

## üìå –í–≤–µ–¥–µ–Ω–∏–µ
- **NFS (Network File System)** ‚Äî —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ —Å–µ—Ç–∏.  
- **FUSE (Filesystem in Userspace)** ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –¥—Ä–∞–π–≤–µ—Ä–æ–≤ —è–¥—Ä–∞.  

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π               | **NFS**                                                                 | **FUSE**                                                                 |
|------------------------|-------------------------------------------------------------------------|--------------------------------------------------------------------------|
| **–ß—Ç–æ —ç—Ç–æ**            | –°–µ—Ç–µ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ                             | –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è     |
| **–£—Ä–æ–≤–µ–Ω—å**            | –†–∞–±–æ—Ç–∞–µ—Ç –≤ —è–¥—Ä–µ –û–° (—á–µ—Ä–µ–∑ NFS-–∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä)                            | –†–∞–±–æ—Ç–∞–µ—Ç –≤ userspace (—á–µ—Ä–µ–∑ `libfuse` –∏ –¥—Ä–∞–π–≤–µ—Ä —è–¥—Ä–∞ FUSE)               |
| **–¢–∏–ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**  | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ø–∞–ø–æ–∫ –ø–æ —Å–µ—Ç–∏                                     | –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö/–Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º                       |
| **–ü—Ä–∏–º–µ—Ä—ã**            | `mount -t nfs server:/data /mnt`                                        | `sshfs user@host:/ /mnt`, `encfs`, `ntfs-3g`, `rclone mount`             |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –í—ã—à–µ (—á–∞—Å—Ç—å –ª–æ–≥–∏–∫–∏ –≤ —è–¥—Ä–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å —Å–µ—Ç–∏)                 | –ù–∏–∂–µ (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–¥—Ä–æ ‚Üî userspace), –Ω–æ –±–æ–ª–µ–µ –≥–∏–±–∫–æ                     |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å**          | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–π –¥—Ä–∞–π–≤–µ—Ä —è–¥—Ä–∞                                       | –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å FS –Ω–∞ C/C++/Python/Rust                                     |
| **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**         | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∫–ª–∞—Å—Ç–µ—Ä—ã, –æ—Ñ–∏—Å–Ω—ã–µ —Å–µ—Ç–∏                       | –û–±–ª–∞–∫–∞, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–ø–∫–∏, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º       |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**       | NFSv3: —Å–ª–∞–±–∞—è (–ø–æ IP), NFSv4: Kerberos, ACL                             | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—á–∞—Å—Ç–æ SSH, TLS –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)         |
| **–ü–ª—é—Å—ã**              | –ü—Ä–æ—Å—Ç–æ—Ç–∞, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å                                        | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å ¬´–Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ¬ª —Ö—Ä–∞–Ω–∏–ª–∏—â–∞       |
| **–ú–∏–Ω—É—Å—ã**             | –ñ—ë—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—É NFS                              | –ë–æ–ª–µ–µ –Ω–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏          |

---
## üõ† –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üìÇ NFS
- bash
# –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ NFS-—Å–µ—Ä–≤–µ—Ä–∞
- sudo mount -t nfs 192.168.1.10:/data /mnt/data

### üîê FUSE (sshfs)
# –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ —á–µ—Ä–µ–∑ SSH
- sshfs user@remote:/home/user /mnt/remote

---

## üõ† –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- ‚úÖ **NFS** ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∏ –±—ã—Å—Ç—Ä–æ —Ä–∞—Å—à–∞—Ä–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –º–µ–∂–¥—É –º–∞—à–∏–Ω–∞–º–∏ (–ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å, NAS, –∫–ª–∞—Å—Ç–µ—Ä—ã).  
- ‚úÖ **FUSE** ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –æ–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ—Å—Ç—É–ø –ø–æ SSH –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–¥–∫–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤.  
  </details>

  <details>
<summary> 
	
**–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É vim**
</summary>
- Vim –®–ø–∞—Ä–≥–∞–ª–∫–∞

## –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Vim ‚Äî –æ–¥–Ω–æ–≥–æ –∏–∑ —Å–∞–º—ã—Ö –º–æ—â–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤.

---

## –†–µ–∂–∏–º—ã
- **Normal (–æ–±—ã—á–Ω—ã–π)** ‚Äî —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–∞–≤–∏–≥–∞—Ü–∏—è, –∫–æ–º–∞–Ω–¥—ã).
- **Insert (–≤—Å—Ç–∞–≤–∫–∞)** ‚Äî –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ (`i`, `a`, `o`).
- **Visual (–≤—ã–¥–µ–ª–µ–Ω–∏–µ)** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–ª–æ–∫–∞–º–∏ —Ç–µ–∫—Å—Ç–∞ (`v`, `V`, `Ctrl+v`).
- **Command-line** ‚Äî –∫–æ–º–∞–Ω–¥—ã (`:`).

---

## –ù–∞–≤–∏–≥–∞—Ü–∏—è
- `h` / `l` ‚Äî –≤–ª–µ–≤–æ / –≤–ø—Ä–∞–≤–æ  
- `j` / `k` ‚Äî –≤–Ω–∏–∑ / –≤–≤–µ—Ä—Ö  
- `0` / `^` / `$` ‚Äî –Ω–∞—á–∞–ª–æ / –ø–µ—Ä–≤—ã–π –Ω–µ–ø—Ä–æ–±–µ–ª—å–Ω—ã–π / –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏  
- `w` / `e` ‚Äî –≤–ø–µ—Ä—ë–¥ –∫ –Ω–∞—á–∞–ª—É / –∫–æ–Ω—Ü—É —Å–ª–æ–≤–∞  
- `b` ‚Äî –Ω–∞–∑–∞–¥ –∫ –Ω–∞—á–∞–ª—É —Å–ª–æ–≤–∞  
- `gg` ‚Äî –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞  
- `G` ‚Äî –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞  
- `:{n}` ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–æ–∫—É `n`  

---

## –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `i` ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –∫—É—Ä—Å–æ—Ä–æ–º  
- `a` ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –∫—É—Ä—Å–æ—Ä–∞  
- `o` / `O` ‚Äî –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–∏–∂–µ / –≤—ã—à–µ  
- `x` ‚Äî —É–¥–∞–ª–∏—Ç—å —Å–∏–º–≤–æ–ª  
- `dd` ‚Äî —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É  
- `yy` ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É  
- `p` ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –∫—É—Ä—Å–æ—Ä–∞  
- `u` ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å (undo)  
- `Ctrl+r` ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç—å (redo)  

---

## –ü–æ–∏—Å–∫ –∏ –∑–∞–º–µ–Ω–∞
- `/—Å–ª–æ–≤–æ` ‚Äî –ø–æ–∏—Å–∫ —Å–ª–æ–≤–∞ –≤–ø–µ—Ä—ë–¥  
- `?—Å–ª–æ–≤–æ` ‚Äî –ø–æ–∏—Å–∫ —Å–ª–æ–≤–∞ –Ω–∞–∑–∞–¥  
- `n` / `N` ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –≤–ø–µ—Ä—ë–¥ / –Ω–∞–∑–∞–¥  
- `:%s/—Å—Ç–∞—Ä–æ–µ/–Ω–æ–≤–æ–µ/g` ‚Äî –∑–∞–º–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ  
- `:.,$s/—Å—Ç–∞—Ä–æ–µ/–Ω–æ–≤–æ–µ/g` ‚Äî –∑–∞–º–µ–Ω–∞ —Å —Ç–µ–∫—É—â–µ–π –¥–æ –∫–æ–Ω—Ü–∞  

---

## –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
- `:w` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å  
- `:q` ‚Äî –≤—ã–π—Ç–∏  
- `:wq` –∏–ª–∏ `ZZ` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏  
- `:q!` ‚Äî –≤—ã–π—Ç–∏ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è  
- `:e –∏–º—è` ‚Äî –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª  
- `:r –∏–º—è` ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞  

---

## –ü–æ–ª–µ–∑–Ω–æ–µ
- `.` ‚Äî –ø–æ–≤—Ç–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã  
- `>>` / `<<` ‚Äî —Å–¥–≤–∏–≥ —Å—Ç—Ä–æ–∫–∏ –≤–ø—Ä–∞–≤–æ / –≤–ª–µ–≤–æ (—Ç–∞–±—É–ª—è—Ü–∏—è)  
- `:%!sort` ‚Äî –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω—é—é –∫–æ–º–∞–Ω–¥—É  
- `:set number` ‚Äî –≤–∫–ª—é—á–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫  
- `:syntax on` ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞  

---

## –í—ã—Ö–æ–¥ –∏–∑ Vim (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ üòÖ)
- `:wq` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏  
- `:q!` ‚Äî –≤—ã–π—Ç–∏ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è  
- `ZZ` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)  

---

üìå –°–æ–≤–µ—Ç: –ø—Ä–∞–∫—Ç–∏–∫—É–π—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–π `vimtutor` –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
</details>
---

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:**
- –∑–∞–ø—É—â–µ–Ω—ã –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã ol-apl-ubuntu-sernfs –∏ ol-apl-ubuntu-clntnfs —Å –û–° Ubuntu Linux (64-bit) 24.04.3 LTS
- **spg@ol-apl-ubuntu-sernfs:~$ sudo -i**
- [sudo] password for spg:
- **root@ol-apl-ubuntu-sernfs:~# apt install nfs-kernel-server** # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ NFS, –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ /etc/nfs.conf
- **root@ol-apl-ubuntu-sernfs:~# ss -tnplu** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–ª—É—à–∞—é—â–∏—Ö –ø–æ—Ä—Ç–æ–≤
- tcp         LISTEN       0            64                              0.0.0.0:2049                     0.0.0.0:*
- **root@ol-apl-ubuntu-sernfs:~# mkdir -p /srv/share/upload** # —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
- **root@ol-apl-ubuntu-sernfs:~# chown -R nobody:nogroup /srv/share** # –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- **root@ol-apl-ubuntu-sernfs:~# chmod 0777 /srv/share/upload** # –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞
- **root@ol-apl-ubuntu-sernfs:~# vim /etc/exports** # –∑–¥–µ—Å—å –ª–µ–∂–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª–∏—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- /srv/share 10.0.77.0/24(rw,sync,root_squash) # –¥–æ–±–∞–≤–∏–º —Ç—É–¥–∞ —Å—Ç—Ä–æ—á–∫—É –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω–∞—à–µ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –¥–ª—è –Ω–∞—à–µ–π —Å–µ—Ç–∏ 10.0.77.0/24

- **root@ol-apl-ubuntu-sernfs:~# exportfs -r** # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- exportfs: /etc/exports [1]: Neither 'subtree_check' or 'no_subtree_check' specified for export "10.0.77.0/24:/srv/share".
- Assuming default behaviour ('no_subtree_check').
- NOTE: this default has changed since nfs-utils version 1.0.x
- **root@ol-apl-ubuntu-sernfs:~# exportfs -s** # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
- /srv/share  10.0.77.0/24(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,root_squash,no_all_squash)
---
- ## –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç NFS
- **—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞ NFS**
- **spg@ol-apl-ubuntu-clntnfs:~$ sudo -i**
- [sudo] password for spg:
- **root@ol-apl-ubuntu-clntnfs:~# apt install nfs-common**
- **root@ol-apl-ubuntu-clntnfs:~# echo "10.0.77.182:/srv/share/ /mnt nfs vers=3,noauto,x-systemd.automount 0 0" >> /etc/fstab** # –¥–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **root@ol-apl-ubuntu-clntnfs:~# vim /etc/fstab** # –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nfs
- 10.0.77.182:/srv/share/ /mnt nfs vers=3,noauto,x-systemd.automount 0 0
- **root@ol-apl-ubuntu-clntnfs:~# systemctl daemon-reload**  # –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–∞–º–∏—Ö —Å–ª—É–∂–±
- **root@ol-apl-ubuntu-clntnfs:~# systemctl restart remote-fs.target** # –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ systemd
---
- ## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- **root@ol-apl-ubuntu-sernfs:/srv/share/upload# cd /srv/share/upload/**
- **root@ol-apl-ubuntu-sernfs:/srv/share/upload# touch check_file**
- **root@ol-apl-ubuntu-sernfs:/srv/share/upload# ls -hal**
- total 8.0K
- drwxrwxrwx 2 nobody nogroup 4.0K Sep 22 12:26 .
- drwxr-xr-x 3 nobody nogroup 4.0K Sep 22 12:25 ..
- -rw-r--r-- 1 root   root       0 Sep 22 12:26 check_file
- **root@ol-apl-ubuntu-clntnfs:/mnt/upload# cd /mnt/upload/**
- **root@ol-apl-ubuntu-clntnfs:/mnt/upload# ls -hal**
- total 8.0K
- drwxrwxrwx 2 nobody nogroup 4.0K Sep 22 12:26 .
- drwxr-xr-x 3 nobody nogroup 4.0K Sep 22 12:25 ..
- -rw-r--r-- 1 root   root       0 Sep 22 12:26 check_file
---
- ## –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å—Ç–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:
- ##  –ö–ª–∏–µ–Ω—Ç
- **root@ol-apl-ubuntu-clntnfs:/mnt/upload# reboot**
- **spg@ol-apl-ubuntu-clntnfs:~$ sudo -i**
- [sudo] password for spg:
- **root@ol-apl-ubuntu-clntnfs:~# ls -hal  /mnt/upload/**
- total 8.0K
- drwxrwxrwx 2 nobody nogroup 4.0K Sep 22 12:26 .
- drwxr-xr-x 3 nobody nogroup 4.0K Sep 22 12:25 ..
- ## –°–µ—Ä–≤–µ—Ä
- **root@ol-apl-ubuntu-sernfs:~# reboot**
- **root@ol-apl-ubuntu-sernfs:~# exportfs -s**
- /srv/share  10.0.77.0/24(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,root_squash,no_all_squash)
- **root@ol-apl-ubuntu-sernfs:~# showmount -a**
- All mount points on ol-apl-ubuntu-sernfs:
- 10.0.77.142:/srv/share
- **root@ol-apl-ubuntu-sernfs:~# ls -hal  /srv/share/upload/**
- total 8.0K
- drwxrwxrwx 2 nobody nogroup 4.0K Sep 22 12:26 .
- drwxr-xr-x 3 nobody nogroup 4.0K Sep 22 12:25 ..
- -rw-r--r-- 1 root   root       0 Sep 22 12:26 check_file
- ## –∫–ª–∏–µ–Ω—Ç
- **root@ol-apl-ubuntu-clntnfs:~# ls -hal  /mnt/upload/**
- total 8.0K
- drwxrwxrwx 2 nobody nogroup 4.0K Sep 22 12:26 .
- drwxr-xr-x 3 nobody nogroup 4.0K Sep 22 12:25 ..
- -rw-r--r-- 1 root   root       0 Sep 22 12:26 check_file
- - root@ol-apl-ubuntu-clntnfs:~#
- - -rw-r--r-- 1 root   root       0 Sep 22 12:26 check_file
- **root@ol-apl-ubuntu-clntnfs:~# cd /mnt/upload/**
- **root@ol-apl-ubuntu-clntnfs:/mnt/upload# touch final_check**
- **root@ol-apl-ubuntu-clntnfs:/mnt/upload# ls -hal**
- total 8.0K
- drwxrwxrwx 2 nobody nogroup 4.0K Sep 22 12:44 .
- drwxr-xr-x 3 nobody nogroup 4.0K Sep 22 12:25 ..
- -rw-r--r-- 1 root   root       0 Sep 22 12:26 **check_file**
- -rw-r--r-- 1 nobody nogroup    0 Sep 22 12:44 **final_check**
- ## –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω

## 7 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–°–±–æ—Ä–∫–∞ RPM-–ø–∞–∫–µ—Ç–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"</ins>

–¶–µ–ª—å: –ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–±–∏—Ä–∞—Ç—å RPM-–ø–∞–∫–µ—Ç—ã.
–°–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π RPM-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- 1.—Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π RPM (–º–æ–∂–Ω–æ –≤–∑—è—Ç—å —Å–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ª–∏–±–æ —Å–æ–±—Ä–∞—Ç—å –∫ –ø—Ä–∏–º–µ—Ä—É Apache —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏);
- 2.c–æ–∑–¥–∞—Ç—å —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ç–∞–º —Ä–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–π RPM;
- 3.—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–æ –≤—Å–µ –ª–∏–±–æ –≤ Vagrant, –ª–∏–±–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —É —Å–µ–±—è —á–µ—Ä–µ–∑ Nginx –∏ –¥–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

<details>
	
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
# –°–±–æ—Ä–∫–∞ RPM-–ø–∞–∫–µ—Ç–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ Ubuntu

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã —Å–±–æ—Ä–∫–∏ RPM-–ø–∞–∫–µ—Ç–æ–≤ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º–µ Ubuntu.  
Ubuntu –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–±–æ—Ç–∞–µ—Ç —Å DEB-–ø–∞–∫–µ—Ç–∞–º–∏, –Ω–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å RPM –¥–ª—è —Å–∏—Å—Ç–µ–º —Å–µ–º–µ–π—Å—Ç–≤–∞ RHEL/CentOS/Fedora.

---

## üì¶ –ß—Ç–æ —Ç–∞–∫–æ–µ RPM
- **RPM (Red Hat Package Manager)** ‚Äî —Ñ–æ—Ä–º–∞—Ç –±–∏–Ω–∞—Ä–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ RHEL, CentOS, Fedora, openSUSE.  
- –ê–Ω–∞–ª–æ–≥ —Ñ–æ—Ä–º–∞—Ç–∞ `.deb` –≤ Debian/Ubuntu.  
- –°–æ–¥–µ—Ä–∂–∏—Ç:
  - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã,
  - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∏–º—è, –≤–µ—Ä—Å–∏—è, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏),
  - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è.

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–±–æ—Ä–∫–∏

1. **–ò—Å—Ö–æ–¥–Ω–∏–∫–∏** ‚Äî –∞—Ä—Ö–∏–≤ —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º (`mypkg-1.0.tar.gz`).  
2. **.spec-—Ñ–∞–π–ª** ‚Äî —Ä–µ—Ü–µ–ø—Ç —Å–±–æ—Ä–∫–∏:
   - –∏–º—è –∏ –≤–µ—Ä—Å–∏—è –ø–∞–∫–µ—Ç–∞,
   - —Å–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π,
   - —Ä–∞–∑–¥–µ–ª—ã `%prep`, `%build`, `%install`, `%files`.  
3. **rpmbuild** ‚Äî —É—Ç–∏–ª–∏—Ç–∞, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è —Å–±–æ—Ä–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ `.spec`.  
   –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ `~/rpmbuild/`:
- **BUILD/** ‚Üí –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–±–æ—Ä–∫–∏
- **RPMS/** ‚Üí –≥–æ—Ç–æ–≤—ã–µ –±–∏–Ω–∞—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- **SOURCES/** ‚Üí –∏—Å—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ö–∏–≤—ã
- **SPECS/** ‚Üí spec-—Ñ–∞–π–ª—ã
- **SRPMS/** ‚Üí –∏—Å—Ö–æ–¥–Ω—ã–µ SRPM-–ø–∞–∫–µ—Ç—ã

  
## üìÇ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π RPM
–ß—Ç–æ —ç—Ç–æ
- –ö–∞—Ç–∞–ª–æ–≥ —Å .rpm-–ø–∞–∫–µ—Ç–∞–º–∏ –∏ –∏–Ω–¥–µ–∫—Å–æ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç yum –∏–ª–∏ dnf:
- 1. –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤,
- 2. —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏,
- 3. –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–∞–∫–µ—Ç—ã.
  4. 
## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- createrepo –∏–ª–∏ createrepo_c ‚Äî —Å–æ–∑–¥–∞—é—Ç repodata/ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–∞–∫–µ—Ç–æ–≤.

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã
- 1	–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç .rpm-—Ñ–∞–π–ª—ã –≤ –∫–∞—Ç–∞–ª–æ–≥.
- 2	–ó–∞–ø—É—Å–∫–∞–µ—Ç: createrepo /–ø—É—Ç—å/–∫/–∫–∞—Ç–∞–ª–æ–≥—É
   –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–∞–ø–∫–∞ repodata/.
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–∞–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ HTTP/FTP/NFS. –ù–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è .repo-—Ñ–∞–π–ª –≤ /etc/yum.repos.d/:
  
## ‚öñÔ∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ Ubuntu
- Ubuntu —Å–∞–º–∞ RPM –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç.
- –°–±–æ—Ä–∫–∞ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω—É–∂–Ω—ã, –µ—Å–ª–∏ Ubuntu –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- –∫–∞–∫ —Å–±–æ—Ä–æ—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è CentOS/Fedora,
- –∏–ª–∏ –∫–∞–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π-—Å–µ—Ä–≤–µ—Ä, —Ä–∞–∑–¥–∞—é—â–∏–π RPM-–∫–ª–∏–µ–Ω—Ç–∞–º.
- –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω—ã –ø–∞–∫–µ—Ç—ã: sudo apt install rpm rpm-build createrepo alien
 
## üìä –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ (.tar.gz)
- ‚îÇ
- ‚ñº
- SPEC-—Ñ–∞–π–ª (.spec)
- ‚îÇ
- ‚ñº
- rpmbuild ‚îÄ‚îÄ‚îÄ‚ñ∫ RPM-–ø–∞–∫–µ—Ç (.rpm)
- ‚îÇ
- ‚ñº
- createrepo ‚îÄ‚îÄ‚ñ∫ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (repodata/)
- ‚îÇ
- ‚ñº
- –ö–ª–∏–µ–Ω—Ç (yum/dnf)
___

# DEB vs RPM

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø–∞–∫–µ—Ç–æ–≤ –≤ Linux: **DEB** (Debian/Ubuntu) –∏ **RPM** (RHEL/CentOS/Fedora).

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞       | DEB                                      | RPM                                       |
|-----------------------|-------------------------------------------|--------------------------------------------|
| **–°–µ–º–µ–π—Å—Ç–≤–æ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–≤** | Debian, Ubuntu, Linux Mint              | RHEL, CentOS, Fedora, openSUSE             |
| **–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤** | `dpkg`, `apt`                             | `rpm`, `yum`, `dnf`, `zypper`              |
| **–§–æ—Ä–º–∞—Ç –ø–∞–∫–µ—Ç–∞**    | `.deb`                                    | `.rpm`                                     |
| **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ**       | Control-—Ñ–∞–π–ª—ã (`control`, `postinst`, `prerm`) | Spec-—Ñ–∞–π–ª (`.spec`, —Å–µ–∫—Ü–∏–∏ `%prep`, `%build`, `%install`) |
| **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏**      | `apt`-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å `Packages.gz`          | `yum/dnf`-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å `repodata/`        |
| **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–±–æ—Ä–∫–∏** | `dpkg-deb`, `debuild`, `pbuilder`         | `rpmbuild`                                 |
| **–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏** | –ü–æ–¥–ø–∏—Å–∏ GPG, –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π         | –ü–æ–¥–ø–∏—Å–∏ GPG, –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π         |
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**    | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Debian-–ø–æ–¥–æ–±–Ω—ã—Ö      | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ RedHat-–ø–æ–¥–æ–±–Ω—ã—Ö             |

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –≤ –¥—Ä—É–≥–æ–π.  
–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ **alien**:

# DEB ‚Üí RPM
alien -r mypackage.deb

# RPM ‚Üí DEB
alien -d mypackage.rpm

___

## üìä –°—Ö–µ–º–∞ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã
 Debian/Ubuntu ‚îÄ‚îÄ‚îÄ‚ñ∫ DEB ‚îÄ‚îÄ‚îÄ‚ñ∫ apt/dpkg
 RedHat/Fedora ‚îÄ‚îÄ‚îÄ‚ñ∫ RPM ‚îÄ‚îÄ‚îÄ‚ñ∫ yum/dnf/zypper

## ‚úÖ –ò—Ç–æ–≥
- DEB ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è Debian/Ubuntu.
- RPM ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è RedHat/Fedora.
- –û–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É: —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏
- –†–∞–∑–ª–∏—á–∞—é—Ç—Å—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –≤ —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitGub:
- cd –ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É
- git remote add origin https://github.com/psibirenko-svg/spgrepo.git
- git branch -M main
- git push -u origin main
</details>

- **[root@AlmaLinux93 ~]# yum install -y wget rpmdevtools rpm-build createrepo \
 yum-utils cmake gcc git nano** # –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RPM (rpmdevtools), –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ (rpm-build), –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ YUM/DNF —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è(createrepo), –¥–æ–ø.—É—Ç–∏–ª–∏—Ç—ã (yum-utils), —Å–∏—Å—Ç–µ–º—É —Å–±–æ—Ä–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ (cmake), –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä C (gcc), —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π (git) –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä (nano)
- ...
- Complete!
- **[root@AlmaLinux93 ~]# mkdir rpm && cd rpm** # —Å–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥
- **[root@AlmaLinux93 rpm]#**
- ### –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –≤–æ–∑—å–º–µ–º –ø–∞–∫–µ—Ç Nginx –∏ —Å–æ–±–µ—Ä–µ–º –µ–≥–æ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –º–æ–¥—É–ª–µ–º ngx_broli
- **root@AlmaLinux93 rpm]# yumdownloader --source nginx** # —Å–∫–∞—á–∞–µ–º nginx RPM –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥
- enabling appstream-source repository
- enabling baseos-source repository
- enabling extras-source repository
- AlmaLinux 9 - AppStream - Source                                                          912 kB/s | 881 kB     00:00
- AlmaLinux 9 - BaseOS - Source                                                             387 kB/s | 377 kB     00:00
- AlmaLinux 9 - Extras - Source                                                              14 kB/s | 8.2 kB     00:00
- nginx-1.20.1-22.el9_6.3.alma.1.src.rpm                                                    3.8 MB/s | 1.1 MB     00:00
- **[root@AlmaLinux93 rpm]# ls**
- nginx-1.20.1-22.el9_6.3.alma.1.src.rpm
- **[root@AlmaLinux93 rpm]# ls /root/rpmbuild/**
- ***[root@AlmaLinux93 rpm]# rpm -Uvh nginx*.src.rpm**
- Updating / installing...
- 1:nginx-2:1.20.1-22.el9_6.3.alma.1 warning: user mockbuild does not exist - using root
- warning: group mock does not exist - using root
- ################################# [100%]
- **[root@AlmaLinux93 rpm]# ls /root/rpmbuild/**
- BUILD  RPMS  SOURCES  SPECS  SRPMS

- **[root@AlmaLinux93 rpm]# ls /root/rpmbuild/SPECS/**
- nginx.spec
- **[root@AlmaLinux93 rpm]# ls /root/rpmbuild/SOURCES/**
- 0001-remove-Werror-in-upstream-build-scripts.patch               UPGRADE-NOTES-1.6-to-1.10
- 0002-fix-PIDFile-handling.patch                                  macros.nginxmods.in
- 0003-Support-loading-cert-hardware-token-PKC.patch               maxim.key
- 0004-Set-proper-compiler-optimalization-level-O2-for-perl.patch  mdounin.key
- 0005-Init-openssl-engine-properly.patch                          nginx-1.20.1-CVE-2025-23419.patch
- 0006-Fix-ALPACA-security-issue.patch                             nginx-1.20.1.tar.gz
- 0007-Enable-TLSv1.3-by-default.patch                             nginx-1.20.1.tar.gz.asc
- 0008-CVE-2023-44487-HTTP-2-per-iteration-stream-handling.patch   nginx-logo.png
- 0009-defer-ENGINE_finish-calls-to-a-cleanup.patch                nginx-upgrade
- 0010-Optimized-chain-link-usage.patch                            nginx-upgrade.8
- 0011-CVE-2024-7347-Buffer-overread-in-the-mp4-module.patch       nginx.conf
- 0012-CVE-2022-41741-and-CVE-2022-41742-fix.patch                 nginx.logrotate
- 0013-SSL-use-of-the-SSL_OP_IGNORE_UNEXPECTED_EOF-option.patch    nginx.service
- 404.html                                                         nginx.sysusers
- 50x.html                                                         nginxmods.attr
- README.dynamic                                                   sb.key
- **[root@AlmaLinux93 rpm]# yum-builddep nginx** # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø–∞–∫–µ—Ç–∞ Nginx –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ (SRPM) –Ω–∞ AlmaLinux/RHEL-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.
- **[root@AlmaLinux93 rpm]# cd /root**
- **[root@AlmaLinux93 ~]# git clone --recurse-submodules -j8 \
https://github.com/google/ngx_brotli** # –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–æ–¥—É–ª—è ngx_brotli ‚Äî –æ–Ω
–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- Cloning into 'ngx_brotli'...
- remote: Enumerating objects: 237, done.
- remote: Counting objects: 100% (37/37), done.
- remote: Compressing objects: 100% (16/16), done.
- remote: Total 237 (delta 24), reused 21 (delta 21), pack-reused 200 (from 1)
- Receiving objects: 100% (237/237), 79.51 KiB | 992.00 KiB/s, done.
- Resolving deltas: 100% (114/114), done.
- Submodule 'deps/brotli' (https://github.com/google/brotli.git) registered for path 'deps/brotli'
- Cloning into '/root/ngx_brotli/deps/brotli'...
- remote: Enumerating objects: 8473, done.
- remote: Counting objects: 100% (240/240), done.
- remote: Compressing objects: 100% (143/143), done.
- remote: Total 8473 (delta 146), reused 102 (delta 96), pack-reused 8233 (from 4)
- Receiving objects: 100% (8473/8473), 41.85 MiB | 30.03 MiB/s, done.
- Resolving deltas: 100% (5401/5401), done.
- Submodule path 'deps/brotli': checked out 'ed738e842d2fbdf2d6459e39267a633c4a9b2f5d'
- **[root@AlmaLinux93 ~]# cd ngx_brotli/deps/brotli**
- **[root@AlmaLinux93 brotli]# mkdir out && cd out**
- **[root@AlmaLinux93 out]# cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DCMAKE_C_FLAGS="-Ofast -m64 -march=native -mtune=native -flto -funroll-loops -ffunction-sections -fdata-sections -Wl,--gc-sections" -DCMAKE_CXX_FLAGS="-Ofast -m64 -march=native -mtune=native -flto -funroll-loops -ffunction-sections -fdata-sections -Wl,--gc-sections" -DCMAKE_INSTALL_PREFIX=./installed ..** # –°–æ–±–∏—Ä–∞–µ–º –º–æ–¥—É–ª—å ngx_brotli: **-DCMAKE_BUILD_TYPE=Release** - —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è —Ä–µ–ª–∏–∑–∞ (–±–µ–∑ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π —Å–∫–æ—Ä–æ—Å—Ç–∏),**-DBUILD_SHARED_LIBS=OFF** - —Å–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤–º–µ—Å—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö, **-DCMAKE_C_FLAGS="..."** - —Ñ–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –¥–ª—è C: **-Ofast** ‚Äî –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏; **-m64** ‚Äî 64-–±–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞; **-march=native -mtune=native** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞; **-flto** ‚Äî Link Time Optimization (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —ç—Ç–∞–ø–µ –ª–∏–Ω–∫–æ–≤–∫–∏); **-funroll-loops** ‚Äî —Ä–∞—Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–æ–≤; **-ffunction-sections**  **-fdata-sections** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ–∫—Ü–∏–∏; **-Wl,--gc-sections** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ–∫—Ü–∏–π –Ω–∞ —ç—Ç–∞–ø–µ –ª–∏–Ω–∫–æ–≤–∫–∏. **-DCMAKE_CXX_FLAGS="..."** - –¢–µ –∂–µ —Ñ–ª–∞–≥–∏, –Ω–æ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ C++. **-DCMAKE_INSTALL_PREFIX=./installed** - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –±–∏–ª–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é ./installed.

- -- The C compiler identification is GNU 11.5.0
- -- Detecting C compiler ABI info
- -- Detecting C compiler ABI info - done
- -- Check for working C compiler: /bin/cc - skipped
- -- Detecting C compile features
- -- Detecting C compile features - done
- -- Build type is 'Release'
- -- Performing Test BROTLI_EMSCRIPTEN
- -- Performing Test BROTLI_EMSCRIPTEN - Failed
- -- Compiler is not EMSCRIPTEN
- -- Looking for log2
- -- Looking for log2 - not found
- -- Looking for log2
- -- Looking for log2 - found
- -- Configuring done (0.5s)
- -- Generating done (0.0s)
- CMake Warning:
- Manually-specified variables were not used by the project:

- CMAKE_CXX_FLAGS

-- Build files have been written to: /root/ngx_brotli/deps/brotli/out

- **[root@AlmaLinux93 out]# cmake --build . --config Release -j 2 --target brotlienc**
- [  3%] Building C object CMakeFiles/brotlicommon.dir/c/common/constants.c.o
- [  6%] Building C object CMakeFiles/brotlicommon.dir/c/common/context.c.o
- [ 10%] Building C object CMakeFiles/brotlicommon.dir/c/common/dictionary.c.o
- [ 13%] Building C object CMakeFiles/brotlicommon.dir/c/common/platform.c.o
- [ 17%] Building C object CMakeFiles/brotlicommon.dir/c/common/shared_dictionary.c.o
- [ 20%] Building C object CMakeFiles/brotlicommon.dir/c/common/transform.c.o
- [ 24%] Linking C static library libbrotlicommon.a
- [ 24%] Built target brotlicommon
- [ 27%] Building C object CMakeFiles/brotlienc.dir/c/enc/backward_references.c.o
- [ 31%] Building C object CMakeFiles/brotlienc.dir/c/enc/backward_references_hq.c.o
- [ 34%] Building C object CMakeFiles/brotlienc.dir/c/enc/bit_cost.c.o
- [ 37%] Building C object CMakeFiles/brotlienc.dir/c/enc/block_splitter.c.o
- [ 41%] Building C object CMakeFiles/brotlienc.dir/c/enc/brotli_bit_stream.c.o
- [ 44%] Building C object CMakeFiles/brotlienc.dir/c/enc/cluster.c.o
- [ 48%] Building C object CMakeFiles/brotlienc.dir/c/enc/command.c.o
- [ 51%] Building C object CMakeFiles/brotlienc.dir/c/enc/compound_dictionary.c.o
- [ 55%] Building C object CMakeFiles/brotlienc.dir/c/enc/compress_fragment.c.o
- [ 58%] Building C object CMakeFiles/brotlienc.dir/c/enc/compress_fragment_two_pass.c.o
- [ 62%] Building C object CMakeFiles/brotlienc.dir/c/enc/dictionary_hash.c.o
- [ 65%] Building C object CMakeFiles/brotlienc.dir/c/enc/encode.c.o
- [ 68%] Building C object CMakeFiles/brotlienc.dir/c/enc/encoder_dict.c.o
- [ 72%] Building C object CMakeFiles/brotlienc.dir/c/enc/entropy_encode.c.o
- [ 75%] Building C object CMakeFiles/brotlienc.dir/c/enc/fast_log.c.o
- [ 79%] Building C object CMakeFiles/brotlienc.dir/c/enc/histogram.c.o
- [ 82%] Building C object CMakeFiles/brotlienc.dir/c/enc/literal_cost.c.o
- [ 86%] Building C object CMakeFiles/brotlienc.dir/c/enc/memory.c.o
- [ 89%] Building C object CMakeFiles/brotlienc.dir/c/enc/metablock.c.o
- [ 93%] Building C object CMakeFiles/brotlienc.dir/c/enc/static_dict.c.o
- [ 96%] Building C object CMakeFiles/brotlienc.dir/c/enc/utf8_util.c.o
- [100%] Linking C static library libbrotlienc.a
- [100%] Built target brotlienc
- **[root@AlmaLinux93 out]# cd ../../../..**
- **[root@AlmaLinux93 ~]# pwd**
- /root
-  –ù—É–∂–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å —Å–∞–º spec —Ñ–∞–π–ª, —á—Ç–æ–±—ã Nginx —Å–æ–±–∏—Ä–∞–ª—Å—è —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –Ω–∞–º –æ–ø—Ü–∏—è–º–∏: –Ω–∞—Ö–æ–¥–∏–º —Å–µ–∫—Ü–∏—é —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ configure (–¥–æ —É—Å–ª–æ–≤–∏–π if) –∏ –¥–æ–±–∞–≤–ª—è–µ–º —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª—å (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ —É–∫–∞–∑–∞—Ç—å –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π –æ–±—Ä–∞—Ç–Ω—ã–π —Å–ª—ç—à):
--add-module=/root/ngx_brotli \
- **[root@AlmaLinux93]# vi /root/rpmbuild/SPECS/nginx.spec**
- **[root@AlmaLinux93 SPECS]# rpmbuild -ba nginx.spec -D 'debug_package %{nil}'** # —Å–æ–±–∏—Ä–∞–µ–º –ø–∞–∫–µ—Ç RPM, –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–±–æ—Ä–∫—É binary –∏ source –ø–∞–∫–µ—Ç–æ–≤ (-b = build, a = all).‚Ä®–¢–æ –µ—Å—Ç—å —Å–æ–∑–¥–∞—é—Ç—Å—è: 	–±–∏–Ω–∞—Ä–Ω—ã–π RPM ~/rpmbuild/RPMS/‚Ä¶ –∏ 	–∏—Å—Ö–æ–¥–Ω—ã–π SRPM ~/rpmbuild/SRPMS/‚Ä¶ –∏ -D 'debug_package - –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–∞–∫–µ—Ç–∞ —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏

- ...
- Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.lNW9Nj
- + umask 022
- + cd /root/rpmbuild/BUILD
- + cd nginx-1.20.1
- + LICENSEDIR=/root/rpmbuild/BUILDROOT/nginx-1.20.1-22.el9.3.alma.1.x86_64/usr/share/licenses/nginx-core
- + export LC_ALL=C
- + LC_ALL=C
- + export LICENSEDIR
- + /usr/bin/mkdir -p /root/rpmbuild/BUILDROOT/nginx-1.20.1-22.el9.3.alma.1.x86_64/usr/share/licenses/nginx-core
- + cp -pr LICENSE /root/rpmbuild/BUILDROOT/nginx-1.20.1-22.el9.3.alma.1.x86_64/usr/share/licenses/nginx-core
- + RPM_EC=0
- ++ jobs -p
- + exit 0
- **root@AlmaLinux93 rpmbuild]# ls -hal RPMS/x86_64/** # —Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –ø–∞–∫–µ—Ç—ã —Å–æ–∑–¥–∞–ª–∏—Å—å
- ...
-rw-r--r--. 1 root root   37K Sep 24 13:50 nginx-1.20.1-22.el9.3.alma.1.x86_64.rpm
- ...
- –ö–æ–ø–∏—Ä—É–µ–º –ø–∞–∫–µ—Ç—ã –≤ –æ–±—â–∏–π –∫–∞—Ç–∞–ª–æ–≥
- ***[root@AlmaLinux93 rpmbuild]# cp ~/rpmbuild/RPMS/noarch/* ~/rpmbuild/RPMS/x86_64/** 
- **[root@AlmaLinux93 rpmbuild]# cd ~/rpmbuild/RPMS/x86_64**
- **[root@AlmaLinux93 x86_64]# yum localinstall *.rpm***
- ...
- Installed:
- almalinux-logos-httpd-90.6-2.el9.noarch                         nginx-2:1.20.1-22.el9.3.alma.1.x86_64
- nginx-all-modules-2:1.20.1-22.el9.3.alma.1.noarch               nginx-core-2:1.20.1-22.el9.3.alma.1.x86_64
- nginx-filesystem-2:1.20.1-22.el9.3.alma.1.noarch                nginx-mod-devel-2:1.20.1-22.el9.3.alma.1.x86_64
- nginx-mod-http-image-filter-2:1.20.1-22.el9.3.alma.1.x86_64     nginx-mod-http-perl-2:1.20.1-22.el9.3.alma.1.x86_64
- nginx-mod-http-xslt-filter-2:1.20.1-22.el9.3.alma.1.x86_64      nginx-mod-mail-2:1.20.1-22.el9.3.alma.1.x86_64
- nginx-mod-stream-2:1.20.1-22.el9.3.alma.1.x86_64
- Complete!
- **[root@AlmaLinux93 x86_64]# systemctl start nginx**
- **[root@AlmaLinux93 x86_64]# systemctl status nginx**
- ...
- Sep 24 14:11:30 AlmaLinux93 systemd[1]: Starting The nginx HTTP and reverse proxy server...
- Sep 24 14:11:30 AlmaLinux93 nginx[49885]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
- Sep 24 14:11:30 AlmaLinux93 nginx[49885]: nginx: configuration file /etc/nginx/nginx.conf test is successful
- Sep 24 14:11:30 AlmaLinux93 systemd[1]: Started The nginx HTTP and reverse proxy server.

---

# –°–æ–∑–¥–µ–º —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —Ä–∞–∑–º–µ—â–∞–µ–º —Ç–∞–º —Ä–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–π RPM

- **[root@AlmaLinux93 x86_64]# mkdir /usr/share/nginx/html/repo**
- **[root@AlmaLinux93 x86_64]# cp ~/rpmbuild/RPMS/x86_64/*.rpm /usr/share/nginx/html/repo/** #–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ —É Nginx –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é /usr/share/nginx/html. –°–æ–∑–¥–∞–¥–∏–º —Ç–∞–º –∫–∞—Ç–∞–ª–æ–≥ repo: –∫–æ–ø–∏—Ä—É–µ–º —Ç—É–¥–∞ –Ω–∞—à–∏ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ RPM-–ø–∞–∫–µ—Ç—ã

- **root@AlmaLinux93 x86_64]# ls /usr/share/nginx/html/repo/** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- nginx-1.20.1-22.el9.3.alma.1.x86_64.rpm              nginx-mod-http-image-filter-1.20.1-22.el9.3.alma.1.x86_64.rpm
- nginx-all-modules-1.20.1-22.el9.3.alma.1.noarch.rpm  nginx-mod-http-perl-1.20.1-22.el9.3.alma.1.x86_64.rpm
- nginx-core-1.20.1-22.el9.3.alma.1.x86_64.rpm         nginx-mod-http-xslt-filter-1.20.1-22.el9.3.alma.1.x86_64.rpm
- nginx-filesystem-1.20.1-22.el9.3.alma.1.noarch.rpm   nginx-mod-mail-1.20.1-22.el9.3.alma.1.x86_64.rpm
- nginx-mod-devel-1.20.1-22.el9.3.alma.1.x86_64.rpm    nginx-mod-stream-1.20.1-22.el9.3.alma.1.x86_64.rpm
- **[root@AlmaLinux93 x86_64]# createrepo /usr/share/nginx/html/repo/** # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- Directory walk started
- Directory walk done - 10 packages
- Temporary output repo path: /usr/share/nginx/html/repo/.repodata/
- Preparing sqlite DBs
- Pool started (with 5 workers)
- Pool finished
- **root@AlmaLinux93 x86_64]# vi /etc/nginx/nginx.conf** # –Ω–∞—Å—Ç—Ä–æ–∏–º –≤ NGINX –¥–æ—Å—Ç—É–ø –∫ –ª–∏—Å—Ç–∏–Ω–≥—É –∫–∞—Ç–∞–ª–æ–≥–∞. –í —Ñ–∞–π–ª–µ /etc/nginx/nginx.conf –≤ –±–ª–æ–∫–µ server –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã:
- index index.html index.htm;
- autoindex on;
- **[root@AlmaLinux93 x86_64]# nginx -t** #  –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º nginx
- nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
- nginx: configuration file /etc/nginx/nginx.conf test is successful
- **[root@AlmaLinux93 x86_64]# nginx -s reload**
- <html>
- <head><title>Index of /repo/</title></head>
- <body>
- <h1>Index of /repo/</h1><hr><pre><a href="../">../</a>
- <a href="repodata/">repodata/</a>                                          25-Sep-2025 12:15                   -
- <a href="nginx-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-1.20.1-22.el9.3.alma.1.x86_64.rpm</a>            25-Sep-2025 12:11               36976
- <a href="nginx-all-modules-1.20.1-22.el9.3.alma.1.noarch.rpm">nginx-all-modules-1.20.1-22.el9.3.alma.1.noarch..&gt;</a> 25-Sep-2025 12:11                8089
- <a href="nginx-core-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-core-1.20.1-22.el9.3.alma.1.x86_64.rpm</a>       25-Sep-2025 12:11             1030199
- <a href="nginx-filesystem-1.20.1-22.el9.3.alma.1.noarch.rpm">nginx-filesystem-1.20.1-22.el9.3.alma.1.noarch.rpm</a> 25-Sep-2025 12:11                9696
- <a href="nginx-mod-devel-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-mod-devel-1.20.1-22.el9.3.alma.1.x86_64.rpm</a>  25-Sep-2025 12:11              761144
- <a href="nginx-mod-http-image-filter-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-mod-http-image-filter-1.20.1-22.el9.3.alm..&gt;</a> 25-Sep-2025 12:11               20101
- <a href="nginx-mod-http-perl-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-mod-http-perl-1.20.1-22.el9.3.alma.1.x86_..&gt;</a> 25-Sep-2025 12:11               31607
- <a href="nginx-mod-http-xslt-filter-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-mod-http-xslt-filter-1.20.1-22.el9.3.alma..&gt;</a> 25-Sep-2025 12:11               18885
- <a href="nginx-mod-mail-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-mod-mail-1.20.1-22.el9.3.alma.1.x86_64.rpm</a>   25-Sep-2025 12:11               54514
- <a href="nginx-mod-stream-1.20.1-22.el9.3.alma.1.x86_64.rpm">nginx-mod-stream-1.20.1-22.el9.3.alma.1.x86_64.rpm</a> 25-Sep-2025 12:11               81157
- </pre><hr></body>
- </html>
- **[root@AlmaLinux93 x86_64]# cat >> /etc/yum.repos.d/otus.repo << EOF** # –í—Å–µ –≥–æ—Ç–æ–≤–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.–î–æ–±–∞–≤–∏–º –µ–≥–æ –≤ /etc/yum.repos.d
- > [otus]
- > name=otus-linux
- > baseurl=http://localhost/repo
- > gpgcheck=0
- > enabled=1
- > EOF
- **[root@AlmaLinux93 x86_64]# yum repolist enabled | grep otus**
- otus                             otus-linux
- **[root@AlmaLinux93 x86_64]# cd /usr/share/nginx/html/repo/** # –î–æ–±–∞–≤–∏–º –ø–∞–∫–µ—Ç –≤ –Ω–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- **[root@AlmaLinux93 repo]# wget https://repo.percona.com/yum/percona-release-latest.noarch.rpm**
- --2025-09-26 11:38:38--  https://repo.percona.com/yum/percona-release-latest.noarch.rpm
- Resolving repo.percona.com (repo.percona.com)... 49.12.125.205, 2a01:4f8:242:5792::2
- Connecting to repo.percona.com (repo.percona.com)|49.12.125.205|:443... connected.
- HTTP request sent, awaiting response... 200 OK
- Length: 28532 (28K) [application/x-redhat-package-manager]
- Saving to: ‚Äòpercona-release-latest.noarch.rpm‚Äô

- percona-release-latest.noarch.rpm       100%[=============================================================================>]  27.86K  --.-KB/s    in 0s

- 2025-09-26 11:38:39 (292 MB/s) - ‚Äòpercona-release-latest.noarch.rpm‚Äô saved [28532/28532]
- **[root@AlmaLinux93 repo]# createrepo /usr/share/nginx/html/repo/** # –û–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- Directory walk started
- Directory walk done - 11 packages
- Temporary output repo path: /usr/share/nginx/html/repo/.repodata/
- Preparing sqlite DBs
- Pool started (with 5 workers)
- Pool finished
- **[root@AlmaLinux93 repo]# yum makecache**
- AlmaLinux 9 - AppStream                                                                                                       6.9 kB/s | 4.2 kB     00:00
- AlmaLinux 9 - BaseOS                                                                                                          5.9 kB/s | 3.8 kB     00:00
- AlmaLinux 9 - Extras                                                                                                          7.7 kB/s | 3.3 kB     00:00
- otus-linux                                                                                                                    2.9 MB/s | 3.0 kB     00:00
- otus-linux                                                                                                                    2.1 MB/s | 7.2 kB     00:00
- **[root@AlmaLinux93 repo]# yum list | grep otus**
- percona-release.noarch                               1.0-32                              otus
---

- **[root@AlmaLinux93 repo]# yum install -y percona-release.noarch** # –¢–∞–∫ –∫–∞–∫ Nginx —É –Ω–∞—Å —É–∂–µ —Å—Ç–æ–∏—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π percona-release
- Last metadata expiration check: 0:01:48 ago on Fri Sep 26 11:42:24 2025.
- Dependencies resolved.
- ==============================================================================================================================================================
-  Package                                      Architecture                        Version                             Repository                         Size
- ==============================================================================================================================================================
- Installing:
-  percona-release                              noarch                              1.0-32                              otus                               28 k

- Transaction Summary
- ==============================================================================================================================================================
- Install  1 Package

- Total download size: 28 k
- Installed size: 50 k
- Downloading Packages:
- percona-release-latest.noarch.rpm                                                                                              18 MB/s |  28 kB     00:00
- --------------------------------------------------------------------------------------------------------------------------------------------------------------
- Total                                                                                                                         2.7 MB/s |  28 kB     00:00
- Running transaction check
- Transaction check succeeded.
- Running transaction test
- Transaction test succeeded.
- Running transaction
-   Preparing        :                                                                                                                                      1/1
-   Installing       : percona-release-1.0-32.noarch                                                                                                        1/1
-   Running scriptlet: percona-release-1.0-32.noarch                                                                                                        1/1
- * Enabling the Percona Release repository
- <*> All done!
- * Enabling the Percona Telemetry repository
- <*> All done!
- * Enabling the PMM2 Client repository
- <*> All done!
- The percona-release package now contains a percona-release script that can enable additional repositories for our newer products.

- Note: currently there are no repositories that contain Percona products or distributions enabled. We recommend you to enable Percona Distribution repositories instead of - - - individual product repositories, because with the Distribution you will get not only the database itself but also a set of other componets that will help you work with your - - database.

- For example, to enable the Percona Distribution for MySQL 8.0 repository use:

-   percona-release setup pdps8.0

- Note: To avoid conflicts with older product versions, the percona-release setup command may disable our original repository for some products.

- For more information, please visit:
-   https://docs.percona.com/percona-software-repositories/percona-release.html


-   Verifying        : percona-release-1.0-32.noarch                                                                                                        1/1

- Installed:
-   percona-release-1.0-32.noarch

- **Complete!**

---

root@AlmaLinux93 repo]# git init
hint: Using 'master' as the name for the initial branch. This default branch name
hint: is subject to change. To configure the initial branch name to use in all
hint: of your new repositories, which will suppress this warning, call:
hint:
hint: 	git config --global init.defaultBranch <name>
hint:
hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
hint: 'development'. The just-created branch can be renamed via this command:
hint:
hint: 	git branch -m <name>
Initialized empty Git repository in /usr/share/nginx/html/repo/.git/



## 8 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–†–∞–±–æ—Ç–∞ —Å –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º"</ins>

–¶–µ–ª—å: –Ω–∞—É—á–∏—Ç—å—Å—è –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –ø–∞—Ä–æ–ª—è;
—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å LVM –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å –≤ VG;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- 1. –í–∫–ª—é—á–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é Grub.
- 2. –ü–æ–ø–∞—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –ø–∞—Ä–æ–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏.
- 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å LVM, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å VG.

<details>
	
<summary> = –¢–µ–æ—Ä–∏—è = </summary>

</details>

# 1.–í–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é Grub

- **root@ol-apl-ubuntu:~# vim /etc/default/grub** # –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
- "/etc/default/grub" 40L, 1538B                                                                 1,1           All
- ...
- GRUB_DEFAULT=0
- **#GRUB_TIMEOUT_STYLE=hidden**
- **GRUB_TIMEOUT=10**
- GRUB_DISTRIBUTOR=`( . /etc/os-release; echo ${NAME:-Ubuntu} ) 2>/dev/null || echo Ubuntu`
- GRUB_CMDLINE_LINUX_DEFAULT=""
- GRUB_CMDLINE_LINUX=""
- ...
- **root@ol-apl-ubuntu:~# update-grub** # –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é GRUB
- Sourcing file `/etc/default/grub'
- Generating grub configuration file ...
- Found linux image: /boot/vmlinuz-6.8.0-84-generic
- Found initrd image: /boot/initrd.img-6.8.0-84-generic
- Found linux image: /boot/vmlinuz-6.8.0-83-generic
- Found initrd image: /boot/initrd.img-6.8.0-83-generic
- Warning: os-prober will not be executed to detect other bootable partitions.
- Systems on them will not be added to the GRUB boot configuration.
- Check GRUB_DISABLE_OS_PROBER documentation entry.
- Adding boot menu entry for UEFI Firmware Settings ...
- done
- **root@ol-apl-ubuntu:~# reboot** # –ø—Ä–æ–≤–µ—Ä—è–µ–º, –º–µ–Ω—é GRUB –ø–æ—è–≤–∏–ª–æ—Å—å
- –Ω–∞–∂–∏–º–∞–µ–º "e" (edit) –∫–æ–≥–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –º–µ–Ω—é GRUB, –ø–æ–ø–∞–¥–∞–µ–º –≤ –æ–∫–Ω–æ, –≥–¥–µ –º—ã –º–æ–∂–µ–º –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
-
# 2. –ü–æ–ø–∞—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –ø–∞—Ä–æ–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

- **–°–ø–æ—Å–æ–± 1. init=/bin/bash**
- –í –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–µ–π—Å—è —Å linux, –¥–æ–±–∞–≤–ª—è–µ–º init=/bin/bash
- 
- –∏ –Ω–∞–∂–∏–º–∞–µ–º —Åtrl-x –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Å–∏—Å—Ç–µ–º—É
- –í—ã –ø–æ–ø–∞–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É. –ù–æ –µ—Å—Ç—å –æ–¥–∏–Ω –Ω—é–∞–Ω—Å. –†—É—Ç–æ–≤–∞—è —Ñ–∞–π–ª–æ–≤–∞—è
—Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏ —ç—Ç–æ–º –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ Read-Only. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–µ –≤ —Ä–µ–∂–∏–º Read-Write, –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–æ–π:
- **root@(none):/# mount -o remount,rw /
- **root@(none):/# vim 123 # —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª 123, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º, –∑–∞–ø–∏—Å—ã–≤—ã–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º: –ï–°–¢–¨ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å!
- 
- **–°–ø–æ—Å–æ–± 2. Recovery mode**
- –í –º–µ–Ω—é –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–º —É—Ä–æ–≤–Ω–µ –≤—ã–±—Ä–∞—Ç—å –≤—Ç–æ—Ä–æ–π –ø—É–Ω–∫—Ç (Advanced options‚Ä¶), –¥–∞–ª–µ–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é —Å —É–∫–∞–∑–∞–Ω–∏–µ–º recovery mode –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏. 
- –ü–æ–ª—É—á–∏–º –º–µ–Ω—é —Ä–µ–∂–∏–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
- –í —ç—Ç–æ–º –º–µ–Ω—é —Å–Ω–∞—á–∞–ª–∞ –≤–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–µ—Ç–∏ **(network)** –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å –≤ —Ä–µ–∂–∏–º read/write (–ª–∏–±–æ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é).
- –î–∞–ª–µ–µ –≤—ã–±–∏—Ä–∞–µ–º –ø—É–Ω–∫—Ç **root** –∏ –ø–æ–ø–∞–¥–∞–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º root. –ï—Å–ª–∏ –≤—ã —Ä–∞–Ω–µ–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ–≥–æ –Ω–µ—Ç), —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–≥–æ –≤–≤–µ—Å—Ç–∏. 
–í —ç—Ç–æ–π –∫–æ–Ω—Å–æ–ª–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –ª—é–±—ã–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–æ–π. –†–ê–ë–û–¢–ê–ï–¢!!
- **root@ol-apl-ubuntu:Àú# pw**
- /root
- **root@ol-apl-ubuntu:Àú# vim 222** # —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —É–¥–∞–ª—è–µ–º
- **root@ol-apl-ubuntu:Àú# vim /etc/group** # —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞...

- # 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å LVM, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å VG
- 
- **spg@ol-apl-ubuntu:~$ sudo -i**
- [sudo] password for spg:
- **root@ol-apl-ubuntu:~# vgs** # —Å–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- VG        #PV #LV #SN Attr   VSize   VFree
- **ubuntu-vg   1   1   0 wz--n- <28.00g 14.00g**

- **root@ol-apl-ubuntu:~# vgrename ubuntu-vg ubuntu-otus** # –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º Volume Group
- Volume group "ubuntu-vg" successfully renamed to "ubuntu-otus"
- 
- **root@ol-apl-ubuntu:~# vim /boot/grub/grub.cfg** #–î–∞–ª–µ–µ –ø—Ä–∞–≤–∏–º /boot/grub/grub.cfg. –í–µ–∑–¥–µ –∑–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ VG –Ω–∞ –Ω–æ–≤–æ–µ (–≤ —Ñ–∞–π–ª–µ –¥–µ—Ñ–∏—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–≤–∞ –¥–µ—Ñ–∏—Å–∞ ubuntu--vg ubuntu--otus).
- **root@ol-apl-ubuntu:~# reboot**

- Broadcast message from root@ol-apl-ubuntu on pts/1 (Wed 2025-10-01 09:22:27 UTC):

- The system will reboot now!

- **root@ol-apl-ubuntu:~# vgs**
-  VG          #PV #LV #SN Attr   VSize   VFree
-  **ubuntu-otus**   1   1   0 wz--n- <28.00g 14.00g

# 2 –º–µ—Å—è—Ü
## 9 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"Systemd - —Å–æ–∑–¥–∞–Ω–∏–µ unit-—Ñ–∞–π–ª–∞"</ins>

-  –¶–µ–ª—å: –ù–∞—É—á–∏—Ç—å—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ unit-—Ñ–∞–π–ª—ã;

üéØ**–ó–∞–¥–∞–Ω–∏–µ
- 1. –ù–∞–ø–∏—Å–∞—Ç—å service, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (—Ñ–∞–π–ª –ª–æ–≥–∞ –∏ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω—ã –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –≤ /etc/default).
- 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å spawn-fcgi –∏ —Å–æ–∑–¥–∞—Ç—å unit-—Ñ–∞–π–ª (spawn-fcgi.sevice) —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–¥–µ–ª–∫–∏ init-—Å–∫—Ä–∏–ø—Ç–∞ (https://gist.github.com/cea2k/1318020).
- 3. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å unit-—Ñ–∞–π–ª Nginx (nginx.service) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
	# Systemd ‚Äî —à–ø–∞—Ä–≥–∞–ª–∫–∞

## üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ systemd
**systemd** ‚Äî —ç—Ç–æ init-—Å–∏—Å—Ç–µ–º–∞ Linux, –∫–æ—Ç–æ—Ä–∞—è:
- —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ –¥–µ–º–æ–Ω–∞–º–∏,
- –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫,
- —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ (`journald`),
- —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–∞–π–º–µ—Ä–∞–º–∏ (–∞–Ω–∞–ª–æ–≥ cron),
- –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–µ—Å—É—Ä—Å—ã (cgroups).

---

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`systemctl`)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- sudo systemctl start nginx      # –∑–∞–ø—É—Å—Ç–∏—Ç—å
- sudo systemctl stop nginx       # –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
- sudo systemctl restart nginx    # –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
- sudo systemctl reload nginx     # –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥

### –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
sudo systemctl enable nginx     # –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl disable nginx    # –≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- systemctl status nginx

üîπ –õ–æ–≥–∏
- journalctl -u nginx.service     # –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ nginx
- journalctl -f                   # "tail -f" –¥–ª—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤
- journalctl --since "10 min ago" # –ª–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç

üîπ –Æ–Ω–∏—Ç-—Ñ–∞–π–ª (–ø—Ä–∏–º–µ—Ä —Å–µ—Ä–≤–∏—Å–∞)
- /etc/systemd/system/myapp.service:

 [Unit]
- Description=My Test App
- After=network.target

[Service]
- ExecStart=/usr/bin/python3 /opt/myapp/app.py
- WorkingDirectory=/opt/myapp
- Restart=always
- User=www-data

[Install]
- WantedBy=multi-user.target

üîπ –¢–∞–π–º–µ—Ä (–∞–Ω–∞–ª–æ–≥ cron)
- –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ —Ä–∞–∑ –≤ —á–∞—Å.
- –°–µ—Ä–≤–∏—Å /etc/systemd/system/myscript.service:

[Unit]
- Description=Run script

[Service]
- ExecStart=/usr/local/bin/myscript.sh
- –¢–∞–π–º–µ—Ä /etc/systemd/system/myscript.timer:

[Unit]
- Description=Run script every hour

[Timer]
OnCalendar=hourly
Persistent=true

[Install]
- WantedBy=timers.target

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è:
- sudo systemctl enable --now myscript.timer

‚ö° –ò—Ç–æ–≥
-	‚Ä¢	systemctl ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
-	‚Ä¢	journalctl ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
-	‚Ä¢	unit-—Ñ–∞–π–ª—ã ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
-	‚Ä¢	timers ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ cron

# Systemd Units ‚Äî —à–ø–∞—Ä–≥–∞–ª–∫–∞

## üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ Unit
**Unit** ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç –≤ systemd.  
–ö–∞–∂–¥—ã–π unit –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —Ä–µ—Å—É—Ä—Å: —Å–µ—Ä–≤–∏—Å, —Å–æ–∫–µ—Ç, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–∞–π–º–µ—Ä –∏ —Ç.–¥.

---

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã Unit
- **service** ‚Äî —Å–µ—Ä–≤–∏—Å –∏–ª–∏ –¥–µ–º–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `nginx.service`)
- **socket** ‚Äî —Å–æ–∫–µ—Ç –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é (`cups.socket`)
- **device** ‚Äî —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —è–¥—Ä–∞ (`dev-sda.device`)
- **mount** ‚Äî —Ç–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (`mnt-data.mount`)
- **automount** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **target** ‚Äî –≥—Ä—É–ø–ø–∞ —é–Ω–∏—Ç–æ–≤ (–∞–Ω–∞–ª–æ–≥ runlevel, –Ω–∞–ø—Ä–∏–º–µ—Ä `multi-user.target`)
- **timer** ‚Äî –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞–Ω–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (`backup.timer`)
- **path** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- **slice** ‚Äî –≥—Ä—É–ø–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ (cgroups)
- **scope** ‚Äî –µ–¥–∏–Ω–∏—á–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–æ–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## üîπ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è Unit-—Ñ–∞–π–ª—ã
- `/etc/systemd/system/` ‚Äî —é–Ω–∏—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ)
- `/lib/systemd/system/` –∏–ª–∏ `/usr/lib/systemd/system/` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ —é–Ω–∏—Ç—ã
- `~/.config/systemd/user/` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —é–Ω–∏—Ç—ã

---

## üîπ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Unit-—Ñ–∞–π–ª–∞
–ü—Ä–∏–º–µ—Ä `myapp.service`:

[Unit]
Description=My Application
After=network.target

[Service]
ExecStart=/usr/bin/python3 /opt/myapp/app.py
WorkingDirectory=/opt/myapp
Restart=always
User=www-data

[Install]
WantedBy=multi-user.target

</details>

 - ## 1. –ù–∞–ø–∏—Å–∞—Ç—å service, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (—Ñ–∞–π–ª –ª–æ–≥–∞ –∏ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω—ã –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –≤ /etc/default).

- **root@ol-apl-ubuntu:~# cat > /etc/default/watchlog**
- #Configuration file for my watchlog service
- #Place it to /etc/default

- #File and word in that file that we will be monit
- WORD="**ALERT**"
- LOG=/var/log/watchlog.log

- **root@ol-apl-ubuntu:~# cat /var/log/syslog > /var/log/watchlog.log** # –ò –ø–æ—Ç–æ–º –≤ —Å—Ç—Ä–æ–∫–∏ –∫–æ–µ-–≥–¥–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ ‚Äò**ALERT**‚Äô
- **root@ol-apl-ubuntu:~# cat > /opt/watchlog.sh**
#!/bin/bash

- WORD=$1
- LOG=$2
- DATE=`date`

- if grep $WORD $LOG &> /dev/null
- then
- logger "$DATE: I found word, Master!" # –ö–æ–º–∞–Ω–¥–∞ logger –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª.
- else
- exit 0
- fi

- **root@ol-apl-ubuntu:~# vim /opt/watchlog.sh**
- **root@ol-apl-ubuntu:~# chmod +x /opt/watchlog.sh**
- **root@ol-apl-ubuntu:~# cat > /etc/systemd/system/watchlog.service** # –°–æ–∑–¥–∞–¥–∏–º —é–Ω–∏—Ç –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞
- [Unit]
- Description=My watchlog service

- [Service]
- Type=oneshot
- EnvironmentFile=/etc/default/watchlog
- ExecStart=/opt/watchlog.sh $WORD $LOG
- **root@ol-apl-ubuntu:~# cat > /etc/systemd/system/watchlog.timer** # –°–æ–∑–¥–∞–¥–∏–º —é–Ω–∏—Ç –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
- [Unit]
- Description=Run watchlog script every 30 second

- [Timer]
- #Run every 30 second
- OnUnitActiveSec=30
- Unit=watchlog.service

- [Install]
- WantedBy=multi-user.target

- **root@ol-apl-ubuntu:~# systemctl start watchlog.timer** # –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
- **root@ol-apl-ubuntu:~# systemctl start watchlog.service** # —Ç–∞–π–º–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –ø–æ–∫–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª —Å–µ—Ä–≤–∏—Å (?)
- **root@ol-apl-ubuntu:~# tail -f 1000 /var/log/syslog  | grep word** #  –∏ –≤—Ä–µ–º—è —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ timer –Ω–µ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç...
- **root@ol-apl-ubuntu:~# vi /etc/systemd/system/watchlog.timer** # –ø–æ—Å–ª–µ 30 –ø–æ—Å—Ç–∞–≤–∏–ª "s" -seconds, –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (—Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ —Ç–æ—á–Ω–æ —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥)
- **root@ol-apl-ubuntu:~# sudo systemctl daemon-reload**
- **root@ol-apl-ubuntu:~# sudo systemctl enable --now /etc/systemd/system/watchlog.timer**
- **root@ol-apl-ubuntu:~# tail -f 1000 /var/log/syslog  | grep word**
- tail: cannot open '1000' for reading: No such file or directory
- 2025-10-01T16:57:44.553189+03:00 ol-apl-ubuntu root: Wed Oct  1 04:57:44 PM MSK 2025: I found word, Master!
- 2025-10-01T16:58:42.720890+03:00 ol-apl-ubuntu root: Wed Oct  1 04:58:42 PM MSK 2025: I found word, Master!
- 2025-10-01T16:59:52.724261+03:00 ol-apl-ubuntu root: Wed Oct  1 04:59:52 PM MSK 2025: I found word, Master!
- 2025-10-01T17:00:52.719809+03:00 ol-apl-ubuntu root: Wed Oct  1 05:00:52 PM MSK 2025: I found word, Master!
- 2025-10-01T17:01:52.720875+03:00 ol-apl-ubuntu root: Wed Oct  1 05:01:52 PM MSK 2025: I found word, Master!
- 2025-10-01T17:02:52.722077+03:00 ol-apl-ubuntu root: Wed Oct  1 05:02:52 PM MSK 2025: I found word, Master!
- 2025-10-01T17:03:42.719089+03:00 ol-apl-ubuntu root: Wed Oct  1 05:03:42 PM MSK 2025: I found word, Master!
- 2025-10-01T17:04:32.719106+03:00 ol-apl-ubuntu root: Wed Oct  1 05:04:32 PM MSK 2025: I found word, Master!
- 2025-10-01T17:05:42.721282+03:00 ol-apl-ubuntu root: Wed Oct  1 05:05:42 PM MSK 2025: I found word, Master!
- 2025-10-01T17:06:42.716960+03:00 ol-apl-ubuntu root: Wed Oct  1 05:06:42 PM MSK 2025: I found word, Master!

- 
- ## 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å spawn-fcgi –∏ —Å–æ–∑–¥–∞—Ç—å unit-—Ñ–∞–π–ª (spawn-fcgi.sevice) —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–¥–µ–ª–∫–∏ init-—Å–∫—Ä–∏–ø—Ç–∞
- 
- **root@ol-apl-ubuntu:~# apt install spawn-fcgi php php-cgi php-cli  apache2 libapache2-mod-fcgid -y** # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º spawn-fcgi –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –Ω–µ–≥–æ –ø–∞–∫–µ—Ç—ã
- **root@ol-apl-ubuntu:~# cat > /etc/spawn-fcgi/fcgi.conf**
- -bash: /etc/spawn-fcgi/fcgi.conf: No such file or directory

- **root@ol-apl-ubuntu:~# mkdir /etc/spawn-fcgi** # —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- **root@ol-apl-ubuntu:~# cat > /etc/spawn-fcgi/fcgi.conf**
- #You must set some working options before the "spawn-fcgi" service will work.
- #If SOCKET points to a file, then this file is cleaned up by the init script.
- 
- #See spawn-fcgi(1) for all possible options.
- 
- #Example :
- SOCKET=/var/run/php-fcgi.sock
- OPTIONS="-u www-data -g www-data -s $SOCKET -S -M 0600 -C 32 -F 1 -- /usr/bin/php-cgi"
- **root@ol-apl-ubuntu:~# vim /etc/spawn-fcgi/fcgi.conf** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- **root@ol-apl-ubuntu:~# cat > /etc/systemd/system/spawn-fcgi.service** # —é–Ω–∏—Ç-—Ñ–∞–π–ª
- [Unit]
- Description=Spawn-fcgi startup service by Otus
- After=network.target

- [Service]
- Type=simple
- PIDFile=/var/run/spawn-fcgi.pid
- EnvironmentFile=/etc/spawn-fcgi/fcgi.conf
- ExecStart=/usr/bin/spawn-fcgi -n $OPTIONS
- KillMode=process

- [Install]
- WantedBy=multi-user.target
- **oot@ol-apl-ubuntu:~# vim  /etc/systemd/system/spawn-fcgi.service** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- **root@ol-apl-ubuntu:~# systemctl start spawn-fcgi**
- **root@ol-apl-ubuntu:~# systemctl status spawn-fcgi**
- ‚óè spawn-fcgi.service - Spawn-fcgi startup service by Otus
- Loaded: loaded (/etc/systemd/system/spawn-fcgi.service; disabled; preset: enabled)
- Active: active (running) since Fri 2025-10-03 11:19:00 MSK; 10s ago
- Main PID: 37457 (php-cgi)
- Tasks: 33 (limit: 2268)
- Memory: 14.5M (peak: 14.5M)
- CPU: 38ms
- CGroup: /system.slice/spawn-fcgi.service
-  ‚îú‚îÄ37457 /usr/bin/php-cgi
-  ‚îú‚îÄ37458 /usr/bin/php-cgi
-  ‚îú‚îÄ37459 /usr/bin/php-cgi
-  ...

-  ## 3. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å unit-—Ñ–∞–π–ª Nginx (nginx.service) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

- **root@ol-apl-ubuntu:~# apt install nginx -y** # –£—Å—Ç–∞–Ω–æ–≤–∏–º Nginx –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- **root@ol-apl-ubuntu:~# cat > /etc/systemd/system/nginx@.service** # –î–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π service –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∞ —Ç–∞–∫–∂–µ PID-—Ñ–∞–π–ª–æ–≤. –î–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π Unit –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏
- #Stop dance for nginx
- #=======================
- #
- #ExecStop sends SIGSTOP (graceful stop) to the nginx process.
- #If, after 5s (--retry QUIT/5) nginx is still running, systemd takes control
- #and sends SIGTERM (fast shutdown) to the main process.
- #After another 5s (TimeoutStopSec=5), and if nginx is alive, systemd sends
- #SIGKILL to all the remaining processes in the process group (KillMode=mixed).
- #
- #nginx signals reference doc:
- #http://nginx.org/en/docs/control.html
- #
- [Unit]
- Description=A high performance web server and a reverse proxy server
- Documentation=man:nginx(8)
- After=network.target nss-lookup.target

- [Service]
- Type=forking
- PIDFile=/run/nginx-%I.pid
- ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx-%I.conf -q -g 'daemon on; master_process on;'
- ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx-%I.conf -g 'daemon on; master_process on;'
- ExecReload=/usr/sbin/nginx -c /etc/nginx/nginx-%I.conf -g 'daemon on; master_process on;' -s reload
- ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx-%I.pid
- TimeoutStopSec=5
- KillMode=mixed

- [Install]
- WantedBy=multi-user.target

- **root@ol-apl-ubuntu:~# vim /etc/systemd/system/nginx@.service** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- **root@ol-apl-ubuntu:~# cp -p  /etc/nginx/nginx.conf /etc/nginx/nginx-first.conf** # —Å–æ–∑–¥–µ–º –¥–≤–∞ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (/etc/nginx/nginx-first.conf, /etc/nginx/nginx-second.conf).  –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ /etc/nginx/nginx.conf, —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø—É—Ç–µ–π –¥–æ PID-—Ñ–∞–π–ª–æ–≤ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –ø–æ—Ä—Ç–∞–º
- **@ol-apl-ubuntu:~# cp -p  /etc/nginx/nginx.conf /etc/nginx/nginx-second.conf**
- **@ol-apl-ubuntu:~# vim /etc/nginx/nginx-fist.conf**
- ...
- pid /run/**nginx-first.pid**;
- ...
- http {
-
- ##
- #Basic Settings
- ##
-
- sendfile on;
- tcp_nopush on;
- types_hash_max_size 2048;
- #server_tokens off;
- server {
- listen **9001**;
- }
- ...
- - #include /etc/nginx/sites-enabled/*;
- }
- ...
- #include /etc/nginx/sites-enabled/*;
- **@ol-apl-ubuntu:~# vim /etc/nginx/nginx-fist.conf** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- - ...
- pid /run/**nginx-second.pid**;
- ...
- http {
-
- ##
- #Basic Settings
- ##
-
- sendfile on;
- tcp_nopush on;
- types_hash_max_size 2048;
- #server_tokens off;
- server {
- listen **9002**;
- }
- ...
- - #include /etc/nginx/sites-enabled/*;
-
- **root@ol-apl-ubuntu:/etc/nginx# systemctl start nginx@first**
- **root@ol-apl-ubuntu:/etc/nginx# systemctl start nginx@second**
- **root@ol-apl-ubuntu:/etc/nginx# systemctl status nginx@second**
- ‚óè nginx@second.service - A high performance web server and a reverse proxy server
- Loaded: loaded (/etc/systemd/system/nginx@.service; disabled; preset: enabled)
-   Active: active (running) since Fri 2025-10-03 14:22:35 MSK; 17min ago
-   Docs: man:nginx(8)
-   Process: 39470 ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx-second.conf -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
-   Process: 39475 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx-second.conf -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
-   Main PID: 39477 (nginx)
-   Tasks: 2 (limit: 2268)
-   Memory: 1.7M (peak: 1.9M)
-   CPU: 11ms
-   CGroup: /system.slice/system-nginx.slice/nginx@second.service
-   ‚îú‚îÄ39477 "nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx-second.conf -g daemon on; master_process on;"
-   ‚îî‚îÄ39478 "nginx: worker process"

- Oct 03 14:22:35 ol-apl-ubuntu systemd[1]: Starting nginx@second.service - A high performance web server and a reverse proxy server...
- Oct 03 14:22:35 ol-apl-ubuntu systemd[1]: Started nginx@second.service - A high performance web server and a reverse proxy server.
- **root@ol-apl-ubuntu:/etc/nginx# ss -tnulp | grep nginx** # —Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–∏–µ –ø–æ—Ä—Ç—ã —Å–ª—É—à–∞—é—Ç—Å—è:
- tcp   LISTEN 0      511               0.0.0.0:9001      0.0.0.0:*    users:(("nginx",pid=39765,fd=5),("nginx",pid=39764,fd=5))
- tcp   LISTEN 0      511               0.0.0.0:9002      0.0.0.0:*    users:(("nginx",pid=39478,fd=5),("nginx",pid=39477,fd=5))

- **root@ol-apl-ubuntu:/etc/nginx# ps afx | grep nginx** # —Å–º–æ—Ç—Ä–∏–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
-   39591 pts/1    Tl     0:00                          \_ vim nginx-first.conf
-   39813 pts/1    S+     0:00                          \_ grep --color=auto nginx
-   39477 ?        Ss     0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx-second.conf -g daemon on; master_process on;
-   39478 ?        S      0:00  \_ nginx: worker process
-   39764 ?        Ss     0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx-first.conf -g daemon on; master_process on;
-   39765 ?        S      0:00  \_ nginx: worker process

## 10 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"Systemd - —Å–æ–∑–¥–∞–Ω–∏–µ unit-—Ñ–∞–π–ª–∞"</ins>

-  –¶–µ–ª—å: –Ω–∞–ø–∏—Å–∞—Ç—å bash-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –µ–∂–µ—á–∞—Å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ email –æ—Ç—á—ë—Ç –æ —Ä–∞–±–æ—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- –ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è CRON, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑ –≤ —á–∞—Å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ—á—Ç—É.


- **–û—Ç—á—ë—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:**

- IP-–∞–¥—Ä–µ—Å–∞ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞);
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ URL —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞);
- –û—à–∏–±–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞);
- HTTP-–∫–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (—Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞).
- –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ø–∏–π, –¥–æ –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
- –í –ø–∏—Å—å–º–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–ø–∏—Å–∞–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω.
  
<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
# üß© –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ Linux (Regex Cheatsheet)

> üìò –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (Regular Expressions, RegEx) ‚Äî —ç—Ç–æ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞ –≤ Linux –∏ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.  
> –†–∞–±–æ—Ç–∞—é—Ç –≤ `grep`, `sed`, `awk`, `perl`, `bash` –∏ –º–Ω–æ–≥–∏—Ö –¥—Ä—É–≥–∏—Ö —É—Ç–∏–ª–∏—Ç–∞—Ö.

---

## üß† –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–∞—Å–∏–º–≤–æ–ª—ã

| –°–∏–º–≤–æ–ª | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä | –°–æ–≤–ø–∞–¥–µ–Ω–∏—è |
|:-------|:----------|:--------|:-------------|
| `.` | –õ—é–±–æ–π —Å–∏–º–≤–æ–ª | `a.b` | `acb`, `a_b`, `a9b` |
| `^` | –ù–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏ | `^INFO` | `INFO: start` |
| `$` | –ö–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏ | `end$` | `The end` |
| `*` | 0 –∏–ª–∏ –±–æ–ª—å—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π | `lo*l` | `ll`, `lol`, `loool` |
| `+` | 1 –∏–ª–∏ –±–æ–ª—å—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π | `go+d` | `good`, `gooood` |
| `?` | 0 –∏–ª–∏ 1 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ | `colou?r` | `color`, `colour` |
| `[]` | –ö–ª–∞—Å—Å —Å–∏–º–≤–æ–ª–æ–≤ | `[A-Z]` | –õ—é–±–∞—è –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞ |
| `[^]` | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ | `[^0-9]` | –õ—é–±–æ–π —Å–∏–º–≤–æ–ª, –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä—ã |
| `{n,m}` | –ü–æ–≤—Ç–æ—Ä—ã –æ—Ç n –¥–æ m | `[0-9]{2,4}` | –ß–∏—Å–ª–∞ –¥–ª–∏–Ω–æ–π 2‚Äì4 —Ü–∏—Ñ—Ä—ã |
| `()` | –ì—Ä—É–ø–ø–∞ | `(abc)+` | –ü–æ–≤—Ç–æ—Ä –≥—Ä—É–ø–ø—ã `abc` |
| `|` | –õ–æ–≥–∏—á–µ—Å–∫–æ–µ ‚Äú–∏–ª–∏‚Äù | `cat|dog` | `cat` –∏–ª–∏ `dog` |
| `\` | –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | `\.` | –¢–æ—á–∫–∞ `.` |

---

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Linux

### grep

- grep -E "^ERROR" /var/log/syslog # –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è —Å ERROR

- grep -Eo "([0-9]{1,3}\.){3}[0-9]{1,3}" access.log # –í—ã–≤–æ–¥ —Ç–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (IP-–∞–¥—Ä–µ—Å–æ–≤)

- sed -E 's/[0-9]+/NUM/g' file.txt # –ó–∞–º–µ–Ω—è–µ—Ç –≤—Å–µ —á–∏—Å–ª–∞ –Ω–∞ —Å–ª–æ–≤–æ NUM

awk '/ERROR|CRITICAL/ {print $0}' /var/log/app.log # –í—ã–≤–æ–¥–∏—Ç —Å—Ç—Ä–æ–∫–∏ —Å ERROR –∏–ª–∏ CRITICAL

- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ					–®–∞–±–ª–æ–Ω													–ü—Ä–∏–º–µ—Ä
- IP-–∞–¥—Ä–µ—Å					([0-9]{1,3}\.){3}[0-9]{1,3}								192.168.1.10
- Email						[[:alnum:]\._%+-]+@[[:alnum:]\.-]+\.[a-z]{2,}			user@mail.com
- URL							https?://[a-zA-Z0-9\./_-]+								https://example.com/test
- –î–∞—Ç–∞ (dd/mm/yyyy)			[0-9]{2}/[0-9]{2}/[0-9]{4}								08/10/2025
- –û—à–∏–±–∫–∏ –ª–æ–≥–æ–≤				`(ERROR													CRITICAL
- HTTP-–∫–æ–¥—ã					\" [0-9]{3}												" 404
- –í—Ä–µ–º—è (HH:MM:SS)			[0-9]{2}:[0-9]{2}:[0-9]{2}								12:30:45

- ‚öôÔ∏è –í Bash
- line="192.168.0.1"
- if [[ $line =~ ^([0-9]{1,3}\.){3}[0-9]{1,3}$ ]]; then
-     echo "–≠—Ç–æ IP-–∞–¥—Ä–µ—Å"
- fi

- üìé –ü—Ä–∏–º–µ—Ä: –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–∞ Nginx
- LOG=/var/log/nginx/access.log

- # –ß–∞—Å—Ç—ã–µ IP
- grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}' "$LOG" | sort | uniq -c | sort -nr | head

- # –ß–∞—Å—Ç—ã–µ URL
- grep -Eo '"(GET|POST) [^ ]+' "$LOG" | cut -d' ' -f2 | sort | uniq -c | sort -nr | head

- # –û—à–∏–±–∫–∏
- grep -E "error|crit|alert" /var/log/nginx/error.log

</details>
 
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx

## üöÄ –°–∫—Ä–∏–ø—Ç
- **root@ol-apl-ubuntu:/usr/local/bin# cat my_report2.sh**
```bash
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç: my_report.sh
# –ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ—á—Ç—É.
# –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞:
#	1.–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ flock –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ø–∏–π.
#	2.STATEFILE —Ö—Ä–∞–Ω–∏—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞.
#	3.AWK-–ø–∞—Ä—Å–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞—Ç—É –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ [07/Oct/2025:10:43:56 +0300] –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –µ—ë —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º –∑–∞–ø—É—Å–∫–æ–º.
#	4.–¢–æ–ø IP –∏ URL —Å—á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ awk, sort, uniq -c.
#	5.–û—à–∏–±–∫–∏ –∏ HTTP-–∫–æ–¥—ã –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.
#	6.–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ mail –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —à–ª—ë—Ç –æ—Ç—á—ë—Ç –Ω–∞ e-mail.
#	7.TMPFILE + –æ—á–∏—Å—Ç–∫–∞ ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞.


# === –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ===
LOGFILE="/var/log/nginx/example.local.access.log" # –ü—É—Ç—å –∫ –ª–æ–≥-—Ñ–∞–π–ª—É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
STATEFILE="/var/tmp/web_report_state" # –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
LOCKFILE="/var/tmp/web_report.lock"  # –§–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π
MAIL_TO="spg@garant.ru" # –ü–æ—á—Ç–∞, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç—á—ë—Ç
HOSTNAME=$(hostname) # –ò–º—è —Ö–æ—Å—Ç–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –æ—Ç—á—ë—Ç

# === –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ ===
exec 9>"$LOCKFILE" # –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä 9 –Ω–∞ LOCKFILE
if ! flock -n 9; then # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è
   echo "[$(date)] –£–∂–µ –∑–∞–ø—É—â–µ–Ω–æ, –≤—ã—Ö–æ–¥–∏–º."
    exit 1
fi

# === –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ ===
if [ -f "$STATEFILE" ]; then
    LAST_RUN=$(cat "$STATEFILE") # –ß–∏—Ç–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
else
    LAST_RUN=0 # –ï—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
fi
CURRENT_TIME=$(date +%s) # –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ UNIX timestamp

# === –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ãx —Å—Ç—Ä–æ–∫ –∏–∑ –ª–æ–≥–∞ (# –ë–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞)===
NEWLINES=$(awk -v last="$LAST_RUN" '
    match($0, /\[([0-9]{2})\/([A-Za-z]{3})\/([0-9]{4}):([0-9]{2}:[0-9]{2}:[0-9]{2}) ([+\-][0-9]{4})\]/, m) {
        day = m[1]; mon = m[2]; year = m[3]; time = m[4]; tz = m[5];
        formatted = day " " mon " " year " " time " " tz # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–ª—è date
        cmd = "date -d \"" formatted "\" +%s" # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ UNIX timestamp
        cmd | getline t
        close(cmd)
        if (t > last) print $0 # –ï—Å–ª–∏ –Ω–æ–≤–µ–µ LAST_RUN, –≤—ã–≤–æ–¥–∏–º
    }
' "$LOGFILE")
# –ï—Å–ª–∏ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –Ω–µ—Ç, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
if [ -z "$NEWLINES" ]; then
    echo "[$(date)] –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –≤ –ª–æ–≥–µ, –æ—Ç—á—ë—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è."
    echo "$CURRENT_TIME" > "$STATEFILE"
    exit 0
fi

# === –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç ===
TMPFILE=$(mktemp) # –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ—Ç—á—ë—Ç–∞
{
    echo "–û—Ç—á—ë—Ç –æ –≤–µ–±-—Ç—Ä–∞—Ñ–∏–∫–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ $HOSTNAME"
    echo "–ü–µ—Ä–∏–æ–¥: $(date -d "@$LAST_RUN") ‚Äî $(date -d "@$CURRENT_TIME")"
    echo
    echo "=== –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤ ==="
    echo "$NEWLINES" | awk '{print $1}' | sort | uniq -c | sort -nr | head -10
    echo
    echo "=== –¢–æ–ø-10 –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL ==="
    echo "$NEWLINES" | awk '{for (i=1;i<=NF;i++) if ($i ~ /^"?GET|POST|HEAD$/) print $(i+1)}' | sort | uniq -c | sort -nr | head -10
    echo
    echo "=== –û—à–∏–±–∫–∏ (HTTP 4xx/5xx) ==="
    echo "$NEWLINES" | awk '$9 ~ /^[45][0-9][0-9]$/' | tail -20
    echo
    echo "=== –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ ==="
    echo "$NEWLINES" | awk '{print $9}' | grep -E '^[0-9]{3}$' | sort | uniq -c | sort -nr
} > "$TMPFILE"

# === –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á—ë—Ç –ø–æ –ø–æ—á—Ç–µ ===
mail -s "Web report $HOSTNAME ($(date))" "$MAIL_TO" < "$TMPFILE"

# === –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ ===
echo "$CURRENT_TIME" > "$STATEFILE"

# === –û—á–∏—Å—Ç–∫–∞ ===
rm -f "$TMPFILE"
flock -u 9
rm -f "$LOCKFILE"
```
- 
- **–ü–∏—Å—å–º–æ-–æ—Ç—á–µ—Ç**
- Subject: Web report ol-apl-ubuntu (Fri Oct 10 11:19:55 AM MSK 2025)
- To: <spg@garant.ru>
- User-Agent: mail (GNU Mailutils 3.17)
- Date: Fri, 10 Oct 2025 11:19:55 +0300
- Message-Id: <20251010081955.E350E65811@ol-apl-ubuntu.garant.ru>
- From: root <root@ol-apl-ubuntu.garant.ru>

- –û—Ç—á—ë—Ç –æ –≤–µ–±-—Ç—Ä–∞—Ñ–∏–∫–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ ol-apl-ubuntu
- **–ü–µ—Ä–∏–æ–¥: Tue Oct  7 12:14:15 PM MSK 2025 ‚Äî Fri Oct 10 11:19:55 AM MSK 2025**

- === –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤ ===
- 46 10.0.77.13
- 7  10.0.77.5

- === –¢–æ–ø-10 –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL ===
- 20/about.html
- 16 /about.html
- 12 /index.html
- 5 /contact.html

- === –û—à–∏–±–∫–∏ (HTTP 4xx/5xx) ===
- 10.0.77.13 - - [10/Oct/2025:10:54:37 +0300] "GET /apple-touch-icon-precomposed.png HTTP/1.1" 404 134 "-" "com.apple.WebKit.Networking/21622.1.22.11.15Network/5569.1.3 macOS/26.0.1"
- 10.0.77.13 - - [10/Oct/2025:10:54:37 +0300] "GET /apple-touch-icon.png HTTP/1.1" 404 134 "-" "com.apple.WebKit.Networking/21622.1.22.11.15 Network/5569.1.3 macOS/26.0.1"
- 10.0.77.13 - - [10/Oct/2025:10:54:37 +0300] "GET /favicon.ico HTTP/1.1" 404 134 "-" "com.apple.WebKit.Networking/21622.1.22.11.15 Network/5569.1.3  macOS/26.0.1"
- 10.0.77.13 - - [10/Oct/2025:11:11:51 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.0.1 Safari/605.1.15"
- 10.0.77.13 - - [10/Oct/2025:11:12:45 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.0.1 Safari/605.1.15"
- 10.0.77.13 - - [10/Oct/2025:11:18:46 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.0.1 Safari/605.1.15"
- 10.0.77.13 - - [10/Oct/2025:11:19:01 +0300] "GET /apple-touch-icon-precomposed.png HTTP/1.1" 404 134 "-" "com.apple.WebKit.Networking/21622.1.22.11.15 Network/5569.1.3 macOS/26.0.1"
- 10.0.77.13 - - [10/Oct/2025:11:19:01 +0300] "GET /apple-touch-icon.png HTTP/1.1" 404 134 "-" "com.apple.WebKit.Networking/21622.1.22.11.15 Network/5569.1.3 macOS/26.0.1"
- 10.0.77.13 - - [10/Oct/2025:11:19:01 +0300] "GET /favicon.ico HTTP/1.1" 404 134 "-" "com.apple.WebKit.Networking/21622.1.22.11.15 Network/5569.1.3 macOS/26.0.1"
- 10.0.77.5 - - [10/Oct/2025:11:19:05 +0300] "GET /favicon.ico HTTP/1.1" 404 134 "http://10.0.77.142/about.html" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:142.0) Gecko/20100101 Firefox/142.0"
- 10.0.77.13 - - [10/Oct/2025:11:19:18 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.0.1 Safari/605.1.15"
- 10.0.77.13 - - [10/Oct/2025:11:19:20 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.0.1 Safari/605.1.15"
- 10.0.77.13 - - [10/Oct/2025:11:19:35 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"
- 10.0.77.13 - - [10/Oct/2025:11:19:38 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"
- 10.0.77.13 - - [10/Oct/2025:11:19:39 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"
- 10.0.77.13 - - [10/Oct/2025:11:19:39 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"

- === –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ ===
- 19 200
- 18 304
- 16 404
- **root@ol-apl-ubuntu:/usr/local/bin# ./my_report2.sh** # –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–∞–π—Ç—É
- [Fri Oct 10 11:25:54 AM MSK 2025] –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –≤ –ª–æ–≥–µ, –æ—Ç—á—ë—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
- **root@ol-apl-ubuntu:/usr/local/bin# ./my_report2.sh** # –µ—â–µ —Ä–∞–∑ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–∞–π—Ç—É
- **root@ol-apl-ubuntu:/usr/local/bin# mail -u spg** # —Å–º–æ—Ç—Ä–∏–º –æ—Ç—á–µ—Ç –≤ –ø–æ—á—Ç–µ
- - **–ü–∏—Å—å–º–æ-–æ—Ç—á–µ—Ç**
- >N  26 root               Fri Oct 10 11:28  27/1267  Web report ol-apl-ubuntu (Fri Oct 10 11:28:52 AM MSK 2025)
- ? 26
- Return-Path: <root@ol-apl-ubuntu.garant.ru>
- X-Original-To: spg@garant.ru
- Delivered-To: spg@garant.ru
- Received: by ol-apl-ubuntu.garant.ru (Postfix, from userid 0)
- 	id C979665964; Fri, 10 Oct 2025 11:28:52 +0300 (MSK)
- Subject: Web report ol-apl-ubuntu (Fri Oct 10 11:28:52 AM MSK 2025)
- To: <spg@garant.ru>
- User-Agent: mail (GNU Mailutils 3.17)
- Date: Fri, 10 Oct 2025 11:28:52 +0300
- Message-Id: <20251010082852.C979665964@ol-apl-ubuntu.garant.ru>
- From: root <root@ol-apl-ubuntu.garant.ru>

- –û—Ç—á—ë—Ç –æ –≤–µ–±-—Ç—Ä–∞—Ñ–∏–∫–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ ol-apl-ubuntu
- **–ü–µ—Ä–∏–æ–¥: Fri Oct 10 11:25:54 AM MSK 2025 ‚Äî Fri Oct 10 11:28:52 AM MSK 2025**

- === –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤ ===
- 12 10.0.77.13
- 7  10.0.77.5
- 
- === –¢–æ–ø-10 –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL ===
- 8 /about.html
- 6 /contact.html
- 4 /index.html
- 1 /about.htmlhttp://10.0.77.142/about.html

- === –û—à–∏–±–∫–∏ (HTTP 4xx/5xx) ===
- 10.0.77.13 - - [10/Oct/2025:11:28:30 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.0.1 Safari/605.1.15"
- 10.0.77.13 - - [10/Oct/2025:11:28:42 +0300] "GET /%3C?php HTTP/1.1" 404 134 "http://10.0.77.142/contact.html" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"

- === –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ ===
- 3 304
- 2 404
---
- ## –ü–µ—Ä–µ–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ CRON
- **root@ol-apl-ubuntu:/usr/local/bin# crontab -e** #  –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –≤ CRON
- 0 * * * * ‚Üí –∫–∞–∂–¥—ã–π —á–∞—Å –≤ –Ω—É–ª–µ–≤—É—é –º–∏–Ω—É—Ç—É
- /usr/local/bin/report.sh ‚Üí –ø—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É
- >> /var/log/report.log 2>&1 ‚Üí –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –∏ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥

- 0 * * * * /usr/local/bin/my_reporti2.sh >> /var/log/my_report.log 2>&1
---
- ## –ü–µ—Ä–µ–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å –ø–æ —Ç–∞–π–º–µ—Ä—É (–º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –î–ó)
- **root@ol-apl-ubuntu:/usr/local/bin# vim /etc/systemd/system/my_report.service**
- [Unit]
- Description=My watchlog service

- [Service]
- Type=oneshot
- EnvironmentFile=/var/log/nginx/example.local.access.log
- ExecStart=/usr/local/bin/my_report2.sh


- **root@ol-apl-ubuntu:/usr/local/bin# vim /etc/systemd/system/my_report.timere**
- Unit]
- Description=Run my_report2 script every 60 second

- [Timer]
- #Run every 60 second
- OnUnitActiveSec=60
- Unit=my_report.service

- [Install]
- WantedBy=multi-user.target



- **root@ol-apl-ubuntu:/usr/local/bin# mail -u spg**
- 30 root               Fri Oct 10 13:42  29/901   Web report ol-apl-ubuntu (Fri Oct 10 01:42:45 PM MSK 2025)
- ? quit
- Held 30 messages in /var/mail/spg
- root@ol-apl-ubuntu:/usr/local/bin# systemctl start my_report.service
- root@ol-apl-ubuntu:/usr/local/bin# systemctl start my_report.timer
- root@ol-apl-ubuntu:/usr/local/bin# systemctl daemon-reload
- root@ol-apl-ubuntu:/usr/local/bin# systemctl enable --now /etc/systemd/system/my_report.timer
- Created symlink /etc/systemd/system/multi-user.target.wants/my_report.timer ‚Üí /etc/systemd/system/my_report.timer.>N  31 root               Fri Oct 10 - - 14:45  26/868   Web report ol-apl-ubuntu (Fri Oct 10 02:45:00 PM MSK 2025)
- **root@ol-apl-ubuntu:/usr/local/bin# mail -u spg**
- >N  31 root               Fri Oct 10 14:45  26/868   Web report ol-apl-ubuntu (Fri Oct 10 02:45:00 PM MSK 2025)
- ? 31
- Return-Path: <root@ol-apl-ubuntu.garant.ru>
- X-Original-To: spg@garant.ru
- Delivered-To: spg@garant.ru
- Received: by ol-apl-ubuntu.garant.ru (Postfix, from userid 0)
- 	id BC69465811; Fri, 10 Oct 2025 14:45:00 +0300 (MSK)
- Subject: Web report ol-apl-ubuntu (Fri Oct 10 02:45:00 PM MSK 2025)
- To: <spg@garant.ru>
- User-Agent: mail (GNU Mailutils 3.17)
- Date: Fri, 10 Oct 2025 14:45:00 +0300
- Message-Id: <20251010114500.BC69465811@ol-apl-ubuntu.garant.ru>
- From: root <root@ol-apl-ubuntu.garant.ru>

- –û—Ç—á—ë—Ç –æ –≤–µ–±-—Ç—Ä–∞—Ñ–∏–∫–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ ol-apl-ubuntu
- –ü–µ—Ä–∏–æ–¥: Fri Oct 10 02:33:38 PM MSK 2025 ‚Äî Fri Oct 10 02:45:00 PM MSK 2025

- === –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤ ===
- 2 10.0.77.13

- === –¢–æ–ø-10 –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL ===
- 1 /styles.css
- 1 /contact.html

- === –û—à–∏–±–∫–∏ (HTTP 4xx/5xx) ===

- === –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ ===
- 2 304

- **–†–∞–±–æ—Ç–∞–µ—Ç**

## 12 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏"</ins>

-  –¶–µ–ª—å: –†–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é lsof.


- **–û—Ç—á—ë—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:**

- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏;

  
<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>

üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ /proc
üß© 1. –û–±—â–µ—Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **/proc/cpuinfo** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ: –º–æ–¥–µ–ª—å, —á–∞—Å—Ç–æ—Ç–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä, —Ñ–ª–∞–≥–∏.
- **/proc/meminfo**  - –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏.
- **/proc/uptime** - –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Å –º–æ–º–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏.
- **/proc/loadavg** - –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞ 1, 5 –∏ 15 –º–∏–Ω—É—Ç.
- **/proc/version** - –í–µ—Ä—Å–∏—è —è–¥—Ä–∞ –∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞.
- **/proc/cmdline** - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ —è–¥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.
- **/proc/modules** - –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ —è–¥—Ä–∞.
- **/proc/filesystems** - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã.
- **/proc/partitions** - –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.
- **/proc/diskstats** - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞.
- **/proc/interrupts** - –°—á—ë—Ç—á–∏–∫–∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π.
- **/proc/swaps** - –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ swap-—Ä–∞–∑–¥–µ–ª—ã.
- **/proc/mounts** - –¢–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã.
- **/proc/ioports** - –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞.
- **/proc/iomem** - –ö–∞—Ä—Ç–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏.
- **/proc/net/** - –ü–æ–¥–∫–∞—Ç–∞–ª–æ–≥ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö.
- **/proc/sys/** - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —è–¥—Ä–∞ (sysctl).

üë§ 2. –ö–∞—Ç–∞–ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ö–∞–∂–¥—ã–π –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–º–µ–µ—Ç —Å–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥ /proc/[pid]/, –≥–¥–µ [pid] ‚Äî –µ–≥–æ —á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
- –ù–∞–ø—Ä–∏–º–µ—Ä: /proc/1234/

- **/proc/[pid]/cmdline** - –ö–æ–º–∞–Ω–¥–∞ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å –±—ã–ª –∑–∞–ø—É—â–µ–Ω.
- **/proc/[pid]/cwd** - –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–∏–π —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞.
- **/proc/[pid]/environ** - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- **/proc/[pid]/exe** - –°–∏–º–ª–∏–Ω–∫ –Ω–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª.
- **/proc/[pid]/fd/** - –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤.
- **/proc/[pid]/maps** - –ö–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞.
- **/proc/[pid]/mem** - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è root).
- **/proc/[pid]/stat** - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –∏ –ø–∞–º—è—Ç–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ —Ç. –¥.
- **/proc/[pid]/status** - –£–¥–æ–±–æ—á–∏—Ç–∞–µ–º–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É (UID, VmRSS, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç).
- **/proc/[pid]/task/** - –ü–æ—Ç–æ–∫–∏ (threads) —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.
- **/proc/[pid]/io** - –°—á—ë—Ç—á–∏–∫–∏ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞.
- **/proc/[pid]/net/** - –°–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.
- **/proc/[pid]/mounts** - –°–ø–∏—Å–æ–∫ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –§–°, –≤–∏–¥–∏–º—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–º (namespace).

‚öôÔ∏è 3. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∏

- **/proc/bus/** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∏–Ω–∞—Ö (PCI, USB –∏ –¥—Ä.).
- **/proc/driver/** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥—Ä–∞–π–≤–µ—Ä–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
- **/proc/sys/** - –î–µ—Ä–µ–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —è–¥—Ä–∞, —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —á–µ—Ä–µ–∑ sysctl. –ü—Ä–∏–º–µ—Ä: /proc/sys/net/ipv4/ip_forward.
- **/proc/tty/** - –¢–µ—Ä–º–∏–Ω–∞–ª—ã –∏ –∏—Ö –¥—Ä–∞–π–≤–µ—Ä—ã.
- **/proc/acpi/** - (–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ) ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏, –±–∞—Ç–∞—Ä–µ–µ, ACPI —Å–æ–±—ã—Ç–∏—è—Ö.
- **/proc/scsi/** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ SCSI-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.


	
# üß∞ lsof ‚Äî List Open Files

**`lsof`** (–æ—Ç _List Open Files_) ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ Linux/Unix, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è **–≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã** –≤ —Å–∏—Å—Ç–µ–º–µ.  
–í Linux –≤—Å—ë —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª–æ–º ‚Äî –ø–æ—ç—Ç–æ–º—É `lsof` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã, –Ω–æ –∏:

- üìÅ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏  
- ‚öôÔ∏è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (`/dev/sda1`, `/dev/tty`)  
- üåê —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (TCP/UDP)  
- üîå —Å–æ–∫–µ—Ç—ã  
- üìö –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –º–∞–ø–ø–∏–Ω–≥–∏ –ø–∞–º—è—Ç–∏  
- üßµ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (pipes, FIFOs)

---

## üß† –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤ Linux –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É **–æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤** (`/proc/<pid>/fd`).  
`lsof` –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –≤—ã–≤–æ–¥–∏—Ç, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –æ–Ω–∏ –æ—Ç–∫—Ä—ã–ª–∏.

---

## üí° –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (—á–∞—Å—Ç–æ –¥–ª–∏–Ω–Ω—ã–π –≤—ã–≤–æ–¥, —Ç—Ä–µ–±—É–µ—Ç sudo).

üîç –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–ø—Ü–∏–∏
- –ö–æ–º–∞–Ω–¥–∞                   –û–ø–∏—Å–∞–Ω–∏–µ
- **lsof -p <PID>** -           –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã, –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- **lsof <—Ñ–∞–π–ª>** -             –∫–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–µ—Ä–∂–∞—Ç —Ñ–∞–π–ª –æ—Ç–∫—Ä—ã—Ç—ã–º
- **lsof +D <–∫–∞—Ç–∞–ª–æ–≥>** -       –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)
- **lsof -u <–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å>** -  –≤—Å–µ —Ñ–∞–π–ª—ã, –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **lsof -i** -                 –≤—Å–µ —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **lsof -iTCP -sTCP:LISTEN** - –ø—Ä–æ—Ü–µ—Å—Å—ã, —Å–ª—É—à–∞—é—â–∏–µ TCP-–ø–æ—Ä—Ç—ã
- **lsof -i :80** -             –∫—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 80
- **lsof -a -u root -i** -      —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ root
- **lsof /dev/sda1** -          –ø—Ä–æ—Ü–µ—Å—Å—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ /dev/sda1
- **lsof +L1** -                —É–¥–∞–ª—ë–Ω–Ω—ã–µ, –Ω–æ –≤—Å—ë –µ—â—ë –∑–∞–Ω—è—Ç—ã–µ —Ñ–∞–π–ª—ã
- 
üìÑ –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞
- COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
- bash     1092 pavel  cwd  DIR  8,1     4096    2   /
- bash     1092 pavel  txt  REG  8,1   1113504 123 /usr/bin/bash
- bash     1092 pavel    0u  CHR 136,0      0t0  3 /dev/pts/0
- bash     1092 pavel    1u  CHR 136,0      0t0  3 /dev/pts/0
- bash     1092 pavel    2u  CHR 136,0      0t0  3 /dev/pts/0
- 
üß© –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å—Ç–æ–ª–±—Ü–æ–≤

- **COMMAND** -–∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞
- **PID** - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞
- **USER** - –≤–ª–∞–¥–µ–ª–µ—Ü
- **FD** - –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Ñ–∞–π–ª–∞ (0=stdin, 1=stdout, 2=stderr, cwd=—Ç–µ–∫—É—â–∏–π –∫–∞—Ç–∞–ª–æ–≥, txt=–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª)
- **TYPE** - —Ç–∏–ø —Ñ–∞–π–ª–∞ (REG, DIR, CHR, FIFO, IPv4, IPv6)
- **NAME** - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–∫–µ—Ç–∞

‚ö° –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –¶–µ–ª—å                                  –ö–æ–º–∞–Ω–¥–∞
- üîí –ö—Ç–æ –¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª –æ—Ç–∫—Ä—ã—Ç—ã–º?          **lsof /var/log/syslog**
- üåê –ß—Ç–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 22?               **lsof -i :22**
- üßπ –ù–∞–π—Ç–∏ —É–¥–∞–ª—ë–Ω–Ω—ã–µ, –Ω–æ –∑–∞–Ω—è—Ç—ã–µ —Ñ–∞–π–ª—ã  **lsof +L1**
- üìÇ –ß—Ç–æ –æ—Ç–∫—Ä—ã—Ç–æ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ /mnt?      **lsof +D /mnt**
- üë§ –§–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                 **lsof -u $USER**

‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- lsof –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ /proc:
- 	‚Ä¢	/proc/<pid>/fd/ ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã
- 	‚Ä¢	/proc/<pid>/maps ‚Äî –º–∞–ø–ø–∏–Ω–≥–∏ –ø–∞–º—è—Ç–∏ (–±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
- 	‚Ä¢	/proc/net/* ‚Äî —Å–µ—Ç–µ–≤—ã–µ —Å–æ–∫–µ—Ç—ã
- –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

---

üß† –ü–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–∏—ë–º—ã **awk** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ **/proc**

üìä 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å /proc/meminfo ‚Äî –∞–Ω–∞–ª–∏–∑ –ø–∞–º—è—Ç–∏
- **–ü–æ–∫–∞–∑–∞—Ç—å –æ–±—â–∏–π –æ–±—ä—ë–º –∏ —Å–≤–æ–±–æ–¥–Ω—É—é –ø–∞–º—è—Ç—å:**

```bash
awk '/MemTotal|MemFree|Buffers|Cached/ {print}' /proc/meminfo
```

- **–ü–æ—Å—á–∏—Ç–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö:**

```bash
awk '/MemTotal/ {total=$2} /MemAvailable/ {avail=$2} END {printf "Memory used: %.1f%%\n", 100*(1-avail/total)}' /proc/meminfo
```

üíª 2. /proc/cpuinfo ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ
- **–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–æ–¥–µ–ª–∏ CPU:**

```bash  
awk -F': ' '/model name/ {print $2}' /proc/cpuinfo
```

- **–ü–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —è–¥–µ—Ä:**

```bash  
awk '/^processor/ {n++} END {print "CPU cores:", n}' /proc/cpuinfo
```

üöÄ 3. /proc/loadavg ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- **–ü—Ä–æ—Å—Ç–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥:**

```bash  
awk '{printf "Load average: 1min=%s 5min=%s 15min=%s\n", $1, $2, $3}' /proc/loadavg
```

üîß 4. /proc/uptime ‚Äî –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- **–°–¥–µ–ª–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–æ–ø–æ–Ω—è—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –∞–ø—Ç–∞–π–º–∞:**

```bash  
aawk '{h=int($1/3600); m=int(($1%3600)/60); s=int($1%60); printf "Uptime: %dh %dm %ds\n", h, m, s}' /proc/uptime
```

üß© 5. /proc/[pid]/status ‚Äî –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–≤–µ—Å—Ç–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ > 100 000 KB:**

```bash  
for pid in /proc/[0-9]*; do
  awk -v pid=$(basename "$pid") '/VmRSS:/ {if ($2>100000) printf "%-6s %s KB\n", pid, $2}' "$pid/status" 2>/dev/null
done
```

üß± 6. /proc/[pid]/fd ‚Äî –ø–æ–¥—Å—á—ë—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash  
for pid in /proc/[0-9]*; do
  user=$(awk '/^Uid:/ {print $2}' "$pid/status" 2>/dev/null | xargs -I{} getent passwd {} | cut -d: -f1)
  [ -d "$pid/fd" ] && count=$(ls "$pid/fd" 2>/dev/null | wc -l)
  [ -n "$count" ] && echo "$pid $user $count"
done | awk '{if($3>50) printf "PID=%s USER=%s OPEN_FD=%s\n", $1,$2,$3}'
```

üßÆ 7. /proc/net/dev ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **–ü–æ—Å—á–∏—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–π/–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:**

```bash  
awk 'NR>2 {print $1, "RX=" $2/1024 "KB", "TX=" $10/1024 "KB"}' /proc/net/dev
```

üîã 8. /proc/stat ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
- **–ü–æ—Å—á–∏—Ç–∞—Ç—å –æ–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CPU –∑–∞ —Å–µ–∫—É–Ω–¥—É:**

```bash  
awk '/^cpu / {u=$2; n=$3; s=$4; i=$5; total=u+n+s+i; printf "%d %d\n", u+s, total}' /proc/stat > /tmp/cpu1
sleep 1
awk '/^cpu / {u=$2; n=$3; s=$4; i=$5; total=u+n+s+i; printf "%d %d\n", u+s, total}' /proc/stat > /tmp/cpu2
awk 'NR==FNR{u1=$1;t1=$2;next}{u2=$1;t2=$2}END{printf "CPU usage: %.1f%%\n", 100*(u2-u1)/(t2-t1)}' /tmp/cpu1 /tmp/cpu2
```

üî• 10. /proc/swaps ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ swap

```bash  
awk 'NR>1 {printf "%s: %s/%s kB used\n", $1, $4, $3}' /proc/swaps
```

üßæ –ë–æ–Ω—É—Å: –≤—Å—ë —Å—Ä–∞–∑—É –≤ –≤–∏–¥–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞

```bash  
echo "=== CPU ==="
awk -F': ' '/model name/ {print $2; exit}' /proc/cpuinfo
awk '/^cpu / {printf "Load: %.1f%%\n", 100*($2+$4)/($2+$4+$5)}' /proc/stat

echo "=== MEM ==="
awk '/MemTotal|MemFree|Buffers|Cached/ {print}' /proc/meminfo

echo "=== UPTIME ==="
awk '{printf "Uptime: %.2f hours\n", $1/3600}' /proc/uptime
```
---
üß© proc_monitor ‚Äî –º–∏–Ω–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑ /proc # –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π Bash-—Å–∫—Ä–∏–ø—Ç

```bash  
#!/usr/bin/env bash
#
# proc_monitor ‚Äî —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å–≤–æ–¥–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ /proc
# –ê–≤—Ç–æ—Ä: —Ç—ã :)
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: —Ç–æ–ª—å–∫–æ bash, awk, sleep
#

# === –¶–≤–µ—Ç–∞ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã ===
RED="\033[1;31m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
RESET="\033[0m"

while true; do
  clear
  echo -e "${CYAN}==== SYSTEM STATUS ($(date +"%F %T")) ====${RESET}"

  # ---- CPU ----
cpu_usage=$(awk '
  /^cpu / {
    u1=$2+$3+$4; t1=$2+$3+$4+$5+$6+$7+$8
    system("sleep 1")
    getline < "/proc/stat"
    u2=$2+$3+$4; t2=$2+$3+$4+$5+$6+$7+$8
    printf "%d", 100*(u2-u1)/(t2-t1)
  }' /proc/stat)
echo -e "${GREEN}CPU usage:${RESET} ${cpu_usage}%"

  # ---- MEMORY ----
  awk '
    /MemTotal:/ {total=$2}
    /MemAvailable:/ {avail=$2}
    END {
      used=total-avail;
      printf "\033[1;32mMemory:\033[0m %.1f%% used (%d / %d MB)\n", 100*used/total, used/1024, total/1024
    }
  ' /proc/meminfo

  # ---- LOAD AVG ----
  awk '{printf "\033[1;32mLoad avg:\033[0m 1min=%s 5min=%s 15min=%s\n", $1, $2, $3}' /proc/loadavg

  # ---- UPTIME ----
  awk '{h=int($1/3600); m=int(($1%3600)/60); printf "\033[1;32mUptime:\033[0m %dh %dm\n", h, m}' /proc/uptime

  # ---- PROCESSES ----
  procs=$(ls -d /proc/[0-9]* 2>/dev/null | wc -l)
  echo -e "${GREEN}Processes:${RESET} $procs"

  # ---- TOP 5 –ø–æ –ø–∞–º—è—Ç–∏ ----
  echo -e "\n${YELLOW}Top 5 processes by memory:${RESET}"
  printf "%-8s %-20s %10s\n" "PID" "COMMAND" "RSS(KB)"
  for pid in /proc/[0-9]*; do
    status="$pid/status"
    [ -r "$status" ] || continue
    rss=$(awk '/VmRSS:/ {print $2}' "$status")
    comm=$(<"$pid/comm")
    [ -n "$rss" ] && printf "%-8d %-20s %10d\n" "$(basename "$pid")" "$comm" "$rss"
  done | sort -k3 -nr | head -n 5

  # ---- DISK ----
  echo -e "\n${YELLOW}Disk activity (/proc/diskstats):${RESET}"
  awk '{if ($3 ~ /^sd|nvme|vd/) printf "%-6s reads=%-8s writes=%-8s\n", $3, $4, $8}' /proc/diskstats

  # ---- NET ----
  echo -e "\n${YELLOW}Network traffic (/proc/net/dev):${RESET}"
  awk 'NR>2 {printf "%-8s RX=%-10.0fKB TX=%-10.0fKB\n", $1, $2/1024, $10/1024}' /proc/net/dev

  echo
  sleep 7
done
```

</details>

---

## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

- **root@ol-apl-ubuntu:/usr/local/bin# cat /proc/cpuinfo** # –∏–Ω—Ñ–æ –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ
- processor	: 0
- vendor_id	: GenuineIntel
- cpu family	: 6
- model		: 85
- model name	: Intel(R) Xeon(R) Gold 6238R CPU @ 2.20GHz
- stepping	: 7
- microcode	: 0x5003707
- cpu MHz		: 2194.843
- cache size	: 39424 KB
- physical id	: 0
- siblings	: 1
- core id		: 0
- cpu cores	: 1

- **root@ol-apl-ubuntu:/usr/local/bin# grep Mem /proc/meminfo** # –ò–Ω—Ñ–æ –æ –ø–∞–º—è—Ç–∏
- MemTotal:        2015348 kB
- MemFree:          795792 kB
- MemAvailable:    1578184 kB

- **root@ol-apl-ubuntu:/usr/local/bin# cat /proc/swaps** # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SWAP
- Filename				Type		Size		Used		Priority
- /swap.img                               file		2097148		0		-2

- **root@ol-apl-ubuntu:/usr/local/bin# cat /proc/net/dev —Å–µ—Ç–µ–≤—ã–µ** # –∏–Ω–µ—Ç–µ—Ä—Ñ–µ–π—Å—ã
- Inter-|   Receive                                                |  Transmit
- face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed
- lo:  168351    1785    0    0    0     0          0         0   168351    1785    0    0    0     0       0          0
- ens192: 189391314 1782688    0  712    0     0          0      5071 39149174  324460    0    0    0     0       0          0

- **root@ol-apl-ubuntu:/usr/local/bin# cat /proc/mounts** # –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- sysfs /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0
- proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0
- udev /dev devtmpfs rw,nosuid,relatime,size=967776k,nr_inodes=241944,mode=755,inode64 0 0
- devpts /dev/pts devpts rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0
- tmpfs /run tmpfs rw,nosuid,nodev,noexec,relatime,size=201536k,mode=755,inode64 0 0
- /dev/mapper/ubuntu--otus-ubuntu--lv / ext4 rw,relatime 0 0
- ...



# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–æ–≥ lsof –Ω–∞ Perl
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: COMMAND PID USER FD NAME
- **root@ol-apl-ubuntu:/usr/local/bin# vim my_lsof2.pl**

```bash

#!/usr/bin/env perl
use strict; # –∂—ë—Å—Ç–∫–∏–π —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.
use warnings; # –≤—ã–≤–æ–¥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
use File::Basename; # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º—è —Å–∫—Ä–∏–ø—Ç–∞

opendir(my $proc, "/proc") or die "–ù–µ –º–æ–≥—É –æ—Ç–∫—Ä—ã—Ç—å /proc: $!"; # —Ä–∞–±–æ—Ç–∞ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º /proc

printf "%-15s %6s %-8s %3s %s\n", "COMMAND", "PID", "USER", "FD", "NAME"; # –≤—ã–≤–æ–¥ "—à–∞–ø–∫–∏"

while (my $pid = readdir($proc)) { # —á–∏—Ç–∞–µ–º –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ /proc –ø–∏–¥—ã
    next unless $pid =~ /^\d+$/;              # –¢–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ PID
    my $base = "/proc/$pid"; # –ø–æ–ª—É—á–∞–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–π –∫–∞—Ç–∞–ª–æ–≥ –ø–∏–¥–∞

    # –ò–º—è –∫–æ–º–∞–Ω–¥—ã, —á–∏—Ç–∞–µ–º –∏–º—è –∫–æ–º–∞–Ω–¥—ã (–ø—Ä–æ—Ü–µ—Å—Å–∞) –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ /proc/<pid>/comm
    my $comm = ""; #–æ–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    if (open my $c, '<', "$base/comm") { # –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥ comm –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ –ø–∏–¥–∞
        chomp($comm = <$c>); # —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
        close $c;
    } else { # –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å—á–∏—Ç–∞—Ç—å (—Ñ–∞–π–ª –∑–∞–∫—Ä—ã–ª—Å—è) –∏–¥–µ–º –¥–∞–ª—å—à–µ (next)
        next;
    }

    # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ uid –∏–∑ /proc/<pid>/status)
    my $user = ""; #–æ–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    if (open my $s, '<', "$base/status") { # —á–∏—Ç–∞–µ–º —Å—Ç—Ä–æ—á–∫–∏ –∏–∑ status
        while (<$s>) {
            if (/^Uid:\s+(\d+)/) { # –∏—â–µ–º "Uid"
                my $uid = $1; 
                $user = getpwuid($uid) // $uid; # –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                last;
            }
        }
        close $s;
    }

    my $fd_dir = "$base/fd"; 
    next unless -d $fd_dir;

    opendir(my $fdh, $fd_dir) or next; # –µ—Å–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ fd –Ω–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ—Ü–µ—Å—Å —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    while (my $fd = readdir($fdh)) {  # –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ç–∞–ª–æ–≥–∞  ‚Äî –Ω–æ–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤
        next if $fd eq '.' or $fd eq '..'; # –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –∑–∞–ø–∏—Å–∏
        my $link = readlink("$fd_dir/$fd"); # —á–∏—Ç–∞–µ–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —É–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
        next unless defined $link; # –ø—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–ª–∞—Å—å
        printf "%-15s %6d %-8s %3s %s\n", $comm, $pid, $user, $fd, $link; # –≤—ã–≤–æ–¥–∏–º –Ω–∞—à–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø–æ—Å—Ç—Ä–æ—á–Ω–æ –≤ —Ü–∏–∫–ª–µ –ø–æ–∫–∞ –µ—Å—Ç—å)
    }
    closedir($fdh);
}
closedir($proc);


```
```bash
root@ol-apl-ubuntu:/usr/local/bin# ./my_lsof2.pl | { head -n 1; tail -n 20; } # –≤—ã–≤–æ–¥ –ø–µ—Ä–≤–æ–π (—à–∞–ø–∫–∏) –∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 20 —Å—Ç—Ä–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞–±–æ—Ç—ã
COMMAND            PID USER      FD NAME
pickup          386139 postfix    0 /dev/null
pickup          386139 postfix    1 /dev/null
pickup          386139 postfix    2 /dev/null
pickup          386139 postfix    3 pipe:[15403]
pickup          386139 postfix    4 pipe:[15403]
pickup          386139 postfix    5 socket:[15327]
pickup          386139 postfix    6 socket:[15325]
pickup          386139 postfix    7 socket:[1626153]
pickup          386139 postfix    8 anon_inode:[eventpoll]
pickup          386139 postfix    9 pipe:[1626166]
pickup          386139 postfix   10 pipe:[1626166]
perl            387639 root       0 /dev/pts/1
perl            387639 root       1 pipe:[1638256]
perl            387639 root       2 /dev/pts/1
perl            387639 root       3 /proc
perl            387639 root       4 /proc/387639/fd
bash            387640 root       0 pipe:[1638256]
bash            387640 root       1 /dev/pts/1
bash            387640 root       2 /dev/pts/1
bash            387640 root     255 /dev/pts/1
root@ol-apl-ubuntu:/usr/local/bin#

```
## 15 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–ü—Ä–∞–∫—Ç–∏–∫–∞ —Å SELinux"</ins>

**–¶–µ–ª—å**: —Ä–∞–±–æ—Ç–∞—Ç—å —Å SELinux: –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ SELinux –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –µ—Å–ª–∏ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å nginx –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É 3-–º—è —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:
- 1. –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ setsebool;
- 2. –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞ –≤ –∏–º–µ—é—â–∏–π—Å—è —Ç–∏–ø;
- 3. —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥—É–ª—è SELinux.


<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
	
üõ°Ô∏è SELinux ‚Äî –∫—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
üìò –ß—Ç–æ —ç—Ç–æ
- SELinux (Security-Enhanced Linux) ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –º–∞–Ω–¥–∞—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ (MAC), –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ —è–¥—Ä–æ Linux.‚Ä®–û–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —É –Ω–∏—Ö root-–ø—Ä–∞–≤.
- SELinux ‚Äî —ç—Ç–æ –≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç,‚Ä®—á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Å —Ñ–∞–π–ª–∞–º–∏, –ø–æ—Ä—Ç–∞–º–∏, —Å–æ–∫–µ—Ç–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏.

‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- SELinux –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî –Ω–∞–±–æ—Ä–∞—Ö –ø—Ä–∞–≤–∏–ª,‚Ä®–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç, –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å (–¥–æ–º–µ–Ω) –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∫–æ–º—É –æ–±—ä–µ–∫—Ç—É (–∫–æ–Ω—Ç–µ–∫—Å—Ç—É).
- –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –∏ –ø—Ä–æ—Ü–µ—Å—Å –∏–º–µ–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- ls -Z /var/www/html
- –†–µ–∑—É–ª—å—Ç–∞—Ç:
- -rw-r--r--. root root system_u:object_r:httpd_sys_content_t:s0 index.html
- –ó–¥–µ—Å—å httpd_sys_content_t ‚Äî —Ç–∏–ø –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à—ë–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º httpd.

üö¶ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã SELinux
- –†–µ–∂–∏–º							–û–ø–∏—Å–∞–Ω–∏–µ
- enforcing						SELinux –∞–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- permissive						–¢–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ –ª–æ–≥ (/var/log/audit/audit.log), –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
- disabled						SELinux –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:
- getenforce
- –∏–ª–∏
- sestatus

üîß –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
- sudo setenforce 0   # –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ permissive
- sudo setenforce 1   # –í–µ—Ä–Ω—É—Ç—å enforcing

üîß –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–∞
- sudo nano /etc/selinux/config
- –ò–∑–º–µ–Ω–∏ —Å—Ç—Ä–æ–∫—É: SELINUX=enforcing
- –Ω–∞ –æ–¥–Ω—É –∏–∑: 
- SELINUX=permissive
- SELINUX=disabled

üìÇ –ü–æ–ª–∏—Ç–∏–∫–∏ SELinux
–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –ø–æ–ª–∏—Ç–∏–∫:
- –ü–æ–ª–∏—Ç–∏–∫–∞				–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- targeted				–ó–∞—â–∏—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ—Ç–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ CentOS, RHEL, Fedora)
- mls						–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Military Level Security)
- minimum					–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
- sestatus | grep Policy

üß© –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:
- ls -Z

- –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–∞–π–ª–∞:
- sudo chcon -t httpd_sys_content_t /var/www/html/index.html

- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã (–ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ):
- sudo restorecon -Rv /var/www/html

üß† –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
| –°–∏—Ç—É–∞—Ü–∏—è | –†–µ—à–µ–Ω–∏–µ |
|----------|-----------|
| `Apache –Ω–µ –≤–∏–¥–∏—Ç —Ñ–∞–π–ª—ã –≤ /srv/www` | chcon -R -t httpd_sys_content_t /srv/www |
| `nginx –Ω–µ –º–æ–∂–µ—Ç —Å–ª—É—à–∞—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç` | semanage port -a -t http_port_t -p tcp 8080 |
| `–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥` | –ø—Ä–æ–≤–µ—Ä–∏—Ç—å audit.log ‚Üí —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç chcon -t var_log_t |

üîç –õ–æ–≥–∏ SELinux
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è:
- sudo cat /var/log/audit/audit.log | grep denied
- –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:
- sudo ausearch -m avc
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è:
- –£—Ç–∏–ª–∏—Ç–∞ sealert ‚Äî —á–∞—Å—Ç—å –ø–∞–∫–µ—Ç–∞ setroubleshoot, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É SELinux –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ.

üß† –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Docker / Kubernetes
	‚Ä¢	–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ç–∏–ø–æ–º container_t.
	‚Ä¢	–ú–æ–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º, –ø–æ–º–µ—Ç–∏–≤ –∏—Ö —Ç–∏–ø–æ–º container_file_t.
	‚Ä¢	–ò–Ω–æ–≥–¥–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å bind mounts –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ :z –∏–ª–∏ :Z:
- docker run -v /data:/data:Z nginx

üí° –ö–æ—Ä–æ—Ç–∫–æ: –∫–∞–∫ –∂–∏—Ç—å —Å SELinux
	1	–ù–µ –æ—Ç–∫–ª—é—á–∞–π SELinux –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã.‚Ä®–õ—É—á—à–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∫–ª—é—á–∏ permissive –∏ —Ä–∞–∑–±–µ—Ä–∏ –ª–æ–≥–∏.
	2	–ò—Å–ø–æ–ª—å–∑—É–π restorecon ‚Äî —á–∞—Å—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É.
	3	–°—Ç–∞–≤—å —É—Ç–∏–ª–∏—Ç—É policycoreutils-python-utils –¥–ª—è semanage, restorecon, chcon.

- SELinux ‚Äî —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã (MAC),
- –∞ –ø–µ—Ä–≤—ã–π ‚Äî —ç—Ç–æ DAC (Discretionary Access Control).

üîπ 1. DAC ‚Äî –î–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –≠—Ç–æ –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å Unix-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
- –ü—Ä–∏–º–µ—Ä: —É –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –µ—Å—Ç—å —Ç—Ä–∏ –∞—Ç—Ä–∏–±—É—Ç–∞ –¥–æ—Å—Ç—É–ø–∞:
- –í–ª–∞–¥–µ–ª–µ—Ü (user)
- –ì—Ä—É–ø–ø–∞ (group)
- –û—Å—Ç–∞–ª—å–Ω—ã–µ (others)
- –ü—Ä–∞–≤–∞: —á—Ç–µ–Ω–∏–µ r, –∑–∞–ø–∏—Å—å w, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ x

üîπ 2. MAC ‚Äî –ú–∞–Ω–¥–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (–≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å)
- MAC –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–≤–µ—Ä—Ö DAC —Å–∏—Å—Ç–µ–º—É –ø–æ–ª–∏—Ç–∏–∫,‚Ä®–≥–¥–µ —Ä–µ—à–∞–µ—Ç —É–∂–µ –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü —Ñ–∞–π–ª–∞, –∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
- –ù–∞–ø—Ä–∏–º–µ—Ä:
	‚Ä¢	–£ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ httpd –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ /var/www,‚Ä®–Ω–æ SELinux –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç –µ–º—É —á–∏—Ç–∞—Ç—å /etc/passwd ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–∞–≤–∞ DAC —ç—Ç–æ —Ä–∞–∑—Ä–µ—à–∞—é—Ç.
- –í –º–æ–¥–µ–ª–∏ MAC:
- –ü—Ä–æ—Ü–µ—Å—Å—ã –∏ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.‚Ä®–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∞ —è–≤–Ω–æ —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç.

‚öôÔ∏è –ö–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ
	1	–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è DAC (–æ–±—ã—á–Ω—ã–µ UNIX-–ø—Ä–∞–≤–∞, ACL).
	2	–ï—Å–ª–∏ DAC —Ä–∞–∑—Ä–µ—à–∞–µ—Ç, —Ç–æ SELinux (MAC) –ø—Ä–æ–≤–æ–¥–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ.
	3	–ï—Å–ª–∏ –æ–±–∞ —Ä–∞–∑—Ä–µ—à–∞—é—Ç ‚Äî –¥–æ—Å—Ç—É–ø –¥–∞–Ω.
- –¢–æ –µ—Å—Ç—å:
- –†–∞–∑—Ä–µ—à–µ–Ω–æ = DAC + MAC
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ = –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–∫–∞–∑–∞–ª ‚Äú–Ω–µ—Ç‚Äù

üí° –ö–æ—Ä–æ—Ç–∫–æ:
| –£—Ä–æ–≤–µ–Ω—å | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|----------|-----------|
| `DAC` | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ UNIX-–ø—Ä–∞–≤–∞ (chmod, chown, umask, ACL) |
| `MAC` | –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —è–¥—Ä–∞ (SELinux, AppArmor –∏ —Ç.–¥.) |
| `RBAC (–¥–æ–ø.)` | Role-Based Access Control ‚Äî —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á–∞—Å—Ç–æ –≤–Ω—É—Ç—Ä–∏ MAC) |


</details>

---
## –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞
- –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –≤ –∫–æ–Ω—Ñ —Ñ–∞–π–ª nginx –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç 4881, —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –Ω–µ –≥–æ—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥
- **[root@AlmaLinux ~]# systemctl start nginx**
- **[root@AlmaLinux ~]# systemctl status nginx**
- **‚óè nginx.service - The nginx HTTP and reverse proxy server
- Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: disabled)
- Active: active (running) since Tue 2025-10-21 14:05:19 MSK; 6min ago
- Process: 11133 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
- Process: 11134 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
- Process: 11135 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
- Main PID: 11136 (nginx)
- Tasks: 2 (limit: 48850)
- Memory: 1.9M
- CPU: 16ms
- CGroup: /system.slice/nginx.service
-  ‚îî‚îÄ11136 "nginx: master process /usr/sbin/nginx"
-  ‚îî‚îÄ11137 "nginx: worker process"

- Oct 21 14:05:19 AlmaLinux systemd[1]: Starting The nginx HTTP and reverse proxy server...
- Oct 21 14:05:19 AlmaLinux nginx[11134]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
- Oct 21 14:05:19 AlmaLinux nginx[11134]: nginx: configuration file /etc/nginx/nginx.conf test is successful
- Oct 21 14:05:19 AlmaLinux systemd[1]: Started The nginx HTTP and reverse proxy server.
- **[root@AlmaLinux ~]# systemctl status firewalld** # –ø—Ä–æ–≤–µ—Ä—è–µ–º FireWall
- ‚óè firewalld.service - firewalld - dynamic firewall daemon
- Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; preset: enabled)
- Active: **active (running)** since Tue 2025-10-21 13:52:32 MSK; 28min ago # –∑–∞–ø—É—â–µ–Ω :(
- Docs: man:firewalld(1)
- Main PID: 808 (firewalld)
- Tasks: 2 (limit: 48850)
- Memory: 42.4M
- CPU: 401ms
- CGroup: /system.slice/firewalld.service
- ‚îî‚îÄ808 /usr/bin/python3 -s /usr/sbin/firewalld --nofork --nopid

- Oct 21 13:52:31 AlmaLinux systemd[1]: Starting firewalld - dynamic firewall daemon...
- Oct 21 13:52:32 AlmaLinux systemd[1]: Started firewalld - dynamic firewall daemon.
- **[root@AlmaLinux ~]# systemctl stop firewalld** # –≥–∞—Å–∏–º FireWall
- **[root@AlmaLinux ~]# systemctl status firewalld** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- ‚óã firewalld.service - firewalld - dynamic firewall daemon
- Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; preset: enabled)
- Active: **inactive (dead)** since Tue 2025-10-21 14:22:14 MSK; 2s ago # –ø–æ—Ç—É—Ö :)
- Duration: 29min 42.334s
- Docs: man:firewalld(1)
- Process: 808 ExecStart=/usr/sbin/firewalld --nofork --nopid $FIREWALLD_ARGS (code=exited, status=0/SUCCESS)
- Main PID: 808 (code=exited, status=0/SUCCESS)
- CPU: 459ms
- 
- **[root@AlmaLinux ~]# nginx -t** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
- nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
- nginx: configuration file /etc/nginx/nginx.conf test is successful
- **[root@AlmaLinux ~]# sestatus** # –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å SELinux
- SELinux status:                 enabled
- SELinuxfs mount:                /sys/fs/selinux
- SELinux root directory:         /etc/selinux
- Loaded policy name:             targeted
- Current mode:                   enforcing
- Mode from config file:          enforcing
- Policy MLS status:              enabled
- Policy deny_unknown status:     allowed
- Memory protection checking:     actual (secure)
- Max kernel policy version:      33

- **[root@AlmaLinux ~]# getenforce** # —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã SELinux
- **Enforcing** # –î–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ SELinux –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.
- 
## 1. –†–∞–∑—Ä–µ—à–∏–º –≤ SELinux —Ä–∞–±–æ—Ç—É nginx –Ω–∞ –ø–æ—Ä—Ç—É TCP 4881 c –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π setsebool

- **http://10.0.77.182:4881**
- <img width="523" height="99" alt="Screenshot 2025-10-21 at 14 46 13" src="https://github.com/user-attachments/assets/7bb19e61-0fe4-4b91-9bc4-8f0e263c6649" />

- **[root@AlmaLinux ~]# grep 4881 /var/log/audit/audit.log**
- type=AVC msg=audit(**1761217234.568:48**): avc:  denied  { name_bind } for  pid=1004 comm="nginx" src=4881 - - - - scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket permissive=0
- **[root@AlmaLinux ~]# grep 1761217234.568:48** /var/log/audit/audit.log | audit2why # –£—Ç–∏–ª–∏—Ç–∞ audit2why –ø–æ–∫–∞–∂–µ—Ç –ø–æ—á–µ–º—É —Ç—Ä–∞—Ñ–∏–∫ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è 
 –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º nginx: setsebool -P nis_enabled on

- type=AVC msg=audit(1761217234.568:48): avc:  denied  { name_bind } for  pid=1004 comm="nginx" src=4881 - scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket permissive=0

- Was caused by:
- The boolean nis_enabled was set incorrectly.
- Description:
- Allow nis to enabled

- Allow access by executing:
  ### setsebool -P nis_enabled 1 # –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä nis_enabled
- 
- **[root@AlmaLinux ~]# setsebool -P nis_enabled on** # –í–∫–ª—é—á–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä nis_enabled
- **[root@AlmaLinux ~]# systemctl restart nginx** # –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º nginx
- **[root@AlmaLinux ~]# systemctl status nginx** # –ø—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
- ‚óè nginx.service - The nginx HTTP and reverse proxy server
- Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: disabled)
- Active: active (running) since Thu 2025-10-23 14:19:31 MSK; 8s ago
	
- **http://10.0.77.182:4881** # –ø—Ä–æ–≤–µ—Ä–∏–º, —Å–ª—É—à–∞–µ—Ç –ª–∏ nginx –ø–æ—Ä—Ç 4881
- <img width="790" height="312" alt="Screenshot 2025-10-23 at 14 06 59" src="https://github.com/user-attachments/assets/edb7c5f8-57a6-4b3e-bf9e-5666e5034eb7" />
- **[root@AlmaLinux ~]# getsebool -a | grep nis_enabled**
- nis_enabled --> on
- **[root@AlmaLinux ~]# setsebool -P nis_enabled off** # –≤–µ—Ä–Ω–µ–º –≤—Å–µ –æ–±—Ä–∞—Ç–Ω–æ
- 

## 2. –†–∞–∑—Ä–µ—à–∏–º –≤ SELinux —Ä–∞–±–æ—Ç—É nginx –Ω–∞ –ø–æ—Ä—Ç—É TCP 4881 c –ø–æ–º–æ—â—å—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞ –≤ –∏–º–µ—é—â–∏–π—Å—è —Ç–∏–ø:
-
- **[root@AlmaLinux ~]# semanage port -l | grep http**
- http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010
- http_cache_port_t              udp      3130
- http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000
- pegasus_http_port_t            tcp      5988
- pegasus_https_port_t           tcp      5989

<img width="614" height="172" alt="Screenshot 2025-10-21 at 15 36 58" src="https://github.com/user-attachments/assets/a33953a0-e895-4048-b1b6-aa3eb9904aa0" />

- [root@AlmaLinux ~]# semanage port -a -t http_port_t -p tcp 4881
- [root@AlmaLinux ~]# semanage port -l | grep  http_port_t
- http_port_t                    tcp      **4881**, 80, 81, 443, 488, 8008, 8009, 8443, 9000
- pegasus_http_port_t            tcp      5988
- **[root@AlmaLinux ~]# systemctl restart nginx && systemctl status nginx**
- ‚óè nginx.service - The nginx HTTP and reverse proxy server
- Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: disabled)
- Active: active (running) since Thu 2025-10-23 15:21:47 MSK; 10ms ago

<img width="646" height="459" alt="Screenshot 2025-10-23 at 15 24 34" src="https://github.com/user-attachments/assets/9fcfda94-239f-42f0-b382-af438cbf35b0" />

- **[root@AlmaLinux ~]# semanage port -d -t http_port_t -p tcp 4881**
- **[root@AlmaLinux ~]# semanage port -l | grep http**
- http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010
- http_cache_port_t              udp      3130
- http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000
- pegasus_http_port_t            tcp      5988
- pegasus_https_port_t           tcp      5989
- **[root@AlmaLinux ~]# systemctl restart nginx && systemctl status nginx**

- <img width="931" height="496" alt="Screenshot 2025-10-23 at 15 26 55" src="https://github.com/user-attachments/assets/77c836b2-3ea6-439d-a4c8-9bc2f0213451" />

## 3. –†–∞–∑—Ä–µ—à–∏–º –≤ SELinux —Ä–∞–±–æ—Ç—É nginx –Ω–∞ –ø–æ—Ä—Ç—É TCP 4881 c –ø–æ–º–æ—â—å—é —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥—É–ª—è SELinux:
- **[root@AlmaLinux ~]# systemctl start nginx**
- Job for nginx.service failed because the control process exited with error code.
- See "systemctl status nginx.service" and "journalctl -xeu nginx.service" for details.
### Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ SELinux –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –µ–≥–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å. 
- **[root@AlmaLinux ~]# grep nginx /var/log/audit/audit.log** # –ü–æ—Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ SELinux, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ Nginx: 
- type=SERVICE_START msg=audit(1761287760.047:221): pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg='unit=nginx comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=failed'UID="root" AUID="unset"
- **[root@AlmaLinux ~]# grep nginx /var/log/audit/audit.log | audit2allow -M nginx** # –í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —É—Ç–∏–ª–∏—Ç–æ–π - audit2allow –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–æ–≤ SELinux —Å–¥–µ–ª–∞—Ç—å –º–æ–¥—É–ª—å, —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–π —Ä–∞–±–æ—Ç—É nginx –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É
- ******************** IMPORTANT ***********************
- To make this policy package active, execute:

- semodule -i nginx.pp # –∏ –∫–∞–∫ –µ–≥–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç
- **[root@AlmaLinux ~]# semodule -i nginx.pp** # –ø—Ä–∏–º–µ–Ω—è–µ–º
- **[root@AlmaLinux ~]# systemctl start nginx** # –∑–∞–ø—É—Å–∫–∞–µ–º nginx
- **[root@AlmaLinux ~]# systemctl status nginx** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
- ‚óè nginx.service - The nginx HTTP and reverse proxy server
- Loaded: loaded (/usr/lib/systemd/system/nginx.service; **enabled**; **preset: disabled**)
- Active: **active** (running) since Fri 2025-10-24 10:06:41 MSK; 40s ago
  ### http://10.0.77.182:4881 –¥–æ—Å—Ç—É–ø–Ω–∞:

- <img width="579" height="270" alt="Screenshot 2025-10-24 at 10 09 45" src="https://github.com/user-attachments/assets/2acb963f-0568-4d1a-815f-55db2d831767" />

- **[root@AlmaLinux ~]# semodule -l** # –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- **[root@AlmaLinux ~]# semodule -r nginx** # —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è nginx
- libsemanage.semanage_direct_remove_key: Removing last nginx module (no other nginx module exists at another priority).

- <img width="594" height="119" alt="Screenshot 2025-10-24 at 10 16 56" src="https://github.com/user-attachments/assets/00213e67-0c25-406b-ba88-7059db7a4f6f" />



## 16 —É—Ä–æ–∫
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏ —Å Ansible"</ins>

-  –¶–µ–ª—å: –Ω–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Å Ansible;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- –ù–∞  —Å–µ—Ä–≤–µ—Ä–µ, –∏—Å–ø–æ–ª—å–∑—É—è Ansible, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å nginx —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏:

- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å yum/apt;
- –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∑—è—Ç—ã –∏–∑ —à–∞–±–ª–æ–Ω–∞ jinja2 —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏;
- –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ nginx –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ä–µ–∂–∏–º–µ enabled –≤ systemd;
- –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω notify –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ nginx –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏;
- —Å–∞–π—Ç –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É ‚Äî 8080, –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Ansible.

  
<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
# üß† Ansible ‚Äî –¢–µ–æ—Ä–∏—è –∏ –æ—Å–Ω–æ–≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

> Ansible ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏, —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —É–∑–ª–∞—Ö.

---

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

| –¢–µ—Ä–º–∏–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------|
| **Control Node** | –°–µ—Ä–≤–µ—Ä, –≥–¥–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Ansible –∏ –æ—Ç–∫—É–¥–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è playbooks |
| **Managed Nodes** | –¶–µ–ª–µ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–º–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç Ansible |
| **Inventory** | –§–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —Ö–æ—Å—Ç–æ–≤ |
| **Playbook** | YAML-—Ñ–∞–π–ª, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ |
| **Task** | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ playbook (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞) |
| **Module** | –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π –±–ª–æ–∫ –∫–æ–¥–∞, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `yum`, `copy`, `template`) |
| **Role** | –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á, —à–∞–±–ª–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö |
| **Facts** | –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —Å–æ–±–∏—Ä–∞–µ–º–∞—è Ansible —Å —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —É–∑–ª–æ–≤ |
| **Handler** | –ó–∞–¥–∞—á–∏, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–µ –ø–æ —Å–æ–±—ã—Ç–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) |

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible

```bash
# AlmaLinux / Oracle / CentOS
sudo dnf install epel-release -y
sudo dnf install ansible -y
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
- ansible --version
```
## Installing Ansible on UbuntuÔÉÅ

- Ubuntu provides Ansible packages through a Personal Package Archive (PPA) that contains more recent versions than the standard repositories.

- Ubuntu builds are available in a PPA here.

- Configure the PPA on your system and install Ansible:

- $ sudo apt update
- $ sudo apt install software-properties-common
- $ sudo add-apt-repository --yes --update ppa:ansible/ansible
- $ sudo apt install ansible


üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Ansible
–ü—Ä–∏–º–µ—Ä —Ç–∏–ø–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```bash
project/
‚îú‚îÄ‚îÄ ansible.cfg
‚îú‚îÄ‚îÄ inventory
‚îÇ   ‚îú‚îÄ‚îÄ hosts.ini
‚îú‚îÄ‚îÄ playbooks/
‚îÇ   ‚îú‚îÄ‚îÄ site.yml
‚îÇ   ‚îî‚îÄ‚îÄ webservers.yml
‚îî‚îÄ‚îÄ roles/
    ‚îú‚îÄ‚îÄ nginx/
    ‚îÇ   ‚îú‚îÄ‚îÄ tasks/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
    ‚îÇ   ‚îú‚îÄ‚îÄ templates/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf.j2
    ‚îÇ   ‚îî‚îÄ‚îÄ vars/
    ‚îÇ       ‚îî‚îÄ‚îÄ main.yml
```
üßæ –§–∞–π–ª inventory
- Inventory ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ Ansible –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å –∑–∞–¥–∞—á–∏.
- –ü—Ä–∏–º–µ—Ä (inventory/hosts.ini):

- [webservers]
- 192.168.1.10
- 192.168.1.11

- [dbservers]
- db1.example.com ansible_user=root

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- ansible all -i inventory/hosts.ini -m ping

üß© –ü—Ä–∏–º–µ—Ä Playbook (site.yml)
---
```bash
- name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ Nginx
  hosts: webservers
  become: yes
  tasks:
    - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç nginx
      yum:
        name: nginx
        state: present

    - name: –í–∫–ª—é—á–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É nginx
      service:
        name: nginx
        state: started
        enabled: yes
```
- –ó–∞–ø—É—Å–∫:
- ansible-playbook -i inventory/hosts.ini playbooks/site.yml

üß± –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (Variables)
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:
```bash
–ú–µ—Å—Ç–æ								–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç											–ü—Ä–∏–º–µ—Ä
–í playbook							–Ω–∏–∑–∫–∏–π												vars:
–í group_vars/						—Å—Ä–µ–¥–Ω–∏–π												group_vars/webservers.yml
–í host_vars/						–≤—ã—Å–æ–∫–∏–π												host_vars/db1.yml
–ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É				—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π										-e var=value
```
- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```bash
vars:
  nginx_port: 8080

tasks:
  - name: –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
    template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
```
üß∞ –ú–æ–¥—É–ª–∏ Ansible
```bash
–ö–∞—Ç–µ–≥–æ—Ä–∏—è			–ü—Ä–∏–º–µ—Ä –º–æ–¥—É–ª—è								–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞				user, group, hostname						–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ö–æ—Å—Ç–∞–º–∏
–§–∞–π–ª—ã				copy, template, file, unarchive				–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
–°–µ—Ç—å				firewalld, iptables, nmcli					–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏
–ü–∞–∫–µ—Ç—ã				yum, apt, dnf								–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏
–°–µ—Ä–≤–∏—Å—ã				service, systemd							–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É–∂–±–∞–º–∏
–£—Ç–∏–ª–∏—Ç—ã				command, shell, debug						–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
```
üîÅ Handlers (–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.
```bash
- tasks:
  - name: –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥ nginx
    template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
    notify: restart nginx

handlers:
  - name: restart nginx
    service:
      name: nginx
      state: restarted
```
üß© Roles (–†–æ–ª–∏)
- –†–æ–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É—é—Ç –∫–æ–¥ Ansible. –ü—Ä–∏–º–µ—Ä:
```bash
- roles/
‚îî‚îÄ‚îÄ nginx/
    ‚îú‚îÄ‚îÄ tasks/main.yml
    ‚îú‚îÄ‚îÄ handlers/main.yml
    ‚îú‚îÄ‚îÄ templates/nginx.conf.j2
    ‚îî‚îÄ‚îÄ vars/main.yml
```
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ site.yml:
```bash
- hosts: webservers
  roles:
    - nginx
```
üîê –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä–æ–ª—è–º–∏ (Ansible Vault)
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```bash
ansible-vault create secrets.yml
ansible-vault edit secrets.yml
ansible-vault view secrets.yml
```
- –ó–∞–ø—É—Å–∫ —Å –ø–∞—Ä–æ–ª–µ–º:
```bash
ansible-playbook site.yml --ask-vault-pass
```

üßÆ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
–ö–æ–º–∞–Ω–¥–∞–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
ansible all -m ping			–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤
ansible-inventory --list	–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
ansible-playbook --check	–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (dry-run)
ansible-config dump			–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
ansible-doc -l				–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
```
üß† –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã Ansible
- 1	–ë–µ–∑ –∞–≥–µ–Ω—Ç–∞ ‚Äî SSH-–¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç–∞–º.
- 2	–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚Äî –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ, –µ—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É–∂–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ.
- 3	–Ø–∑—ã–∫ YAML ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
- 4	–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å ‚Äî —á–µ—Ä–µ–∑ –º–æ–¥—É–ª–∏ –∏ —Ä–æ–ª–∏.
- 5	–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ --check.


üí¨ ‚ÄúAnsible –¥–µ–ª–∞–µ—Ç —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–æ—Å—Ç—ã–º, –∞ —Ä—É—Ç–∏–Ω–Ω–æ–µ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º.‚Äù

</details>

---
- **root@ansibleserver:~# ansible --version**
- ansible [core 2.19.3]
-   config file = /etc/ansible/ansible.cfg
-   configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
-   ansible python module location = /usr/lib/python3/dist-packages/ansible
-   ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections
-   executable location = /usr/bin/ansible
-   python version = 3.12.3 (main, Aug 14 2025, 17:47:21) [GCC 13.3.0] (/usr/bin/python3)
-   jinja version = 3.1.2
-   pyyaml version = 6.0.1 (with libyaml v0.2.5)

- **root@ansibleserver:~/project/inventory# pwd**
/root/project/inventory
- **root@ansibleserver:~/project/inventory# vi hosts.ini**
```bash
[nginx]
10.0.77.142 ansible_user=spg ansible_ssh_private_key_file=/root/.ssh/id_rsa
```
- **root@ansibleserver:~/project/inventory# ssh-keygen -t rsa -b 4096 -C "ansible@ansibleserver"**
- Generating public/private rsa key pair.
- **root@ansibleserver:~/project/inventory# ls -l /root/.ssh/id_rsa***
- -rw------- 1 root root 3389 Oct 27 13:09 /root/.ssh/id_rsa
- -rw-r--r-- 1 root root  747 Oct 27 13:09 /root/.ssh/id_rsa.pub
- **root@ansibleserver:~/project/inventory# ssh-copy-id -i /root/.ssh/id_rsa.pub spg@10.0.77.142**
- **root@ansibleserver:~/project/inventory# ansible  nginx -i /root/project/inventory/hosts.ini -m ping**
- ***[WARNING]: Host '10.0.77.142' is using the discovered Python interpreter at '/usr/bin/python3.12', but - future installation of another Python interpreter could cause a different interpreter to be discovered. - See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more - information.***
 ```bash
  10.0.77.142 | SUCCESS => {
    "ansible_facts": {
         "discovered_interpreter_python": "/usr/bin/python3.12"
     },
     "changed": false,
    "ping": "pong"
}
```

- **root@ansibleserver:~/project# vi ansible.cfg**
```bash
[defaults]
inventory = inventory/hosts.ini
remote_user = spg
host_key_checking = False
retry_files_enabled = False
```

- **root@ansibleserver:~/project/inventory# vi hosts.ini**
```bash
[nginx]
10.0.77.142 ansible_port=22 ansible_ssh_private_key_file=/root/.ssh/id_rsa
```
- **root@ansibleserver:~/project# ansible  nginx -i /root/project/inventory/hosts.ini -m ping**
- ***[WARNING]: Host '10.0.77.142' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.***
```bash  
10.0.77.142 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3.12"
    },
    "changed": false,
    "ping": "pong"
}
```

- **root@ansibleserver:~/project# ansible  nginx -m command -a "uname -r"**
```bash
10.0.77.142 | CHANGED | rc=0 >>
6.8.0-86-generic
```

- **root@ansibleserver:~/project# ansible  nginx -m systemd -a name=firewalld**
```bash
10.0.77.142 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3.12"
    },
    "changed": false,
    "name": "firewalld",
    "status": {
        "ActiveEnterTimestampMonotonic": "0",
        "ActiveExitTimestampMonotonic": "0",
        "ActiveState": "inactive",
```

- ****
- **root@ansibleserver:~/project# vi nginx.ym** # –Ω–∞—á–∏–Ω–∞–µ–º –ø–∏—Å–∞—Ç—å –ø–ª–µ–π–±—É–∫ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ NGINX
```bash
---
- name: NGINX | Install and configure NGINX
  hosts: nginx
  # become: true # –º–Ω–µ –Ω–µ –Ω—É–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é –∫–ª—é—á–∏ (10.0.77.142 ansible_user=spg ansible_ssh_private_key_file=/root/.ssh/id_rsa)
 
  tasks:
    - name: update
      apt:
        update_cache=yes

    - name: NGINX | Install NGINX
      apt:
        name : nginx
        state: latest
```
- ***root@ansibleserver:~/project# ansible-playbook nginx.yml**
```bash
PLAY [NGINX | Install and configure NGINX] ******************************************************

TASK [Gathering Facts] **************************************************************************
[WARNING]: Host '10.0.77.142' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.
ok: [10.0.77.142]

TASK [update] ***********************************************************************************
[ERROR]: Task failed: Module failed: Failed to lock apt for exclusive operation: Failed to lock directory /var/lib/apt/lists/: E:Could not open lock file /var/lib/apt/lists/lock - open (13: Permission denied)
Origin: /root/project/nginx.yml:7:7

5
6   tasks:
7     - name: update
        ^ column 7

fatal: [10.0.77.142]: FAILED! => {"changed": false, "msg": "Failed to lock apt for exclusive operation: Failed to lock directory /var/lib/apt/lists/: E:Could not open lock file /var/lib/apt/lists/lock - open (13: Permission denied)"}

PLAY RECAP **************************************************************************************
10.0.77.142                : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
ed=0    ignored=0
PLAY: command not found
Command 'Install' not found, did you mean:
  command 'install' from deb coreutils (9.4-3ubuntu6.1)
Try: apt install <deb name>
TASK: command not found
[WARNING]:: command not found
ok:: command not found
TASK: command not found
-bash: syntax error near unexpected token `('
Origin:: command not found
5: command not found
6: command not found
7: command not found
^: command not found
fatal:: command not found
PLAY: command not found
10.0.77.142: command not found
```
## –ß—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –î–ó...
- **root@ansibleserver:~/project# cat inventory/hosts.ini** # –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –º–∞—à–∏–Ω—É @ansibleclient
```bash
[nginx]
10.0.77.142 ansible_user=spg ansible_port=22 ansible_ssh_private_key_file=/root/.ssh/id_rsa
```
- **root@ansibleserver:~/project# ansible-playbook nginx.yml**
```bash
PLAY [NGINX | Install and configure NGINX] ******************************************************

TASK [Gathering Facts] **************************************************************************
[ERROR]: Task failed: Missing sudo password
fatal: [10.0.77.142]: FAILED! => {"changed": false, "msg": "Task failed: Missing sudo password"}

PLAY RECAP **************************************************************************************
10.0.77.142                : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
```
- **root@ansibleserver:~/project# cat inventory/hosts.ini** # –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∏ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –º–∞—à–∏–Ω—É @ansibleclient
```bash
[nginx]
10.0.77.142 ansible_user=spg ansible_become_password=******* ansible_port=22 ansible_ssh_private_key_file=/root/.ssh/id_rsa
```
- **root@ansibleserver:~/project# ansible-playbook nginx.yml** 
```bash
PLAY [NGINX | Install and configure NGINX] ******************************************************

TASK [Gathering Facts] **************************************************************************
[WARNING]: Host '10.0.77.142' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.
ok: [10.0.77.142]

TASK [update] ***********************************************************************************
changed: [10.0.77.142]

TASK [NGINX | Install NGINX] ********************************************************************
changed: [10.0.77.142]

PLAY RECAP **************************************************************************************
10.0.77.142                : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
## –†–∞–±–æ—Ç–∞–µ—Ç
- **root@ansibleserver:~/project# cat nginx.yml** # –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
```bash
---
- name: NGINX | Install and configure NGINX
  hosts: nginx
  become: true
  vars:
    nginx_listen_port: 8080

  tasks:
    - name: update
      apt:
        update_cache=yes
      tags:
        - update apt

    - name: NGINX | Install NGINX
      apt:
        name : nginx
        state: latest
      notify:
        - restart nginx
      tags:
        - nginx-package

    - name: NGINX | Create NGINX config file from template
      template:
        src: templates/nginx.config.j2
        dest: /etc/nginx/nginx.conf
      notify:
        - restart nginx
      tags:
        - nginx-configuration

  handlers:
    - name: restart nginx
      systemd:
        name: nginx
        state: restarted
        enabled: yes

    - name: reload nginx
      systemd:
        name: nginx
        state: reloaded
  ```
- **root@ansibleserver:~/project# cat templates/nginx.config.j2** # —à–∞–±–ª–æ–Ω (template:)
```bash
# {{ ansible_managed }}
events {
    worker_connections 1024;
}

http {
    server {
        listen       {{ nginx_listen_port }} default_server;
        server_name  default_server;
        root         /usr/share/nginx/html;

        location / {
        }
    }
}
```
- **root@ansibleserver:~/project# ansible-playbook nginx.yml** # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è —Ñ–∞–π–ª nginx.yml. 
```bash
PLAY [NGINX | Install and configure NGINX] ******************************************************

TASK [Gathering Facts] **************************************************************************
[WARNING]: Host '10.0.77.142' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.
ok: [10.0.77.142]

TASK [update] ***********************************************************************************
changed: [10.0.77.142]

TASK [NGINX | Install NGINX] ********************************************************************
ok: [10.0.77.142]

TASK [NGINX | Create NGINX config file from template] *******************************************
changed: [10.0.77.142]

RUNNING HANDLER [restart nginx] *****************************************************************
changed: [10.0.77.142]

PLAY RECAP **************************************************************************************
10.0.77.142                : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
- **root@ansibleserver:~/project# curl http://10.0.77.142:8080** # –ü–†–û–í–ï–†–Ø–ï–ú
```bash 
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
```
## —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 8080



---
## 18 —É—Ä–æ–∫ VAGRANT!
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏—Å–∫–æ–≤ –∏ —Å–µ—Ç–µ–π"</ins>

-  –¶–µ–ª—å: –Ω–∞—É—á–∏—Ç—å—Å—è –¥–æ–±–∞–≤–ª—è—Ç—å –¥–∏—Å–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- –£–±–µ–¥–∏—Ç–µ—Å—Ç—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ VirtualBox –∏ Vagrant.
- –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞.
- 2. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ –ª—é–±–æ–π –æ–±—Ä–∞–∑.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç–µ –ø–∞–º—è—Ç—å –í–ú: 1024 –ú–ë.
- 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤:
- –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∏—Å–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–º 1 –ì–ë –∫–∞–∂–¥—ã–π.
- 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏:
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–±—Ä–æ—Å 80 –ø–æ—Ä—Ç–∞ —Å –≥–æ—Å—Ç–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –ø–æ—Ä—Ç 8080 —Ö–æ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.
- 5. ## –ü—Ä–æ–≤–∏–∂–∏–Ω–∏–Ω–≥:

## –ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–≤–∏–∂–∏–Ω–∏–Ω–≥, –∫–æ—Ç–æ—Ä—ã–π:
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∏—Å–∫–∏ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ext4.
- –°–æ–∑–¥–∞–µ—Ç —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è /mnt/disk1 –∏ /mnt/disk2.
- –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç –¥–∏—Å–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
- –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ /etc/fstab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ MacOS M4 (Apple Silicon :)

- **spg@spg-mac ~ % which vagrant**
- /usr/local/bin/vagrant

- **spg@spg-mac ~ % which virtualbox**
- /usr/local/bin/virtualbox

- **spg@spg-mac ~ % which vagrant **  
- /usr/local/bin/vagrant

- **spg@spg-mac ~ % vagrant -v**
- Vagrant 2.4.9

- **spg@spg-mac ~ % virtualbox -h**
- Oracle VirtualBox Manager v7.2.0
- Copyright (C) 2005-2025 Oracle and/or its affiliates

- **pg@spg-mac ~ % VBoxManage --version**         
- 7.2.0r170228

- **spg@spg-mac ~ % vagrant box list**
- There are no installed boxes! Use `vagrant box add` to add some.

- **spg@spg-mac ~ % ls -hal Downloads/focal-server-cloudimg-amd64-vagrant.box**
- -rwx------  1 spg  staff   587M Nov  1 09:52 Downloads/focal-server-cloudimg-amd64-vagrant.box

spg@spg-mac ~ % vagrant box add Downloads/focal-server-cloudimg-amd64-vagrant.box --name ubuntu/test
==> box: Box file was not detected as metadata. Adding it directly...
==> box: Adding box 'ubuntu/test' (v0) for provider: (arm64)
    box: Unpacking necessary files from: file:///Users/spg/Downloads/focal-server-cloudimg-amd64-vagrant.box
==> box: Successfully added box 'ubuntu/test' (v0) for '(arm64)'!
----
##  –í—ã–≤–æ–¥ –ø–æ—Å–ª–µ –Ω–µ–¥–µ–ª–∏ –ø–æ–ø—ã—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –î–ó –Ω–∞ –º–∞–∫–µ —Å –ú4:
- VirtualBox - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç;
- Lima - –∑–∞–±—Ä–æ—Å–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É;
- Qemu - –Ω–µ—Ç box-–æ–≤ –ø–æ–¥ arm64;
- Parallels Desktop - —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç–Ω—ã–µ, 14 -–¥–Ω–µ–≤–Ω–æ–≥–æ —Ç—Ä–∏–∞–ª–∞ —É–∂–µ –Ω–µ—Ç;
- VMware Fusion - Vagrant Plugin: vagrant-vmware-desktop - –ø–ª–∞—Ç–Ω—ã–π;
- Rosetta2 - –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å...
  
 
## –î–ó –ø–æ–¥ Windows c VirtualBox

- **PS C:\Users\spg> vagrant -v**
- Vagrant 2.4.9
- **PS C:\Users\spg\.VirtualBox> cat selectorwindow.log**
- 00:00:00.427401 VirtualBox GUI VM Selector Window 7.2.4 r170995 win.amd64 (Oct 17 2025 12:31:09) release log
- 00:00:00.427405 Log opened 2025-11-10T06:55:22.896040200Z
- 00:00:00.427406 Build Type: release
- 00:00:00.427407 OS Product: Windows 10
- 00:00:00.427527 OS Release: 10.0.19045.3693
- 00:00:00.427528 OS Service Pack:
- 00:00:00.449061 DMI Product Name: MS-7673
- 00:00:00.454285 DMI Product Version: 1.0
- 00:00:00.454302 Firmware type: BIOS
- 00:00:00.454311 Host RAM: 8162MB (7.9GB) total, 4642MB (4.5GB) available
- 00:00:00.454318 Executable: C:\Program Files\Oracle\VirtualBox\VirtualBox.exe
- 00:00:00.454319 Process ID: 11888
- 00:00:00.454319 Package type: WINDOWS_64BITS_GENERIC
- 00:00:00.454320 Windows Features:
- 00:00:00.454321   Core Isolation (Memory Integrity): Not supported
- 00:00:00.466500 Qt version: 6.8.0
- 00:00:00.468161 GUI: UIMediumEnumerator: Initial medium-enumeration finished!
- 00:00:00.545723 GUI: UIMediumEnumerator: Medium-enumeration started...
- 00:00:02.852674 GUI: UIMediumEnumerator: Medium-enumeration finished!
- **PS C:\Users\spg\.VirtualBox> cd ../**
- **PS C:\Users\spg> mkdir Vagrant_win**
- –ö–∞—Ç–∞–ª–æ–≥: C:\Users\spg
```bash
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        10.11.2025     10:12                Vagrant_win
```
- **PS C:\Users\spg> mkdir C:\vagrant\ubuntu**

- **PS C:\Users\spg> cd C:\vagrant\ubuntu**

- **PS C:\vagrant\ubuntu> vagrant up**
```bash
Bringing machine 'default' up with 'virtualbox' provider...
==> default: Importing base box 'ubuntu/jammy64'...
==> default: Matching MAC address for NAT networking...
==> default: Checking if box 'ubuntu/jammy64' version '20241002.0.0' is up to date...
==> default: Setting the name of the VM: ubuntu-with-disks
==> default: Clearing any previously set network interfaces...
==> default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==> default: Forwarding ports...
    default: 22 (guest) => 2222 (host) (adapter 1)
==> default: Running 'pre-boot' VM customizations...
==> default: Booting VM...
==> default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
Timed out while waiting for the machine to boot. This means that
Vagrant was unable to communicate with the guest machine within
the configured ("config.vm.boot_timeout" value) time period.

If you look above, you should be able to see the error(s) that
Vagrant had when attempting to connect to the machine. These errors
are usually good hints as to what may be wrong.

If you're using a custom box, make sure that networking is properly
working and you're able to connect to the machine. It is a common
problem that networking isn't setup properly in these boxes.
Verify that authentication configurations are also setup properly,
as well.

If the box appears to be booting properly, you may want to increase
the timeout ("config.vm.boot_timeout") value.
```
 ## –ü–µ—Ä–µ—à–µ–ª –Ω–∞ –Ω–æ–≤—É—é –º–∞—à–∏–Ω—É –ø–æ–¥ –û–° Windows (—Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–æ–µ –î–ó)
 PS C:\Users\spg> vboxmanage --version
7.2.4r170995
PS C:\Users\spg> vagrant -v
Vagrant 2.4.9
PS C:\Users\spg> cd C:\vagrant\
PS C:\vagrant> ls
```bash

    –ö–∞—Ç–∞–ª–æ–≥: C:\vagrant


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        10.11.2025     15:45                ubuntu

```
PS C:\vagrant> cd .\ubuntu\
PS C:\vagrant\ubuntu> ls
```bash

    –ö–∞—Ç–∞–ª–æ–≥: C:\vagrant\ubuntu


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        10.11.2025     15:45                .vagrant
d-----        10.11.2025     15:45                boxes
-a----        10.11.2025     12:41            387 Vagrantfile
-a----        10.11.2025     10:55           1142 Vagrantfile22
-a----        10.11.2025     11:22           2480 Vagrantfile_main

```
PS C:\vagrant\ubuntu> vagrant box list
There are no installed boxes! Use `vagrant box add` to add some.
PS C:\vagrant\ubuntu> vagrant box add ubuntu/jammy64 "C:\vagrant\ubuntu\boxes\jammy-server-cloudimg-amd64-vagrant.box" --provider virtualbox
```bash
==> box: Box file was not detected as metadata. Adding it directly...
==> box: Adding box 'ubuntu/jammy64' (v0) for provider: virtualbox (i386)
    box: Unpacking necessary files from: file:///C:/vagrant/ubuntu/boxes/jammy-server-cloudimg-amd64-vagrant.box
    box:
==> box: Successfully added box 'ubuntu/jammy64' (v0) for 'virtualbox (i386)'!
```
## –°–æ–∑–¥–∞–µ–º –í–ú
PS C:\vagrant\ubuntu> vagrant up
```bash
Bringing machine 'default' up with 'virtualbox' provider...
==> default: Importing base box 'ubuntu/jammy64'...
==> default: Matching MAC address for NAT networking...
==> default: Setting the name of the VM: ubuntu-with-disks
Vagrant is currently configured to create VirtualBox synced folders with
the `SharedFoldersEnableSymlinksCreate` option enabled. If the Vagrant
guest is not trusted, you may want to disable this option. For more
information on this option, please refer to the VirtualBox manual:

  https://www.virtualbox.org/manual/ch04.html#sharedfolders

This option can be disabled globally with an environment variable:

  VAGRANT_DISABLE_VBOXSYMLINKCREATE=1

or on a per folder basis within the Vagrantfile:

  config.vm.synced_folder '/host/path', '/guest/path', SharedFoldersEnableSymlinksCreate: false
==> default: Clearing any previously set network interfaces...
==> default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==> default: Forwarding ports...
    default: 22 (guest) => 2222 (host) (adapter 1)
==> default: Running 'pre-boot' VM customizations...
==> default: Booting VM...
==> default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
    default:
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair for better security.
    default:
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest if it's present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
==> default: Machine booted and ready!
==> default: Checking for guest additions in VM...
    default: The guest additions on this VM do not match the installed version of
    default: VirtualBox! In most cases this is fine, but in rare cases it can
    default: prevent things such as shared folders from working properly. If you see
    default: shared folder errors, please make sure the guest additions within the
    default: virtual machine match the version of VirtualBox you have installed on
    default: your host and reload your VM.
    default:
    default: Guest Additions Version: 6.0.0 r127566
    default: VirtualBox Version: 7.2
==> default: Setting hostname...
==> default: Mounting shared folders...
    default: C:/vagrant/ubuntu => /vagrant
```
- **PS C:\vagrant\ubuntu> cat .\Vagrantfile**
```bash

Vagrant.configure("2") do |config|
  # –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
  config.vm.box = "ubuntu/jammy64"        # –æ–±—Ä–∞–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã Ubuntu 22.04
  # –ò–º—è –∏ –±–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã –í–ú
  config.vm.hostname = "ubuntu-test"
  config.vm.provider "virtualbox" do |vb|
    vb.name = "ubuntu-with-disks"
    vb.memory = 1024
    vb.cpus = 2
  end

  # –í–º–µ—Å—Ç–æ NAT –≤–∫–ª—é—á–∞–µ–º –º–æ—Å—Ç (bridge)
  config.vm.network "public_network"
  # –ú–µ–Ω—è–µ–º SSH-–ø–æ—Ä—Ç –≥–æ—Å—Ç–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (–Ω–∞ 2222)
  # –û–±—ã—á–Ω–æ Vagrant —Å–∞–º –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç 22 -> 2222, –Ω–æ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ:
  config.vm.network "forwarded_port", guest: 22, host: 2222, id: "ssh"

  # –ü—Ä–æ–±—Ä–æ—Å HTTP ‚Äî –ø–æ—Ä—Ç 80 –≥–æ—Å—Ç—è –Ω–∞ 8080 —Ö–æ—Å—Ç–∞
  config.vm.network "forwarded_port", guest: 80, host: 8080, id: "http"

  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏
  config.vm.boot_timeout = 600
end

```
- **PS C:\vagrant\ubuntu> vagrant destroy -f**
- ==> default: Destroying VM and associated drives...
- **PS C:\vagrant\ubuntu> vagrant up**

```bash
Bringing machine 'default' up with 'virtualbox' provider...
==> default: Importing base box 'ubuntu/jammy64'...
==> default: Matching MAC address for NAT networking...
==> default: Setting the name of the VM: ubuntu-with-disks
==> default: Clearing any previously set network interfaces...
==> default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
    default: Adapter 2: bridged
==> default: Forwarding ports...
    default: 22 (guest) => 2222 (host) (adapter 1)
    default: 80 (guest) => 8080 (host) (adapter 1)
==> default: Running 'pre-boot' VM customizations...
==> default: Booting VM...
==> default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
    default:
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair for better security.
    default:
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest if it's present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
==> default: Machine booted and ready!
==> default: Checking for guest additions in VM...
    default: The guest additions on this VM do not match the installed version of
    default: VirtualBox! In most cases this is fine, but in rare cases it can
    default: prevent things such as shared folders from working properly. If you see
    default: shared folder errors, please make sure the guest additions within the
    default: virtual machine match the version of VirtualBox you have installed on
    default: your host and reload your VM.
    default:
    default: Guest Additions Version: 6.0.0 r127566
    default: VirtualBox Version: 7.2
==> default: Setting hostname...
==> default: Configuring and enabling network interfaces...
==> default: Mounting shared folders...
    default: C:/vagrant/ubuntu => /vagrant

```
- **PS C:\vagrant\ubuntu> vagrant port**

```bash
The forwarded ports for the machine are listed below. Please note that
these values may differ from values configured in the Vagrantfile if the
provider supports automatic port collision detection and resolution.

    80 (guest) => 8080 (host)
    22 (guest) => 2222 (host)


```
- **PS C:\vagrant\ubuntu> vagrant ssh-config**
```bash
Host default
  HostName 127.0.0.1
  User vagrant
  Port 2222
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile C:/vagrant/ubuntu/.vagrant/machines/default/virtualbox/private_key
  IdentitiesOnly yes
  LogLevel FATAL
  PubkeyAcceptedKeyTypes +ssh-rsa
  HostKeyAlgorithms +ssh-rsa
```

- **PS C:\vagrant\ubuntu> ssh -p 2222 -i .vagrant\machines\default\virtualbox\private_key vagrant@127.0.0.1**
```bash
The authenticity of host '[127.0.0.1]:2222 ([127.0.0.1]:2222)' can't be established.
ED25519 key fingerprint is SHA256:7KZXz2N4uxRwSzGkXd6B01otNEVIDWBw7fOw3NaKrZs.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
...
```

- **vagrant@ubuntu-test:~$ uname -a**
- Linux ubuntu-test 5.15.0-161-generic #171-Ubuntu SMP Sat Oct 11 08:17:01 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux

- **PS C:\vagrant\ubuntu> netstat -ano | findstr "2222"**
- TCP    0.0.0.0:2222           0.0.0.0:0              LISTENING       8072 # VirtualBox –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –≥–æ—Å—Ç–µ–≤—É—é –û–°
- **PS C:\vagrant\ubuntu> netstat -ano | findstr "8080"**
- TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       8072 # VirtualBox –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –≥–æ—Å—Ç–µ–≤—É—é –û–°
- TCP    10.0.77.141:50581      10.0.1.191:8080        CLOSE_WAIT      7940

## Vagrantfile
```bash
Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/jammy64"

#  config.vm.provider :virtualbox

  config.vm.provider :virtualbox do |vb|
    vb.name = "ubuntu-jammy-vm"   # –ó–∞–¥–∞–µ–º –∏–º—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
    vb.memory = 1024              # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 1024 MB –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏
    vb.cpus = 2                   # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 2 –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (—è–¥—Ä–∞)
  end


  config.vm.disk :disk, size: "1GB", name: "extra_storage1"
  config.vm.disk :disk, size: "1GB", name: "extra_storage2"

  config.vm.network "private_network", ip: "10.0.77.161"
  config.vm.network "forwarded_port", guest: 80, host: 8080, id: "http"

# --- Provisioning: —Ä–∞–∑–º–µ—Ç–∫–∞ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤ ---
  config.vm.provision "shell", inline: <<-SHELL
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–∏—Å–∫–æ–≤
    DISKS=("sdb" "sdc")
    MOUNTPOINTS=("/mnt/disk1" "/mnt/disk2")

    for i in ${!DISKS[@]}; do
      DISK=/dev/${DISKS[$i]}
      MOUNT=${MOUNTPOINTS[$i]}

      # –†–∞–∑–º–µ—Ç–∫–∞, –µ—Å–ª–∏ –¥–∏—Å–∫ –Ω–µ —Ä–∞–∑–º–µ—á–µ–Ω
      if ! blkid $DISK; then
        echo "Creating partition on $DISK"
        echo -e "o\nn\np\n1\n\n\nw" | fdisk $DISK
        partprobe $DISK
      fi

      # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
      if ! blkid ${DISK}1; then
        echo "Formatting ${DISK}1 as ext4"
        mkfs.ext4 ${DISK}1
      fi

      # –°–æ–∑–¥–∞–µ–º —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      mkdir -p $MOUNT

      # –ú–æ–Ω—Ç–∏—Ä—É–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ /etc/fstab
      UUID=$(blkid -s UUID -o value ${DISK}1)
      grep -q $UUID /etc/fstab || echo "UUID=$UUID $MOUNT ext4 defaults 0 2" >> /etc/fstab
      mount $MOUNT
    done

 # –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤
    sudo apt-get update

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Nginx
    sudo apt-get install -y nginx

    # –ó–∞–ø—É—Å–∫–∞–µ–º Nginx
    sudo systemctl start nginx

    # –í–∫–ª—é—á–∞–µ–º Nginx –Ω–∞ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã
    sudo systemctl enable nginx

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ Nginx
    sudo systemctl status nginx

  SHELL
end
```
- **–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞:**


<img width="1409" height="791" alt="Screenshot 2025-11-12 at 14 36 03" src="https://github.com/user-attachments/assets/f3baa5a1-15ca-4e6f-8a3e-c3beb6591760" />


- **vagrant@ubuntu-jammy:~$ ss -tulnp | grep 80**
```bash
tcp   LISTEN 0      511             0.0.0.0:80        0.0.0.0:*
tcp   LISTEN 0      511                [::]:80           [::]:*
```
- **vagrant@ubuntu-jammy:~$ lsblk**
```bash
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
loop0    7:0    0 63.8M  1 loop /snap/core20/2669
loop1    7:1    0 91.4M  1 loop /snap/lxd/35819
loop2    7:2    0 50.9M  1 loop /snap/snapd/25577
sda      8:0    0   40G  0 disk
‚îî‚îÄsda1   8:1    0   40G  0 part /
sdb      8:16   0   10M  0 disk
sdc      8:32   0    1G  0 disk
‚îî‚îÄsdc1   8:33   0 1023M  0 part
sdd      8:48   0    1G  0 disk
```
- **vagrant@ubuntu-jammy:~$ df -h /mnt/***
```bash
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        39G  1.8G   37G   5% /
/dev/sda1        39G  1.8G   37G   5% /
```
- **vagrant@ubuntu-jammy:~$ ip a**
```bash
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 02:53:41:1d:bc:3a brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 metric 100 brd 10.0.2.255 scope global dynamic enp0s3
       valid_lft 83826sec preferred_lft 83826sec
    inet6 fd17:625c:f037:2:53:41ff:fe1d:bc3a/64 scope global dynamic mngtmpaddr noprefixroute
       valid_lft 86338sec preferred_lft 14338sec
    inet6 fe80::53:41ff:fe1d:bc3a/64 scope link
       valid_lft forever preferred_lft forever
3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:8b:72:a9 brd ff:ff:ff:ff:ff:ff
    inet 10.0.77.161/24 brd 10.0.77.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe8b:72a9/64 scope link
       valid_lft forever preferred_lft forever
 ``` 
## 19 —É—Ä–æ–∫ DOCKER
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–ü—Ä–∞–∫—Ç–∏–∫–∞ —Å DOCKER"</ins>

**–¶–µ–ª—å**: –æ—Å–≤–æ–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å Docker, –Ω–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏;

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –Ω–∞ —Ö–æ—Å—Ç –º–∞—à–∏–Ω—É https://docs.docker.com/engine/install/ubuntu/
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose - –∫–∞–∫ –ø–ª–∞–≥–∏–Ω, –∏–ª–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–∑ nginx –Ω–∞ –±–∞–∑–µ alpine. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ nginx –¥–æ–ª–∂–µ–Ω –æ—Ç–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É nginx)
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏ –æ–±—Ä–∞–∑–æ–º
- –í—ã–≤–æ–¥ –æ–ø–∏—à–∏—Ç–µ –≤ –¥–æ–º–∞—à–Ω–µ–º –∑–∞–¥–∞–Ω–∏–∏.
- –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å: –ú–æ–∂–Ω–æ –ª–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å–æ–±—Ä–∞—Ç—å —è–¥—Ä–æ?


<details>
<summary> = –¢–µ–æ—Ä–∏—è = </summary>
üß± 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Docker
	
```bash	
Docker ‚Äî —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏, –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö.
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞, –≥–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
 (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏, –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ —Ç.–¥.), –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–¥—Ä–æ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ö–æ—Å—Ç–∞.
üëâ –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è:
Docker –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ¬´–≤ –∫–æ—Ä–æ–±–∫–µ¬ª, –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ –ª—é–±–æ–π –º–∞—à–∏–Ω–µ.
```
	
‚öôÔ∏è 2. –ü–æ—á–µ–º—É Docker –ø–æ—è–≤–∏–ª—Å—è
```bash
–î–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ç—Ä–∞–¥–∞–ª–∏ –æ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ:
‚Äú–£ –º–µ–Ω—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ —É —Ç–µ–±—è ‚Äî –Ω–µ—Ç.‚Äù
–ü—Ä–∏—á–∏–Ω—ã:
	‚Ä¢	–†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫.
	‚Ä¢	–†–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –û–°.
	‚Ä¢	–†–∞–∑–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (dev/test/prod).
Docker —Ä–µ—à–∞–µ—Ç —ç—Ç–æ, —É–ø–∞–∫–æ–≤—ã–≤–∞—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—Å—ë, —á—Ç–æ –µ–º—É –Ω—É–∂–Ω–æ, –≤ –æ–¥–∏–Ω –æ–±—Ä–∞–∑ (image),
–∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ.
```
	
üì¶ 3. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è Docker
```bash
–ü–æ–Ω—è—Ç–∏–µ							–û–ø–∏—Å–∞–Ω–∏–µ		
Image (–æ–±—Ä–∞–∑)					–®–∞–±–ª–æ–Ω (—Å–ª–µ–ø–æ–∫) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ò–∑ –Ω–µ–≥–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
Container (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)			–ó–∞–ø—É—â–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–∑–∞. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å.
Dockerfile						–°–∫—Ä–∏–ø—Ç, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π, –∫–∞–∫ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑.
Docker Hub / Registry			–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤.
Volume (—Ç–æ–º)					–ú–µ—Å—Ç–æ –Ω–∞ —Ö–æ—Å—Ç–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
Network (—Å–µ—Ç—å)					–ú–µ—Ö–∞–Ω–∏–∑–º —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º.
```

üß© 4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Docker
```bash
Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —è–¥—Ä–∞ Linux:
	‚Ä¢	Namespaces ‚Äî —Å–æ–∑–¥–∞—é—Ç –∏–∑–æ–ª—è—Ü–∏—é (–∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–µ–±—è).
	‚Ä¢	cgroups ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç —Ä–µ—Å—É—Ä—Å—ã (CPU, RAM).
	‚Ä¢	UnionFS / OverlayFS ‚Äî –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã —Å–ª–æ—è–º–∏ (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞).
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–µ—Å—è—Ç–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ–≥–æ —è–¥—Ä–∞.
```

üöÄ 5. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

	1	–°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑
- docker build -t myapp .
(Docker —á–∏—Ç–∞–µ—Ç Dockerfile –∏ —Å–æ–∑–¥–∞—ë—Ç image)

	2	–ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

- docker run -d -p 8080:80 myapp
  
	3	–°–º–æ—Ç—Ä–∏–º, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ

- docker ps

	4	–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

- docker stop <id>

üß∞ 6. –ü—Ä–∏–º–µ—Ä Dockerfile
```bash
FROM ubuntu:22.04
RUN apt-get update && apt-get install -y nginx
COPY ./index.html /var/www/html/
CMD ["nginx", "-g", "daemon off;"]
```
üì¶ –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–∑–¥–∞—Å—Ç –æ–±—Ä–∞–∑ —Å Ubuntu, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç Nginx –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.

üï∏Ô∏è 7. Docker Compose
–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö), –∏—Å–ø–æ–ª—å–∑—É—é—Ç docker-compose.yml.
```bash
version: '3'
services:
  web:
    build: .
    ports:
      - "8080:80"
  db:
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: example
```
üß† 8. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Docker
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ ‚Äî –Ω–µ –Ω–∞–¥–æ —Å—Ç–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.‚Ä®
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è ‚Äî –æ–¥–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ª–æ–º–∞–µ—Ç –¥—Ä—É–≥–æ–µ.
- ‚úÖ –õ—ë–≥–∫–æ—Å—Ç—å ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å—Ç–∞—Ä—Ç—É—é—Ç –∑–∞ —Å–µ–∫—É–Ω–¥—ã.‚Ä®
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –ª–µ–≥–∫–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤ –æ–±–ª–∞–∫–∞—Ö –∏ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö.

‚ö†Ô∏è 9. –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏
- ‚öôÔ∏è –¢—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è Linux.‚Ä®
- üêç –ù–µ–ø–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã).
- üß© –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω–æ –≤ –±–æ–ª—å—à–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –±–µ–∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Kubernetes).


</details>	

## –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: "–ú–æ–∂–Ω–æ –ª–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å–æ–±—Ä–∞—Ç—å —è–¥—Ä–æ?"
**–ò–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ "–ù–ï–¢": "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞, –≥–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
 (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏, –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ —Ç.–¥.), –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–¥—Ä–æ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ö–æ—Å—Ç–∞.
üëâ –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è: –•–æ—Å—Ç–æ–≤–∞—è –º–∞—à–∏–Ω–∞ (–µ–µ —è–¥—Ä–æ) —è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –±—ã –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–æ–º –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.**

## –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: "–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏ –æ–±—Ä–∞–∑–æ–º."
üìÄ –û–±—Ä–∞–∑ (Image) ‚Äî —ç—Ç–æ —à–∞–±–ª–æ–Ω
**(–Ω–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∞ –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.)**

- –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π (immutable)
- —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–æ—ë–≤ (layered filesystem)
- —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Docker Hub –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º registry
- —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (Container) ‚Äî —ç—Ç–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–∑–∞
**(—Ä–µ–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø—Ä–æ—Ü–µ—Å—Å—ã, —Å–µ—Ä–≤–∏—Å—ã.)**

- –∏–∑–º–µ–Ω—è–µ–º—ã–π (–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- –∏–º–µ–µ—Ç —Å–≤–æ–π —Ñ–∞–π–ª–æ–≤—ã–π —Å–ª–æ–π –ø–æ–≤–µ—Ä—Ö –æ–±—Ä–∞–∑–∞
- –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å
- —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ: —Å–≤–æ–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã, —Å–µ—Ç—å, –§–°

- **root@dockers:~# uname -a**
```bash
PRETTY_NAME="Ubuntu 24.04.3 LTS"
NAME="Ubuntu"
VERSION_ID="24.04"
VERSION="24.04.3 LTS (Noble Numbat)"
```
```bash
root@dockers:~# apt-get install ca-certificates curl** # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º curl
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
ca-certificates is already the newest version (20240203).
ca-certificates set to manually installed.
curl is already the newest version (8.5.0-2ubuntu10.6).
curl set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 34 not upgraded.
```
- **–¥–æ–±–∞–≤–ª—è–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Docker**
```bash
root@dockers:~# install -m 0755 -d /etc/apt/keyrings # –¥–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
root@dockers:~# curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc # —Å–∫–∞—á–∏–≤–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π GPG-–∫–ª—é—á Docker
root@dockers:~# echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | \
  tee /etc/apt/sources.list.d/docker.list > /dev/null**
root@dockers:~# apt-get update
 Get:9 https://download.docker.com/linux/ubuntu noble InRelease [48.5 kB]
```  
- **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker**
```bash
root@dockers:~# apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
root@dockers:~# systemctl status docker
‚óè docker.service - Docker Application Container Engine
     Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; preset: enabled)
     Active: active (running) since Thu 2025-11-27 12:54:50 UTC; 1min 48s ago
TriggeredBy: ‚óè docker.socket
       Docs: https://docs.docker.com
   Main PID: 2540 (dockerd)
      Tasks: 9
     Memory: 25.7M (peak: 26.0M)
        CPU: 247ms
     CGroup: /system.slice/docker.service
             ‚îî‚îÄ2540 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock

Nov 27 12:54:49 dockers dockerd[2540]: time="2025-11-27T12:54:49.749605663Z" level=info msg="Restoring containers: start."
Nov 27 12:54:49 dockers dockerd[2540]: time="2025-11-27T12:54:49.777785419Z" level=info msg="Deleting nftables IPv4 rules>
Nov 27 12:54:49 dockers dockerd[2540]: time="2025-11-27T12:54:49.781815965Z" level=info msg="Deleting nftables IPv6 rules>
Nov 27 12:54:50 dockers dockerd[2540]: time="2025-11-27T12:54:50.007050378Z" level=info msg="Loading containers: done."
Nov 27 12:54:50 dockers dockerd[2540]: time="2025-11-27T12:54:50.012753459Z" level=info msg="Docker daemon" commit=461269>
Nov 27 12:54:50 dockers dockerd[2540]: time="2025-11-27T12:54:50.012835626Z" level=info msg="Initializing buildkit"
Nov 27 12:54:50 dockers dockerd[2540]: time="2025-11-27T12:54:50.044034511Z" level=info msg="Completed buildkit initializ>
Nov 27 12:54:50 dockers dockerd[2540]: time="2025-11-27T12:54:50.051089113Z" level=info msg="Daemon has completed initial>
Nov 27 12:54:50 dockers dockerd[2540]: time="2025-11-27T12:54:50.051221457Z" level=info msg="API listen on /run/docker.so>
Nov 27 12:54:50 dockers systemd[1]: Started docker.service - Docker Application Container Engine.
```
- **root@dockers:~# docker compose version** # –ø—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ –¥–æ–∫–µ—Ä compose –∏ –∫–∞–∫–æ–π –≤–µ—Ä—Å–∏–∏
- Docker Compose version v2.40.3 # –≤—Å–µ —Ö–æ—Ä–æ—à–æ

- **root@dockers:~/docproject# ls**
Dockerfile  html  nginx.conf
- **root@dockers:~/docproject# vi Dockerfile**
```bash
FROM alpine:3.20

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º nginx
RUN apk add --no-cache nginx

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è HTML
RUN mkdir -p /var/www/html

# –ö–æ–ø–∏—Ä—É–µ–º —Å–≤–æ–∏ —Ñ–∞–π–ª—ã —Å–∞–π—Ç–∞
COPY ./html /var/www/html

# –ö–æ–ø–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ nginx
COPY ./nginx.conf /etc/nginx/nginx.conf

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç
EXPOSE 80

# –ó–∞–ø—É—Å–∫–∞–µ–º nginx –≤ foreground —Ä–µ–∂–∏–º–µ
CMD ["nginx", "-g", "daemon off;"]
```
- **root@dockers:~/docproject# vi nginx.conf**
```bash
user nginx;
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile on;
    keepalive_timeout 65;

    server {
        listen 80;
        server_name _;

        root /var/www/html;
        index index.html;

        location / {
            try_files $uri $uri/ =404;
        }
    }
}
```
- **root@dockers:~/docproject/html# vi index.html**
```bash
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f3faff;
            padding-top: 60px;
        }
        h1 {
            color: #0d63af;
            font-size: 48px;
        }
        img {
            width: 300px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h1>
    <img src="https://www.docker.com/wp-content/uploads/2022/03/vertical-logo-monochromatic.png" alt="Docker Whale">
</body>
</html>
```

- **root@dockers:~/docproject# docker build -t my-nginx-alpine**
```bash
[+] Building 4.3s (10/10) FINISHED                                                                         docker:default
 => [internal] load build definition from Dockerfile                                                                 0.0s
 => => transferring dockerfile: 505B                                                                                 0.0s
 => [internal] load metadata for docker.io/library/alpine:3.20                                                       1.9s
 => [internal] load .dockerignore                                                                                    0.0s
 => => transferring context: 2B                                                                                      0.0s
 => [1/5] FROM docker.io/library/alpine:3.20@sha256:765942a4039992336de8dd5db680586e1a206607dd06170ff0a37267a9e0195  0.6s
 => => resolve docker.io/library/alpine:3.20@sha256:765942a4039992336de8dd5db680586e1a206607dd06170ff0a37267a9e0195  0.0s
 => => sha256:5311e7f182d02360a7194aa2995849bcdf04795c39a0ffdcf413eae625865970 3.63MB / 3.63MB                       0.5s
 => => extracting sha256:5311e7f182d02360a7194aa2995849bcdf04795c39a0ffdcf413eae625865970                            0.1s
 => [internal] load build context                                                                                    0.0s
 => => transferring context: 559B                                                                                    0.0s
 => [2/5] RUN apk add --no-cache nginx                                                                               1.2s
 => [3/5] RUN mkdir -p /var/www/html                                                                                 0.2s
 => [4/5] COPY ./html /var/www/html                                                                                  0.0s
 => [5/5] COPY ./nginx.conf /etc/nginx/nginx.conf                                                                    0.0s
 => exporting to image                                                                                               0.3s
 => => exporting layers                                                                                              0.2s
 => => exporting manifest sha256:e7016a019e6a1aee4cbfb1cd2ad06bc84067c095ec6df24b6202587c3ed65570                    0.0s
 => => exporting config sha256:62c963faa7e9046c91bd7c8213a6b97593b2ea4aa202b5f0fe13d3e249563e6d                      0.0s
 => => exporting attestation manifest sha256:3e626b399a02b7ce42cf2a9c83aeac582e337842115d058d60f2035e74f5043c        0.0s
 => => exporting manifest list sha256:86f7f8e4dc42f5c5e40c20398a3c99a20ae75b9fda33883f86882f474574a4fc               0.0s
 => => naming to docker.io/library/my-nginx-alpine:latest                                                            0.0s
 => => unpacking to docker.io/library/my-nginx-alpine:latest
```
- **root@dockers:~/docproject# docker run -d -p 8080:80 my-nginx-alpine**
- fbb79b0b9f651d05c95435b82a7641a0d958fd61be5441bc2c7e0b6d7b3b3cc5
- **root@dockers:~/docproject# docker ps**
```bash
CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS          PORTS                                     NAMES
fbb79b0b9f65   my-nginx-alpine   "nginx -g 'daemon of‚Ä¶"   12 seconds ago   Up 11 seconds   0.0.0.0:8080->80/tcp, [::]:8080->80/tcp   exciting_lewin
```
- **root@dockers:~/docproject# docker ps -a**
```bash
CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS                    PORTS                                     NAMES
fbb79b0b9f65   my-nginx-alpine   "nginx -g 'daemon of‚Ä¶"   23 seconds ago   Up 22 seconds             0.0.0.0:8080->80/tcp, [::]:8080->80/tcp   exciting_lewin
9f52d28943c0   hello-world       "/hello"                 23 hours ago     Exited (0) 23 hours ago                                             great_keldysh
```
- **root@dockers:~/docproject# ip a**
```bash
...
2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:b3:87:45 brd ff:ff:ff:ff:ff:ff
    altname enp11s0
    inet 10.0.77.182/24 metric 100 brd 10.0.77.255 scope global dynamic ens192
```
<img width="868" height="590" alt="Screenshot 2025-11-28 at 15 38 08" src="https://github.com/user-attachments/assets/658f719a-1424-420f-9ed6-0ea7638d71d0" />

- **root@dockers:~/docproject# docker tag my-nginx-alpine psibirenko/nginx-demo:latest**
- **root@dockers:~/docproject# docker images**
```bash                                                                                                                                                                                                                    i Info ‚Üí   U  In Use
IMAGE                          ID             DISK USAGE   CONTENT SIZE   EXTRA
hello-world:latest             f7931603f70e       20.3kB         3.96kB    U
my-nginx-alpine:latest         54fd5354770f       14.4MB         4.26MB    U
pavels/nginx-demo:latest       54fd5354770f       14.4MB         4.26MB    U
psibirenko/nginx-demo:latest   54fd5354770f       14.4MB         4.26MB    U
```
- **root@dockers:~/docproject# docker push psibirenko/nginx-demo:latest**
```bash
The push refers to repository [docker.io/psibirenko/nginx-demo]
ef88f82276c6: Pushed
56bbfe682db9: Pushed
68f000e86b74: Pushed
5311e7f182d0: Pushed
012202b96bd6: Pushed
4fa074e02d96: Pushed
latest: digest: sha256:54fd5354770f2fb49d02ea5e3806be2321d470262f67ac69fcba743c71d935ee size: 856
```
## https://hub.docker.com/r/psibirenko/nginx-demo/tags

## 23 —É—Ä–æ–∫ ZABBIX
**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ zabbix"</ins>

**–¶–µ–ª—å**: –ù–∞—É—á–∏—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–∞—à–±–æ—Ä–¥

üéØ**–ó–∞–¥–∞–Ω–∏–µ**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ —Å 4-–º—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏:
- –ø–∞–º—è—Ç—å;
- –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä;
- –¥–∏—Å–∫;
- —Å–µ—Ç—å.

‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL** # –ù—É–∂–Ω–æ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Zabbix
- **root@zabbixproject:~# systemctl status postgresql**
- Unit postgresql.service could not be found.
- **root@zabbixproject:~# apt update**
- **root@zabbixproject:~# apt install -y wget gnupg lsb-release # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
- **root@zabbixproject:~# wget -qO - https://www.postgresql.org/media/keys/ACCC4CF8.asc | tee /etc/apt/trusted.gpg.d/postgresql.gpg > /dev/null** # –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π PostgreSQL
- **root@zabbixproject:~# echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" \
  | sudo tee /etc/apt/sources.list.d/pgdg.list** # –¥–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
- deb http://apt.postgresql.org/pub/repos/apt noble-pgdg main
- **root@zabbixproject:~# sudo apt install -y postgresql postgresql-contrib** # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PostgreSQL
- **root@zabbixproject:~# systemctl status postgresql** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
```bash
‚óè postgresql.service - PostgreSQL RDBMS
     Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled; preset: enabled)
     Active: active (exited) since Mon 2025-12-01 07:20:21 UTC; 2min 40s ago
   Main PID: 3818 (code=exited, status=0/SUCCESS)
        CPU: 916us

Dec 01 07:20:21 zabbixproject systemd[1]: Starting postgresql.service - PostgreSQL RDBMS...
Dec 01 07:20:21 zabbixproject systemd[1]: Finished postgresql.service - PostgreSQL RDBMS.
```
- ## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏ ZABBIX –¥–ª—è –º–æ–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: Ubuntu 24.04 Noble, Server frontend agent 2, PostgreSQL, Nginx
- ## a. Install Zabbix repository
- **root@zabbixproject:~# wget https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest_7.0+ubuntu24.04_all.deb**
```bash
--2025-12-01 07:36:10--  https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest_7.0+ubuntu24.04_all.deb
Resolving repo.zabbix.com (repo.zabbix.com)... 178.128.6.101, 2604:a880:2:d0::2062:d001
Connecting to repo.zabbix.com (repo.zabbix.com)|178.128.6.101|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 8092 (7.9K) [application/octet-stream]
Saving to: ‚Äòzabbix-release_latest_7.0+ubuntu24.04_all.deb‚Äô

zabbix-release_latest_7.0+ubu 100%[===============================================>]   7.90K  --.-KB/s    in 0s

2025-12-01 07:36:11 (371 MB/s) - ‚Äòzabbix-release_latest_7.0+ubuntu24.04_all.deb‚Äô saved [8092/8092]
```
- **root@zabbixproject:~# dpkg -i zabbix-release_latest_7.0+ubuntu24.04_all.deb**
```bash
Selecting previously unselected package zabbix-release.
(Reading database ... 152523 files and directories currently installed.)
Preparing to unpack zabbix-release_latest_7.0+ubuntu24.04_all.deb ...
Unpacking zabbix-release (1:7.0-2+ubuntu24.04) ...
Setting up zabbix-release (1:7.0-2+ubuntu24.04) ...
```
- **root@zabbixproject:~# apt update**
- ## b. Install Zabbix server, frontend, agent2
- **root@zabbixproject:~# apt install zabbix-server-pgsql zabbix-frontend-php php8.3-pgsql zabbix-nginx-conf zabbix-sql-scripts zabbix-agent2**
- ## c. Install Zabbix agent 2 plugins
- **root@zabbixproject:~# apt install zabbix-agent2-plugin-mongodb zabbix-agent2-plugin-mssql zabbix-agent2-plugin-postgresql**
- ## d. Create initial database
- **root@zabbixproject:~# sudo -u postgres createuser --pwprompt zabbix**
- Enter password for new role:
- Enter it again:
- **root@zabbixproject:~# sudo -u postgres createdb -O zabbix zabbix**
- **root@zabbixproject:~# zcat /usr/share/zabbix-sql-scripts/postgresql/server.sql.gz | sudo -u zabbix psql zabbix**
- ## f. Start Zabbix server and agent processes
- **root@zabbixproject:~# systemctl restart zabbix-server zabbix-agent2 nginx php8.3-fpm**
- **root@zabbixproject:~# systemctl enable zabbix-server zabbix-agent2 nginx php8.3-fpm**
- **root@zabbixproject:~# ss -tulpn | grep 10050** # —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 10050
- tcp   LISTEN 0      4096                    *:10050            *:*    users:(("zabbix_agent2",pid=868,fd=8))
- **root@zabbixproject:~# vi /etc/zabbix/zabbix_server.conf** –ø—Ä–∞–≤–∏–º –∫–æ–Ω—Ñ–∏–≥ —Å–µ—Ä–≤–µ—Ä–∞:
- ListenPort=10051
- LogFile=/var/log/zabbix/zabbix_server.log
- LogFileSize=0
- DBUser=zabbix
- DBPassword=Zww57df32!
- 
- ## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏ –∫–ª–∏–µ–Ω—Ç–∞ ZABBIX –Ω–∞ Linux –º–∞—à–∏–Ω–µ
- **root@ansibleclient:~# wget https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_7.0-2+ubuntu24.04_all.deb** # —Å–∫–∞—á–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç
- **root@ansibleclient:~# dpkg -i zabbix-release_7.0-2+ubuntu24.04_all.deb**
- **root@ansibleclient:~# apt update**
- **root@ansibleclient:~# apt install -y zabbix-agent2** # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∞–º–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- **root@ansibleclient:~# vi /etc/zabbix/zabbix_agent2.conf** # –ø—Ä–∞–≤–∏–º –∫–æ–Ω—Ñ–∏–≥ –∞–≥–µ–Ω—Ç–∞:
- PidFile=/run/zabbix/zabbix_agent2.pid
- LogFile=/var/log/zabbix/zabbix_agent2.log
- LogFileSize=0
- Server=10.0.77.182
- ServerActive=10.0.77.182
- Hostname=Zabbix agen142
- PluginSocket=/run/zabbix/agent.plugin.sock
  
- **root@zabbixproject:~# zabbix_get -s 10.0.77.142 -p 10050 -k agent.ping** # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞
- 1 # –¥–æ—Å—Ç—É–ø–µ–Ω!

## –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º ZABBIX —á–µ–∑ WEB: http://10.0.77.182:8080/zabbix.php?action=host.list

<img width="1404" height="804" alt="Screenshot 2025-12-01 at 16 14 23" src="https://github.com/user-attachments/assets/72263caa-a053-4072-bfad-cdaedaeae619" />

<img width="1252" height="708" alt="Screenshot 2025-12-01 at 16 15 15" src="https://github.com/user-attachments/assets/1e79880f-d52b-427a-819e-c1cbc9b1edf5" />

<img width="1435" height="959" alt="Screenshot 2025-12-01 at 16 16 35" src="https://github.com/user-attachments/assets/84463044-55eb-41ea-ae21-674fa63729bd" />

<img width="1455" height="682" alt="Screenshot 2025-12-01 at 16 17 04" src="https://github.com/user-attachments/assets/be314392-6443-49ae-a6a9-f1caf1487bf2" />

<img width="1438" height="961" alt="Screenshot 2025-12-01 at 16 17 57" src="https://github.com/user-attachments/assets/f8f66dba-29c4-4778-a57d-9fbdda775f6b" />

## –î–∞–ª—å—à–µ –º–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–∞—Ä—Ç—ã —Å–µ—Ç–µ–π —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É–∑–ª–æ–≤ –∏ –ø—Ä.


<img width="1477" height="964" alt="Screenshot 2025-12-01 at 16 47 31" src="https://github.com/user-attachments/assets/b549fbbd-9fc2-4cee-949a-3a09e6b12a8e" />


## 24 —É—Ä–æ–∫ 
## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –≥—Ä—É–ø–ø—ã. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è 

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"PAM"</ins>

**–¶–µ–ª—å**: –Ω–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫—Ä–æ–º–µ –≥—Ä—É–ø–ø—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤, –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ (—Å—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ), –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –¥–Ω–µ–π.


‚≠êÔ∏è –ó–∞–¥–∞–Ω–∏–µ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø –∫ Docker –∏ –ø—Ä–∞–≤–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å Docker-—Å–µ—Ä–≤–∏—Å.

‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
## –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å pam_time.so –≤ Ubuntu 24.04 –Ω–µ –ø—Ä–∏–≤–µ–ª–∏ –∫ –∂–µ–ª–∞–µ–º–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.
–í—ã–≤–æ–¥—ã:
- üî• –í Ubuntu 24.04 –µ—Å—Ç—å –ë–ê–ì: pam_time.so –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ sshd
–≠—Ç–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ Launchpad –∏ –Ω–∞ —Ñ–æ—Ä—É–º–∞—Ö Ubuntu:‚Ä®–ú–æ–¥—É–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ sshd –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
–ü–æ—è–≤–∏–ª–æ—Å—å –≤ 22.04, –æ—Å—Ç–∞—ë—Ç—Å—è –≤ 24.04. –∏ 24.10 :(
- üî• systemd-logind –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
–∏ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç PAM –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
–ü–æ—ç—Ç–æ–º—É pam_time.so –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—Ä–µ—Ç–∏—Ç—å SSH –≤—Ö–æ–¥, –µ—Å–ª–∏ systemd –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç —Å–µ—Å—Å–∏—é –¥–æ PAM-–º–æ–¥—É–ª—è.
 ## –ò –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —É—à–ª–æ –≤—Ä–µ–º—è... –Ω–µ–¥–µ–ª—è –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–æ–π :( –í–∏–¥–∏–º–æ, –ø—Ä–æ—Å–ª—É—à–∞–ª –Ω–∞ –∑–∞–Ω—è—Ç–∏–∏ –∏–ª–∏ –Ω–µ –¥–æ–≥–∞–¥–∞–ª—Å—è, —á—Ç–æ –Ω–∞–¥–æ –∏–¥—Ç–∏ –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–º—É –≤ –º–µ—Ç–æ–¥–∏—á–∫–µ –ø—É—Ç–∏...
## –†–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:
- **root@pamproject:~# vipw** # —Å–æ–∑–¥–∞–ª–∏ –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π mouse –∏  dog –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ —á–µ—Ä–µ–∑ adduser
- mouse:x:1001:1001:Mikky Mouse,00,01,02,Simple user 1:/home/mouse:/bin/bash
- dog:x:1002:1002:Jerry Dog,55,56,57,Simple user 2:/home/dog:/bin/bash
- **root@pamproject:~# usermod mouse -a -G sudo** # –¥–æ–±–∞–≤–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è mouse –≤ –≥—Ä—É–ø–ø—É sudo
- **root@pamproject:~# id mouse** # –ø—Ä–æ–≤–µ—Ä–∏–º
- uid=1001(mouse) gid=1001(mouse) groups=1001(mouse),27(sudo),100(users
- **root@pamproject:~# cat /etc/group | grep sudo** # –ø—Ä–æ–≤–µ—Ä–∏–º
- sudo:x:27:spg,mouse
- ### –°–ö–†–ò–ü–¢
- **root@pamproject:~# cat /usr/local/bin/check_time2.sh** # —Å–∫—Ä–∏–ø—Ç –∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏ –Ω–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω
```bash
#!/bin/bash

DAY=$(date +%a)

# –ï—Å–ª–∏ –≤—ã—Ö–æ–¥–Ω–æ–π
if [ "$DAY" = "Sat" ] || [ "$DAY" = "Sun" ]; then
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ sudo ‚Äî –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
    if id -nG "$PAM_USER" | grep -qw "sudo"; then
        exit 0
    else
        exit 1
    fi
else
    # –í –±—É–¥–Ω–∏ –≤—Å–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–æ
    exit 0
fi
```
- **root@pamproject:~# sudo chmod +x /usr/local/bin/check_time2.sh** –¥–µ–ª–∞–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
- **root@pamproject:~# vi /etc/pam.d/sshd** # –î–æ–±–∞–≤–∏–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –ø–µ—Ä–µ–¥ @include common-account
```bash
# Standard Un*x authorization.
account required pam_exec.so /usr/local/bin/check_time.sh
@include common-account
```
- **root@pamproject:~# sudo systemctl restart ssh** # –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º ssh
- **root@pamproject:~# timedatectl set-ntp false** # –æ—Ç–∫–ª—é—á–∏–º NTP
- **root@pamproject:~# timedatectl set-time "2025-12-06"** # –ø–æ—Å—Ç–∞–≤–∏–º —Å—É–±–±–æ—Ç—É –≤ –¥–∞—Ç—É
-  **~ ssh spg@10.0.77.182** - –ü—Ä–æ–≤–µ—Ä–∏–º –ø—É—Å–∫–∞—é—Ç –ª–∏ –≥—Ä—É–ø–ø—É sudo? –î–∞  
- spg@10.0.77.182's password: 
- Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-88-generic x86_64)
- **~ ssh mouse@10.0.77.182** # –î–∞
- mouse@10.0.77.182's password: 
- Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-88-generic x86_64)
- **~ ssh dog@10.0.77.182** # –ù–µ—Ç (dog - –Ω–µ –≤ –≥—Ä—É–ø–ø–µ sudo)  
- dog@10.0.77.182's password: 
- /usr/local/bin/check_time2.sh failed: exit code 1
- Connection closed by 10.0.77.182 port 22
- **root@pamproject:~# timedatectl set-ntp true** # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞—Ç—É –∫ —Ç–µ–∫—É—â–µ–π
- **root@pamproject:~# timedatectl** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
```bash
               Local time: Wed 2025-12-10 13:47:38 MSK
           Universal time: Wed 2025-12-10 10:47:38 UTC
                 RTC time: Wed 2025-12-10 10:47:38
                Time zone: Europe/Moscow (MSK, +0300)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```
- **~ ssh dog@10.0.77.182** # –î–∞ (dog - –Ω–µ –≤ –≥—Ä—É–ø–ø–µ sudo, –Ω–æ –±—É–¥–Ω–∏)
- dog@10.0.77.182's password: 
- Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-88-generic x86_64)
- **root@pamproject:~# cat /usr/local/bin/check_time.sh** # —Å–∫—Ä–∏–ø—Ç c —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å, –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–π
```bash
#!/bin/bash
#
# PAM time checker (users + groups + weekdays + time windows)
#
# –§–æ—Ä–º–∞—Ç –ø—Ä–∞–≤–∏–ª:
#   user_or_group:DAYS:HHMM-HHMM,HHMM-HHMM
#
# user_or_group:
#   - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:  spg
#   - –≥—Ä—É–ø–ø–∞:                @sudo
#
# –ü—Ä–∏–º–µ—Ä—ã:
#   @sudo:Mo-Fr:0000-2400
#   dog:Mo-Fr:0900-1800
#

RULES="
@sudo:Mo-Fr:0000-2400
dog:Mo-Fr:0900-1800
"

USER="$PAM_USER"
WEEKDAY=$(date +%a)   # Mo, Tu, We...
TIME=$(date +%H%M)    # HHMM
GROUPS=$(id -nG "$USER")

log() {
    logger "pam_exec_time: $1"
}

is_group_match() {
    local r="$1"

    if [[ "$r" =~ ^@(.*)$ ]]; then
        local grp="${BASH_REMATCH[1]}"
        for g in $GROUPS; do
            if [[ "$g" == "$grp" ]]; then
                return 0
            fi
        done
        return 1
    else
        [[ "$r" == "$USER" ]]
        return $?
    fi
}

match_day() {
    local day=$1
    local pattern=$2

    # –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–Ω—è
    [[ " $pattern " =~ " $day " ]] && return 0

    # –¥–∏–∞–ø–∞–∑–æ–Ω Mo-Fr
    if [[ $pattern =~ ^([A-Za-z]{2})-([A-Za-z]{2})$ ]]; then
        local start=${BASH_REMATCH[1]}
        local end=${BASH_REMATCH[2]}
        local order="Mo Tu We Th Fr Sa Su"

        # –∏–Ω–¥–µ–∫—Å—ã
        i_start=$(echo $order | awk -v d="$start" '{for(i=1;i<=NF;i++)if($i==d)print i}')
        i_end=$(echo $order | awk -v d="$end" '{for(i=1;i<=NF;i++)if($i==d)print i}')
        i_day=$(echo $order | awk -v d="$day" '{for(i=1;i<=NF;i++)if($i==d)print i}')

        [[ $i_day -ge $i_start && $i_day -le $i_end ]] && return 0
    fi

    return 1
}

# --- –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø—Ä–∞–≤–∏–ª ---
while IFS= read -r rule; do
    [[ -z "$rule" ]] && continue

    IFS=":" read rule_user rule_days rule_times <<< "$rule"

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –≥—Ä—É–ø–ø—É
    if ! is_group_match "$rule_user"; then
        continue
    fi

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–Ω–∏
    for day_block in $rule_days; do
        if match_day "$WEEKDAY" "$day_block"; then

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏
            IFS="," read -ra intervals <<< "$rule_times"
            for intv in "${intervals[@]}"; do
                start=${intv%-*}
                end=${intv#*-}

                if [[ $TIME -ge $start && $TIME -lt $end ]]; then
                    exit 0    # –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
                fi
            done
        fi
    done

done <<< "$RULES"

log "–¥–æ—Å—Ç—É–ø –ó–ê–ü–†–ï–©–ï–ù: user=$USER groups=($GROUPS) weekday=$WEEKDAY time=$TIME"
exit 1

```
- **root@pamproject:~# sudo chmod +x /usr/local/bin/check_time.sh** # –¥–µ–ª–∞–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
- **root@pamproject:~# vi /etc/pam.d/sshd** # –î–æ–±–∞–≤–∏–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –ø–µ—Ä–µ–¥ @include common-account
```bash
# Standard Un*x authorization.
account required pam_exec.so /usr/local/bin/check_time.sh
@include common-account
```
- **root@pamproject:~# sudo systemctl restart ssh** # –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º ssh
- ## –°–∫—Ä–∏–ø—Ç —Ç–æ–∂–µ —Ä–∞–±–æ—á–∏–π

- ## –î–û–ü. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø –∫ Docker –∏ –ø—Ä–∞–≤–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å Docker-—Å–µ—Ä–≤–∏—Å.

- **root@pamproject:~# docker ps** # –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∑–∞–¥–∞–Ω–∏—è
- CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
- **root@pamproject:~# su mouse** # –ø–µ—Ä–µ–π–¥–µ–º –≤ –æ–±–æ–ª–æ—á–∫—É –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞–ª–∏ –∑–∞—Ä–∞–Ω–µ–µ
- **mouse@pamproject:/root$ docker ps** # —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø—Ä–∞–≤ –Ω–∞ docker —É –Ω–µ–≥–æ –Ω–µ—Ç
- **permission denied** while trying to connect to the docker API at unix:///var/run/docker.sock
- **mouse@pamproject:/root$ which docker** # –ø–æ—Å–º–æ—Ç—Ä–∏–º, –≥–¥–µ docker
- /usr/bin/docker
- **mouse@pamproject:/root$ which systemctl** # –ø–æ—Å–º–æ—Ç—Ä–∏–º, –≥–¥–µ systemctl
- /usr/bin/systemctl
- **mouse@pamproject:/root$ exit** # –≤–µ—Ä–Ω–µ–º—Å—è –≤ root
- exit

- **root@pamproject:~# sudo usermod -aG docker mouse** # –¥–æ–±–∞–≤–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è mouse –≤ –≥—Ä—É–ø–ø—É docker
- **root@pamproject:~# su - mouse** # –ø–µ—Ä–µ–π–¥–µ–º –≤ –æ–±–æ–ª–æ—á–∫—É –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è mouse
- **mouse@pamproject:~$ docker ps** # –ø—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –∫ docker (–µ—Å—Ç—å)
- CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
- **mouse@pamproject:~$ id mouse** # –ø—Ä–æ–≤–µ—Ä–∏–º —á–ª–µ–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è mouse –≤ –≥—Ä—É–ø–ø–µ –∫ docker (–µ—Å—Ç—å)
- uid=1001(mouse) gid=1001(mouse) groups=1001(mouse),100(users),**988(docker)**
- **mouse@pamproject:~$ exit** # –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- logout
- **root@pamproject:~# visudo -f /etc/sudoers.d/mouse-docker** # —Å–æ–∑–¥–∞–¥–∏–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –≤ sudoers –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ doker –∏–∑-–ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è mouse
- mouse ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart docker # —Å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π —Ä–∞–∑—Ä–µ—à–∞—é—â–µ–π mouse —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å docker –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
- **root@pamproject:~# visudo -c** # –ø—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é sudoers
- /etc/sudoers: parsed OK
- /etc/sudoers.d/README: parsed OK
- /etc/sudoers.d/mouse-docker: bad permissions, should be mode 0440 # –Ω—É–∂–Ω–æ –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **root@pamproject:~# chmod 440 /etc/sudoers.d/mouse-docker** # –ø–æ–ø—Ä–∞–≤–∏–º
- **root@pamproject:~# su - mouse** # –ø–µ—Ä–µ–π–¥–µ–º –≤ mouse
- **mouse@pamproject:~$ systemctl restart docker** # –ø—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ docker (–µ—Å—Ç—å)
- **mouse@pamproject:~$**
- **mouse@pamproject:~$ sudo systemctl stop docker** # –∞ –Ω–∞ stop, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∞–≤ –Ω–µ—Ç
- [sudo] password for mouse:
- Sorry, user mouse is not allowed to execute '/usr/bin/systemctl stop docker' as root on pamproject.
- ## –≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

## 26 —É—Ä–æ–∫ 
## –°–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ 

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤"</ins>

**–¶–µ–ª—å**: –Ω–∞—É—á–∏—Ç—Å—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤;
—Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
1. –ü–æ–¥–Ω–∏–º–∞–µ–º –¥–≤–µ –º–∞—à–∏–Ω—ã ‚Äî logclient –∏ logserver.
2. –ù–∞ logclient –ø–æ–¥–Ω–∏–º–∞–µ–º nginx.
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ª–æ–≥-—Å–µ—Ä–≤–µ—Ä logserver –Ω–∞ –ª—é–±–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ –≤—ã–±–æ—Ä—É:
journald;
**rsyslog;**
elk.
4. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞—É–¥–∏—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π nginx.
5. –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ª–æ–≥–∏ —Å logclient –¥–æ–ª–∂–Ω—ã —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –∏ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É–¥–∞–ª–µ–Ω–Ω–æ.
6. –í—Å–µ –ª–æ–≥–∏ —Å nginx –¥–æ–ª–∂–Ω—ã —É—Ö–æ–¥–∏—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä logserver (–ª–æ–∫–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ).
7. –õ–æ–≥–∏ –∞—É–¥–∏—Ç–∞ –¥–æ–ª–∂–Ω—ã —Ç–∞–∫–∂–µ —É—Ö–æ–¥–∏—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É.

**–ï—Å—Ç—å –¥–≤–µ –º–∞—à–∏–Ω—ã —Å Linux Ubuntu 24.04: logclient –∏ logserver
- **root@logclient:~# systemctl status nginx** # –Ω–∞ –∫–ª–∏–µ–Ω—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω nginx
‚óè nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: enabled)
     Active: active (running) since Wed 2025-12-10 12:14:09 UTC; 21s ago
  <img width="1071" height="324" alt="Screenshot 2025-12-10 at 15 30 42" src="https://github.com/user-attachments/assets/5e110db2-5896-4408-b88a-a01e95b9b27c" />

- **oot@pamproject:~# apt list rsyslog -a** # rsyslog –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –Ω–∞—à–µ–π –û–°, –ø—Ä–æ–≤–µ—Ä–∏–º —ç—Ç–æ
- Listing... Done
- rsyslog/noble-updates,now 8.2312.0-3ubuntu9.1 amd64 [installed,automatic]
- rsyslog/noble 8.2312.0-3ubuntu9 amd64
- **root@pamproject:~# cat /etc/rsyslog.conf**
```bash
# provides UDP syslog reception
module(load="imudp")
input(type="imudp" port="514")

# provides TCP syslog reception
module(load="imtcp")
input(type="imtcp" port="514")
...
#Add remote logs # –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤–ª—Ñ–µ–º –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–µ–º–∞ –ª–æ–≥–æ–≤
$template RemoteLogs,"/var/log/rsyslog/%HOSTNAME%/%PROGRAMNAME%.log"
*.* ?RemoteLogs
& ~
```
 
- **root@pamproject:~# ss -tuln**
```bash
Netid     State      Recv-Q     Send-Q              Local Address:Port         Peer Address:Port    Process
udp       UNCONN     0          0                         0.0.0.0:514               0.0.0.0:*
udp       UNCONN     0          0                      127.0.0.54:53                0.0.0.0:*
udp       UNCONN     0          0                   127.0.0.53%lo:53                0.0.0.0:*
udp       UNCONN     0          0              10.0.77.182%ens192:68                0.0.0.0:*
udp       UNCONN     0          0                            [::]:514                  [::]:*
tcp       LISTEN     0          25                        0.0.0.0:514               0.0.0.0:*
tcp       LISTEN     0          4096                      0.0.0.0:22                0.0.0.0:*
tcp       LISTEN     0          4096                127.0.0.53%lo:53                0.0.0.0:*
tcp       LISTEN     0          4096                   127.0.0.54:53                0.0.0.0:*
tcp       LISTEN     0          25                           [::]:514                  [::]:*
tcp       LISTEN     0          4096                         [::]:22                   [::]:*
```
- **root@logclient:~# nginx -v**
- nginx version: nginx/1.24.0 (Ubuntu)
- **root@logclient:~# cat /etc/nginx/nginx.conf** # –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥ nginx –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- error_log /var/log/nginx/error.log;
- error_log  syslog:server=10.0.77.182:514,tag=nginx_error;
```bash
- ...
- http {
- ...
- access_log /var/log/nginx/access.log;
- access_log syslog:server=10.0.77.182:514,tag=nginx_access,severity=info combined;
- **root@logclient:~# nginx -t** # –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```
- **root@logserver:~# cat /var/log/rsyslog/logclient/nginx_access.log**
```bash
2025-12-11T14:22:40+03:00 logclient nginx_access: 10.0.77.13 - - [11/Dec/2025:14:22:40 +0000] "GET / HTTP/1.1" 200 409 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.1 Safari/605.1.15"
2025-12-11T14:22:41+03:00 logclient nginx_access: 10.0.77.13 - - [11/Dec/2025:14:22:41 +0000] "GET / HTTP/1.1" 200 409 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.1 Safari/605.1.15"
```
- **root@logserver:~# ail -f /var/log/rsyslog/logclient/nginx_error.log**
```bash
2025-12-12T11:36:01+03:00 logclient nginx_error: 2025/12/12 11:36:01 [error] 14294#14294: *15 directory index of "/var/www/html/" is forbidden, client: 10.0.77.13, server: _, request: "GET / HTTP/1.1", host: "10.0.77.142"
2025-12-12T11:36:12+03:00 logclient nginx_error: 2025/12/12 11:36:12 [error] 14294#14294: *15 directory index of "/var/www/html/" is forbidden, client: 10.0.77.13, server: _, request: "GET / HTTP/1.1", host: "10.0.77.142"
2025-12-12T11:36:16+03:00 logclient nginx_error: 2025/12/12 11:36:16 [error] 14294#14294: *15 directory index of "/var/www/html/" is forbidden, client: 10.0.77.13, server: _, request: "GET / HTTP/1.1", host: "10.0.77.142
```
- **root@logclient:~# tail -f  /var/log/nginx/error.log**
```bash
2025/12/12 11:36:01 [error] 14294#14294: *15 directory index of "/var/www/html/" is forbidden, client: 10.0.77.13, server: _, request: "GET / HTTP/1.1", host: "10.0.77.142"
2025/12/12 11:36:12 [error] 14294#14294: *15 directory index of "/var/www/html/" is forbidden, client: 10.0.77.13, server: _, request: "GET / HTTP/1.1", host: "10.0.77.142"
2025/12/12 11:36:16 [error] 14294#14294: *15 directory index of "/var/www/html/" is forbidden, client: 10.0.77.13, server: _, request: "GET / HTTP/1.1", host: "10.0.77.142"
```


üß† 
## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ audit –ª–æ–≥–∞ –Ω–∞ logclient, –ø–µ—Ä–µ–¥–∞—á–∞ –≤ rsyslog –∏ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è logserver:

- 1	auditd —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è ‚Üí –ø–∏—à–µ—Ç –≤ /var/log/audit/audit.log
- 2	rsyslog —á–∏—Ç–∞–µ—Ç —ç—Ç–∏ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ imfile
- 3	rsyslog –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (UDP/TCP 514)
- 4	–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –≤—Å—ë —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ —Ö–æ—Å—Ç–∞–º
	
- **root@logclient:~# sudo apt install auditd audispd-plugins -y** # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º audit
- **root@logclient:~# sudo systemctl enable --now auditd** # —Å—Ç–∞—Ä—Ç—É–µ–º audit
- Synchronizing state of auditd.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
- Executing: /usr/lib/systemd/systemd-sysv-install enable auditd
- ## –†–∞–∑—Ä–µ—à–∞–µ–º auditd –ø–∏—Å–∞—Ç—å –ª–æ–≥–∏ –≤ rsyslog

- **root@logclient:~# sudo vi /etc/rsyslog.d/30-audit.conf**
- **oot@logclient:~# cat /etc/rsyslog.d/30-audit.conf** # –í Ubuntu auditd –æ–±—ã—á–Ω–æ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –ª–æ–≥–∏ –Ω–∞–ø—Ä—è–º—É—é, –Ω—É–∂–µ–Ω –º–æ–¥—É–ª—å imfile.
```bash
module(load="imfile")

input(
  type="imfile"
  File="/var/log/audit/audit.log"
  Tag="auditd"
  Severity="info"
  Facility="local6"
  PersistStateInterval="200"
)
# –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (TCP!)
action(
  type="omfwd"
  Target="10.0.77.182"
  Port="514"
  Protocol="tcp"
  Template="RSYSLOG_SyslogProtocol23Format"
  Action.ResumeRetryCount="-1"
  Queue.Type="LinkedList"
  Queue.Size="10000"
)
```
- **root@logclient:~# sudo vi /etc/rsyslog.d/90-central.conf**
```bash
local6.* @10.0.77.182:514 # UDP
local6.* @@10.0.77.182:514 # TCP
```
- **root@logclient:~# sudo systemctl restart rsyslog** # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ rsyslog
- **root@logclient:~# systemctl status rsyslog**

- **root@logclient:~# tail -f /var/log/audit/audit.log** # —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∞—É–¥–∏—Ç –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
```bash
type=CRED_DISP msg=audit(1765799991.855:5208): pid=23423 uid=0 auid=1000 ses=1 subj=unconfined msg='op=PAM:setcred grantors=pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'UID="root" AUID="spg
```
- **root@logclient:~# systemctl restart auditd**
  
## –ù–∞—Å—Ç—Ä–æ–∏–º —Å–±–æ—Ä –ª–æ–≥–æ–≤ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
```bash
[–ö–ª–∏–µ–Ω—Ç] auditd ‚Üí /var/log/audit/audit.log
        rsyslog ‚Üí TCP/514
                ‚Üì
[–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –ª–æ–≥–æ–≤] rsyslog ‚Üí /var/log/remote/<host>/audit.log
```

- **root@logserver:/# mkdir -p /var/log/remote**
- **root@logserver:/# chown syslog:adm /var/log/remote**
- **root@logserver:/# chmod 750 /var/log/remote** # rsyslog —Å–∞–º —Å–æ–∑–¥–∞—Å—Ç –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∏ logclient/, –µ—Å–ª–∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ /var/log/remote

- **root@logserver:/# vi /etc/rsyslog.d/20-audit-storage.conf** # —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥–µ
```bash
template(name="RemoteAudit" type="string"
         string="/var/log/remote/%HOSTNAME%/audit.log") # —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ audit-–ª–æ–≥–æ–≤ –ø–æ —Ö–æ—Å—Ç–∞–º

if ($programname == "audit") then {
    action(
        type="omfile"
        dynaFile="RemoteAudit"
        DirCreateMode="0750"
        FileCreateMode="0640"
        DirOwner="syslog"
        DirGroup="adm"
        FileOwner="syslog"
        FileGroup="adm"
    )
    stop
}
```
- **root@logserver:/var/log/rsyslog/logclient# tail -f /var/log/remote/logclient/audit.log** # —Å–º–æ—Ç—Ä–∏–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ª–æ–≥ –∞—É–¥–∏—Ç–∞ –º–∞—à–∏–Ω—ã logclient –∏ –≤–∏–¥–∏–º, —á—Ç–æ –ª–æ–≥ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–æ –≤—Ä–µ–º—è –ª–æ–≥–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ
```bash
- 2025-12-15T11:59:51+03:00 logclient auditd type=CRED_DISP msg=audit(1765799991.855:5208): pid=23423 uid=0 auid=1000 ses=1 subj=unconfined msg='op=PAM:setcred grantors=pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'#035UID="root" AUID="spg"
```
- **root@logserver:/var/log/rsyslog/logclient# timedatectl** # –≤—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ª–æ–≥–æ–≤
```bash
               Local time: Mon 2025-12-15 15:08:20 MSK
           Universal time: Mon 2025-12-15 12:08:20 UTC
                 RTC time: Mon 2025-12-15 12:08:20
                Time zone: Europe/Moscow (MSK, +0300)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```
- **root@logclient:~# timedatectl** # –≤—Ä–µ–º—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ª–æ–≥–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ, –Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è UTC
```bash
               Local time: Mon 2025-12-15 15:00:33 MSK
           Universal time: Mon 2025-12-15 12:00:33 UTC
                 RTC time: Mon 2025-12-15 12:00:33
                Time zone: Europe/Moscow (MSK, +0300)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```
## –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ª–æ–≥–æ–≤ –≤ UTC –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —É–∂–µ –ø—Ä–∏ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏/–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏/...–õ—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å UTC, –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π TZ —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤:

- üëâ	‚Ä¢	ELK / OpenSearch
- üëâ	‚Ä¢	Graylog
- üëâ	‚Ä¢	Splunk

## 27 —É—Ä–æ–∫ 
## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ 

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –±—ç–∫–∞–ø—ã"</ins>

**–¶–µ–ª—å**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–π –±–µ–∫–∞–ø –∫–∞—Ç–∞–ª–æ–≥–∞ /etc c —Å–µ—Ä–≤–µ—Ä–∞ client –ø—Ä–∏ –ø–æ–º–æ—â–∏ borgbackup. –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:

- –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π /var/backup. –≠—Ç–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä –Ω–µ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª–µ–Ω, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—É–¥–µ—Ç –∏ 2GB;
- —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –∫–ª—é—á–æ–º –∏–ª–∏ –ø–∞—Ä–æ–ª–µ–º - –Ω–∞ –≤–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ;
- –∏–º—è –±–µ–∫–∞–ø–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Ä–µ–º–µ–Ω–∏ —Å–Ω—è—Ç–∏—è –±–µ–∫–∞–ø–∞;
- –≥–ª—É–±–∏–Ω–∞ –±–µ–∫–∞–ø–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≥–æ–¥, —Ö—Ä–∞–Ω–∏—Ç—å –º–æ–∂–Ω–æ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–ø–∏–∏ –Ω–∞ –∫–æ–Ω–µ—Ü –º–µ—Å—è—Ü–∞, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ—Ö.
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∏ –º–µ—Å—è—Ü–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ø–∏–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. –¢.–µ. –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤;
- —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç. –¢–∞–∫–æ–π —á–∞—Å—Ç—ã–π –∑–∞–ø—É—Å–∫ –≤ —Ü–µ–ª—è—Ö –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏;
- –Ω–∞–ø–∏—Å–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–Ω—è—Ç–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π. –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π Cron –¥–∂–æ–±—ã, –ª–∏–±–æ systemd timer-–∞ - –Ω–∞ –≤–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ;
- –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±–µ–∫–∞–ø–∞. –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤–µ—Å—å –≤—ã–≤–æ–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –≤ logger —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Ç–µ–≥–æ–º. –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ –Ω–µ –≤ syslog, —Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤.

- ## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- **root@backup:~# lsblk** # –≤ —Å–∏—Å—Ç–µ–º—É –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–π –¥–∏—Å–∫ sdb 4 –ì–ë
```bash
NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda                         8:0    0   30G  0 disk
‚îú‚îÄsda1                      8:1    0    1M  0 part
‚îú‚îÄsda2                      8:2    0    2G  0 part /boot
‚îî‚îÄsda3                      8:3    0   28G  0 part
  ‚îî‚îÄubuntu--vg-ubuntu--lv 252:0    0   14G  0 lvm  /
sdb                         8:16   0    4G  0 disk
sr0                        11:0    1 1024M  0 rom
```
- **root@backup:~# mkfs.ext4 -L backup /dev/sdb** # —Å–æ–∑–¥–∞–µ–º –§–° ext4 (—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º) —Å –º–µ—Ç–∫–æ–π "backup"
```bash
mke2fs 1.47.0 (5-Feb-2023)
Creating filesystem with 1048576 4k blocks and 262144 inodes
Filesystem UUID: 90a22b46-3f37-4470-acab-99280ffdea26
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376, 294912, 819200, 884736

Allocating group tables: done
Writing inode tables: done
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done
```
- **root@backup:~# blkid /dev/sdb** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
```bash
/dev/sdb: LABEL="backup" UUID="551c3ca3-3897-4f76-bfdf-065838e6ba47" BLOCK_SIZE="4096" TYPE="ext4"
```
- **root@backup:~# mkdir -p /var/backup** # —Å–æ–∑–¥–∞–µ–º —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **root@backup:~# mount /dev/sdb /var/backup** # –º–æ–Ω—Ç–∏—Ä—É–µ–º –¥–∏—Å–∫
- **root@backup:~# df -h /var/backup** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
```bash
Filesystem      Size  Used Avail Use% Mounted on
/dev/sdb        3.9G   24K  3.7G   1% /var/backup
```
- ### –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- **root@backup:~# blkid /dev/sdb**
/dev/sdb: LABEL="backup" UUID="551c3ca3-3897-4f76-bfdf-065838e6ba47" BLOCK_SIZE="4096" TYPE="ext4"
- **root@backup:~# cat /etc/fstab** # –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# <file system> <mount point>   <type>  <options>       <dump>  <pass>
# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
/dev/disk/by-id/dm-uuid-LVM-drsoih9oPfyXF1rYvUrehdJZ0QdOjlznwCWWWLAB3J982EVfSo8ZkpXhc5fc48Og / ext4 defaults 0 1
# /boot was on /dev/sda2 during curtin installation
/dev/disk/by-uuid/fdc7fdc6-f439-476a-ad4f-1f8e60b9727c /boot ext4 defaults 0 1
# /var/backup was on /dev/sdb during booting
UUID=551c3ca3-3897-4f76-bfdf-065838e6ba47 /var/backup  ext4  defaults  0  2
```
- **root@backup:~# reboot** # –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º
- **root@backup:~# mount**
```bash
...
- /dev/sdb on /var/backup type ext4 (rw,relatime)
...
```
- **root@backup:~# apt install borgbackup** #
- **root@backup:~# borg --version** #
- borg 1.2.8
- **root@client:~# apt install -y borgbackup** #
- **root@client:~# borg --version** #
- borg 1.2.8
- **root@backup:~# adduser --disabled-password --gecos "" borg** # —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–µ—Ä–≤–∏—Å–∞ borgbackup
```bash
info: Adding user `borg' ...
info: Selecting UID/GID from range 1000 to 59999 ...
info: Adding new group `borg' (1003) ...
info: Adding new user `borg' (1003) with group `borg (1003)' ...
info: Creating home directory `/home/borg' ...
info: Copying files from `/etc/skel' ...
info: Adding new user `borg' to supplemental / extra groups `users' ...
info: Adding user `borg' to group `users' ...
```
- **root@backup:~# id borg** #  –ø—Ä–æ–≤–µ—Ä—è–µ–º
```bash
uid=1003(borg) gid=1003(borg) groups=1003(borg),100(users)
```
- **root@backup:~# chown borg:borg /var/backup** # –¥–∞–µ–º –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é borg –Ω–∞ –ø–∞–ø–∫—É BACKUP
- **root@backup:~# su - borg** # –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –æ–±–æ–ª–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è borg
- **borg@backup:~$ pwd** # –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≥–¥–µ –º—ã
- /home/borg
- **borg@backup:~$ mkdir .ssh** # –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –ø–æ –∫–ª—é—á–∞–º
- **borg@backup:~$ touch .ssh/authorized_keys**
- **borg@backup:~$ chmod 700 .ssh**
- **borg@backup:~$ chmod 600 .ssh/authorized_keys**
- **root@client:~# ssh-keygen**
```bash
Generating public/private ed25519 key pair.
Enter file in which to save the key (/root/.ssh/id_ed25519):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_ed25519
Your public key has been saved in /root/.ssh/id_ed25519.pub
The key fingerprint is:
SHA256:gNgRE4w+kv+f01jTNlRTEvXjzYA9pkajIjgW2/HOIPo root@client
The key's randomart image is:
+--[ED25519 256]--+
|   o=o      o+o  |
|  .o.+      o+ . |
| o. + o    .+.=..|
|o o  = +  .o +.+o|
| o .* + So. o  .o|
|  .o o =o.+.     |
|  ..   +oo .     |
|   .. o..        |
|    E.o.         |
+----[SHA256]-----+
```
- **root@client:~# borg init --encryption=repokey borg@10.0.77.182:/var/backup** # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π borg –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä–µ —Å client —Å–µ—Ä–≤–µ—Ä–∞. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç–æ–π, –∏–Ω–∞—á–µ –µ–≥–æ –Ω–∞–¥–æ –≤—ã—á–∏—Å—Ç–∏—Ç—å rm
- **root@client:~# borg key export borg@10.0.77.182:/var/backup repo-key.borg** # —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- **root@client:~# ssh-copy-id borg@10.0.77.182** # –ù–µ –ø–æ–º–µ—à–∞–µ—Ç –ø–æ–ª–æ–∂–∏—Ç—å –∫–ª—é—á –∏ –≤ –¥–æ–º–∞—à–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è borg –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –±—ç–∫–∞–ø–∞
- **root@backup:/home/borg/.ssh# cat /home/borg/.ssh/authorized_keys** # –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –∫–ª—é—á –ø–æ—è–≤–∏–ª—Å—è
- ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOGBaTq4WoCJFmAba9JAnTCnhaRwsSLzL1+CbNhBwFoq root@client
-  **root@backup:/home/borg/.ssh# vi /home/borg/.ssh/authorized_keys** # –æ–≥—Ä–∞–Ω–∏—á–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ ... 
- command="borg serve --restrict-to-path /var/backup",no-port-forwarding,no-agent-forwarding,no-pty ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOGBaTq4WoCJFmAba9JAnTCnhaRwsSLzL1+CbNhBwFoq root@client
- **root@client:~# borg create --stats --list borg@10.0.77.182:/var/backup/::"etc-{now:%Y-%m-%d_%H:%M:%S}" /etc** # –ó–∞–ø—É—Å–∫–∞–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞
```bash
A /etc/hostname
s /etc/localtime
A /etc/gshadow
A /etc/subgid
A /etc/passwd
A /etc/ld.so.cache
A /etc/hosts
A /etc/group
d /etc
------------------------------------------------------------------------------
Repository: ssh://borg@10.0.77.182/var/backup
Archive name: etc-2025-12-17_15:09:37
```
- **root@client:~# borg list borg@10.0.77.182:/var/backup/**
```bash
etc-2025-12-17_15:09:37              Wed, 2025-12-17 15:09:44 [c50f540b6a164961b5c702f5eed67c670a57fb1f801bcec3c6197d5666cebe24]
```
- **root@client:~# borg list borg@10.0.77.182:/var/backup/::etc-2025-12-17_15:09:37** # —Å–º–æ—Ç—Ä–∏–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –±—ç–∫–∞–ø–µ
```bash
- ...
-rw-r--r-- root   root       1854 Mon, 2025-12-15 09:09:34 etc/passwd
-rw-r--r-- root   root      22499 Fri, 2025-12-12 16:03:42 etc/ld.so.cache
-rw-r--r-- root   root        221 Wed, 2025-12-17 10:24:07 etc/hosts
-rw-r--r-- root   root        802 Mon, 2025-12-15 09:09:36 etc/group
```
- **root@client:~# borg extract borg@10.0.77.182:/var/backup/::etc-2025-12-17_15:09:37 etc/hostname**
- **root@client:~# pwd**
- /root
- **root@client:~# ls ./etc/**
- **root@client:~# ls -hal ./etc/***
```bash
-rw-r--r-- 1 root root 7 Dec 17 10:23 ./etc/hostname
```
- **root@client:~# df -kh ./etc/***
```bash
Filesystem                         Size  Used Avail Use% Mounted on
/dev/mapper/ubuntu--vg-ubuntu--lv   14G  3.0G   11G  23% /
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ —Å –ø–æ–º–æ—â—å—é systemd (–≥–ª—É–±–∏–Ω–∞ –±–µ–∫–∞–ø–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≥–æ–¥, —Ö—Ä–∞–Ω–∏—Ç—å –º–æ–∂–Ω–æ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–ø–∏–∏ –Ω–∞ –∫–æ–Ω–µ—Ü –º–µ—Å—è—Ü–∞, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ—Ö.–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∏ –º–µ—Å—è—Ü–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ø–∏–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- **root@client:~# vim /etc/systemd/system/borg-backup.service** # —Å–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å
```bash
[Unit]
Description=Borg Backup

[Service]
Type=oneshot

# –ü–∞—Ä–æ–ª—å–Ω–∞—è —Ñ—Ä–∞–∑–∞
Environment="BORG_PASSPHRASE=Otus1234"
# –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
Environment=REPO=borg@10.0.77.182:/var/backup/
# –ß—Ç–æ –±—ç–∫–∞–ø–∏–º
Environment=BACKUP_TARGET=/etc

# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
ExecStart=/usr/bin/borg create \
    --stats                \
    ${REPO}::etc-{now:%%Y-%%m-%%d_%%H:%%M:%%S} ${BACKUP_TARGET}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–∞–ø–∞
ExecStart=/usr/bin/borg check ${REPO}

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
ExecStart=/usr/bin/borg prune \
    --keep-daily  90      \
    --keep-monthly 12     \
    --keep-yearly  1       \
    ${REPO}
```

- **root@client:~# vim /etc/systemd/system/borg-backup.timer** # —Å–æ–∑–¥–∞–µ–º —Ç–∞–π–º–µ—Ä
```bash
[Unit]
Description=Borg Backup

[Timer]
OnUnitActiveSec=5min

[Install]
WantedBy=timers.target
```
- **root@client:~# systemctl enable borg-backup.timer** # –í–∫–ª—é—á–∞–µ–º –∏ 
```bash
Created symlink /etc/systemd/system/timers.target.wants/borg-backup.timer ‚Üí /etc/systemd/system/borg-backup.timer.
```
- **root@client:~# systemctl start borg-backup.timer** # –∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É —Ç–∞–π–º–µ—Ä–∞

- **root@client:~# systemctl list-timers | grep borg** # –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç!
```bash
-                                  - -                                      - borg-backup.timer              borg-backup.service
```
- **root@client:~# systemctl stop borg-backup.timer**
- **root@client:~# systemctl daemon-reexec**
- **root@client:~# systemctl daemon-reexec**
- **root@client:~# systemctl daemon-reload**
- **root@client:~# systemctl start borg-backup.timer**
- **root@client:~# systemctl status borg-backup.timer**
```bash
systemctl list-timers | grep borg
‚óè borg-backup.timer - Borg Backup every 5 minutes
     Loaded: loaded (/etc/systemd/system/borg-backup.timer; enabled; preset: enabled)
     Active: active (waiting)
```
- **root@client:~# systemctl list-timers | grep borg** # –†–∞–±–æ—Ç–∞–µ—Ç!
```bash
Thu 2025-12-18 11:56:11 MSK 4min 4s Thu 2025-12-18 11:51:11 MSK      55s ago borg-backup.timer              borg-backup.service
```
- **root@client:~# borg list borg@10.0.77.182:/var/backup/** # –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º –∞—Ä—Ö–∏–≤—ã
```bash
etc-2025-12-17_15:09:37              Wed, 2025-12-17 15:09:44 [c50f540b6a164961b5c702f5eed67c670a57fb1f801bcec3c6197d5666cebe24]
etc-2025-12-18_15-29-12              Thu, 2025-12-18 15:29:14 [b6c13f983e92d9336d3b978faa8a5016c94175a58e25087a8c042ec8e449dbea]
etc-2025-12-18_15:36:43              Thu, 2025-12-18 15:36:44 [9eb71341c2b8ef113b0403ea660f72a74a100a2f8be0f550d03b7ef3b1136eba]
```
- **root@backup:/home/borg/.ssh# borg list /var/backup** # –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å–∞–º–æ–º —Å–µ—Ä–≤–µ—Ä–µ –±—ç–∫–∞–ø–æ–≤
```bash
Warning: Attempting to access a previously unknown unencrypted repository!
Do you want to continue? [yN] y
etc-2025-12-17_15:09:37              Wed, 2025-12-17 15:09:44 [c50f540b6a164961b5c702f5eed67c670a57fb1f801bcec3c6197d5666cebe24]
etc-2025-12-18_15-29-12              Thu, 2025-12-18 15:29:14 [b6c13f983e92d9336d3b978faa8a5016c94175a58e25087a8c042ec8e449dbea]
etc-2025-12-18_15:36:43              Thu, 2025-12-18 15:36:44 [9eb71341c2b8ef113b0403ea660f72a74a100a2f8be0f550d03b7ef3b11
```

## 28 —É—Ä–æ–∫ 
## –°–µ—Ç–µ–≤–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Å–µ—Ç–µ–≤—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é"</ins>

**–¶–µ–ª—å**: –ù–∞—É—á–∏—Ç—å—Å—è –º–µ–Ω—è—Ç—å –±–∞–∑–æ–≤—ã–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Linux-based —Å–∏—Å—Ç–µ–º–∞—Ö;;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

### –ó–∞–¥–∞–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 2-—Ö —á–∞—Å—Ç–µ–π: —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π.
### 1. –í —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è: 
- –ù–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏
- –ü–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ –∫–∞–∂–¥–æ–π –ø–æ–¥—Å–µ—Ç–∏, –≤–∫–ª—é—á–∞—è —Å–≤–æ–±–æ–¥–Ω—ã–µ
- –£–∫–∞–∑–∞—Ç—å Broadcast-–∞–¥—Ä–µ—Å –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥—Å–µ—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–∏

### 2. –í –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è: 
- –°–æ–µ–¥–∏–Ω–∏—Ç—å –æ—Ñ–∏—Å—ã –≤ —Å–µ—Ç—å —Å–æ–≥–ª–∞—Å–Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–π —Å—Ö–µ–º–µ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ç—Ä–∞—Ñ–∏–∫ —Å–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω —Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ inetRouter
- –í—Å–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞ (–¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å ping)
- –£ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç –Ω–∞ NAT (eth0), –∫–æ—Ç–æ—Ä—ã–π vagrant –ø–æ–¥–Ω–∏–º–∞–µ—Ç –¥–ª—è —Å–≤—è–∑–∏
- –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è

### –í–´–ü–û–õ–ù–ï–ù–ò–ï

- –î–∞–Ω–∞ —Å—Ö–µ–º–∞ —Å–µ—Ç–∏:
<img width="785" height="891" alt="Screenshot 2026-01-05 at 11 06 55" src="https://github.com/user-attachments/assets/2dba85d1-969b-4917-bf40-4cea137d4c43" />

### 1. –†–∞–∑–±–µ—Ä–µ–º –µ–µ:
- 10  —Å–µ—Ç–µ–π –¥–ª—è —Ö–æ—Å—Ç–æ–≤
- 4 —Å–µ—Ç–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑–∞–Ω—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã (—É—Å–ª–æ–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Linux). –ß–µ—Ç–≤–µ—Ä—Ç–∞—è —Å–µ—Ç—å –Ω–∞ —Å—Ö–µ–º–µ - –ò–Ω—Ç–µ—Ä–Ω–µ—Ç.
- –ü–æ—Å—á–∏—Ç–∞–µ–º —Å–µ—Ç–∏:
<img width="945" height="927" alt="Screenshot 2026-01-13 at 09 58 52" src="https://github.com/user-attachments/assets/a8c32466-fd2e-4d0c-869a-ef923264b885" />

### 2. –ù–∞—Å—Ç—Ä–æ–∏–º —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–Ω–¥
- –°–æ–∑–¥–∞–¥–∏–º 7 –í–ú —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤ –æ–¥–Ω–æ–π "Distributed port group" (—Ä–∞–∑–¥–µ–ª–∏–º —Å–µ—Ç—è–º–∏) –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –ø–æ –î–ó (3 –í–ú - –ø–æ 1 —Å–µ—Ç–µ–≤–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É; 3 –í–ú - –ø–æ 2 –∏ 1 –í–ú - —Å 4-–º—è): 
<img width="1339" height="491" alt="Screenshot 2026-01-05 at 15 04 36" src="https://github.com/user-attachments/assets/92eb33c9-23b0-4fa8-8f5f-b1eaf2e3d9e8" />
- —É—Å—Ç–∞–Ω–æ–≤–∏–ª –Ω–∞ –≤—Å–µ –º–∞—à–∏–Ω—ã Linux Ubuntu 24.04
- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –Ω–∞ –≤—Å–µ—Ö –º–∞—à–∏–Ω–∞—Ö (–°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ VMware Remote Console –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å "copy/paste"):
<img width="587" height="390" alt="Screenshot 2026-01-06 at 13 54 58" src="https://github.com/user-attachments/assets/05b2f522-1e79-43da-878a-e86fcb6635c2" />
<img width="599" height="560" alt="Screenshot 2026-01-06 at 13 55 18" src="https://github.com/user-attachments/assets/b35504b7-3bbb-4b1b-9fe2-c2c897c03228" />
<img width="601" height="318" alt="Screenshot 2026-01-06 at 13 55 36" src="https://github.com/user-attachments/assets/78f9591b-e13c-4a04-b5ed-0ec18c1bbc2d" />
<img width="540" height="359" alt="Screenshot 2026-01-06 at 13 55 51" src="https://github.com/user-attachments/assets/7e1a064c-fe80-4bbd-bebd-9d3cb80d3df2" />
<img width="542" height="390" alt="Screenshot 2026-01-06 at 13 56 07" src="https://github.com/user-attachments/assets/b2ac5a94-9cae-42f0-9f99-1fac0364d0da" />
<img width="536" height="314" alt="Screenshot 2026-01-06 at 13 56 19" src="https://github.com/user-attachments/assets/08c74225-645b-4491-99e7-aa44fe0e6a58" />
<img width="534" height="313" alt="Screenshot 2026-01-06 at 13 56 31" src="https://github.com/user-attachments/assets/b4d135a7-8b5e-46c2-9b75-4df2fd506f85" />

- –¥–æ–±–∞–≤–∏–ª –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –Ω–∞ —Ö–æ—Å—Ç–æ–≤—É—é –º–∞—à–∏–Ω—É –ø–æ–¥ Windows –≤ —Ç–æ–º –∂–µ VLAN —á—Ç–æ –∏ 7 —Ç–µ—Å—Ç–æ–≤—ã—Ö –í–ú:
- 
<img width="393" height="209" alt="Screenshot 2026-01-13 at 10 13 53" src="https://github.com/user-attachments/assets/93bc1c29-0911-47ea-b99f-1f3a3a7c4e78" />

- –∏ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫–æ –≤—Å–µ–º –ø–æ ssh:

<img width="1021" height="472" alt="Screenshot 2026-01-13 at 10 16 32" src="https://github.com/user-attachments/assets/1292433e-9795-44ae-ae44-9926933c8483" />

### –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ NAT —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –¥–æ—Å—Ç—É–ø –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤ –±—ã–ª —á–µ—Ä–µ–∑ inetRouter –∏ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω —Å –ª—é–±–æ–≥–æ –∏–∑ 7 —Ö–æ—Å—Ç–æ–≤
- **–û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –Ω–∞ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö:**
- **root@inetRouter:/etc# cat /etc/sysctl.conf** # —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞ 
```bash
# Uncomment the next line to enable packet forwarding for IPv4
net.ipv4.ip_forward=1
```
- **root@inetRouter:/etc# sudo sysctl -p** # –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ /etc/sysctl.conf –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö —Å—Ä–∞–∑—É, –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- net.ipv4.ip_forward = 1
- **root@inetRouter:/etc# cat /proc/sys/net/ipv4/ip_forward** # –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥–∞
- 1
- **–ü—Ä–æ–≤–µ—Ä–∏–ª —Å–≤—è–∑—å —Å —Å–æ—Å–µ–¥—è–º–∏ (13 –∫–æ–º–∞–Ω–¥ ping —Å–æ –≤—Å–µ—Ö –º–∞—à–∏–Ω –ø–æ —Å–æ—Å–µ–¥—è–º). –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã.**
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º iptables –Ω–∞ NAT (inetRouter)**
- **root@inetRouter:~# iptables-save**
```bash
# Generated by iptables-save v1.8.10 (nf_tables) on Tue Jan  6 12:06:06 2026
*filter
:INPUT ACCEPT [5015:355494]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A FORWARD -i ens224 -o ens192 -j ACCEPT
-A FORWARD -i ens192 -o ens224 -m state --state RELATED,ESTABLISHED -j ACCEPT
COMMIT
# Completed on Tue Jan  6 12:06:06 2026
# Generated by iptables-save v1.8.10 (nf_tables) on Tue Jan  6 12:06:06 2026
*nat
:PREROUTING ACCEPT [5:469]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [39:2460]
-A PREROUTING -p tcp -m tcp --dport 1022 -j DNAT --to-destination 192.168.255.2:22
-A POSTROUTING -o ens192 -j MASQUERADE
COMMIT
# Completed on Tue Jan  6 12:06:06 2026
```
- **~ ssh -p 1022 spg@10.0.77.182**
- **spg@centralrouter:~$** # –ø–æ–ª—É—á–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ CentralRouter –∑–∞ NAT-–æ–º –ø–æ ssh
- **–î–∞–ª—å—à–µ –Ω–∞—Å—Ç—Ä–æ–∏–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ä–æ—É—Ç–µ—Ä–∞—Ö –∏ —Å–µ—Ä–≤–µ—Ä–∞—Ö —á–µ—Ä–µ–∑ netplan (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ —É–¥–æ–±–Ω–æ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞–ª–æ)**
- **0. InetRouter**
```bash
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 10.0.77.182/24
      routes:
        - to: default
          via: 10.0.77.1
      nameservers:
        addresses: [10.0.1.167, 10.0.1.194]

    ens224:
      dhcp4: no
      addresses:
        - 192.168.255.1/30
      routes:
        - to: 192.168.0.0/16
          via: 192.168.255.2
```
- **1. CentralRouter**
```bash
root@centralrouter:~# cat /etc/netplan/50-cloud-init.yaml
network:
  version: 2
  renderer: networkd

  ethernets:

    ens161:
      dhcp4: no
      addresses:
        - 192.168.255.2/30
      routes:
        - to: default
          via: 192.168.255.1
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]

    ens192:
      dhcp4: no
      addresses:
        - 192.168.0.1/28

    ens224:
      dhcp4: no
      addresses:
        - 192.168.255.9/30
      routes:
        - to: 192.168.2.0/24
          via: 192.168.255.10

    ens256:
      dhcp4: no
      addresses:
        - 192.168.255.5/30
      routes:
        - to: 192.168.1.0/24
          via: 192.168.255.6

```
- **2. CentralServer**
```bash
root@centralServer:~# cat /etc/netplan/00-installer-config.yaml
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 192.168.0.2/28
      routes:
        - to: default
          via: 192.168.0.1
      nameservers:
        addresses: [ 8.8.8.8, 10.0.1.167]
```
- **3. office1Router**
```bash
root@office1router:~# cat /etc/netplan/50-cloud-init.yaml
network:
  version: 2
  ethernets:
    ens192:
      dhcp4: no
      addresses:
        - 192.168.255.10/30
      routes:
        - to: default
          via: 192.168.255.9
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]

    ens224:
      dhcp4: no
      addresses:
        - 192.168.2.129/26
```
- **4. office2Router**
```bash
root@office2router:~# cat /etc/netplan/50-cloud-init.yaml
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 192.168.255.6/30
      routes:
        - to: default
          via: 192.168.255.5
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]

    ens224:
      dhcp4: no
      addresses:
        - 192.168.1.1/25
```
- **5. office1Server**
```bash
root@office1server:~# cat /etc/netplan/50-cloud-init.yaml
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 192.168.2.130/26
      routes:
        - to: default
          via: 192.168.2.129
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]
```
- **6. office2Server**
```bash
root@office2server:~# cat /etc/netplan/50-cloud-init.yaml
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 192.168.1.2/25
      routes:
        - to: default
          via: 192.168.1.1/25
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]
```
### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ netplan –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –≤ "ip route show"
- **root@inetRouter:~# apt install -y traceroute** # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—Ç–∏–ª–∏—Ç—É traceroute –Ω–∞ –≤—Å–µ –º–∞—à–∏–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –î–ó
- **root@inetRouter:~# traceroute 192.168.2.130** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å inetRouter –Ω–∞ office1Server
```bash
traceroute to 192.168.2.130 (192.168.2.130), 30 hops max, 60 byte packets
 1  192.168.255.2 (192.168.255.2)  0.109 ms  0.073 ms  0.071 ms
 2  192.168.255.10 (192.168.255.10)  0.165 ms  0.127 ms  0.113 ms
 3  192.168.2.130 (192.168.2.130)  0.235 ms  0.216 ms  0.203 ms
```
- **root@inetRouter:~# traceroute 192.168.1.2** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å inetRouter –Ω–∞ office2Server
```bash
traceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets
 1  192.168.255.2 (192.168.255.2)  0.151 ms  0.108 ms  0.114 ms
 2  192.168.255.6 (192.168.255.6)  0.305 ms  0.288 ms  0.277 ms
 3  192.168.1.2 (192.168.1.2)  0.396 ms  0.383 ms  0.370 ms
```
- **root@inetRouter:~# traceroute 192.168.0.2** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å inetRouter –Ω–∞ CentralServer
```bash
traceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets
 1  192.168.255.2 (192.168.255.2)  0.103 ms  0.088 ms  0.065 ms
 2  192.168.0.2 (192.168.0.2)  0.150 ms  0.132 ms  0.125 ms
```
- **root@centralServer:~# traceroute 192.168.2.130** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å CentralServer –Ω–∞ office1Server
```bash
traceroute to 192.168.2.130 (192.168.2.130), 30 hops max, 60 byte packets
 1  _gateway (192.168.0.1)  0.116 ms  0.093 ms  0.080 ms
 2  192.168.255.10 (192.168.255.10)  0.193 ms  0.200 ms  0.195 ms
 3  192.168.2.130 (192.168.2.130)  0.336 ms  0.306 ms  0.288 ms**
```
- **root@centralServer:~# traceroute 192.168.1.2** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å CentralServer –Ω–∞ office2Server
```bash
traceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets
 1  _gateway (192.168.0.1)  0.115 ms  0.104 ms  0.090 ms
 2  192.168.255.6 (192.168.255.6)  0.212 ms  0.212 ms  0.199 ms
 3  192.168.1.2 (192.168.1.2)  0.332 ms  0.320 ms  0.283 ms
```
- **root@centralServer:~# traceroute 8.8.8.8** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å CentralServer –Ω–∞ 8.8.8.8
```bash
traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  _gateway (192.168.0.1)  0.154 ms  0.123 ms  0.106 ms
 2  192.168.255.1 (192.168.255.1)  0.291 ms  0.279 ms  0.262 ms
 3  10.0.77.1 (10.0.77.1)  2.656 ms  1.816 ms  2.834 ms
 4  asr1002-x-1-po7.garant.ru (80.253.4.64)  1.174 ms  0.942 ms  1.343 ms
 5  17-229-9-185.host.cirex.ru (185.9.229.17)  17.516 ms  17.365 ms  17.670 ms
 6  10.10.11.17 (10.10.11.17)  2.374 ms  1.910 ms  2.066 ms
 7  msk-ix-gw3.google.com (195.208.208.250)  4.453 ms  2.057 ms  9.362 ms
 8  * 192.178.241.119 (192.178.241.119)  2.435 ms  2.616 ms
 9  * 192.178.241.66 (192.178.241.66)  1.952 ms 192.178.243.132 (192.178.243.132)  1.916 ms
10  * * *
```
- **root@office1server:~# traceroute 192.168.0.2** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å office1Server –Ω–∞ CentralServer
```bash
traceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets
 1  _gateway (192.168.2.129)  0.124 ms  0.121 ms  0.100 ms
 2  192.168.255.9 (192.168.255.9)  0.260 ms  0.243 ms  0.238 ms
 3  192.168.0.2 (192.168.0.2)  0.380 ms  0.365 ms  0.354 ms
```
- **root@office1server:~# traceroute 192.168.1.2** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å office1Server –Ω–∞ office2Server
```bash
traceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets
 1  _gateway (192.168.2.129)  0.115 ms  0.084 ms  0.068 ms
 2  192.168.255.9 (192.168.255.9)  0.216 ms  0.213 ms  0.198 ms
 3  192.168.255.6 (192.168.255.6)  0.310 ms  0.295 ms  0.281 ms
 4  192.168.1.2 (192.168.1.2)  0.404 ms  0.407 ms  0.392 ms
```
- **root@office1server:~# traceroute 8.8.8.8** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å office1Server –Ω–∞ 8.8.8.8
```bash
traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  _gateway (192.168.2.129)  0.128 ms  0.106 ms  0.095 ms
 2  192.168.255.9 (192.168.255.9)  0.238 ms  0.227 ms  0.220 ms
 3  192.168.255.1 (192.168.255.1)  0.420 ms  0.409 ms  0.398 ms
 4  10.0.77.1 (10.0.77.1)  2.024 ms  2.605 ms  2.806 ms
 5  asr1002-x-1-po7.garant.ru (80.253.4.64)  1.022 ms  1.194 ms  1.386 ms
 6  17-229-9-185.host.cirex.ru (185.9.229.17)  1.554 ms  1.310 ms  1.481 ms
 7  10.10.11.17 (10.10.11.17)  1.754 ms  2.432 ms  2.243 ms
 8  msk-ix-gw3.google.com (195.208.208.250)  3.120 ms  4.514 ms  2.912 ms
 9  192.178.241.65 (192.178.241.65)  2.700 ms *  3.030 ms
10  209.85.143.20 (209.85.143.20)  2.752 ms 192.178.241.70 (192.178.241.70)  2.585 ms 192.178.241.148 (192.178.241.148)  2.574 ms
11  * * *
```
- **root@office2server:~# traceroute 192.168.0.2** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å office2Server –Ω–∞ CentralServer
```bash
traceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets
 1  _gateway (192.168.1.1)  0.119 ms  0.097 ms  0.104 ms
 2  192.168.255.5 (192.168.255.5)  0.245 ms  0.234 ms  0.214 ms
 3  192.168.0.2 (192.168.0.2)  0.352 ms  0.335 ms  0.302 ms
```
- **root@office2server:~# traceroute 192.168.2.130** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å office2Server –Ω–∞ office1Server
```bash
traceroute to 192.168.2.130 (192.168.2.130), 30 hops max, 60 byte packets
 1  _gateway (192.168.1.1)  0.120 ms  0.098 ms  0.098 ms
 2  192.168.255.5 (192.168.255.5)  0.233 ms  0.212 ms  0.197 ms
 3  192.168.255.10 (192.168.255.10)  0.309 ms  0.291 ms  0.276 ms
 4  192.168.2.130 (192.168.2.130)  0.417 ms  0.407 ms  0.410 ms
```
- **root@office2server:~# traceroute 8.8.8.8** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å office2Server –Ω–∞ 8.8.8.8
```bash
traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  _gateway (192.168.1.1)  0.122 ms  0.097 ms  0.085 ms
 2  192.168.255.5 (192.168.255.5)  0.209 ms  0.197 ms  0.190 ms
 3  192.168.255.1 (192.168.255.1)  0.284 ms  0.269 ms  0.235 ms
 4  10.0.77.1 (10.0.77.1)  2.227 ms  2.379 ms  2.122 ms
 5  asr1002-x-1-po7.garant.ru (80.253.4.64)  1.095 ms  1.283 ms  0.891 ms
 6  17-229-9-185.host.cirex.ru (185.9.229.17)  1.716 ms  1.375 ms  1.531 ms
 7  10.10.11.17 (10.10.11.17)  1.943 ms  2.366 ms  2.163 ms
 8  msk-ix-gw3.google.com (195.208.208.250)  2.146 ms * *
 9  * * 192.178.241.65 (192.178.241.65)  2.653 ms
10  209.85.143.20 (209.85.143.20)  2.648 ms 192.178.241.148 (192.178.241.148)  2.493 ms 192.178.241.70 (192.178.241.70)  2.415 ms
11  * * *
```
###  üéÑ –ù–∞ —ç—Ç–æ–º —ç—Ç–æ –∫—Ä–∞—Å–∏–≤–æ–µ –î–ó –∑–∞–≤–µ—Ä—à–µ–Ω–æ 
 
## 29 —É—Ä–æ–∫ 
## DHCP, PXE

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–ù–∞—Å—Ç—Ä–æ–π–∫–∞ PXE —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏"</ins>

**–¶–µ–ª—å**: –û—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–≤—ã–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DHCP, TFTP, PXE –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø–æ —Å–µ—Ç–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞ Ubuntu 24
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∏–∑ HTTP-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É c –ø–æ–º–æ—â—å—é —Ñ–∞–π–ª–∞ user-data
<details>
<summary> = üß† –¢–µ–æ—Ä–∏—è üß†= </summary>
	
## PXE (Preboot eXecution Environment)
### –û–ø–∏—Å–∞–Ω–∏–µ
```bash
PXE (Preboot eXecution Environment) ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è Intel,
–ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∫–æ–º–ø—å—é—Ç–µ—Ä—É –∑–∞–≥—Ä—É–∂–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ —Å–µ—Ç–∏, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π (HDD/SSD/USB).
PXE —à–∏—Ä–æ–∫–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è:
	‚Ä¢	–º–∞—Å—Å–æ–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –û–°;
	‚Ä¢	–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤;
	‚Ä¢	diskless-–∫–ª–∏–µ–Ω—Ç–æ–≤;
	‚Ä¢	recovery / rescue-—Å—Ä–µ–¥;
	‚Ä¢	CI/CD –∏ bare-metal provisioning.
```

### –£—á–∞—Å—Ç–Ω–∏–∫–∏ PXE-–∑–∞–≥—Ä—É–∑–∫–∏
```bash
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç													–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
PXE-–∫–ª–∏–µ–Ω—Ç													–ö–æ–º–ø—å—é—Ç–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PXE (BIOS/UEFI)
DHCP-—Å–µ—Ä–≤–µ—Ä													–í—ã–¥–∞—ë—Ç IP-–∞–¥—Ä–µ—Å –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
TFTP / HTTP —Å–µ—Ä–≤–µ—Ä											–ü–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫ –∏ –æ–±—Ä–∞–∑—ã
Bootloader													pxelinux / GRUB / iPXE
–û–° / –ò–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä											Linux kernel + initrd
```

### –û–±—â–∞—è —Å—Ö–µ–º–∞ PXE-–∑–∞–≥—Ä—É–∑–∫–∏
```bash
[ PXE CLIENT ]
      |
      | 1. DHCP DISCOVER (PXE)
      v
[ DHCP SERVER ]
      |
      | 2. IP + bootfile + server
      v
[ TFTP / HTTP SERVER ]
      |
      | 3. Bootloader
      v
[ BOOTLOADER ]
      |
      | 4. kernel + initrd
      v
[ OS / INSTALLER ]
```
### –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PXE
```bash
	‚Ä¢	BIOS/UEFI –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PXE ROM —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã
	‚Ä¢	–ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Ç—å
	‚Ä¢	–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è DHCPDISCOVER —Å PXE-–æ–ø—Ü–∏—è–º–∏
```

2. DHCP-–æ—Ç–≤–µ—Ç
```bash
DHCP-—Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç DHCPOFFER, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
DHCP option						–û–ø–∏—Å–∞–Ω–∏–µ
IP address						IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞
option 66						–ê–¥—Ä–µ—Å TFTP/HTTP —Å–µ—Ä–≤–µ—Ä–∞
option 67						–ò–º—è –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

–ü–æ—è—Å–Ω–µ–Ω–∏—è –æ–ø—Ü–∏–π:
üîπ DHCP option 66
Boot Server Name
	‚Ä¢	–ø–µ—Ä–µ–¥–∞—ë—Ç IP-–∞–¥—Ä–µ—Å –∏–ª–∏ DNS-–∏–º—è —Å–µ—Ä–≤–µ—Ä–∞, –≥–¥–µ –ª–µ–∂–∏—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫
	‚Ä¢	–æ–±—ã—á–Ω–æ —ç—Ç–æ TFTP-—Å–µ—Ä–≤–µ—Ä, –∏–Ω–æ–≥–¥–∞ HTTP
–ü—Ä–∏–º–µ—Ä:
option 66 192.168.1.10;
–∏–ª–∏:
next-server 192.168.1.10;
üîπ DHCP option 67
Bootfile Name
	‚Ä¢	–ø–µ—Ä–µ–¥–∞—ë—Ç –∏–º—è —Ñ–∞–π–ª–∞ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
	–ü—Ä–∏–º–µ—Ä:
option 67 "pxelinux.0";
–∏–ª–∏:
filename "grubx64.efi";

–ü—Ä–∏–º–µ—Ä DHCP-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

next-server 192.168.1.10;
filename "pxelinux.0";
```
3. –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
```bash
–ö–ª–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫ –ø–æ —Å–µ—Ç–∏:
	‚Ä¢	BIOS PXE ‚Üí TFTP
	‚Ä¢	UEFI PXE ‚Üí TFTP –∏–ª–∏ HTTP

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–≤:
	‚Ä¢	pxelinux.0 (Legacy BIOS)
	‚Ä¢	grubx64.efi (UEFI)
	‚Ä¢	ipxe.efi
```

4. –ó–∞–≥—Ä—É–∑–∫–∞ —è–¥—Ä–∞ –∏ initrd
```bash
Bootloader:
	‚Ä¢	—á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
	‚Ä¢	–∑–∞–≥—Ä—É–∂–∞–µ—Ç vmlinuz –∏ initrd.img
	‚Ä¢	–ø–µ—Ä–µ–¥–∞—ë—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —è–¥—Ä—É

–ü—Ä–∏–º–µ—Ä:
linux vmlinuz ip=dhcp inst.repo=http://server/repo
initrd initrd.img
```bash

5. –ó–∞–ø—É—Å–∫ –û–° –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞
```bash
–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
	‚Ä¢	–∑–∞–ø—É—Å–∫ Live Linux;
	‚Ä¢	—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –û–°;
	‚Ä¢	–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (Kickstart / Preseed / Autoinstall);
	‚Ä¢	–∑–∞–≥—Ä—É–∑–∫–∞ recovery-—Å—Ä–µ–¥—ã.

PXE –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –ø–µ—Ä–µ–¥–∞—á–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —è–¥—Ä—É –û–°.
```

### BIOS PXE vs UEFI PXE
```bash
–ü–∞—Ä–∞–º–µ—Ç—Ä								BIOS PXE							UEFI PXE
–ó–∞–≥—Ä—É–∑—á–∏–∫								pxelinux.0							grubx64.efi
–ü—Ä–æ—Ç–æ–∫–æ–ª								TFTP								TFTP / HTTP
Secure Boot								‚ùå									‚úÖ
–°–∫–æ—Ä–æ—Å—Ç—å								–Ω–∏–∂–µ								–≤—ã—à–µ
```

### iPXE
```bash
iPXE ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è PXE:
	‚Ä¢	–ø–æ–¥–¥–µ—Ä–∂–∫–∞ HTTP / HTTPS;
	‚Ä¢	—Å–∫—Ä–∏–ø—Ç—ã –∏ –º–µ–Ω—é;
	‚Ä¢	chainloading;
	‚Ä¢	–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è;
	‚Ä¢	–≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏.
–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ PXE –≤ production-—Å—Ä–µ–¥–∞—Ö.
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ PXE
```bash
PXE Server:
- DHCP
- TFTP
- HTTP (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

Client:
- PXE-enabled NIC
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è PXE
```bash	
	‚Ä¢	—Ç—Ä–µ–±—É–µ—Ç—Å—è DHCP;
	‚Ä¢	TFTP –º–µ–¥–ª–µ–Ω–Ω—ã–π (—Ä–µ—à–∞–µ—Ç—Å—è iPXE + HTTP);
	‚Ä¢	–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
```

### –ö—Ä–∞—Ç–∫–æ
- PXE ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Å–µ—Ç–µ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ DHCP, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫ –ø–æ —Å–µ—Ç–∏, –∑–∞—Ç–µ–º —è–¥—Ä–æ –∏ initrd, –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –û–° –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π.

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
```bash
	‚Ä¢	–º–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤;
	‚Ä¢	bare-metal provisioning;
	‚Ä¢	diskless —Ä–∞–±–æ—á–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏;
	‚Ä¢	recovery –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.
```
</details>

- ## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- **root@pxeserver:~# systemctl stop ufw** # –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∞–µ—Ä–≤–æ–ª
- **root@pxeserver:~# systemctl disable ufw** #
```bash
Synchronizing state of ufw.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install disable ufw
Removed "/etc/systemd/system/multi-user.target.wants/ufw.service".
```
- **root@pxeserver:~# systemctl status ufw** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
```bash
‚óã ufw.service - Uncomplicated firewall
     Loaded: loaded (/usr/lib/systemd/system/ufw.service; disabled; preset: enabled)
     Active: inactive (dead)
       Docs: man:ufw(8)

Dec 19 12:23:20 pxeserver systemd[1]: Starting ufw.service - Uncomplicated firewall...
Dec 19 12:23:20 pxeserver systemd[1]: Finished ufw.service - Uncomplicated firewall.
Dec 22 08:11:46 pxeserver systemd[1]: Stopping ufw.service - Uncomplicated firewall...
Dec 22 08:11:46 pxeserver ufw-init[8914]: Skip stopping firewall: ufw (not enabled)
Dec 22 08:11:46 pxeserver systemd[1]: ufw.service: Deactivated successfully.
Dec 22 08:11:46 pxeserver systemd[1]: Stopped ufw.service - Uncomplicated firewall.
```
- **root@pxeserver:~# sudo apt update** # –æ–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
- **root@pxeserver:~# sudo apt install dnsmasq** # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—Ç–∏–ª–∏—Ç—É dnsmasq
- **root@pxeserver:~# cat /etc/dnsmasq.d/pxe.conf** # —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PXE
```bash
#–£–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å DHCP/TFTP
interface=eth1
bind-interfaces
#–¢–∞–∫–∂–µ —É–∫–∞–∑–∞–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ range –∞–¥—Ä–µ—Å–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å—Å—è –ø–æ DHCP
dhcp-range=eth1,10.0.77.186,10.0.77.190
#–ò–º—è —Ñ–∞–π–ª–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞–¥–æ –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¥–ª—è Legacy boot (—ç—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∏—á–∫–µ)
dhcp-boot=pxelinux.0
#–ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤, –¥–ª—è UEFI-–∑–∞–≥—Ä—É–∑–∫–∏ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å)
dhcp-match=set:efi-x86_64,option:client-arch,7
dhcp-boot=tag:efi-x86_64,bootx64.efi
#–í–∫–ª—é—á–∞–µ–º TFTP-—Å–µ—Ä–≤–µ—Ä
enable-tftp
#–£–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è TFTP-—Å–µ—Ä–≤–µ—Ä–∞
tftp-root=/srv/tftp/amd64
```
- **root@pxeserver:~# mkdir -p /srv/tftp** # —Å–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Ñ–∞–π–ª–æ–≤ TFTP-—Å–µ—Ä–≤–µ—Ä–∞
- **root@pxeserver:~# wget http://cdimage.ubuntu.com/ubuntu-server/daily-live/current/noble-netboot-amd64.tar.gz
tar -xzvf noble-netboot-amd64.tar.gz -C /srv/tftp** # —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª—ã –¥–ª—è —Å–µ—Ç–µ–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Ubuntu 24.04
```bash
--2025-12-22 08:29:52--  http://cdimage.ubuntu.com/ubuntu-server/daily-live/current/noble-netboot-amd64.tar.gz
Resolving cdimage.ubuntu.com (cdimage.ubuntu.com)... 91.189.91.124, 185.125.190.37, 2620:2d:4000:1::17, ...
Connecting to cdimage.ubuntu.com (cdimage.ubuntu.com)|91.189.91.124|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2025-12-22 08:29:53 ERROR 404: Not Found. 

tar (child): noble-netboot-amd64.tar.gz: Cannot open: No such file or directory
tar (child): Error is not recoverable: exiting now
tar: Child returned status 2
tar: Error is not recoverable: exiting now
```
### –Ω–æ –µ–≥–æ —Ç–∞–º —É–∂–µ –Ω–µ—Ç... 
- **root@pxeserver:~# wget http://cdimage.ubuntu.com/ubuntu-server/daily-live/current/resolute-netboot-amd64.tar.gz** # –Ω–æ –µ—Å—Ç—å –¥—Ä—É–≥–æ–π
```bash
--2025-12-22 08:42:17--  http://cdimage.ubuntu.com/ubuntu-server/daily-live/current/resolute-netboot-amd64.tar.gz
Resolving cdimage.ubuntu.com (cdimage.ubuntu.com)... 91.189.91.124, 185.125.190.37, 2620:2d:4000:1::17, ...
Connecting to cdimage.ubuntu.com (cdimage.ubuntu.com)|91.189.91.124|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 112038753 (107M) [application/x-gzip]
Saving to: ‚Äòresolute-netboot-amd64.tar.gz‚Äô

resolute-netboot-amd64.tar.gz  100%[==================================================>] 106.85M  12.0MB/s    in 9.9s

2025-12-22 08:42:27 (10.8 MB/s) - ‚Äòresolute-netboot-amd64.tar.gz‚Äô saved [112038753/112038753]
```
- **root@pxeserver:~# tar -xzvf resolute-netboot-amd64.tar.gz -C /srv/tftp** # —Ä–∞—Å–ø–∞–∫—É–µ–º
```bash
./
./amd64/
./amd64/grub/
./amd64/grub/grub.cfg
./amd64/initrd
./amd64/grubx64.efi
./amd64/linux
./amd64/pxelinux.0
./amd64/bootx64.efi
./amd64/pxelinux.cfg/
./amd64/pxelinux.cfg/default
./amd64/ldlinux.c32
```
-**root@pxeserver:~# systemctl restart dnsmasq** # –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É dnsmasq

##  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Web-—Å–µ—Ä–≤–µ—Ä–∞
- –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ—Ç–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ HTTP –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.
- **root@pxeserver:~# sudo apt install apache2**
- **root@pxeserver:~# mkdir -p /srv/images**
- **root@pxeserver:~# cd /srv/images/**
- **root@pxeserver:/srv/images# wget http://cdimage.ubuntu.com/ubuntu-server/daily-live/current/resolute-live-server-amd64.iso**
```bash
--2025-12-22 12:54:54--  http://cdimage.ubuntu.com/ubuntu-server/daily-live/current/resolute-live-server-amd64.iso
Resolving cdimage.ubuntu.com (cdimage.ubuntu.com)... 185.125.190.37, 91.189.91.124, 2620:2d:4000:1::17, ...
Connecting to cdimage.ubuntu.com (cdimage.ubuntu.com)|185.125.190.37|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2417293312 (2.3G) [application/x-iso9660-image]
Saving to: ‚Äòresolute-live-server-amd64.iso‚Äô

resolute-live-server-amd64.iso   100%[========================================================>]   2.25G  26.7MB/s    in 2m 2s

2025-12-22 12:56:57 (18.9 MB/s) - ‚Äòresolute-live-server-amd64.iso‚Äô saved [2417293312/2417293312]
```  
- **root@pxeserver:/srv/images# cat /etc/apache2/sites-available/ks-server.conf** #—Å–æ–∑–¥–∞–ª–∏ —Ñ–∞–π–ª 
```bash
#–£–∫–∞–∑—ã–≤–∞–µ–º IP-–∞–¥—Ä–µ—Å —Ö–æ—Å—Ç–∞ –∏ –ø–æ—Ä—Ç –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å Web-—Å–µ—Ä–≤–µ—Ä
<VirtualHost 10.0.77.182:80>
DocumentRoot /
# –£–∫–∞–∑—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /srv/images –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è iso-–æ–±—Ä–∞–∑
<Directory /srv/images>
Options Indexes MultiViews
AllowOverride All
Require all granted
</Directory>
</VirtualHost>
```
- **root@pxeserver:/srv/images# sudo a2ensite ks-server.conf** # –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ks-server –≤ apache
```bash
Enabling site ks-server.
To activate the new configuration, you need to run:
  systemctl reload apache2 #–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º –ø–æ–∑–∂–µ
```
- **cat /srv/tftp/amd64/pxelinux.cfg/default** # –≤–Ω–æ—Å–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª
```bash
DEFAULT install
LABEL install
  KERNEL linux
  INITRD initrd
  APPEND root=/dev/ram0 ramdisk_size=3000000 ip=dhcp iso-url=http://10.0.77.182/srv/images/resolute-live-server-amd64.iso ---
```
### –í –¥–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ —Ñ–∞–π–ª—ã linux –∏ initrd –±—É–¥—É—Ç –∑–∞–±–∏—Ä–∞—Ç—å—Å—è –ø–æ tftp, –∞ —Å–∞–º iso-–æ–±—Ä–∞–∑ ubuntu 24.04
### –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è –∏–∑ –Ω–∞—à–µ–≥–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ http://10.0.0.20/srv/images/noble-live-server-amd64.iso
### –ò–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –æ–±—Ä–∞–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–π (2.6G) –∏ –æ–Ω —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –û–ó–£, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å
### —Ä–∞–∑–º–µ—Ä –û–ó–£ –¥–æ 3 –≥–∏–≥–∞–±–∞–π—Ç (root=/dev/ram0 ramdisk_size=3000000)

- **root@pxeserver:/srv/images# systemctl restart apache2** # –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º apache2

### –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—É—é –º–∞—à–∏–Ω—É-–∫–ª–∏–µ–Ω—Ç–∞

### –ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∏–ª

- <img width="1197" height="494" alt="Screenshot 2025-12-22 at 16 27 45" src="https://github.com/user-attachments/assets/8032617f-ccc0-4139-9ddf-22de3757be6c" />

### –ü–æ—à–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
<img width="1054" height="525" alt="Screenshot 2025-12-22 at 16 55 21" src="https://github.com/user-attachments/assets/36f9026b-b020-41d3-9cd6-83cd62abf755" />


## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Ubuntu 24.04
c–æ–∑–¥–∞—ë–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π
- **root@pxeserver:/srv/images# mkdir /srv/ks** # —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª /srv/ks/user-data –∏ 

- **root@pxeserver:/srv/images# vim /srv/ks/user-data** # –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ–≥–æ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
```bash
autoinstall:
apt:
disable_components: []
geoip: true
preserve_sources_list: false
primary:
- arches:
- amd64
- i386
uri: http://us.archive.ubuntu.com/ubuntu
- arches:
- default
uri: http://ports.ubuntu.com/ubuntu-ports
drivers:
install: false
identity:
hostname: linux
password: $6$sJgo6Hg5zXBwkkI8$btrEoWAb5FxKhajagWR49XM4EAOfO/
Dr5bMrLOkGe3KkMYdsh7T3MU5mYwY2TIMJpVKckAwnZFs2ltUJ1abOZ.
realname: otus
username: otus
kernel:
package: linux-generic
keyboard:
layout: us
toggle: null
variant: ''
locale: en_US.UTF-8
network:
ethernets:
enp0s3:
dhcp4: true
enp0s8:
dhcp4: true
version: 2
ssh:
allow-pw: true
authorized-keys: []
install-server: true
updates: security
version: 1
```
- –í –¥–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
‚Ä¢ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è apt-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π http://us.archive.ubuntu.com/ubuntu
‚Ä¢ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–æ–≤
‚Ä¢ –∑–∞–¥–∞—ë—Ç—Å—è hostname linux
‚Ä¢ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å otus c –ø–∞—Ä–æ–ª–µ–º 123 (–ø–∞—Ä–æ–ª—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –≤ SHA512)
‚Ä¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏
‚Ä¢ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ –ø–æ DHCP (–¥–ª—è –æ–±–æ–∏—Ö –ø–æ—Ä—Ç–æ–≤)
‚Ä¢ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è openssh-—Å–µ—Ä–≤–µ—Ä —Å –¥–æ—Å—Ç—É–ø–æ–º –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é

- **root@pxeserver:/srv/images# touch /srv/ks/meta-data** # —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –∏–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (—Ö—Ä–∞–Ω–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–æ—Å—Ç–µ),–Ω–µ –±—É–¥–µ–º –ø–æ–∫–∞
- **root@pxeserver:/srv/images# cat /etc/apache2/sites-available/ks-server.conf** # –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–±–∞–≤–∏–º –∫–∞—Ç–∞–ª–æ–≥ /srv/ks –∏–¥—ë–Ω—Ç–∏—á–Ω–æ –∫–∞—Ç–∞–ª–æ–≥—É /srv/images
```bash
#–£–∫–∞–∑—ã–≤–∞–µ–º IP-–∞–¥—Ä–µ—Å —Ö–æ—Å—Ç–∞ –∏ –ø–æ—Ä—Ç –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å Web-—Å–µ—Ä–≤–µ—Ä
<VirtualHost 10.0.77.182:80>
DocumentRoot /srv
Alias /ks /srv/ks
# –£–∫–∞–∑—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /srv/ks –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
<Directory /srv/ks>
Options Indexes MultiViews
AllowOverride All
Require all granted
</Directory>
Alias /images /srv/images
# –£–∫–∞–∑—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /srv/images –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è iso-–æ–±—Ä–∞–∑
<Directory /srv/images>
Options Indexes MultiViews
AllowOverride All
Require all granted
</Directory>
</VirtualHost>
```
- **root@pxeserver:/srv/images# cat /srv/tftp/amd64/pxelinux.cfg/default** # –¥–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
DEFAULT install
LABEL install
  KERNEL linux
  INITRD initrd
  APPEND root=/dev/ram0 ramdisk_size=3000000 ip=dhcp iso-url=http://10.0.77.182/images/resolute-live-server-amd64.iso autoinstall ds=nocloud-net;s=http://10.0.77.182/ks/
```
- **root@pxeserver:/srv/images# systemctl restart dnsmasq** # –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º dnsmasq
- **root@pxeserver:/srv/images# systemctl restart apache2** # –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º apache2

### –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É. –ï—Å–ª–∏ –≤ BIOS —Å—Ç–æ—è–ª –ø–µ—Ä–≤—ã–º HD (–ø—É—Å—Ç–æ–π, –±–µ–∑ boot) –¥–æ PXE, —Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞.
<img width="930" height="686" alt="Screenshot 2025-12-23 at 12 43 44" src="https://github.com/user-attachments/assets/ea40c6c0-7447-4519-ad9e-ccd217dd7a65" />

## 30-32 —É—Ä–æ–∫–∏ 
## –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ - iptables/firewalld/nftable

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–°—Ü–µ–Ω–∞—Ä–∏–∏ iptables"</ins>

**–¶–µ–ª—å**: –ù–∞–ø–∏—Å–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ iptables;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
- 1. —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å knocking port (centralRouter –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –Ω–∞ ssh inetrRouter —á–µ—Ä–µ–∑ knock —Å–∫—Ä–∏–ø—Ç. –ü—Ä–∏–º–µ—Ä –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö.)
- 2. –¥–æ–±–∞–≤–∏—Ç—å inetRouter2, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–µ–Ω(–º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è (host-only —Ç–∏–ø —Å–µ—Ç–∏ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª–∫–∏)) —Å —Ö–æ—Å—Ç–∞ –∏–ª–∏ —Ñ–æ—Ä–≤–∞—Ä–¥–∏—Ç—Å—è –ø–æ—Ä—Ç —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—Ö–æ—Å—Ç.
- –∑–∞–ø—É—Å—Ç–∏—Ç—å nginx –Ω–∞ centralServer.
- –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å 80–π –ø–æ—Ä—Ç –Ω–∞ inetRouter2 8080.
- –¥–µ—Ñ–æ–ª—Ç –≤ –∏–Ω–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ inetRouter.


Debian / Ubuntu
```bash
sudo apt update
sudo apt install knockd
```


```bash

```

</details>

- ## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
üîê –ß—Ç–æ —Ç–∞–∫–æ–µ Port Knocking
- Port knocking ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–∫—Ä—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, SSH 22).‚Ä®–ü–æ—Ä—Ç –∑–∞–∫—Ä—ã—Ç –≤—Å–µ–≥–¥–∞, –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –¥—Ä—É–≥–∏–º –ø–æ—Ä—Ç–∞–º.
- –ü—Ä–∏–º–µ—Ä: –ö–ª–∏–µ–Ω—Ç —Å—Ç—É—á–∏—Ç—Å—è: 7000 ‚Üí 8000 ‚Üí 9000  ‚Üí —Å–µ—Ä–≤–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç 22 –Ω–∞ 30 —Å–µ–∫—É–Ω–¥

üì¶ –ß—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è
-	‚Ä¢	Linux-—Å–µ—Ä–≤–µ—Ä
-	‚Ä¢	iptables –∏–ª–∏ nftables
-	‚Ä¢	knockd (–¥–µ–º–æ–Ω port knocking)
- ## 1.	
- **root@inetRouter:~# iptables -nvL** # —á–∏—Å—Ç–æ, –Ω—É –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∏–º –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã (nat,raw..)
```bash
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
```
- **root@inetRouter:~# iptables -A INPUT -i lo -j ACCEPT** # —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É–µ–º –≤—Ö–æ–¥–Ω–æ–π —Ç—Ä–∞—Ñ—Ñ–∏–∫, —Ä–∞–∑—Ä–µ—à–∏–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ 
- **root@inetRouter:~# iptables -nvL** # –ø—Ä–æ–≤–µ—Ä–∏–º
```bash
Chain INPUT (policy ACCEPT 476 packets, 33958 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 ACCEPT     0    --  lo     *       0.0.0.0/0            0.0.0.0/0

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
```

- **root@inetRouter:~# iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT** # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –ø–∞–∫–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∑–∞–ø—Ä–æ—Å–∏–ª–∏
- **root@inetRouter:~# sudo apt update**
- **root@inetRouter:~# sudo apt install knockd** # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ knockd
- **root@inetRouter:~# cat /etc/knockd.conf** # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª knockd
```bash
[options]
    logfile = /var/log/knockd.log

[openSSH]
    sequence    = 7000,8000,9000
    seq_timeout = 10
    command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
    timeout     = 30

[closeSSH]
    sequence    = 9000,8000,7000
    command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
```
-**root@inetRouter:~# ip -br a** # –∏–º–µ–Ω–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
```bash
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens192           UP             10.0.77.182/24 metric 100 fe80::250:56ff:feb3:8745/64
```
- **oot@inetRouter:~# cat /etc/default/knockd** # –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º knock –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–º–æ—Ç—Ä—è—â–∏–π –≤ —Å–µ—Ç—å –æ—Ç–∫—É–¥–∞ –±—É–¥–µ–º –∑–∞—Ö–æ–¥–∏—Ç—å
```bash 
# control if we start knockd at init or not
# 1 = start
# anything else = don't start
# PLEASE EDIT /etc/knockd.conf BEFORE ENABLING
START_KNOCKD=1

# command line options
KNOCKD_OPTS="-i ens192"
```
- **root@inetRouter:~# systemctl start knockd** #
- **root@inetRouter:~# systemctl status knockd** #
- **root@centralRouter:~# apt install knockd** #
- **root@inetRouter:~# iptables -nvL --line**
```bash
Chain INPUT (policy ACCEPT 4 packets, 1104 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        4   444 ACCEPT     0    --  lo     *       0.0.0.0/0            0.0.0.0/0
2        0     0 ACCEPT     1    --  *      *       0.0.0.0/0            0.0.0.0/0
3    64936 4665K ACCEPT     0    --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 35458 packets, 3311K bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        4   444 ACCEPT     0    --  *      lo      0.0.0.0/0            0.0.0.0/0
2       12   576 ACCEPT     1    --  *      *       0.0.0.0/0            0.0.0.0/0 
```
- **root@inetRouter:~# iptables -P INPUT DROP** # –º–µ–Ω—è–µ–º –ø–æ–ª–∏—Ç–∏–∫—É INPUT –Ω–∞ DROP
- **root@inetRouter:~# iptables-save** # —Å–æ—Ö—Ä–∞–Ω—è–µ–º–∏ –≤–∏–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```bash
# Generated by iptables-save v1.8.10 (nf_tables) on Fri Dec 26 12:45:42 2025
*filter
:INPUT DROP [12:2873]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [36489:3403498]
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -p icmp -j ACCEPT
COMMIT
# Completed on Fri Dec 26 12:45:42 2025
```
- **root@centralRouter:~# ssh spg@10.0.77.182** # –æ—Ç–≤–µ—Ç–∞ –ù–ï–¢ (DROP)
- ^C
- **root@centralRouter:~# knock 10.0.77.182 7000 8000 9000** #  –ø–µ—Ä–µ–¥–∞–µ–º —á–µ—Ä–µ–∑ knock –∫–æ–¥–æ–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **root@centralRouter:~# ssh spg@10.0.77.182** # –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç –Ω–∞ –≤—Ä–µ–º—è —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ knock, –∑–∞–∫—Ä—ã—Ç—å –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–π –ø–æ—Å–ª. —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–∞–º –∂–µ
```bash
spg@10.0.77.182's password:
Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-90-generic x86_64
...
Last login: Fri Dec 26 12:27:42 2025 from 10.0.77.13
spg@inetRouter:~$
```
- **root@inetRouter:~# iptables -nvL --line**
```bash
Chain INPUT (policy DROP 151 packets, 30269 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1       23  5208 ACCEPT     6    --  *      *       10.0.77.186          0.0.0.0/0            tcp dpt:22
2        4   444 ACCEPT     0    --  lo     *       0.0.0.0/0            0.0.0.0/0
3        0     0 ACCEPT     1    --  *      *       0.0.0.0/0            0.0.0.0/0
4    67559 4849K ACCEPT     0    --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
```
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã port knocking
	‚Ä¢	–ù–µ —à–∏—Ñ—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫
	‚Ä¢	–í–æ–∑–º–æ–∂–Ω—ã replay-–∞—Ç–∞–∫–∏
	‚Ä¢	–ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞ NAT (–≤ —Ä–µ–¥–∫–∏—Ö —Å–ª—É—á–∞—è—Ö)

- ## 2.
- **root@inetRouter2:/etc# cat /etc/netplan/50-cloud-init.yaml** # —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ inetRouter2
```bash
network:
  version: 2
  ethernets:
    ens192:
      dhcp4: no
      addresses:
        - 10.0.77.182/24
      routes:
        - to: default
          via: 10.0.77.1
      nameservers:
        addresses: [10.0.1.167, 10.0.1.194]

    ens224:
      dhcp4: no
      addresses:
        - 192.168.0.1/28
```  
- **root@inetRouter2:/etc# iptables -nvL** # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–∏—Å—Ç–∞, Firewall-–∞ —Ç–æ–∂–µ –Ω–µ—Ç (systemctl status ufw)
```bash
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
```
- **root@inetRouter2:/etc# cat /etc/sysctl.conf** # —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞ 
```bash
# Uncomment the next line to enable packet forwarding for IPv4
net.ipv4.ip_forward=1
```
- **root@inetRouter2:/etc# sudo sysctl -p** # –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ /etc/sysctl.conf –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö —Å—Ä–∞–∑—É, –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- net.ipv4.ip_forward = 1
- **root@inetRouter2:/etc# cat /proc/sys/net/ipv4/ip_forward** # –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥–∞
- 1

- **root@CentralServer:~# cat /etc/netplan/00-installer-config.yaml** # —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ CentralServer
```bash
network:
  version: 2
  ethernets:
    ens192:
      dhcp4: no
      addresses:
        - 192.168.0.2/28
      routes:
        - to: default
          via: 192.168.0.1
      nameservers:
        addresses: [192.168.0.1, 8.8.8.8]
```
- **root@CentralServer:~# netplan generate** # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **root@CentralServer:~# netplan apply** # –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **root@CentralServer:~# ping ya.ru** # –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—É–¥–∞—á–Ω–∞—è
ping: ya.ru: Temporary failure in name resolution
- **oot@CentralServer:~# ping 8.8.8.8** # –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—É–¥–∞—á–Ω–∞—è
ping: connect: Network is unreachable
- **root@CentralServer:~# ping 192.168.0.1** # —Å–≤—è–∑—å —Å —Ä–æ—É—Ç–µ—Ä–æ–º –µ—Å—Ç—å
```bash
PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data.
64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=0.059 ms
64 bytes from 192.168.0.1: icmp_seq=2 ttl=64 time=0.052 ms
```
- **root@inetRouter2:/etc# sudo iptables -t nat -A PREROUTING -p tcp --dport 9022 -j DNAT --to 192.168.0.2:22** # –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ —Ä–æ—É—Ç–µ—Ä–∞ (9022)  –Ω–∞ –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (22)
- **~ ssh -p 9022 spg@10.0.77.182** # –ü–æ–∫–∞ –Ω–µ –º–æ–∂–µ–º –ø–æ–¥–∫–ª—é—á—Ç—å—Å—è
```bash
ssh: connect to host 10.0.77.182 port 9022: Operation timed out
```
- **root@inetRouter2:/etc# iptables -t nat -A POSTROUTING -o ens224 -j MASQUERADE** # –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º NAT
- **root@inetRouter2:/etc# sudo iptables -A FORWARD -i ens224 -o ens192 -j ACCEPT** # –∫–æ–º–∞–Ω–¥–∞ –Ω—É–∂–Ω–∞ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏–∑ LAN –≤ WAN
- **root@inetRouter2:/etc# sudo iptables -A FORWARD -i ens192 -o ens224 -m state --state RELATED,ESTABLISHED -j ACCEPT** # –†–∞–∑—Ä–µ—à–∞–µ—Ç –ø–∞–∫–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º (–æ—Ç–≤–µ—Ç—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
- **~ssh -p 9022 spg@10.0.77.182** # –£–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ö–æ—Å—Ç–æ–≤–æ–π –º–∞—à–∏–Ω—ã –ø–æ ssh —Å —Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä (9022)
```bash
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[10.0.77.182]:9022' (ED25519) to the list of known hosts.
spg@10.0.77.182's password:
```
- **root@CentralServer:~# ping ya.ru** # # –∏ —Ç—Ä–∞—Ñ–∏–∫ –ø–æ—à–µ–ª –Ω–∞—Ä—É–∂—É
```bash
PING ya.ru (77.88.44.242) 56(84) bytes of data.
64 bytes from ya.ru (77.88.44.242): icmp_seq=1 ttl=56 time=3.60 ms
64 bytes from ya.ru (77.88.44.242): icmp_seq=2 ttl=56 time=3.34 ms
```
- **root@CentralServer:~# sudo apt update** #
- **sudo apt install -y nginx** #
- **root@CentralServer:~# sudo systemctl status nginx**
```bash
‚óè nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: enabled)
     Active: active (running) since Mon 2025-12-29 12:42:28 UTC; 9s ago
```
- **root@CentralServer:~# cat /var/www/html/index.nginx-debian.html** # –î–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏–º –∫–æ—Ä–Ω–µ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É –Ω–∞ "Welcome to CentralServer"
```bash
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CentralServer</title>
</head>
<body>
    <h1>Welcome to CentralServer</h1>
</body>
</html>
```
- **root@inetRouter2:/etc# sudo iptables -t nat -A PREROUTING -p tcp --dport 8080 -j DNAT --to 192.168.0.2:80** # –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ —Ä–æ—É—Ç–µ—Ä–∞ (8080)  –Ω–∞ –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (80)
- **root@inetRouter2:/etc# iptables-save** # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é iptables
```bash
# Generated by iptables-save v1.8.10 (nf_tables) on Mon Dec 29 12:46:20 2025
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [1:64]
:OUTPUT ACCEPT [0:0]
-A FORWARD -i ens224 -o ens192 -j ACCEPT
-A FORWARD -i ens192 -o ens224 -m state --state RELATED,ESTABLISHED -j ACCEPT
COMMIT
# Completed on Mon Dec 29 12:46:20 2025
# Generated by iptables-save v1.8.10 (nf_tables) on Mon Dec 29 12:46:20 2025
*nat
:PREROUTING ACCEPT [5666:1202021]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [72:9196]
-A PREROUTING -p tcp -m tcp --dport 9022 -j DNAT --to-destination 192.168.0.2:22
-A PREROUTING -p tcp -m tcp --dport 8080 -j DNAT --to-destination 192.168.0.2:80
-A POSTROUTING -o ens192 -j MASQUERADE
COMMIT
# Completed on Mon Dec 29 12:46:20 2025
```
### –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ (8080 -> 80) —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ inetRouter2
<img width="1091" height="228" alt="Screenshot 2025-12-29 at 15 48 44" src="https://github.com/user-attachments/assets/380f0197-cad0-43db-bf6b-9b1a808acc2f" />

## 33 —É—Ä–æ–∫ 
## –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, OSPF

**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"OSPF"</ins>

**–¶–µ–ª—å**: –æ—Ç–ª–∏—á–∞—Ç—å unicast, broadcast –∏ multicast;
–ø–æ–Ω—è—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ OSPF;
–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥ –Ω–∞ —Ö–æ—Å—Ç–µ —Å –ø–æ–º–æ—â—å—é FRR;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
- **–°–æ–∑–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Å–µ—Ç–µ–≤—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é. –ù–∞—É—á–∏—Ç—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª OSPF –≤ Linux-based —Å–∏—Å—Ç–µ–º–∞—Ö.**
- 1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å 3 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
- 2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏—Ö —Ä–∞–∑–Ω—ã–º–∏ vlan
- –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å OSPF –º–µ–∂–¥—É –º–∞—à–∏–Ω–∞–º–∏ –Ω–∞ –±–∞–∑–µ FRR;
- –∏–∑–æ–±—Ä–∞–∑–∏—Ç—å –∞—Å—Å–∏–º–µ—Ç—Ä–∏—á–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥;
- —Å–¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –ª–∏–Ω–∫–æ–≤ "–¥–æ—Ä–æ–≥–∏–º", –Ω–æ —á—Ç–æ –±—ã –ø—Ä–∏ —ç—Ç–æ–º —Ä–æ—É—Ç–∏–Ω–≥ –±—ã–ª —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–º.
- **–†–∞–∑–≤–µ—Ä–Ω–µ–º —Ç—Ä–∏ –º–∞—à–∏–Ω—ã linux c OC Ubuntu 24.04 c 3-–º—è —Å–µ—Ç–µ–≤—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏**
<img width="888" height="663" alt="Screenshot 2026-01-21 at 09 03 10" src="https://github.com/user-attachments/assets/e8745723-6571-4d4b-90f4-b6c480462820" />

- **Router1 DZ33**
- **root@router1:~# cat /etc/netplan/50-cloud-init.yaml**
```bash
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 192.168.10.1/24

    ens224:
      dhcp4: no
      addresses:
        - 10.0.10.1/30

    ens256:
      dhcp4: no
      addresses:
        - 10.0.12.1/30
```
- **Router2 DZ33**
- **root@router2:~# cat /etc/netplan/50-cloud-init.yaml**
```bash
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 192.168.20.1/24

    ens224:
      dhcp4: no
      addresses:
        - 10.0.10.2/30

    ens256:
      dhcp4: no
      addresses:
        - 10.0.11.2/30
```
- **Router3 DZ33**
- **root@router3:~# cat /etc/netplan/50-cloud-init.yaml**
```bash
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: no
      addresses:
        - 192.168.30.1/24

    ens224:
      dhcp4: no
      addresses:
        - 10.0.12.2/30

    ens256:
      dhcp4: no
      addresses:
        - 10.0.11.1/30
```
- **–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏  –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OSPF –Ω–∞ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö –¥–æ–±–∞–≤–∏–ª –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–º–æ—Ç—Ä—è—â–∏–π –≤ –ò–Ω–µ—Ç**

- **–ü–æ—Å—Ç–∞–≤–∏–ª –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (vim) –∏ –∏–∑—É—á–µ–Ω–∏—è —Å–µ—Ç–∏ (traceroute, tcpdump, net-tools):**
- **root@router123# apt update**
- **root@router123# apt install vim traceroute tcpdump net-tools**

- **–£–±—Ä–∞–ª —É –≤—Å–µ—Ö —á–µ—Ç–≤–µ—Ä—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** # ens161
- **root@router123# systemctl stop ufw** 
- **root@router123# systemctl disable ufw** # –æ—Ç–∫–ª—é—á–∏–ª –Ω–∞ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö firewall
- **root@router123# curl -s https://deb.frrouting.org/frr/keys.asc | sudo apt-key add -** #–¥–æ–±–∞–≤–ª—è–µ–º gpg –∫–ª—é—á
- **root@router123# echo deb https://deb.frrouting.org/frr $(lsb_release -s -c) frr-stable > /etc/apt/sources.list.d/frr.list**
- **root@router123# sudo apt update** 
- **root@router123# sudo apt install frr frr-pythontools** # –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º FRR
- **root@router123# sysctl net.ipv4.conf.all.forwarding=1** # –†–∞–∑—Ä–µ—à–∞–µ–º (–≤–∫–ª—é—á–∞–µ–º) –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —Ç—Ä–∞–Ω–∑–∏—Ç–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- **root@router123:~# cat /etc/frr/daemons** # –í–∫–ª—é—á–∞–µ–º –¥–µ–º–æ–Ω ospfd –≤ FRR
```bash
bgpd=no
zebra=yes
ospfd=yes
ospf6d=no
ripd=no
ripngd=no
isisd=no
pimd=no
pim6d=no
ldpd=no
nhrpd=no
eigrpd=no
babeld=no
sharpd=no
pbrd=no
bfdd=no
fabricd=no
vrrpd=no
pathd=no

#
# If this option is set the /etc/init.d/frr script automatically loads
# the config via "vtysh -b" when the servers are started.
# Check /etc/pam.d/frr if you intend to use "vtysh"!
#
vtysh_enable=yes
```

- ###–ù–∞—Å—Ç—Ä–æ–π–∫–∞ OSPF
- **–£–∑–Ω–∞—Ç—å –∏–º–µ–Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –∏—Ö –∞–¥—Ä–µ—Å–∞**
- **root@router1:~# ip -br a**
```bash
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens192           UP             192.168.10.1/24 fe80::250:56ff:feb3:7658/64
ens224           UP             10.0.10.1/30 fe80::250:56ff:feb3:a17f/64
ens256           UP             10.0.12.1/30 fe80::250:56ff:feb3:8cca/64
```
**root@router1:~# ip a | grep "inet"** 
```bash
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host noprefixroute
    inet 192.168.10.1/24 brd 192.168.10.255 scope global ens192
    inet6 fe80::250:56ff:feb3:7658/64 scope link
    inet 10.0.10.1/30 brd 10.0.10.3 scope global ens224
    inet6 fe80::250:56ff:feb3:a17f/64 scope link
    inet 10.0.12.1/30 brd 10.0.12.3 scope global ens256
    inet6 fe80::250:56ff:feb3:8cca/64 scope link
```
- **–ò–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ FRR**
- **root@router1:~# vtysh**
```bash
Hello, this is FRRouting (version 10.5.1).
Copyright 1996-2005 Kunihiro Ishiguro, et al.
```
- **router1# show interface brief**
```bash
Interface       Status  VRF             Addresses
---------       ------  ---             ---------
ens192          up      default         192.168.10.1/24
                                        fe80::250:56ff:feb3:7658/64
ens224          up      default         10.0.10.1/30
                                        fe80::250:56ff:feb3:a17f/64
ens256          up      default         10.0.12.1/30
                                        fe80::250:56ff:feb3:8cca/64
lo              up      default
```
- **router1# exit** # –≤—ã—Ö–æ–¥–∏–º
- **root@router1:~#**
- 
- **root@router1:~# cat /etc/frr/frr.conf** # –ü—Ä–∞–≤–∏–º –∫–æ–Ω—Ñ–∏–≥ frr
```bash
# default to using syslog. /etc/rsyslog.d/45-frr.conf places the log in
# /var/log/frr/frr.log
#
# Note:
# FRR's configuration shell, vtysh, dynamically edits the live, in-memory
# configuration while FRR is running. When instructed, vtysh will persist the
# live configuration to this file, overwriting its contents. If you want to
# avoid this, you can edit this file manually before starting FRR, or instruct
# vtysh to write configuration to a different file.
!–£–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ FRR
frr version 10.5.1
frr defaults traditional
!–£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –º–∞—à–∏–Ω—ã
hostname router1
log syslog informational
no ipv6 forwarding
service integrated-vtysh-config
!
!–î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ enp0s8
interface ens224
 !–£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 description r1-r2
 !–£–∫–∞–∑—ã–≤–∞–µ–º ip-a–¥—Ä–µ—Å –∏ –º–∞—Å–∫—É (—ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –º—ã –ø–æ–ª—É—á–∏–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–º —à–∞–≥–µ)
 ip address 10.0.10.1/30
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è MTU
 ip ospf mtu-ignore
 !–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å ¬´—Å—Ç–æ–∏–º–æ—Å—Ç—å¬ª –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 !ip ospf cost 1000
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã hello-–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è OSPF –ø–∞–∫–µ—Ç–æ–≤
 ip ospf hello-interval 10
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã dead-–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è OSPF –ø–∞–∫–µ—Ç–æ–≤
 !–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
 ip ospf dead-interval 30
!
interface ens256
 description r1-r3
 ip address 10.0.12.1/30
 ip ospf mtu-ignore
 !ip ospf cost 45
 ip ospf hello-interval 10
 ip ospf dead-interval 30

interface ens192
 description net_router1
 ip address 192.168.10.1/24
 ip ospf mtu-ignore
 !ip ospf cost 45
 ip ospf hello-interval 10
 ip ospf dead-interval 30
!
!–ù–∞—á–∞–ª–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OSPF
router ospf
 !–£–∫–∞–∑—ã–≤–∞–µ–º router-id
 router-id 1.1.1.1
 !–£–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏–º –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å–µ–¥–Ω–∏–º —Ä–æ—É—Ç–µ—Ä–∞–º
 network 10.0.10.0/30 area 0
 network 10.0.12.0/30 area 0
 network 192.168.10.0/24 area 0
 !–£–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
 neighbor 10.0.10.2
 neighbor 10.0.12.2

!–£–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å log-—Ñ–∞–π–ª–∞
log file /var/log/frr/frr.log
default-information originate always

log syslog informational
```
- **root@router2:~# cat /etc/frr/frr.conf** # –ü—Ä–∞–≤–∏–º –∫–æ–Ω—Ñ–∏–≥ frr
```bash
# default to using syslog. /etc/rsyslog.d/45-frr.conf places the log in
# /var/log/frr/frr.log
#
# Note:
# FRR's configuration shell, vtysh, dynamically edits the live, in-memory
# configuration while FRR is running. When instructed, vtysh will persist the
# live configuration to this file, overwriting its contents. If you want to
# avoid this, you can edit this file manually before starting FRR, or instruct
# vtysh to write configuration to a different file.
!–£–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ FRR
frr version 10.5.1
frr defaults traditional
!–£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –º–∞—à–∏–Ω—ã
hostname router2
log syslog informational
no ipv6 forwarding
service integrated-vtysh-config
!
!–î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ enp0s8
interface ens224
 !–£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 description r2-r1
 !–£–∫–∞–∑—ã–≤–∞–µ–º ip-a–¥—Ä–µ—Å –∏ –º–∞—Å–∫—É (—ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –º—ã –ø–æ–ª—É—á–∏–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–º —à–∞–≥–µ)
 ip address 10.0.10.2/30
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è MTU
 ip ospf mtu-ignore
 !–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å ¬´—Å—Ç–æ–∏–º–æ—Å—Ç—å¬ª –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 !ip ospf cost 1000
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã hello-–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è OSPF –ø–∞–∫–µ—Ç–æ–≤
 ip ospf hello-interval 10
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã dead-–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è OSPF –ø–∞–∫–µ—Ç–æ–≤
 !–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
 ip ospf dead-interval 30
!
interface ens256
 description r2-r3
 ip address 10.0.11.2/30
 ip ospf mtu-ignore
 !ip ospf cost 45
 ip ospf hello-interval 10
 ip ospf dead-interval 30

interface ens192
 description net_router2
 ip address 192.168.20.1/24
 ip ospf mtu-ignore
 !ip ospf cost 45
 ip ospf hello-interval 10
 ip ospf dead-interval 30
!
!–ù–∞—á–∞–ª–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OSPF
router ospf
 !–£–∫–∞–∑—ã–≤–∞–µ–º router-id
 router-id 2.2.2.2
 !–£–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏–º –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å–µ–¥–Ω–∏–º —Ä–æ—É—Ç–µ—Ä–∞–º
 network 10.0.10.0/30 area 0
 network 10.0.11.0/30 area 0
 network 192.168.20.0/24 area 0
 !–£–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
 neighbor 10.0.10.1
 neighbor 10.0.11.1

!–£–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å log-—Ñ–∞–π–ª–∞
log file /var/log/frr/frr.log
default-information originate always

log syslog informational
```
- **root@router3:~# cat /etc/frr/frr.conf** # –ü—Ä–∞–≤–∏–º –∫–æ–Ω—Ñ–∏–≥ frr
```bash
# default to using syslog. /etc/rsyslog.d/45-frr.conf places the log in
# /var/log/frr/frr.log
#
# Note:
# FRR's configuration shell, vtysh, dynamically edits the live, in-memory
# configuration while FRR is running. When instructed, vtysh will persist the
# live configuration to this file, overwriting its contents. If you want to
# avoid this, you can edit this file manually before starting FRR, or instruct
# vtysh to write configuration to a different file.
!–£–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ FRR
frr version 10.5.1
frr defaults traditional
!–£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –º–∞—à–∏–Ω—ã
hostname router3
log syslog informational
no ipv6 forwarding
service integrated-vtysh-config
!
!–î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ enp0s8
interface ens224
 !–£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 description r3-r1
 !–£–∫–∞–∑—ã–≤–∞–µ–º ip-a–¥—Ä–µ—Å –∏ –º–∞—Å–∫—É (—ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –º—ã –ø–æ–ª—É—á–∏–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–º —à–∞–≥–µ)
 ip address 10.0.12.2/30
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è MTU
 ip ospf mtu-ignore
 !–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å ¬´—Å—Ç–æ–∏–º–æ—Å—Ç—å¬ª –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 !ip ospf cost 1000
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã hello-–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è OSPF –ø–∞–∫–µ—Ç–æ–≤
 ip ospf hello-interval 10
 !–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã dead-–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è OSPF –ø–∞–∫–µ—Ç–æ–≤
 !–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
 ip ospf dead-interval 30
!
interface ens256
 description r3-r2
 ip address 10.0.11.1/30
 ip ospf mtu-ignore
 !ip ospf cost 45
 ip ospf hello-interval 10
 ip ospf dead-interval 30

interface ens192
 description net_router3
 ip address 192.168.30.1/24
 ip ospf mtu-ignore
 !ip ospf cost 45
 ip ospf hello-interval 10
 ip ospf dead-interval 30
!
!–ù–∞—á–∞–ª–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OSPF
router ospf
 !–£–∫–∞–∑—ã–≤–∞–µ–º router-id
 router-id 3.3.3.3
 !–£–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏–º –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å–µ–¥–Ω–∏–º —Ä–æ—É—Ç–µ—Ä–∞–º
 network 10.0.12.0/30 area 0
 network 10.0.11.0/30 area 0
 network 192.168.30.0/24 area 0
 !–£–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
 neighbor 10.0.12.1
 neighbor 10.0.11.2

!–£–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å log-—Ñ–∞–π–ª–∞
log file /var/log/frr/frr.log
default-information originate always

log syslog informational
```
- **root@router123:~# ls -l /etc/frr** # –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
```bash
total 28
-rw-r----- 1 frr frr 4138 Jan 16 13:36 daemons
-rw-r----- 1 frr frr 2389 Jan 20 11:09 frr.conf
-rw-r----- 1 frr frr 8667 Jan  6 14:40 support_bundle_commands.conf
-rw-r----- 1 frr frr   32 Jan  6 14:40 vtysh.conf
```

- **root@router123:~# systemctl restart frr** # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º FRR –∏ 
- **root@router123:~# systemctl enable  frr** # –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É
- **root@router123:~# systemctl status  frr** # –ø—Ä–æ–≤–µ—Ä—è–µ–º
```bash
‚óè frr.service - FRRouting
     Loaded: loaded (/usr/lib/systemd/system/frr.service; enabled; preset: enabled)
     Active: active (running) since Mon 2026-01-19 13:22:19 UTC; 6min ago
```
### –ü—Ä–æ–≤–µ—Ä–∏–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç...

```bash
root@router1:~# ping 192.168.10.1
PING 192.168.10.1 (192.168.10.1) 56(84) bytes of data.
64 bytes from 192.168.10.1: icmp_seq=1 ttl=64 time=0.017 ms
64 bytes from 192.168.10.1: icmp_seq=2 ttl=64 time=0.015 ms
^C
--- 192.168.10.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1048ms
rtt min/avg/max/mdev = 0.015/0.016/0.017/0.001 ms
root@router1:~# ping 192.168.20.1
PING 192.168.20.1 (192.168.20.1) 56(84) bytes of data.
64 bytes from 192.168.20.1: icmp_seq=1 ttl=64 time=0.080 ms
^C
--- 192.168.20.1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.080/0.080/0.080/0.000 ms
root@router1:~# ping 192.168.30.1
PING 192.168.30.1 (192.168.30.1) 56(84) bytes of data.
64 bytes from 192.168.30.1: icmp_seq=1 ttl=64 time=0.099 ms
64 bytes from 192.168.30.1: icmp_seq=2 ttl=64 time=0.105 ms
^C
--- 192.168.30.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1042ms
rtt min/avg/max/mdev = 0.099/0.102/0.105/0.003 ms
```
```bash
root@router2:~# ping 192.168.10.1
PING 192.168.10.1 (192.168.10.1) 56(84) bytes of data.
64 bytes from 192.168.10.1: icmp_seq=1 ttl=64 time=0.093 ms
^C
--- 192.168.10.1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.093/0.093/0.093/0.000 ms
root@router2:~# ping 192.168.20.1
PING 192.168.20.1 (192.168.20.1) 56(84) bytes of data.
64 bytes from 192.168.20.1: icmp_seq=1 ttl=64 time=0.013 ms
64 bytes from 192.168.20.1: icmp_seq=2 ttl=64 time=0.012 ms
^C
--- 192.168.20.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1006ms
rtt min/avg/max/mdev = 0.012/0.012/0.013/0.000 ms
root@router2:~# ping 192.168.30.1
PING 192.168.30.1 (192.168.30.1) 56(84) bytes of data.
64 bytes from 192.168.30.1: icmp_seq=1 ttl=64 time=0.111 ms
^C
--- 192.168.30.1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.111/0.111/0.111/0.000 ms
```
```bash
root@router3:~# ping 192.168.30.1
PING 192.168.30.1 (192.168.30.1) 56(84) bytes of data.
64 bytes from 192.168.30.1: icmp_seq=1 ttl=64 time=0.016 ms
64 bytes from 192.168.30.1: icmp_seq=2 ttl=64 time=0.020 ms
^C
--- 192.168.30.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1037ms
rtt min/avg/max/mdev = 0.016/0.018/0.020/0.002 ms
root@router3:~# ping 192.168.20.1
PING 192.168.20.1 (192.168.20.1) 56(84) bytes of data.
64 bytes from 192.168.20.1: icmp_seq=1 ttl=64 time=0.076 ms
64 bytes from 192.168.20.1: icmp_seq=2 ttl=64 time=0.085 ms
^C
--- 192.168.20.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1006ms
rtt min/avg/max/mdev = 0.076/0.080/0.085/0.004 ms
root@router3:~# ping 192.168.10.1
PING 192.168.10.1 (192.168.10.1) 56(84) bytes of data.
64 bytes from 192.168.10.1: icmp_seq=1 ttl=64 time=0.094 ms
64 bytes from 192.168.10.1: icmp_seq=2 ttl=64 time=0.089 ms
^C
--- 192.168.10.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1038ms
rtt min/avg/max/mdev = 0.089/0.091/0.094/0.002 ms
```
- **root@router1:~# traceroute  192.168.30.1** # —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å —Ä–æ—É—Ç–µ—Ä–∞1 –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å —Ä–æ—É—Ç–µ—Ä–∞3
```bash
traceroute to 192.168.30.1 (192.168.30.1), 30 hops max, 60 byte packets
 1  192.168.30.1 (192.168.30.1)  0.096 ms  0.093 ms  0.079 ms
```
- **root@router1:~# vtysh**
- **router1# sh ip route ospf** # –ø–æ—Å–º–æ—Ç—Ä–∏–º –º–∞—Ä—à—Ä—É—Ç—ã OSPF
```bash
Codes: K - kernel route, C - connected, L - local, S - static,
       R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric, t - Table-Direct,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

IPv4 unicast VRF default:
O   10.0.10.0/30 [110/10] is directly connected, ens224, weight 1, 00:26:58
O>* 10.0.11.0/30 [110/20] via 10.0.10.2, ens224, weight 1, 00:24:38
  *                       via 10.0.12.2, ens256, weight 1, 00:24:38
O   10.0.12.0/30 [110/10] is directly connected, ens256, weight 1, 00:24:49
O   192.168.10.0/24 [110/10] is directly connected, ens192, weight 1, 00:27:29
O>* 192.168.20.0/24 [110/20] via 10.0.10.2, ens224, weight 1, 00:26:56
O>* 192.168.30.0/24 [110/20] via 10.0.12.2, ens256, weight 1, 00:24:38
```
- **root@router1:~# ifconfig ens256 down** # –≤—ã–∫–ª—é—á–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ1 —Å–º–æ—Ç—Ä—è—â–∏–π –Ω–∞ —Ä–æ—É—Ç–µ—Ä3
-  ### –∏ –ø–æ–≤—Ç–æ—Ä–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ —Ä–æ—É—Ç–µ—Ä–∞ 3
```bash
root@router1:~# ping 192.168.30.1
PING 192.168.30.1 (192.168.30.1) 56(84) bytes of data.
64 bytes from 192.168.30.1: icmp_seq=1 ttl=63 time=0.168 ms
64 bytes from 192.168.30.1: icmp_seq=2 ttl=63 time=0.151 ms
^C
--- 192.168.30.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1058ms
rtt min/avg/max/mdev = 0.151/0.159/0.168/0.008 ms
root@router1:~# traceroute 192.168.30.1
traceroute to 192.168.30.1 (192.168.30.1), 30 hops max, 60 byte packets
 1  10.0.10.2 (10.0.10.2)  0.098 ms  0.072 ms  0.065 ms
 2  192.168.30.1 (192.168.30.1)  0.149 ms  0.159 ms  0.146 ms
root@router1:~# vtysh

Hello, this is FRRouting (version 10.5.1).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

router1# sh ip route ospf
Codes: K - kernel route, C - connected, L - local, S - static,
       R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric, t - Table-Direct,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

IPv4 unicast VRF default:
O   10.0.10.0/30 [110/10] is directly connected, ens224, weight 1, 00:35:11
O>* 10.0.11.0/30 [110/20] via 10.0.10.2, ens224, weight 1, 00:03:32
                          via 10.0.12.2, ens256 inactive, weight 1, 00:03:32
O>* 10.0.12.0/30 [110/30] via 10.0.10.2, ens224, weight 1, 00:03:12
O   192.168.10.0/24 [110/10] is directly connected, ens192, weight 1, 00:35:42
O>* 192.168.20.0/24 [110/20] via 10.0.10.2, ens224, weight 1, 00:35:09
O>* 192.168.30.0/24 [110/30] via 10.0.10.2, ens224, weight 1, 00:03:32
```
- **root@router1:~# ifconfig ens256 up**

  
- ## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Å—Å–∏–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞
- **root@router123:~# sysctl net.ipv4.conf.all.rp_filter=0** # –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Å—Å–∏–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞ –æ—Ç–∫–ª—é—á–∞–µ–º rp_filter ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç IP-spoofing
- net.ipv4.conf.all.rp_filter = 0
- ### –ø–æ–º–µ–Ω—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ens224 –Ω–∞ router1
```bash
root@router1:~# vtysh

Hello, this is FRRouting (version 10.5.1).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

router1# conf t
router1(config)# int ens224
router1(config-if)# ip ospf cost 1000
router1(config-if)# exit
router1(config)# exit
router1# sh ip route ospf
Codes: K - kernel route, C - connected, L - local, S - static,
       R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric, t - Table-Direct,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

IPv4 unicast VRF default:
O   10.0.10.0/30 [110/30] via 10.0.12.2, ens256, weight 1, 00:01:08
O>* 10.0.11.0/30 [110/20] via 10.0.12.2, ens256, weight 1, 00:01:08
O   10.0.12.0/30 [110/10] is directly connected, ens256, weight 1, 1d16h58m
O   192.168.10.0/24 [110/10] is directly connected, ens192, weight 1, 1d17h39m
O>* 192.168.20.0/24 [110/30] via 10.0.12.2, ens256, weight 1, 00:01:08
O>* 192.168.30.0/24 [110/20] via 10.0.12.2, ens256, weight 1, 1d16h58m
```
```bash
root@router2:~# vtysh

Hello, this is FRRouting (version 10.5.1).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

router2# show ip route ospf
Codes: K - kernel route, C - connected, L - local, S - static,
       R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric, t - Table-Direct,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

IPv4 unicast VRF default:
O   10.0.10.0/30 [110/10] is directly connected, ens224, weight 1, 1d17h43m
O   10.0.11.0/30 [110/10] is directly connected, ens256, weight 1, 1d17h40m
O>* 10.0.12.0/30 [110/20] via 10.0.10.1, ens224, weight 1, 1d17h02m
  *                       via 10.0.11.1, ens256, weight 1, 1d17h02m
O>* 192.168.10.0/24 [110/20] via 10.0.10.1, ens224, weight 1, 1d17h42m
O   192.168.20.0/24 [110/10] is directly connected, ens192, weight 1, 1d17h43m
O>* 192.168.30.0/24 [110/20] via 10.0.11.1, ens256, weight 1, 1d17h40m
```
- ### –í–∏–¥–∏–º, —á—Ç–æ –º–∞—Ä—à—Ä—É—Ç –æ—Ç Router1 –¥–æ —Å–µ—Ç–∏ 192.168.20.0/24 —Ç–µ–ø–µ—Ä—å –ø–æ–π–¥–µ—Ç —á–µ—Ä–µ–∑ Router3 (via 10.0.12.2, ens256), –Ω–æ –º–∞—Ä—à—Ä—É—Ç –æ—Ç Router2 –≤ —Å–µ—Ç—å 192.168.10.0/24 –ø–æ–π–¥–µ—Ç —Å—Ä–∞–∑—É –Ω–∞ Router1 (via 10.0.10.1, ens224)
- **root@router1:~# ping -I 192.168.10.1192.168.20.1** # –∑–∞–ø—É—Å–∫–∞–µ–º ping –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ Router1  –Ω–∞ –∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ Riuter2
```bash
PING 192.168.20.1 (192.168.20.1) from 192.168.10.1 : 56(84) bytes of data.
64 bytes from 192.168.20.1: icmp_seq=1 ttl=64 time=0.114 ms
64 bytes from 192.168.20.1: icmp_seq=2 ttl=64 time=0.116 ms
...
```
- **root@router2:~# tcpdump -i ens256** # –í–∏–¥–∏–º, —á—Ç–æ –ø–∞–∫–µ—Ç—ã ICMP –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Router2 —Å–º–æ—Ç—Ä—è—â–µ–≥–æ –Ω–∞ Router3 (—Ç–æ –µ—Å—Ç—å –ø–æ –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–º—É, –Ω–æ –º–µ–Ω–µ–µ –¥–æ—Ä–æ–≥–æ–º—É –¥–ª—è Router1 –º–∞—Ä—à—Ä—É—Ç—É)
```bash
...
06:42:20.094800 IP 192.168.10.1 > router2: ICMP echo request, id 18317, seq 44, length 64
06:42:21.118789 IP 192.168.10.1 > router2: ICMP echo request, id 18317, seq 45, length 64
06:42:22.142742 IP 192.168.10.1 > router2: ICMP echo request, id 18317, seq 46, length 64
```
- **root@router2:~# tcpdump -i ens224** # –í–∏–¥–∏–º, —á—Ç–æ  –æ—Ç–≤–µ—Ç–Ω—ã–µ –ø–∞–∫–µ—Ç—ã ICMP –≤—ã—Ö–æ–¥—è—Ç —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Router2 —Å–º–æ—Ç—Ä—è—â–µ–≥–æ –Ω–∞ Router1 (—Ç–æ –µ—Å—Ç—å –ø–æ –∫—Ä–∞—Ç—á–∞–π—à–µ–º—É –¥–æ Router1 –º–∞—Ä—à—Ä—É—Ç—É)
```bash
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on ens224, link-type EN10MB (Ethernet), snapshot length 262144 bytes
06:41:44.255895 IP router2 > 192.168.10.1: ICMP echo reply, id 18317, seq 9, length 64
```

- ## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–º–º–µ—Ç–∏—á–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞
- ### –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å–∏–º–∏—Ç—Ä–∏—á–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥ –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, —Å–¥–µ–ª–∞–µ–º –æ—Ç–≤–µ—Ç–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç Router2 -> Router1  –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—É–Ω–∫—Ç–∞ –¥–æ—Ä–æ–≥–∏–º –∏ –∑–∞—Å—Ç–∞–≤–∏–º –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞–∫–µ—Ç–≤ –ø–æ —Ç–æ–º—É –∂–µ –º–∞—Ä—à—Ä—É—Ç—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –æ–Ω –∏—Ö –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç Router1 (—á–µ—Ä–µ–∑ Router3):
```bash
root@router2:~# tvysh
Command 'tvysh' not found, did you mean:
  command 'vtysh' from deb frr (8.4.4-1.1ubuntu6.3)
Try: apt install <deb name>
root@router2:~# vtysh

Hello, this is FRRouting (version 10.5.1).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

router2# conf t
router2(config)# int ens224
router2(config-if)# ip ospf cost 1000
router2(config-if)# exit
router2(config)# exit
router2# show ip route ospf
Codes: K - kernel route, C - connected, L - local, S - static,
       R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric, t - Table-Direct,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

IPv4 unicast VRF default:
O   10.0.10.0/30 [110/1000] is directly connected, ens224, weight 1, 00:00:25
O   10.0.11.0/30 [110/10] is directly connected, ens256, weight 1, 1d21h58m
O>* 10.0.12.0/30 [110/20] via 10.0.11.1, ens256, weight 1, 00:00:25
O>* 192.168.10.0/24 [110/30] via 10.0.11.1, ens256, weight 1, 00:00:25
O   192.168.20.0/24 [110/10] is directly connected, ens192, weight 1, 1d22h00m
O>* 192.168.30.0/24 [110/20] via 10.0.11.1, ens256, weight 1, 1d21h57m
```
### –≤–∏–¥–∏–º, —á—Ç–æ –º–∞—Ä—à—Ä—É—Ç –¥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ Router1 (192.168.10.0/24) —Ç–µ–ø–µ—Ä—å –∏–¥–µ—Ç —á–µ—Ä–µ–∑ Router3 (10.0.1.11)
### –ü—Ä–æ–≤–µ—Ä–∫–∞:
- **root@router1:~# ping -I 192.168.10.1 192.168.20.1**
```bash
PING 192.168.20.1 (192.168.20.1) from 192.168.10.1 : 56(84) bytes of data.
64 bytes from 192.168.20.1: icmp_seq=1 ttl=63 time=0.154 ms
64 bytes from 192.168.20.1: icmp_seq=2 ttl=63 time=0.134 ms
```
- **root@router2:~# tcpdump -i ens256** # –¢–µ–ø–µ—Ä—å –∏ –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –º–∞—Ä—à—Ä—É—Ç
```bash
10:28:17.259046 IP 192.168.10.1 > router2: ICMP echo request, id 20201, seq 24, length 64
10:28:17.259055 IP router2 > 192.168.10.1: ICMP echo reply, id 20201, seq 24, length 64
10:28:18.283037 IP 192.168.10.1 > router2: ICMP echo request, id 20201, seq 25, length 64
10:28:18.283049 IP router2 > 192.168.10.1: ICMP echo reply, id 20201, seq 25, length 64
```
## 33 —É—Ä–æ–∫ 
## –°–µ—Ç–µ–≤—ã–µ –ø–∞–∫–µ—Ç—ã. VLAN'—ã. LACP


**–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ** <ins>"–°—Ç—Ä–æ–∏–º –±–æ–Ω–¥—ã –∏ –≤–ª–∞–Ω—ã"</ins>

**–¶–µ–ª—å**: –ù–∞—É—á–∏—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å VLAN –∏ LACP;

üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
- **–°–æ–∑–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Å–µ—Ç–µ–≤—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é. –ù–∞—É—á–∏—Ç—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª OSPF –≤ Linux-based —Å–∏—Å—Ç–µ–º–∞—Ö.**
- –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
- –≤ Office1 –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –ø–æ–¥—Å–µ—Ç–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–∞ —Å –¥–æ–ø –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ –∏ –∞–¥—Ä–µ—Å–∞–º–∏
–≤ internal —Å–µ—Ç–∏ testLAN:

- testClient1 - 10.10.10.254
- testClient2 - 10.10.10.254
- testServer1- 10.10.10.1
- testServer2- 10.10.10.1
- –†–∞–≤–µ—Å—Ç–∏ –≤–ª–∞–Ω–∞–º–∏:
- testClient1 <-> testServer1
- testClient2 <-> testServer2

- –ú–µ–∂–¥—É centralRouter –∏ inetRouter "–ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å" 2 –ª–∏–Ω–∫–∞ (–æ–±—â–∞—è inernal —Å–µ—Ç—å) –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏—Ö –≤ –±–æ–Ω–¥, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É c –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- ## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –†–∞–∑–≤–µ—Ä–Ω–µ–º –Ω–∞ Vcenter 7 –º–∞—à–∏–Ω:
  <img width="1093" height="497" alt="Screenshot 2026-01-27 at 16 32 29" src="https://github.com/user-attachments/assets/5b508ec9-a222-4b7d-9e52-156575369886" />
- ### –î–∞–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –î–ó:

<img width="824" height="810" alt="image" src="https://github.com/user-attachments/assets/5fe8e4e4-9338-4ced-9703-9703b49c4277" />

- –¢–æ–ø–æ–ª–æ–≥–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å–µ—Ç–∏  –∏ –î–ó –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–æ–≥–∞—é—Ç vlan —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –Ω–∞ —Ö–æ—Å—Ç–µ office1Router. –ü–æ—ç—Ç–æ–º—É —è –∑–∞–º–µ–Ω—é –µ–≥–æ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä portgroup trunking –≤ "VMware vSphere" (—Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–π –¥–µ–ª–∞—é –î–ó) –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–∞–∫–µ—Ç—ã –º–µ–∂–¥—É –í–ú –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∏—Å—å –ø–æ —Ç–µ–≥–∞–º (—Ä–∞–∑—Ä–µ—à–µ–Ω –≤–µ—Å—å –¥–∏–∞–ø–∞–∑–æ–Ω VLAN-–æ–≤). –ö –Ω–µ–º—É –ø–æ–¥–∫–ª—é—á—É —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã ens224. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã ens192 –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –≤ —Ä–µ–∂–∏–º–µ access –∫ –º–æ–µ–π —Ä–∞–±–æ—á–µ–π —Å–µ—Ç–∏, —Å—Ç–æ–±—ã –ª–µ–≥—á–µ –±—ã–ª–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∂–¥–æ–π –í–ú –ø–æ ssh (–Ω–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å, –æ—Ç–∫—É–¥–∞ —Å–ª–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑e–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã –≤ Github)
- ### –°—Ö–µ–º–∞ —Ç–µ–ø–µ—Ä—å –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
<img width="819" height="800" alt="Screenshot 2026-01-28 at 10 48 30" src="https://github.com/user-attachments/assets/30521413-33d1-413b-a9e4-b41515808365" />



- **root@*******:~# apt install -y vim traceroute tcpdump net-tools**
- **root@*******:~# cat /etc/netplan/50-cloud-init.yaml**
```bash
network:
  version: 2
  renderer: networkd

  ethernets:

    ens192:
      dhcp4: true 

    ens224:
      dhcp4: no
      addresses:
        - 10.10.10.1/24 # –¥–ª—è testServer1 testServer2
    –∏–ª–∏
        - 10.10.10.254/24 # –¥–ª—è testClient1 testClient2
```
- **root@*******:~# ip -br a** # –Ω–∞ –≤—Å–µ—Ö 4-—Ö –º–∞—à–∏–Ω–∞—Ö –ø–æ–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –∞–¥—Ä–µ—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```bash
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens192           UP             10.0.77.*/24 metric 100 fe80::250:56ff:feb3:7658/64
ens224           DOWN             10.10.10.254/24 fe80::250:56ff:feb3:1666/64
```
- **root@*******:~# ip link set dev ens224 up**  # –Ω–∞ –≤—Å–µ—Ö 4-—Ö –º–∞—à–∏–Ω–∞—Ö –ø–æ–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ
- ### –°–æ–∑–¥–∞–Ω–∏–µ VLAN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **root@testclient1:~# ip link add link ens224 name ens224.10 type vlan id 10**
- **root@testclient1:~# ip addr add 10.10.10.254/24 dev ens224.10**
- **root@testclient1:~# ip link set dev ens224.10 up**
- 
- **root@testserver1:~# ip link add link ens224 name ens224.10 type vlan id 10**
- **root@testserver1:~# ip addr add 10.10.10.1/24 dev ens224.10**
- **root@testserver1:~# ip link set dev ens224.10 up**
- 
- **root@testclient2:~# ip link add link ens224 name ens224.20 type vlan id 20**
- **root@testclient2:~# ip addr add 10.10.10.254/24 dev ens224.20**
- **root@testclient2:~# ip link set dev ens224.20 up**
- 
- **root@testserver2:~# ip link add link ens224 name ens224.20 type vlan id 20**
- **root@testserver2:~# ip addr add 10.10.10.1/24 dev ens224.20**
- **root@testserver2:~# ip link set dev ens224.20 up**

- **root@testclient1:~# ip -br a**
```bash
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens192           UP             10.0.77.156/24 metric 100 fe80::250:56ff:feb3:8557/64
ens224           UP
ens224.10@ens224 UP             10.10.10.254/24 fe80::250:56ff:feb3:42a3/64
```
- **root@testserver1:~# ip -br a**
```bash
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens192           UP             10.0.77.186/24 metric 100 fe80::250:56ff:feb3:7ee8/64
ens224           UP             fe80::250:56ff:feb3:a62/64
ens224.10@ens224 UP             10.10.10.1/24 fe80::250:56ff:feb3:a62/64
```
- **root@testclient2:~# ip -br a**
```bash
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens192           UP             10.0.77.170/24 metric 100 fe80::250:56ff:feb3:7658/64
ens224           UP
ens224.20@ens224 UP             10.10.10.254/24 fe80::250:56ff:feb3:1666/64
```
- **root@testserver2:~# ip -br a**
```bash
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens192           UP             10.0.77.182/24 metric 100 fe80::250:56ff:feb3:8745/64
ens224           UP             fe80::250:56ff:feb3:b7c7/64
ens224.20@ens224 UP             10.10.10.1/24 fe80::250:56ff:feb3:b7c7/64
```
